Connecting to database specified by database.yml
Connecting to database specified by database.yml
Connecting to database specified by database.yml
Creating scope :except. Overwriting existing method User.except.
PG::Error: ERROR:  relation "users" does not exist
LINE 5:              WHERE a.attrelid = '"users"'::regclass
                                        ^
:             SELECT a.attname, format_type(a.atttypid, a.atttypmod),
                     pg_get_expr(d.adbin, d.adrelid), a.attnotnull, a.atttypid, a.atttypmod
              FROM pg_attribute a LEFT JOIN pg_attrdef d
                ON a.attrelid = d.adrelid AND a.attnum = d.adnum
             WHERE a.attrelid = '"users"'::regclass
               AND a.attnum > 0 AND NOT a.attisdropped
             ORDER BY a.attnum

  [1m[36m (113.1ms)[0m  [1mDROP DATABASE IF EXISTS "ffcrm_vend_test"[0m
  [1m[35m (253.0ms)[0m  CREATE DATABASE "ffcrm_vend_test" ENCODING = 'utf8'
  [1m[36m (14.8ms)[0m  [1mCREATE TABLE "account_contacts" ("id" serial primary key, "account_id" integer, "contact_id" integer, "deleted_at" timestamp, "created_at" timestamp NOT NULL, "updated_at" timestamp NOT NULL) [0m
  [1m[35m (3.2ms)[0m  CREATE TABLE "account_opportunities" ("id" serial primary key, "account_id" integer, "opportunity_id" integer, "deleted_at" timestamp, "created_at" timestamp NOT NULL, "updated_at" timestamp NOT NULL) 
  [1m[36m (18.2ms)[0m  [1mCREATE TABLE "accounts" ("id" serial primary key, "user_id" integer, "assigned_to" integer, "name" character varying(64) DEFAULT '' NOT NULL, "access" character varying(8) DEFAULT 'Public', "website" character varying(64), "toll_free_phone" character varying(32), "phone" character varying(32), "fax" character varying(32), "deleted_at" timestamp, "created_at" timestamp NOT NULL, "updated_at" timestamp NOT NULL, "email" character varying(64), "background_info" character varying(255), "rating" integer DEFAULT 0 NOT NULL, "category" character varying(32), "subscribed_users" text) [0m
  [1m[35m (1.1ms)[0m  CREATE INDEX "index_accounts_on_assigned_to" ON "accounts" ("assigned_to")
  [1m[36m (1.7ms)[0m  [1mCREATE UNIQUE INDEX "index_accounts_on_user_id_and_name_and_deleted_at" ON "accounts" ("user_id", "name", "deleted_at")[0m
  [1m[35m (4.3ms)[0m  CREATE TABLE "activities" ("id" serial primary key, "user_id" integer, "subject_id" integer, "subject_type" character varying(255), "action" character varying(32) DEFAULT 'created', "info" character varying(255) DEFAULT '', "private" boolean DEFAULT 'f', "created_at" timestamp NOT NULL, "updated_at" timestamp NOT NULL) 
  [1m[36m (0.9ms)[0m  [1mCREATE INDEX "index_activities_on_created_at" ON "activities" ("created_at")[0m
  [1m[35m (12.5ms)[0m  CREATE INDEX "index_activities_on_user_id" ON "activities" ("user_id")
  [1m[36m (8.2ms)[0m  [1mCREATE TABLE "addresses" ("id" serial primary key, "street1" character varying(255), "street2" character varying(255), "city" character varying(64), "state" character varying(64), "zipcode" character varying(16), "country" character varying(64), "full_address" character varying(255), "address_type" character varying(16), "addressable_id" integer, "addressable_type" character varying(255), "created_at" timestamp NOT NULL, "updated_at" timestamp NOT NULL, "deleted_at" timestamp) [0m
  [1m[35m (0.9ms)[0m  CREATE INDEX "index_addresses_on_addressable_id_and_addressable_type" ON "addresses" ("addressable_id", "addressable_type")
  [1m[36m (5.2ms)[0m  [1mCREATE TABLE "avatars" ("id" serial primary key, "user_id" integer, "entity_id" integer, "entity_type" character varying(255), "image_file_size" integer, "image_file_name" character varying(255), "image_content_type" character varying(255), "created_at" timestamp NOT NULL, "updated_at" timestamp NOT NULL) [0m
  [1m[35m (4.3ms)[0m  CREATE TABLE "campaigns" ("id" serial primary key, "user_id" integer, "assigned_to" integer, "name" character varying(64) DEFAULT '' NOT NULL, "access" character varying(8) DEFAULT 'Public', "status" character varying(64), "budget" decimal(12,2), "target_leads" integer, "target_conversion" float, "target_revenue" decimal(12,2), "leads_count" integer, "opportunities_count" integer, "revenue" decimal(12,2), "starts_on" date, "ends_on" date, "objectives" text, "deleted_at" timestamp, "created_at" timestamp NOT NULL, "updated_at" timestamp NOT NULL, "background_info" character varying(255), "subscribed_users" text) 
  [1m[36m (9.0ms)[0m  [1mCREATE INDEX "index_campaigns_on_assigned_to" ON "campaigns" ("assigned_to")[0m
  [1m[35m (1.9ms)[0m  CREATE UNIQUE INDEX "index_campaigns_on_user_id_and_name_and_deleted_at" ON "campaigns" ("user_id", "name", "deleted_at")
  [1m[36m (4.4ms)[0m  [1mCREATE TABLE "comments" ("id" serial primary key, "user_id" integer, "commentable_id" integer, "commentable_type" character varying(255), "private" boolean, "title" character varying(255) DEFAULT '', "comment" text, "created_at" timestamp NOT NULL, "updated_at" timestamp NOT NULL, "state" character varying(16) DEFAULT 'Expanded' NOT NULL) [0m
  [1m[35m (3.1ms)[0m  CREATE TABLE "contact_opportunities" ("id" serial primary key, "contact_id" integer, "opportunity_id" integer, "role" character varying(32), "deleted_at" timestamp, "created_at" timestamp NOT NULL, "updated_at" timestamp NOT NULL) 
  [1m[36m (4.2ms)[0m  [1mCREATE TABLE "contacts" ("id" serial primary key, "user_id" integer, "lead_id" integer, "assigned_to" integer, "reports_to" integer, "first_name" character varying(64) DEFAULT '' NOT NULL, "last_name" character varying(64) DEFAULT '' NOT NULL, "access" character varying(8) DEFAULT 'Public', "title" character varying(64), "department" character varying(64), "source" character varying(32), "email" character varying(64), "alt_email" character varying(64), "phone" character varying(32), "mobile" character varying(32), "fax" character varying(32), "blog" character varying(128), "linkedin" character varying(128), "facebook" character varying(128), "twitter" character varying(128), "born_on" date, "do_not_call" boolean DEFAULT 'f' NOT NULL, "deleted_at" timestamp, "created_at" timestamp NOT NULL, "updated_at" timestamp NOT NULL, "background_info" character varying(255), "skype" character varying(128), "subscribed_users" text) [0m
  [1m[35m (1.1ms)[0m  CREATE INDEX "index_contacts_on_assigned_to" ON "contacts" ("assigned_to")
  [1m[36m (1.4ms)[0m  [1mCREATE UNIQUE INDEX "id_last_name_deleted" ON "contacts" ("user_id", "last_name", "deleted_at")[0m
  [1m[35m (4.8ms)[0m  CREATE TABLE "emails" ("id" serial primary key, "imap_message_id" character varying(255) NOT NULL, "user_id" integer, "mediator_id" integer, "mediator_type" character varying(255), "sent_from" character varying(255) NOT NULL, "sent_to" character varying(255) NOT NULL, "cc" character varying(255), "bcc" character varying(255), "subject" character varying(255), "body" text, "header" text, "sent_at" timestamp, "received_at" timestamp, "deleted_at" timestamp, "created_at" timestamp NOT NULL, "updated_at" timestamp NOT NULL, "state" character varying(16) DEFAULT 'Expanded' NOT NULL) 
  [1m[36m (1.3ms)[0m  [1mCREATE INDEX "index_emails_on_mediator_id_and_mediator_type" ON "emails" ("mediator_id", "mediator_type")[0m
  [1m[35m (3.5ms)[0m  CREATE TABLE "field_groups" ("id" serial primary key, "name" character varying(64), "label" character varying(128), "position" integer, "hint" character varying(255), "created_at" timestamp NOT NULL, "updated_at" timestamp NOT NULL, "tag_id" integer, "klass_name" character varying(32)) 
  [1m[36m (3.4ms)[0m  [1mCREATE TABLE "fields" ("id" serial primary key, "type" character varying(255), "field_group_id" integer, "position" integer, "name" character varying(64), "label" character varying(128), "hint" character varying(255), "placeholder" character varying(255), "as" character varying(32), "collection" text, "disabled" boolean, "required" boolean, "maxlength" integer, "created_at" timestamp NOT NULL, "updated_at" timestamp NOT NULL) [0m
  [1m[35m (0.9ms)[0m  CREATE INDEX "index_fields_on_field_group_id" ON "fields" ("field_group_id")
  [1m[36m (1.0ms)[0m  [1mCREATE INDEX "index_fields_on_name" ON "fields" ("name")[0m
  [1m[35m (4.7ms)[0m  CREATE TABLE "leads" ("id" serial primary key, "user_id" integer, "campaign_id" integer, "assigned_to" integer, "first_name" character varying(64) DEFAULT '' NOT NULL, "last_name" character varying(64) DEFAULT '' NOT NULL, "access" character varying(8) DEFAULT 'Public', "title" character varying(64), "company" character varying(64), "source" character varying(32), "status" character varying(32), "referred_by" character varying(64), "email" character varying(64), "alt_email" character varying(64), "phone" character varying(32), "mobile" character varying(32), "blog" character varying(128), "linkedin" character varying(128), "facebook" character varying(128), "twitter" character varying(128), "rating" integer DEFAULT 0 NOT NULL, "do_not_call" boolean DEFAULT 'f' NOT NULL, "deleted_at" timestamp, "created_at" timestamp NOT NULL, "updated_at" timestamp NOT NULL, "background_info" character varying(255), "skype" character varying(128), "subscribed_users" text) 
  [1m[36m (1.1ms)[0m  [1mCREATE INDEX "index_leads_on_assigned_to" ON "leads" ("assigned_to")[0m
  [1m[35m (1.4ms)[0m  CREATE UNIQUE INDEX "index_leads_on_user_id_and_last_name_and_deleted_at" ON "leads" ("user_id", "last_name", "deleted_at")
  [1m[36m (3.7ms)[0m  [1mCREATE TABLE "lists" ("id" serial primary key, "name" character varying(255), "url" text, "created_at" timestamp NOT NULL, "updated_at" timestamp NOT NULL) [0m
  [1m[35m (5.5ms)[0m  CREATE TABLE "opportunities" ("id" serial primary key, "user_id" integer, "campaign_id" integer, "assigned_to" integer, "name" character varying(64) DEFAULT '' NOT NULL, "access" character varying(8) DEFAULT 'Public', "source" character varying(32), "stage" character varying(32), "probability" integer, "amount" decimal(12,2), "discount" decimal(12,2), "closes_on" date, "deleted_at" timestamp, "created_at" timestamp NOT NULL, "updated_at" timestamp NOT NULL, "background_info" character varying(255), "subscribed_users" text) 
  [1m[36m (1.2ms)[0m  [1mCREATE INDEX "index_opportunities_on_assigned_to" ON "opportunities" ("assigned_to")[0m
  [1m[35m (1.1ms)[0m  CREATE UNIQUE INDEX "id_name_deleted" ON "opportunities" ("user_id", "name", "deleted_at")
  [1m[36m (3.4ms)[0m  [1mCREATE TABLE "permissions" ("id" serial primary key, "user_id" integer, "asset_id" integer, "asset_type" character varying(255), "created_at" timestamp NOT NULL, "updated_at" timestamp NOT NULL) [0m
  [1m[35m (1.0ms)[0m  CREATE INDEX "index_permissions_on_asset_id_and_asset_type" ON "permissions" ("asset_id", "asset_type")
  [1m[36m (1.0ms)[0m  [1mCREATE INDEX "index_permissions_on_user_id" ON "permissions" ("user_id")[0m
  [1m[35m (4.0ms)[0m  CREATE TABLE "preferences" ("id" serial primary key, "user_id" integer, "name" character varying(32) DEFAULT '' NOT NULL, "value" text, "created_at" timestamp NOT NULL, "updated_at" timestamp NOT NULL) 
  [1m[36m (0.9ms)[0m  [1mCREATE INDEX "index_preferences_on_user_id_and_name" ON "preferences" ("user_id", "name")[0m
  [1m[35m (2.9ms)[0m  CREATE TABLE "sessions" ("id" serial primary key, "session_id" character varying(255) NOT NULL, "data" text, "created_at" timestamp NOT NULL, "updated_at" timestamp NOT NULL) 
  [1m[36m (1.2ms)[0m  [1mCREATE INDEX "index_sessions_on_session_id" ON "sessions" ("session_id")[0m
  [1m[35m (1.0ms)[0m  CREATE INDEX "index_sessions_on_updated_at" ON "sessions" ("updated_at")
  [1m[36m (3.9ms)[0m  [1mCREATE TABLE "settings" ("id" serial primary key, "name" character varying(32) DEFAULT '' NOT NULL, "value" text, "created_at" timestamp NOT NULL, "updated_at" timestamp NOT NULL) [0m
  [1m[35m (1.2ms)[0m  CREATE INDEX "index_settings_on_name" ON "settings" ("name")
  [1m[36m (3.5ms)[0m  [1mCREATE TABLE "taggings" ("id" serial primary key, "tag_id" integer, "taggable_id" integer, "tagger_id" integer, "tagger_type" character varying(255), "taggable_type" character varying(255), "context" character varying(255), "created_at" timestamp) [0m
  [1m[35m (0.9ms)[0m  CREATE INDEX "index_taggings_on_tag_id" ON "taggings" ("tag_id")
  [1m[36m (1.7ms)[0m  [1mCREATE INDEX "index_taggings_on_taggable_id_and_taggable_type_and_context" ON "taggings" ("taggable_id", "taggable_type", "context")[0m
  [1m[35m (2.1ms)[0m  CREATE TABLE "tags" ("id" serial primary key, "name" character varying(255)) 
  [1m[36m (3.2ms)[0m  [1mCREATE TABLE "tasks" ("id" serial primary key, "user_id" integer, "assigned_to" integer, "completed_by" integer, "name" character varying(255) DEFAULT '' NOT NULL, "asset_id" integer, "asset_type" character varying(255), "priority" character varying(32), "category" character varying(32), "bucket" character varying(32), "due_at" timestamp, "completed_at" timestamp, "deleted_at" timestamp, "created_at" timestamp NOT NULL, "updated_at" timestamp NOT NULL, "background_info" character varying(255), "subscribed_users" text) [0m
  [1m[35m (0.9ms)[0m  CREATE INDEX "index_tasks_on_assigned_to" ON "tasks" ("assigned_to")
  [1m[36m (1.1ms)[0m  [1mCREATE UNIQUE INDEX "index_tasks_on_user_id_and_name_and_deleted_at" ON "tasks" ("user_id", "name", "deleted_at")[0m
  [1m[35m (6.1ms)[0m  CREATE TABLE "users" ("id" serial primary key, "username" character varying(32) DEFAULT '' NOT NULL, "email" character varying(64) DEFAULT '' NOT NULL, "first_name" character varying(32), "last_name" character varying(32), "title" character varying(64), "company" character varying(64), "alt_email" character varying(64), "phone" character varying(32), "mobile" character varying(32), "aim" character varying(32), "yahoo" character varying(32), "google" character varying(32), "skype" character varying(32), "password_hash" character varying(255) DEFAULT '' NOT NULL, "password_salt" character varying(255) DEFAULT '' NOT NULL, "persistence_token" character varying(255) DEFAULT '' NOT NULL, "perishable_token" character varying(255) DEFAULT '' NOT NULL, "last_request_at" timestamp, "last_login_at" timestamp, "current_login_at" timestamp, "last_login_ip" character varying(255), "current_login_ip" character varying(255), "login_count" integer DEFAULT 0 NOT NULL, "deleted_at" timestamp, "created_at" timestamp NOT NULL, "updated_at" timestamp NOT NULL, "admin" boolean DEFAULT 'f' NOT NULL, "suspended_at" timestamp, "single_access_token" character varying(255)) 
  [1m[36m (1.1ms)[0m  [1mCREATE INDEX "index_users_on_email" ON "users" ("email")[0m
  [1m[35m (1.2ms)[0m  CREATE INDEX "index_users_on_last_request_at" ON "users" ("last_request_at")
  [1m[36m (1.1ms)[0m  [1mCREATE INDEX "index_users_on_perishable_token" ON "users" ("perishable_token")[0m
  [1m[35m (1.1ms)[0m  CREATE INDEX "index_users_on_remember_token" ON "users" ("persistence_token")
  [1m[36m (10.6ms)[0m  [1mCREATE UNIQUE INDEX "index_users_on_username_and_deleted_at" ON "users" ("username", "deleted_at")[0m
  [1m[35m (11.3ms)[0m  CREATE TABLE "versions" ("id" serial primary key, "item_type" character varying(255) NOT NULL, "item_id" integer NOT NULL, "event" character varying(512) NOT NULL, "whodunnit" character varying(255), "object" text, "created_at" timestamp, "object_changes" text, "related_id" integer, "related_type" character varying(255)) 
  [1m[36m (1.3ms)[0m  [1mCREATE INDEX "index_versions_on_item_type_and_item_id" ON "versions" ("item_type", "item_id")[0m
  [1m[35m (1.1ms)[0m  CREATE INDEX "index_versions_on_whodunnit" ON "versions" ("whodunnit")
  [1m[36m (1.1ms)[0m  [1mCREATE TABLE "schema_migrations" ("version" character varying(255) NOT NULL) [0m
  [1m[35m (1.0ms)[0m  CREATE UNIQUE INDEX "unique_schema_migrations" ON "schema_migrations" ("version")
  [1m[36m (0.2ms)[0m  [1mSELECT version FROM "schema_migrations"[0m
  [1m[35m (0.4ms)[0m  INSERT INTO "schema_migrations" (version) VALUES ('20120528102124')
  [1m[36m (0.1ms)[0m  [1mBEGIN[0m
  [1m[35m (0.3ms)[0m  ROLLBACK
Connecting to database specified by database.yml
  [1m[36mFieldGroup Load (3.3ms)[0m  [1mSELECT "field_groups".* FROM "field_groups" WHERE "field_groups"."klass_name" = 'Account' ORDER BY position[0m
  [1m[35mFieldGroup Load (0.3ms)[0m  SELECT "field_groups".* FROM "field_groups" WHERE "field_groups"."klass_name" = 'Campaign' ORDER BY position
  [1m[36mFieldGroup Load (0.2ms)[0m  [1mSELECT "field_groups".* FROM "field_groups" WHERE "field_groups"."klass_name" = 'Contact' ORDER BY position[0m
  [1m[35mFieldGroup Load (0.3ms)[0m  SELECT "field_groups".* FROM "field_groups" WHERE "field_groups"."klass_name" = 'Lead' ORDER BY position
  [1m[36mFieldGroup Load (0.3ms)[0m  [1mSELECT "field_groups".* FROM "field_groups" WHERE "field_groups"."klass_name" = 'Opportunity' ORDER BY position[0m
  [1m[35mFieldGroup Load (0.3ms)[0m  SELECT "field_groups".* FROM "field_groups" WHERE "field_groups"."klass_name" = 'Task' ORDER BY position
Creating scope :except. Overwriting existing method User.except.
  [1m[36m (128.6ms)[0m  [1mDROP DATABASE IF EXISTS "ffcrm_vend_test"[0m
  [1m[35m (351.9ms)[0m  CREATE DATABASE "ffcrm_vend_test" ENCODING = 'utf8'
  [1m[36m (5.9ms)[0m  [1mCREATE TABLE "account_contacts" ("id" serial primary key, "account_id" integer, "contact_id" integer, "deleted_at" timestamp, "created_at" timestamp NOT NULL, "updated_at" timestamp NOT NULL) [0m
  [1m[35m (2.6ms)[0m  CREATE TABLE "account_opportunities" ("id" serial primary key, "account_id" integer, "opportunity_id" integer, "deleted_at" timestamp, "created_at" timestamp NOT NULL, "updated_at" timestamp NOT NULL) 
  [1m[36m (4.2ms)[0m  [1mCREATE TABLE "accounts" ("id" serial primary key, "user_id" integer, "assigned_to" integer, "name" character varying(64) DEFAULT '' NOT NULL, "access" character varying(8) DEFAULT 'Public', "website" character varying(64), "toll_free_phone" character varying(32), "phone" character varying(32), "fax" character varying(32), "deleted_at" timestamp, "created_at" timestamp NOT NULL, "updated_at" timestamp NOT NULL, "email" character varying(64), "background_info" character varying(255), "rating" integer DEFAULT 0 NOT NULL, "category" character varying(32), "subscribed_users" text) [0m
  [1m[35m (1.3ms)[0m  CREATE INDEX "index_accounts_on_assigned_to" ON "accounts" ("assigned_to")
  [1m[36m (1.3ms)[0m  [1mCREATE UNIQUE INDEX "index_accounts_on_user_id_and_name_and_deleted_at" ON "accounts" ("user_id", "name", "deleted_at")[0m
  [1m[35m (3.4ms)[0m  CREATE TABLE "activities" ("id" serial primary key, "user_id" integer, "subject_id" integer, "subject_type" character varying(255), "action" character varying(32) DEFAULT 'created', "info" character varying(255) DEFAULT '', "private" boolean DEFAULT 'f', "created_at" timestamp NOT NULL, "updated_at" timestamp NOT NULL) 
  [1m[36m (1.2ms)[0m  [1mCREATE INDEX "index_activities_on_created_at" ON "activities" ("created_at")[0m
  [1m[35m (1.0ms)[0m  CREATE INDEX "index_activities_on_user_id" ON "activities" ("user_id")
  [1m[36m (4.1ms)[0m  [1mCREATE TABLE "addresses" ("id" serial primary key, "street1" character varying(255), "street2" character varying(255), "city" character varying(64), "state" character varying(64), "zipcode" character varying(16), "country" character varying(64), "full_address" character varying(255), "address_type" character varying(16), "addressable_id" integer, "addressable_type" character varying(255), "created_at" timestamp NOT NULL, "updated_at" timestamp NOT NULL, "deleted_at" timestamp) [0m
  [1m[35m (1.1ms)[0m  CREATE INDEX "index_addresses_on_addressable_id_and_addressable_type" ON "addresses" ("addressable_id", "addressable_type")
  [1m[36m (3.7ms)[0m  [1mCREATE TABLE "avatars" ("id" serial primary key, "user_id" integer, "entity_id" integer, "entity_type" character varying(255), "image_file_size" integer, "image_file_name" character varying(255), "image_content_type" character varying(255), "created_at" timestamp NOT NULL, "updated_at" timestamp NOT NULL) [0m
  [1m[35m (5.1ms)[0m  CREATE TABLE "campaigns" ("id" serial primary key, "user_id" integer, "assigned_to" integer, "name" character varying(64) DEFAULT '' NOT NULL, "access" character varying(8) DEFAULT 'Public', "status" character varying(64), "budget" decimal(12,2), "target_leads" integer, "target_conversion" float, "target_revenue" decimal(12,2), "leads_count" integer, "opportunities_count" integer, "revenue" decimal(12,2), "starts_on" date, "ends_on" date, "objectives" text, "deleted_at" timestamp, "created_at" timestamp NOT NULL, "updated_at" timestamp NOT NULL, "background_info" character varying(255), "subscribed_users" text) 
  [1m[36m (1.1ms)[0m  [1mCREATE INDEX "index_campaigns_on_assigned_to" ON "campaigns" ("assigned_to")[0m
  [1m[35m (1.2ms)[0m  CREATE UNIQUE INDEX "index_campaigns_on_user_id_and_name_and_deleted_at" ON "campaigns" ("user_id", "name", "deleted_at")
  [1m[36m (24.1ms)[0m  [1mCREATE TABLE "comments" ("id" serial primary key, "user_id" integer, "commentable_id" integer, "commentable_type" character varying(255), "private" boolean, "title" character varying(255) DEFAULT '', "comment" text, "created_at" timestamp NOT NULL, "updated_at" timestamp NOT NULL, "state" character varying(16) DEFAULT 'Expanded' NOT NULL) [0m
  [1m[35m (3.9ms)[0m  CREATE TABLE "contact_opportunities" ("id" serial primary key, "contact_id" integer, "opportunity_id" integer, "role" character varying(32), "deleted_at" timestamp, "created_at" timestamp NOT NULL, "updated_at" timestamp NOT NULL) 
  [1m[36m (5.6ms)[0m  [1mCREATE TABLE "contacts" ("id" serial primary key, "user_id" integer, "lead_id" integer, "assigned_to" integer, "reports_to" integer, "first_name" character varying(64) DEFAULT '' NOT NULL, "last_name" character varying(64) DEFAULT '' NOT NULL, "access" character varying(8) DEFAULT 'Public', "title" character varying(64), "department" character varying(64), "source" character varying(32), "email" character varying(64), "alt_email" character varying(64), "phone" character varying(32), "mobile" character varying(32), "fax" character varying(32), "blog" character varying(128), "linkedin" character varying(128), "facebook" character varying(128), "twitter" character varying(128), "born_on" date, "do_not_call" boolean DEFAULT 'f' NOT NULL, "deleted_at" timestamp, "created_at" timestamp NOT NULL, "updated_at" timestamp NOT NULL, "background_info" character varying(255), "skype" character varying(128), "subscribed_users" text) [0m
  [1m[35m (7.1ms)[0m  CREATE INDEX "index_contacts_on_assigned_to" ON "contacts" ("assigned_to")
  [1m[36m (2.0ms)[0m  [1mCREATE UNIQUE INDEX "id_last_name_deleted" ON "contacts" ("user_id", "last_name", "deleted_at")[0m
  [1m[35m (4.5ms)[0m  CREATE TABLE "emails" ("id" serial primary key, "imap_message_id" character varying(255) NOT NULL, "user_id" integer, "mediator_id" integer, "mediator_type" character varying(255), "sent_from" character varying(255) NOT NULL, "sent_to" character varying(255) NOT NULL, "cc" character varying(255), "bcc" character varying(255), "subject" character varying(255), "body" text, "header" text, "sent_at" timestamp, "received_at" timestamp, "deleted_at" timestamp, "created_at" timestamp NOT NULL, "updated_at" timestamp NOT NULL, "state" character varying(16) DEFAULT 'Expanded' NOT NULL) 
  [1m[36m (1.2ms)[0m  [1mCREATE INDEX "index_emails_on_mediator_id_and_mediator_type" ON "emails" ("mediator_id", "mediator_type")[0m
  [1m[35m (3.3ms)[0m  CREATE TABLE "field_groups" ("id" serial primary key, "name" character varying(64), "label" character varying(128), "position" integer, "hint" character varying(255), "created_at" timestamp NOT NULL, "updated_at" timestamp NOT NULL, "tag_id" integer, "klass_name" character varying(32)) 
  [1m[36m (16.5ms)[0m  [1mCREATE TABLE "fields" ("id" serial primary key, "type" character varying(255), "field_group_id" integer, "position" integer, "name" character varying(64), "label" character varying(128), "hint" character varying(255), "placeholder" character varying(255), "as" character varying(32), "collection" text, "disabled" boolean, "required" boolean, "maxlength" integer, "created_at" timestamp NOT NULL, "updated_at" timestamp NOT NULL) [0m
  [1m[35m (1.0ms)[0m  CREATE INDEX "index_fields_on_field_group_id" ON "fields" ("field_group_id")
  [1m[36m (5.4ms)[0m  [1mCREATE INDEX "index_fields_on_name" ON "fields" ("name")[0m
  [1m[35m (5.2ms)[0m  CREATE TABLE "leads" ("id" serial primary key, "user_id" integer, "campaign_id" integer, "assigned_to" integer, "first_name" character varying(64) DEFAULT '' NOT NULL, "last_name" character varying(64) DEFAULT '' NOT NULL, "access" character varying(8) DEFAULT 'Public', "title" character varying(64), "company" character varying(64), "source" character varying(32), "status" character varying(32), "referred_by" character varying(64), "email" character varying(64), "alt_email" character varying(64), "phone" character varying(32), "mobile" character varying(32), "blog" character varying(128), "linkedin" character varying(128), "facebook" character varying(128), "twitter" character varying(128), "rating" integer DEFAULT 0 NOT NULL, "do_not_call" boolean DEFAULT 'f' NOT NULL, "deleted_at" timestamp, "created_at" timestamp NOT NULL, "updated_at" timestamp NOT NULL, "background_info" character varying(255), "skype" character varying(128), "subscribed_users" text) 
  [1m[36m (1.2ms)[0m  [1mCREATE INDEX "index_leads_on_assigned_to" ON "leads" ("assigned_to")[0m
  [1m[35m (1.3ms)[0m  CREATE UNIQUE INDEX "index_leads_on_user_id_and_last_name_and_deleted_at" ON "leads" ("user_id", "last_name", "deleted_at")
  [1m[36m (3.7ms)[0m  [1mCREATE TABLE "lists" ("id" serial primary key, "name" character varying(255), "url" text, "created_at" timestamp NOT NULL, "updated_at" timestamp NOT NULL) [0m
  [1m[35m (4.3ms)[0m  CREATE TABLE "opportunities" ("id" serial primary key, "user_id" integer, "campaign_id" integer, "assigned_to" integer, "name" character varying(64) DEFAULT '' NOT NULL, "access" character varying(8) DEFAULT 'Public', "source" character varying(32), "stage" character varying(32), "probability" integer, "amount" decimal(12,2), "discount" decimal(12,2), "closes_on" date, "deleted_at" timestamp, "created_at" timestamp NOT NULL, "updated_at" timestamp NOT NULL, "background_info" character varying(255), "subscribed_users" text) 
  [1m[36m (0.8ms)[0m  [1mCREATE INDEX "index_opportunities_on_assigned_to" ON "opportunities" ("assigned_to")[0m
  [1m[35m (1.0ms)[0m  CREATE UNIQUE INDEX "id_name_deleted" ON "opportunities" ("user_id", "name", "deleted_at")
  [1m[36m (2.2ms)[0m  [1mCREATE TABLE "permissions" ("id" serial primary key, "user_id" integer, "asset_id" integer, "asset_type" character varying(255), "created_at" timestamp NOT NULL, "updated_at" timestamp NOT NULL) [0m
  [1m[35m (1.0ms)[0m  CREATE INDEX "index_permissions_on_asset_id_and_asset_type" ON "permissions" ("asset_id", "asset_type")
  [1m[36m (0.8ms)[0m  [1mCREATE INDEX "index_permissions_on_user_id" ON "permissions" ("user_id")[0m
  [1m[35m (4.1ms)[0m  CREATE TABLE "preferences" ("id" serial primary key, "user_id" integer, "name" character varying(32) DEFAULT '' NOT NULL, "value" text, "created_at" timestamp NOT NULL, "updated_at" timestamp NOT NULL) 
  [1m[36m (0.9ms)[0m  [1mCREATE INDEX "index_preferences_on_user_id_and_name" ON "preferences" ("user_id", "name")[0m
  [1m[35m (3.9ms)[0m  CREATE TABLE "sessions" ("id" serial primary key, "session_id" character varying(255) NOT NULL, "data" text, "created_at" timestamp NOT NULL, "updated_at" timestamp NOT NULL) 
  [1m[36m (0.8ms)[0m  [1mCREATE INDEX "index_sessions_on_session_id" ON "sessions" ("session_id")[0m
  [1m[35m (1.0ms)[0m  CREATE INDEX "index_sessions_on_updated_at" ON "sessions" ("updated_at")
  [1m[36m (3.6ms)[0m  [1mCREATE TABLE "settings" ("id" serial primary key, "name" character varying(32) DEFAULT '' NOT NULL, "value" text, "created_at" timestamp NOT NULL, "updated_at" timestamp NOT NULL) [0m
  [1m[35m (1.0ms)[0m  CREATE INDEX "index_settings_on_name" ON "settings" ("name")
  [1m[36m (4.6ms)[0m  [1mCREATE TABLE "taggings" ("id" serial primary key, "tag_id" integer, "taggable_id" integer, "tagger_id" integer, "tagger_type" character varying(255), "taggable_type" character varying(255), "context" character varying(255), "created_at" timestamp) [0m
  [1m[35m (0.9ms)[0m  CREATE INDEX "index_taggings_on_tag_id" ON "taggings" ("tag_id")
  [1m[36m (1.2ms)[0m  [1mCREATE INDEX "index_taggings_on_taggable_id_and_taggable_type_and_context" ON "taggings" ("taggable_id", "taggable_type", "context")[0m
  [1m[35m (2.9ms)[0m  CREATE TABLE "tags" ("id" serial primary key, "name" character varying(255)) 
  [1m[36m (4.3ms)[0m  [1mCREATE TABLE "tasks" ("id" serial primary key, "user_id" integer, "assigned_to" integer, "completed_by" integer, "name" character varying(255) DEFAULT '' NOT NULL, "asset_id" integer, "asset_type" character varying(255), "priority" character varying(32), "category" character varying(32), "bucket" character varying(32), "due_at" timestamp, "completed_at" timestamp, "deleted_at" timestamp, "created_at" timestamp NOT NULL, "updated_at" timestamp NOT NULL, "background_info" character varying(255), "subscribed_users" text) [0m
  [1m[35m (1.4ms)[0m  CREATE INDEX "index_tasks_on_assigned_to" ON "tasks" ("assigned_to")
  [1m[36m (1.3ms)[0m  [1mCREATE UNIQUE INDEX "index_tasks_on_user_id_and_name_and_deleted_at" ON "tasks" ("user_id", "name", "deleted_at")[0m
  [1m[35m (5.2ms)[0m  CREATE TABLE "users" ("id" serial primary key, "username" character varying(32) DEFAULT '' NOT NULL, "email" character varying(64) DEFAULT '' NOT NULL, "first_name" character varying(32), "last_name" character varying(32), "title" character varying(64), "company" character varying(64), "alt_email" character varying(64), "phone" character varying(32), "mobile" character varying(32), "aim" character varying(32), "yahoo" character varying(32), "google" character varying(32), "skype" character varying(32), "password_hash" character varying(255) DEFAULT '' NOT NULL, "password_salt" character varying(255) DEFAULT '' NOT NULL, "persistence_token" character varying(255) DEFAULT '' NOT NULL, "perishable_token" character varying(255) DEFAULT '' NOT NULL, "last_request_at" timestamp, "last_login_at" timestamp, "current_login_at" timestamp, "last_login_ip" character varying(255), "current_login_ip" character varying(255), "login_count" integer DEFAULT 0 NOT NULL, "deleted_at" timestamp, "created_at" timestamp NOT NULL, "updated_at" timestamp NOT NULL, "admin" boolean DEFAULT 'f' NOT NULL, "suspended_at" timestamp, "single_access_token" character varying(255)) 
  [1m[36m (1.0ms)[0m  [1mCREATE INDEX "index_users_on_email" ON "users" ("email")[0m
  [1m[35m (1.1ms)[0m  CREATE INDEX "index_users_on_last_request_at" ON "users" ("last_request_at")
  [1m[36m (1.0ms)[0m  [1mCREATE INDEX "index_users_on_perishable_token" ON "users" ("perishable_token")[0m
  [1m[35m (1.1ms)[0m  CREATE INDEX "index_users_on_remember_token" ON "users" ("persistence_token")
  [1m[36m (1.3ms)[0m  [1mCREATE UNIQUE INDEX "index_users_on_username_and_deleted_at" ON "users" ("username", "deleted_at")[0m
  [1m[35m (4.4ms)[0m  CREATE TABLE "versions" ("id" serial primary key, "item_type" character varying(255) NOT NULL, "item_id" integer NOT NULL, "event" character varying(512) NOT NULL, "whodunnit" character varying(255), "object" text, "created_at" timestamp, "object_changes" text, "related_id" integer, "related_type" character varying(255)) 
  [1m[36m (1.0ms)[0m  [1mCREATE INDEX "index_versions_on_item_type_and_item_id" ON "versions" ("item_type", "item_id")[0m
  [1m[35m (0.9ms)[0m  CREATE INDEX "index_versions_on_whodunnit" ON "versions" ("whodunnit")
  [1m[36m (1.1ms)[0m  [1mCREATE TABLE "schema_migrations" ("version" character varying(255) NOT NULL) [0m
  [1m[35m (1.0ms)[0m  CREATE UNIQUE INDEX "unique_schema_migrations" ON "schema_migrations" ("version")
  [1m[36m (0.3ms)[0m  [1mSELECT version FROM "schema_migrations"[0m
  [1m[35m (0.4ms)[0m  INSERT INTO "schema_migrations" (version) VALUES ('20120528102124')
  [1m[36m (0.2ms)[0m  [1mBEGIN[0m
Started POST "/vend/register_sale" for 127.0.0.1 at 2013-03-05 23:23:38 +1300
Processing by VendController#register_sale as HTML
  Parameters: {"\n    {\n        \"id\": \"5e8b5134-a002-dd6b-b7c7-26126887c4ee\",\n        \"sale_date\": \"2012-11-13 16:40:06\",\n        \"status\": \"CLOSED\",\n        \"user_id\": \"9b2a8d5f-2d20-11e2-8057-080027706aa2\",\n        \"customer_id\": \"9b17ac9d-2d20-11e2-8057-080027706aa2\",\n        \"register_id\": \"9af85e69-2d20-11e2-8057-080027706aa2\",\n        \"market_id\": \"1\",\n        \"invoice_number\": \"144\",\n        \"short_code\": \"ne2zq\",\n        \"totals\": {\n            \"total_price\": \"4.87\",\n            \"total_tax\": \"0.69\",\n            \"total_payment\": \"5.55\",\n            \"total_to_pay\": \"0\"\n        },\n        \"note\": null,\n        \"updated_at\": \"2012-11-13 16:40:09\",\n        \"created_at\": \"2012-11-13 16:40:09\",\n        \"customer\": {\n            \"id\": \"9b17ac9d-2d20-11e2-8057-080027706aa2\",\n            \"customer_code\": \"WALKIN\",\n            \"balance\": \"-6.250\",\n            \"points\": 0,\n            \"note\": null,\n            \"year_to_date\": \"79945.92188\",\n            \"sex\": \"M\",\n            \"date_of_birth\": \"1950-05-25\",\n            \"updated_at\": \"2012-11-13 16:43:15\",\n            \"created_at\": \"2012-11-13 12:28:03\"\n        },\n        \"user\": {\n            \"id\": \"9b2a8d5f-2d20-11e2-8057-080027706aa2\",\n            \"name\": \"admin\",\n            \"display_name\": \"A admin this time\",\n            \"outlet_id\": \"9ae97219-2d20-11e2-8057-080027706aa2\",\n            \"target_daily\": null,\n            \"target_weekly\": null,\n            \"target_monthly\": null,\n            \"created_at\": \"2011-09-08 05:18:38\",\n            \"updated_at\": \"2011-09-08 05:18:38\"\n        },\n        \"register_sale_products\": "=>{"\n        {\n            \"id\": \"148793f0-475a-7d49-442d-fd761ce76339\",\n            \"product_id\": \"9fe945bc-2d20-11e2-8057-080027706aa2\",\n            \"quantity\": 1,\n            \"price\": \"1.90\",\n            \"price_set\": true,\n            \"tax\": \"0.24\",\n            \"price_total\": \"1.9\",\n            \"tax_total\": \"0.24\",\n            \"tax_id\": \"9a025ff0-2d20-11e2-8057-080027706aa2\",\n            \"tax_name\": \"NZ GST\",\n            \"tax_rate\": \"0.150000\"\n        },\n        {\n            \"id\": \"7d37dc0f-9462-06fa-cae0-0b4988b36539\",\n            \"product_id\": \"a0c0df02-2d20-11e2-8057-080027706aa2\",\n            \"quantity\": 3,\n            \"price\": \"0.99\",\n            \"price_set\": true,\n            \"tax\": \"0.15\",\n            \"price_total\": \"2.97\",\n            \"tax_total\": \"0.45\",\n            \"tax_id\": \"9a025ff0-2d20-11e2-8057-080027706aa2\",\n            \"tax_name\": \"NZ GST\",\n            \"tax_rate\": \"0.150000\"\n        }"=>{",\n        \"register_sale_payments\": "=>{"\n        {\n            \"id\": \"39948e3e-bf93-1b60-ff44-f46a777ed1d4\",\n            \"payment_date\": \"2012-11-13 16:40:06\",\n            \"amount\": \"5.55\",\n            \"retailer_payment_type_id\": \"9e9ba1ba-2d20-11e2-8057-080027706aa2\",\n            \"payment_type_id\": \"1\"\n        }"=>{"\n    }\n  "=>nil}}}}}
Completed 500 Internal Server Error in 73ms
  [1m[35m (0.3ms)[0m  ROLLBACK
  [1m[36m (0.1ms)[0m  [1mBEGIN[0m
  [1m[35m (0.1ms)[0m  ROLLBACK
Connecting to database specified by database.yml
Connecting to database specified by database.yml
  [1m[36mFieldGroup Load (1.2ms)[0m  [1mSELECT "field_groups".* FROM "field_groups" WHERE "field_groups"."klass_name" = 'Account' ORDER BY position[0m
  [1m[35mFieldGroup Load (0.3ms)[0m  SELECT "field_groups".* FROM "field_groups" WHERE "field_groups"."klass_name" = 'Campaign' ORDER BY position
  [1m[36mFieldGroup Load (0.3ms)[0m  [1mSELECT "field_groups".* FROM "field_groups" WHERE "field_groups"."klass_name" = 'Contact' ORDER BY position[0m
  [1m[35mFieldGroup Load (0.3ms)[0m  SELECT "field_groups".* FROM "field_groups" WHERE "field_groups"."klass_name" = 'Lead' ORDER BY position
  [1m[36mFieldGroup Load (0.3ms)[0m  [1mSELECT "field_groups".* FROM "field_groups" WHERE "field_groups"."klass_name" = 'Opportunity' ORDER BY position[0m
  [1m[35mFieldGroup Load (0.3ms)[0m  SELECT "field_groups".* FROM "field_groups" WHERE "field_groups"."klass_name" = 'Task' ORDER BY position
Creating scope :except. Overwriting existing method User.except.
  [1m[36m (127.3ms)[0m  [1mDROP DATABASE IF EXISTS "ffcrm_vend_test"[0m
  [1m[35m (244.0ms)[0m  CREATE DATABASE "ffcrm_vend_test" ENCODING = 'utf8'
  [1m[36m (5.9ms)[0m  [1mCREATE TABLE "account_contacts" ("id" serial primary key, "account_id" integer, "contact_id" integer, "deleted_at" timestamp, "created_at" timestamp NOT NULL, "updated_at" timestamp NOT NULL) [0m
  [1m[35m (2.6ms)[0m  CREATE TABLE "account_opportunities" ("id" serial primary key, "account_id" integer, "opportunity_id" integer, "deleted_at" timestamp, "created_at" timestamp NOT NULL, "updated_at" timestamp NOT NULL) 
  [1m[36m (5.1ms)[0m  [1mCREATE TABLE "accounts" ("id" serial primary key, "user_id" integer, "assigned_to" integer, "name" character varying(64) DEFAULT '' NOT NULL, "access" character varying(8) DEFAULT 'Public', "website" character varying(64), "toll_free_phone" character varying(32), "phone" character varying(32), "fax" character varying(32), "deleted_at" timestamp, "created_at" timestamp NOT NULL, "updated_at" timestamp NOT NULL, "email" character varying(64), "background_info" character varying(255), "rating" integer DEFAULT 0 NOT NULL, "category" character varying(32), "subscribed_users" text) [0m
  [1m[35m (1.1ms)[0m  CREATE INDEX "index_accounts_on_assigned_to" ON "accounts" ("assigned_to")
  [1m[36m (1.8ms)[0m  [1mCREATE UNIQUE INDEX "index_accounts_on_user_id_and_name_and_deleted_at" ON "accounts" ("user_id", "name", "deleted_at")[0m
  [1m[35m (4.2ms)[0m  CREATE TABLE "activities" ("id" serial primary key, "user_id" integer, "subject_id" integer, "subject_type" character varying(255), "action" character varying(32) DEFAULT 'created', "info" character varying(255) DEFAULT '', "private" boolean DEFAULT 'f', "created_at" timestamp NOT NULL, "updated_at" timestamp NOT NULL) 
  [1m[36m (0.9ms)[0m  [1mCREATE INDEX "index_activities_on_created_at" ON "activities" ("created_at")[0m
  [1m[35m (1.0ms)[0m  CREATE INDEX "index_activities_on_user_id" ON "activities" ("user_id")
  [1m[36m (3.8ms)[0m  [1mCREATE TABLE "addresses" ("id" serial primary key, "street1" character varying(255), "street2" character varying(255), "city" character varying(64), "state" character varying(64), "zipcode" character varying(16), "country" character varying(64), "full_address" character varying(255), "address_type" character varying(16), "addressable_id" integer, "addressable_type" character varying(255), "created_at" timestamp NOT NULL, "updated_at" timestamp NOT NULL, "deleted_at" timestamp) [0m
  [1m[35m (1.0ms)[0m  CREATE INDEX "index_addresses_on_addressable_id_and_addressable_type" ON "addresses" ("addressable_id", "addressable_type")
  [1m[36m (4.0ms)[0m  [1mCREATE TABLE "avatars" ("id" serial primary key, "user_id" integer, "entity_id" integer, "entity_type" character varying(255), "image_file_size" integer, "image_file_name" character varying(255), "image_content_type" character varying(255), "created_at" timestamp NOT NULL, "updated_at" timestamp NOT NULL) [0m
  [1m[35m (5.0ms)[0m  CREATE TABLE "campaigns" ("id" serial primary key, "user_id" integer, "assigned_to" integer, "name" character varying(64) DEFAULT '' NOT NULL, "access" character varying(8) DEFAULT 'Public', "status" character varying(64), "budget" decimal(12,2), "target_leads" integer, "target_conversion" float, "target_revenue" decimal(12,2), "leads_count" integer, "opportunities_count" integer, "revenue" decimal(12,2), "starts_on" date, "ends_on" date, "objectives" text, "deleted_at" timestamp, "created_at" timestamp NOT NULL, "updated_at" timestamp NOT NULL, "background_info" character varying(255), "subscribed_users" text) 
  [1m[36m (1.0ms)[0m  [1mCREATE INDEX "index_campaigns_on_assigned_to" ON "campaigns" ("assigned_to")[0m
  [1m[35m (1.1ms)[0m  CREATE UNIQUE INDEX "index_campaigns_on_user_id_and_name_and_deleted_at" ON "campaigns" ("user_id", "name", "deleted_at")
  [1m[36m (4.2ms)[0m  [1mCREATE TABLE "comments" ("id" serial primary key, "user_id" integer, "commentable_id" integer, "commentable_type" character varying(255), "private" boolean, "title" character varying(255) DEFAULT '', "comment" text, "created_at" timestamp NOT NULL, "updated_at" timestamp NOT NULL, "state" character varying(16) DEFAULT 'Expanded' NOT NULL) [0m
  [1m[35m (2.6ms)[0m  CREATE TABLE "contact_opportunities" ("id" serial primary key, "contact_id" integer, "opportunity_id" integer, "role" character varying(32), "deleted_at" timestamp, "created_at" timestamp NOT NULL, "updated_at" timestamp NOT NULL) 
  [1m[36m (5.1ms)[0m  [1mCREATE TABLE "contacts" ("id" serial primary key, "user_id" integer, "lead_id" integer, "assigned_to" integer, "reports_to" integer, "first_name" character varying(64) DEFAULT '' NOT NULL, "last_name" character varying(64) DEFAULT '' NOT NULL, "access" character varying(8) DEFAULT 'Public', "title" character varying(64), "department" character varying(64), "source" character varying(32), "email" character varying(64), "alt_email" character varying(64), "phone" character varying(32), "mobile" character varying(32), "fax" character varying(32), "blog" character varying(128), "linkedin" character varying(128), "facebook" character varying(128), "twitter" character varying(128), "born_on" date, "do_not_call" boolean DEFAULT 'f' NOT NULL, "deleted_at" timestamp, "created_at" timestamp NOT NULL, "updated_at" timestamp NOT NULL, "background_info" character varying(255), "skype" character varying(128), "subscribed_users" text) [0m
  [1m[35m (1.0ms)[0m  CREATE INDEX "index_contacts_on_assigned_to" ON "contacts" ("assigned_to")
  [1m[36m (1.1ms)[0m  [1mCREATE UNIQUE INDEX "id_last_name_deleted" ON "contacts" ("user_id", "last_name", "deleted_at")[0m
  [1m[35m (4.0ms)[0m  CREATE TABLE "emails" ("id" serial primary key, "imap_message_id" character varying(255) NOT NULL, "user_id" integer, "mediator_id" integer, "mediator_type" character varying(255), "sent_from" character varying(255) NOT NULL, "sent_to" character varying(255) NOT NULL, "cc" character varying(255), "bcc" character varying(255), "subject" character varying(255), "body" text, "header" text, "sent_at" timestamp, "received_at" timestamp, "deleted_at" timestamp, "created_at" timestamp NOT NULL, "updated_at" timestamp NOT NULL, "state" character varying(16) DEFAULT 'Expanded' NOT NULL) 
  [1m[36m (1.0ms)[0m  [1mCREATE INDEX "index_emails_on_mediator_id_and_mediator_type" ON "emails" ("mediator_id", "mediator_type")[0m
  [1m[35m (3.2ms)[0m  CREATE TABLE "field_groups" ("id" serial primary key, "name" character varying(64), "label" character varying(128), "position" integer, "hint" character varying(255), "created_at" timestamp NOT NULL, "updated_at" timestamp NOT NULL, "tag_id" integer, "klass_name" character varying(32)) 
  [1m[36m (4.0ms)[0m  [1mCREATE TABLE "fields" ("id" serial primary key, "type" character varying(255), "field_group_id" integer, "position" integer, "name" character varying(64), "label" character varying(128), "hint" character varying(255), "placeholder" character varying(255), "as" character varying(32), "collection" text, "disabled" boolean, "required" boolean, "maxlength" integer, "created_at" timestamp NOT NULL, "updated_at" timestamp NOT NULL) [0m
  [1m[35m (0.9ms)[0m  CREATE INDEX "index_fields_on_field_group_id" ON "fields" ("field_group_id")
  [1m[36m (0.8ms)[0m  [1mCREATE INDEX "index_fields_on_name" ON "fields" ("name")[0m
  [1m[35m (4.8ms)[0m  CREATE TABLE "leads" ("id" serial primary key, "user_id" integer, "campaign_id" integer, "assigned_to" integer, "first_name" character varying(64) DEFAULT '' NOT NULL, "last_name" character varying(64) DEFAULT '' NOT NULL, "access" character varying(8) DEFAULT 'Public', "title" character varying(64), "company" character varying(64), "source" character varying(32), "status" character varying(32), "referred_by" character varying(64), "email" character varying(64), "alt_email" character varying(64), "phone" character varying(32), "mobile" character varying(32), "blog" character varying(128), "linkedin" character varying(128), "facebook" character varying(128), "twitter" character varying(128), "rating" integer DEFAULT 0 NOT NULL, "do_not_call" boolean DEFAULT 'f' NOT NULL, "deleted_at" timestamp, "created_at" timestamp NOT NULL, "updated_at" timestamp NOT NULL, "background_info" character varying(255), "skype" character varying(128), "subscribed_users" text) 
  [1m[36m (1.0ms)[0m  [1mCREATE INDEX "index_leads_on_assigned_to" ON "leads" ("assigned_to")[0m
  [1m[35m (10.7ms)[0m  CREATE UNIQUE INDEX "index_leads_on_user_id_and_last_name_and_deleted_at" ON "leads" ("user_id", "last_name", "deleted_at")
  [1m[36m (10.8ms)[0m  [1mCREATE TABLE "lists" ("id" serial primary key, "name" character varying(255), "url" text, "created_at" timestamp NOT NULL, "updated_at" timestamp NOT NULL) [0m
  [1m[35m (4.5ms)[0m  CREATE TABLE "opportunities" ("id" serial primary key, "user_id" integer, "campaign_id" integer, "assigned_to" integer, "name" character varying(64) DEFAULT '' NOT NULL, "access" character varying(8) DEFAULT 'Public', "source" character varying(32), "stage" character varying(32), "probability" integer, "amount" decimal(12,2), "discount" decimal(12,2), "closes_on" date, "deleted_at" timestamp, "created_at" timestamp NOT NULL, "updated_at" timestamp NOT NULL, "background_info" character varying(255), "subscribed_users" text) 
  [1m[36m (1.2ms)[0m  [1mCREATE INDEX "index_opportunities_on_assigned_to" ON "opportunities" ("assigned_to")[0m
  [1m[35m (1.2ms)[0m  CREATE UNIQUE INDEX "id_name_deleted" ON "opportunities" ("user_id", "name", "deleted_at")
  [1m[36m (2.7ms)[0m  [1mCREATE TABLE "permissions" ("id" serial primary key, "user_id" integer, "asset_id" integer, "asset_type" character varying(255), "created_at" timestamp NOT NULL, "updated_at" timestamp NOT NULL) [0m
  [1m[35m (8.5ms)[0m  CREATE INDEX "index_permissions_on_asset_id_and_asset_type" ON "permissions" ("asset_id", "asset_type")
  [1m[36m (6.4ms)[0m  [1mCREATE INDEX "index_permissions_on_user_id" ON "permissions" ("user_id")[0m
  [1m[35m (4.1ms)[0m  CREATE TABLE "preferences" ("id" serial primary key, "user_id" integer, "name" character varying(32) DEFAULT '' NOT NULL, "value" text, "created_at" timestamp NOT NULL, "updated_at" timestamp NOT NULL) 
  [1m[36m (1.1ms)[0m  [1mCREATE INDEX "index_preferences_on_user_id_and_name" ON "preferences" ("user_id", "name")[0m
  [1m[35m (2.9ms)[0m  CREATE TABLE "sessions" ("id" serial primary key, "session_id" character varying(255) NOT NULL, "data" text, "created_at" timestamp NOT NULL, "updated_at" timestamp NOT NULL) 
  [1m[36m (1.1ms)[0m  [1mCREATE INDEX "index_sessions_on_session_id" ON "sessions" ("session_id")[0m
  [1m[35m (1.0ms)[0m  CREATE INDEX "index_sessions_on_updated_at" ON "sessions" ("updated_at")
  [1m[36m (17.6ms)[0m  [1mCREATE TABLE "settings" ("id" serial primary key, "name" character varying(32) DEFAULT '' NOT NULL, "value" text, "created_at" timestamp NOT NULL, "updated_at" timestamp NOT NULL) [0m
  [1m[35m (1.2ms)[0m  CREATE INDEX "index_settings_on_name" ON "settings" ("name")
  [1m[36m (5.1ms)[0m  [1mCREATE TABLE "taggings" ("id" serial primary key, "tag_id" integer, "taggable_id" integer, "tagger_id" integer, "tagger_type" character varying(255), "taggable_type" character varying(255), "context" character varying(255), "created_at" timestamp) [0m
  [1m[35m (1.1ms)[0m  CREATE INDEX "index_taggings_on_tag_id" ON "taggings" ("tag_id")
  [1m[36m (1.2ms)[0m  [1mCREATE INDEX "index_taggings_on_taggable_id_and_taggable_type_and_context" ON "taggings" ("taggable_id", "taggable_type", "context")[0m
  [1m[35m (2.6ms)[0m  CREATE TABLE "tags" ("id" serial primary key, "name" character varying(255)) 
  [1m[36m (4.3ms)[0m  [1mCREATE TABLE "tasks" ("id" serial primary key, "user_id" integer, "assigned_to" integer, "completed_by" integer, "name" character varying(255) DEFAULT '' NOT NULL, "asset_id" integer, "asset_type" character varying(255), "priority" character varying(32), "category" character varying(32), "bucket" character varying(32), "due_at" timestamp, "completed_at" timestamp, "deleted_at" timestamp, "created_at" timestamp NOT NULL, "updated_at" timestamp NOT NULL, "background_info" character varying(255), "subscribed_users" text) [0m
  [1m[35m (1.0ms)[0m  CREATE INDEX "index_tasks_on_assigned_to" ON "tasks" ("assigned_to")
  [1m[36m (1.4ms)[0m  [1mCREATE UNIQUE INDEX "index_tasks_on_user_id_and_name_and_deleted_at" ON "tasks" ("user_id", "name", "deleted_at")[0m
  [1m[35m (5.6ms)[0m  CREATE TABLE "users" ("id" serial primary key, "username" character varying(32) DEFAULT '' NOT NULL, "email" character varying(64) DEFAULT '' NOT NULL, "first_name" character varying(32), "last_name" character varying(32), "title" character varying(64), "company" character varying(64), "alt_email" character varying(64), "phone" character varying(32), "mobile" character varying(32), "aim" character varying(32), "yahoo" character varying(32), "google" character varying(32), "skype" character varying(32), "password_hash" character varying(255) DEFAULT '' NOT NULL, "password_salt" character varying(255) DEFAULT '' NOT NULL, "persistence_token" character varying(255) DEFAULT '' NOT NULL, "perishable_token" character varying(255) DEFAULT '' NOT NULL, "last_request_at" timestamp, "last_login_at" timestamp, "current_login_at" timestamp, "last_login_ip" character varying(255), "current_login_ip" character varying(255), "login_count" integer DEFAULT 0 NOT NULL, "deleted_at" timestamp, "created_at" timestamp NOT NULL, "updated_at" timestamp NOT NULL, "admin" boolean DEFAULT 'f' NOT NULL, "suspended_at" timestamp, "single_access_token" character varying(255)) 
  [1m[36m (1.1ms)[0m  [1mCREATE INDEX "index_users_on_email" ON "users" ("email")[0m
  [1m[35m (1.1ms)[0m  CREATE INDEX "index_users_on_last_request_at" ON "users" ("last_request_at")
  [1m[36m (1.0ms)[0m  [1mCREATE INDEX "index_users_on_perishable_token" ON "users" ("perishable_token")[0m
  [1m[35m (1.2ms)[0m  CREATE INDEX "index_users_on_remember_token" ON "users" ("persistence_token")
  [1m[36m (1.2ms)[0m  [1mCREATE UNIQUE INDEX "index_users_on_username_and_deleted_at" ON "users" ("username", "deleted_at")[0m
  [1m[35m (3.8ms)[0m  CREATE TABLE "versions" ("id" serial primary key, "item_type" character varying(255) NOT NULL, "item_id" integer NOT NULL, "event" character varying(512) NOT NULL, "whodunnit" character varying(255), "object" text, "created_at" timestamp, "object_changes" text, "related_id" integer, "related_type" character varying(255)) 
  [1m[36m (1.1ms)[0m  [1mCREATE INDEX "index_versions_on_item_type_and_item_id" ON "versions" ("item_type", "item_id")[0m
  [1m[35m (1.1ms)[0m  CREATE INDEX "index_versions_on_whodunnit" ON "versions" ("whodunnit")
  [1m[36m (1.0ms)[0m  [1mCREATE TABLE "schema_migrations" ("version" character varying(255) NOT NULL) [0m
  [1m[35m (1.1ms)[0m  CREATE UNIQUE INDEX "unique_schema_migrations" ON "schema_migrations" ("version")
  [1m[36m (0.3ms)[0m  [1mSELECT version FROM "schema_migrations"[0m
  [1m[35m (0.4ms)[0m  INSERT INTO "schema_migrations" (version) VALUES ('20120528102124')
  [1m[36m (0.2ms)[0m  [1mBEGIN[0m
  [1m[35m (0.3ms)[0m  ROLLBACK
  [1m[36m (0.1ms)[0m  [1mBEGIN[0m
Started POST "/vend/register_sale" for 127.0.0.1 at 2013-03-05 23:25:18 +1300
Processing by VendController#register_sale as HTML
  Parameters: {"\n    {\n        \"id\": \"5e8b5134-a002-dd6b-b7c7-26126887c4ee\",\n        \"sale_date\": \"2012-11-13 16:40:06\",\n        \"status\": \"CLOSED\",\n        \"user_id\": \"9b2a8d5f-2d20-11e2-8057-080027706aa2\",\n        \"customer_id\": \"9b17ac9d-2d20-11e2-8057-080027706aa2\",\n        \"register_id\": \"9af85e69-2d20-11e2-8057-080027706aa2\",\n        \"market_id\": \"1\",\n        \"invoice_number\": \"144\",\n        \"short_code\": \"ne2zq\",\n        \"totals\": {\n            \"total_price\": \"4.87\",\n            \"total_tax\": \"0.69\",\n            \"total_payment\": \"5.55\",\n            \"total_to_pay\": \"0\"\n        },\n        \"note\": null,\n        \"updated_at\": \"2012-11-13 16:40:09\",\n        \"created_at\": \"2012-11-13 16:40:09\",\n        \"customer\": {\n            \"id\": \"9b17ac9d-2d20-11e2-8057-080027706aa2\",\n            \"customer_code\": \"WALKIN\",\n            \"balance\": \"-6.250\",\n            \"points\": 0,\n            \"note\": null,\n            \"year_to_date\": \"79945.92188\",\n            \"sex\": \"M\",\n            \"date_of_birth\": \"1950-05-25\",\n            \"updated_at\": \"2012-11-13 16:43:15\",\n            \"created_at\": \"2012-11-13 12:28:03\"\n        },\n        \"user\": {\n            \"id\": \"9b2a8d5f-2d20-11e2-8057-080027706aa2\",\n            \"name\": \"admin\",\n            \"display_name\": \"A admin this time\",\n            \"outlet_id\": \"9ae97219-2d20-11e2-8057-080027706aa2\",\n            \"target_daily\": null,\n            \"target_weekly\": null,\n            \"target_monthly\": null,\n            \"created_at\": \"2011-09-08 05:18:38\",\n            \"updated_at\": \"2011-09-08 05:18:38\"\n        },\n        \"register_sale_products\": "=>{"\n        {\n            \"id\": \"148793f0-475a-7d49-442d-fd761ce76339\",\n            \"product_id\": \"9fe945bc-2d20-11e2-8057-080027706aa2\",\n            \"quantity\": 1,\n            \"price\": \"1.90\",\n            \"price_set\": true,\n            \"tax\": \"0.24\",\n            \"price_total\": \"1.9\",\n            \"tax_total\": \"0.24\",\n            \"tax_id\": \"9a025ff0-2d20-11e2-8057-080027706aa2\",\n            \"tax_name\": \"NZ GST\",\n            \"tax_rate\": \"0.150000\"\n        },\n        {\n            \"id\": \"7d37dc0f-9462-06fa-cae0-0b4988b36539\",\n            \"product_id\": \"a0c0df02-2d20-11e2-8057-080027706aa2\",\n            \"quantity\": 3,\n            \"price\": \"0.99\",\n            \"price_set\": true,\n            \"tax\": \"0.15\",\n            \"price_total\": \"2.97\",\n            \"tax_total\": \"0.45\",\n            \"tax_id\": \"9a025ff0-2d20-11e2-8057-080027706aa2\",\n            \"tax_name\": \"NZ GST\",\n            \"tax_rate\": \"0.150000\"\n        }"=>{",\n        \"register_sale_payments\": "=>{"\n        {\n            \"id\": \"39948e3e-bf93-1b60-ff44-f46a777ed1d4\",\n            \"payment_date\": \"2012-11-13 16:40:06\",\n            \"amount\": \"5.55\",\n            \"retailer_payment_type_id\": \"9e9ba1ba-2d20-11e2-8057-080027706aa2\",\n            \"payment_type_id\": \"1\"\n        }"=>{"\n    }\n  "=>nil}}}}}
Completed 500 Internal Server Error in 1ms
  [1m[35m (0.1ms)[0m  ROLLBACK
Connecting to database specified by database.yml
  [1m[36mFieldGroup Load (1.2ms)[0m  [1mSELECT "field_groups".* FROM "field_groups" WHERE "field_groups"."klass_name" = 'Account' ORDER BY position[0m
  [1m[35mFieldGroup Load (0.2ms)[0m  SELECT "field_groups".* FROM "field_groups" WHERE "field_groups"."klass_name" = 'Campaign' ORDER BY position
  [1m[36mFieldGroup Load (0.2ms)[0m  [1mSELECT "field_groups".* FROM "field_groups" WHERE "field_groups"."klass_name" = 'Contact' ORDER BY position[0m
  [1m[35mFieldGroup Load (0.2ms)[0m  SELECT "field_groups".* FROM "field_groups" WHERE "field_groups"."klass_name" = 'Lead' ORDER BY position
  [1m[36mFieldGroup Load (0.3ms)[0m  [1mSELECT "field_groups".* FROM "field_groups" WHERE "field_groups"."klass_name" = 'Opportunity' ORDER BY position[0m
  [1m[35mFieldGroup Load (0.3ms)[0m  SELECT "field_groups".* FROM "field_groups" WHERE "field_groups"."klass_name" = 'Task' ORDER BY position
Creating scope :except. Overwriting existing method User.except.
  [1m[36m (127.1ms)[0m  [1mDROP DATABASE IF EXISTS "ffcrm_vend_test"[0m
  [1m[35m (246.4ms)[0m  CREATE DATABASE "ffcrm_vend_test" ENCODING = 'utf8'
  [1m[36m (6.3ms)[0m  [1mCREATE TABLE "account_contacts" ("id" serial primary key, "account_id" integer, "contact_id" integer, "deleted_at" timestamp, "created_at" timestamp NOT NULL, "updated_at" timestamp NOT NULL) [0m
  [1m[35m (2.2ms)[0m  CREATE TABLE "account_opportunities" ("id" serial primary key, "account_id" integer, "opportunity_id" integer, "deleted_at" timestamp, "created_at" timestamp NOT NULL, "updated_at" timestamp NOT NULL) 
  [1m[36m (4.7ms)[0m  [1mCREATE TABLE "accounts" ("id" serial primary key, "user_id" integer, "assigned_to" integer, "name" character varying(64) DEFAULT '' NOT NULL, "access" character varying(8) DEFAULT 'Public', "website" character varying(64), "toll_free_phone" character varying(32), "phone" character varying(32), "fax" character varying(32), "deleted_at" timestamp, "created_at" timestamp NOT NULL, "updated_at" timestamp NOT NULL, "email" character varying(64), "background_info" character varying(255), "rating" integer DEFAULT 0 NOT NULL, "category" character varying(32), "subscribed_users" text) [0m
  [1m[35m (1.0ms)[0m  CREATE INDEX "index_accounts_on_assigned_to" ON "accounts" ("assigned_to")
  [1m[36m (1.2ms)[0m  [1mCREATE UNIQUE INDEX "index_accounts_on_user_id_and_name_and_deleted_at" ON "accounts" ("user_id", "name", "deleted_at")[0m
  [1m[35m (3.3ms)[0m  CREATE TABLE "activities" ("id" serial primary key, "user_id" integer, "subject_id" integer, "subject_type" character varying(255), "action" character varying(32) DEFAULT 'created', "info" character varying(255) DEFAULT '', "private" boolean DEFAULT 'f', "created_at" timestamp NOT NULL, "updated_at" timestamp NOT NULL) 
  [1m[36m (1.0ms)[0m  [1mCREATE INDEX "index_activities_on_created_at" ON "activities" ("created_at")[0m
  [1m[35m (1.2ms)[0m  CREATE INDEX "index_activities_on_user_id" ON "activities" ("user_id")
  [1m[36m (4.0ms)[0m  [1mCREATE TABLE "addresses" ("id" serial primary key, "street1" character varying(255), "street2" character varying(255), "city" character varying(64), "state" character varying(64), "zipcode" character varying(16), "country" character varying(64), "full_address" character varying(255), "address_type" character varying(16), "addressable_id" integer, "addressable_type" character varying(255), "created_at" timestamp NOT NULL, "updated_at" timestamp NOT NULL, "deleted_at" timestamp) [0m
  [1m[35m (1.1ms)[0m  CREATE INDEX "index_addresses_on_addressable_id_and_addressable_type" ON "addresses" ("addressable_id", "addressable_type")
  [1m[36m (4.1ms)[0m  [1mCREATE TABLE "avatars" ("id" serial primary key, "user_id" integer, "entity_id" integer, "entity_type" character varying(255), "image_file_size" integer, "image_file_name" character varying(255), "image_content_type" character varying(255), "created_at" timestamp NOT NULL, "updated_at" timestamp NOT NULL) [0m
  [1m[35m (5.1ms)[0m  CREATE TABLE "campaigns" ("id" serial primary key, "user_id" integer, "assigned_to" integer, "name" character varying(64) DEFAULT '' NOT NULL, "access" character varying(8) DEFAULT 'Public', "status" character varying(64), "budget" decimal(12,2), "target_leads" integer, "target_conversion" float, "target_revenue" decimal(12,2), "leads_count" integer, "opportunities_count" integer, "revenue" decimal(12,2), "starts_on" date, "ends_on" date, "objectives" text, "deleted_at" timestamp, "created_at" timestamp NOT NULL, "updated_at" timestamp NOT NULL, "background_info" character varying(255), "subscribed_users" text) 
  [1m[36m (0.8ms)[0m  [1mCREATE INDEX "index_campaigns_on_assigned_to" ON "campaigns" ("assigned_to")[0m
  [1m[35m (1.2ms)[0m  CREATE UNIQUE INDEX "index_campaigns_on_user_id_and_name_and_deleted_at" ON "campaigns" ("user_id", "name", "deleted_at")
  [1m[36m (4.4ms)[0m  [1mCREATE TABLE "comments" ("id" serial primary key, "user_id" integer, "commentable_id" integer, "commentable_type" character varying(255), "private" boolean, "title" character varying(255) DEFAULT '', "comment" text, "created_at" timestamp NOT NULL, "updated_at" timestamp NOT NULL, "state" character varying(16) DEFAULT 'Expanded' NOT NULL) [0m
  [1m[35m (2.6ms)[0m  CREATE TABLE "contact_opportunities" ("id" serial primary key, "contact_id" integer, "opportunity_id" integer, "role" character varying(32), "deleted_at" timestamp, "created_at" timestamp NOT NULL, "updated_at" timestamp NOT NULL) 
  [1m[36m (5.3ms)[0m  [1mCREATE TABLE "contacts" ("id" serial primary key, "user_id" integer, "lead_id" integer, "assigned_to" integer, "reports_to" integer, "first_name" character varying(64) DEFAULT '' NOT NULL, "last_name" character varying(64) DEFAULT '' NOT NULL, "access" character varying(8) DEFAULT 'Public', "title" character varying(64), "department" character varying(64), "source" character varying(32), "email" character varying(64), "alt_email" character varying(64), "phone" character varying(32), "mobile" character varying(32), "fax" character varying(32), "blog" character varying(128), "linkedin" character varying(128), "facebook" character varying(128), "twitter" character varying(128), "born_on" date, "do_not_call" boolean DEFAULT 'f' NOT NULL, "deleted_at" timestamp, "created_at" timestamp NOT NULL, "updated_at" timestamp NOT NULL, "background_info" character varying(255), "skype" character varying(128), "subscribed_users" text) [0m
  [1m[35m (1.2ms)[0m  CREATE INDEX "index_contacts_on_assigned_to" ON "contacts" ("assigned_to")
  [1m[36m (1.3ms)[0m  [1mCREATE UNIQUE INDEX "id_last_name_deleted" ON "contacts" ("user_id", "last_name", "deleted_at")[0m
  [1m[35m (4.6ms)[0m  CREATE TABLE "emails" ("id" serial primary key, "imap_message_id" character varying(255) NOT NULL, "user_id" integer, "mediator_id" integer, "mediator_type" character varying(255), "sent_from" character varying(255) NOT NULL, "sent_to" character varying(255) NOT NULL, "cc" character varying(255), "bcc" character varying(255), "subject" character varying(255), "body" text, "header" text, "sent_at" timestamp, "received_at" timestamp, "deleted_at" timestamp, "created_at" timestamp NOT NULL, "updated_at" timestamp NOT NULL, "state" character varying(16) DEFAULT 'Expanded' NOT NULL) 
  [1m[36m (1.1ms)[0m  [1mCREATE INDEX "index_emails_on_mediator_id_and_mediator_type" ON "emails" ("mediator_id", "mediator_type")[0m
  [1m[35m (3.2ms)[0m  CREATE TABLE "field_groups" ("id" serial primary key, "name" character varying(64), "label" character varying(128), "position" integer, "hint" character varying(255), "created_at" timestamp NOT NULL, "updated_at" timestamp NOT NULL, "tag_id" integer, "klass_name" character varying(32)) 
  [1m[36m (3.8ms)[0m  [1mCREATE TABLE "fields" ("id" serial primary key, "type" character varying(255), "field_group_id" integer, "position" integer, "name" character varying(64), "label" character varying(128), "hint" character varying(255), "placeholder" character varying(255), "as" character varying(32), "collection" text, "disabled" boolean, "required" boolean, "maxlength" integer, "created_at" timestamp NOT NULL, "updated_at" timestamp NOT NULL) [0m
  [1m[35m (1.1ms)[0m  CREATE INDEX "index_fields_on_field_group_id" ON "fields" ("field_group_id")
  [1m[36m (1.1ms)[0m  [1mCREATE INDEX "index_fields_on_name" ON "fields" ("name")[0m
  [1m[35m (4.3ms)[0m  CREATE TABLE "leads" ("id" serial primary key, "user_id" integer, "campaign_id" integer, "assigned_to" integer, "first_name" character varying(64) DEFAULT '' NOT NULL, "last_name" character varying(64) DEFAULT '' NOT NULL, "access" character varying(8) DEFAULT 'Public', "title" character varying(64), "company" character varying(64), "source" character varying(32), "status" character varying(32), "referred_by" character varying(64), "email" character varying(64), "alt_email" character varying(64), "phone" character varying(32), "mobile" character varying(32), "blog" character varying(128), "linkedin" character varying(128), "facebook" character varying(128), "twitter" character varying(128), "rating" integer DEFAULT 0 NOT NULL, "do_not_call" boolean DEFAULT 'f' NOT NULL, "deleted_at" timestamp, "created_at" timestamp NOT NULL, "updated_at" timestamp NOT NULL, "background_info" character varying(255), "skype" character varying(128), "subscribed_users" text) 
  [1m[36m (1.2ms)[0m  [1mCREATE INDEX "index_leads_on_assigned_to" ON "leads" ("assigned_to")[0m
  [1m[35m (8.2ms)[0m  CREATE UNIQUE INDEX "index_leads_on_user_id_and_last_name_and_deleted_at" ON "leads" ("user_id", "last_name", "deleted_at")
  [1m[36m (7.6ms)[0m  [1mCREATE TABLE "lists" ("id" serial primary key, "name" character varying(255), "url" text, "created_at" timestamp NOT NULL, "updated_at" timestamp NOT NULL) [0m
  [1m[35m (17.6ms)[0m  CREATE TABLE "opportunities" ("id" serial primary key, "user_id" integer, "campaign_id" integer, "assigned_to" integer, "name" character varying(64) DEFAULT '' NOT NULL, "access" character varying(8) DEFAULT 'Public', "source" character varying(32), "stage" character varying(32), "probability" integer, "amount" decimal(12,2), "discount" decimal(12,2), "closes_on" date, "deleted_at" timestamp, "created_at" timestamp NOT NULL, "updated_at" timestamp NOT NULL, "background_info" character varying(255), "subscribed_users" text) 
  [1m[36m (1.4ms)[0m  [1mCREATE INDEX "index_opportunities_on_assigned_to" ON "opportunities" ("assigned_to")[0m
  [1m[35m (1.2ms)[0m  CREATE UNIQUE INDEX "id_name_deleted" ON "opportunities" ("user_id", "name", "deleted_at")
  [1m[36m (3.2ms)[0m  [1mCREATE TABLE "permissions" ("id" serial primary key, "user_id" integer, "asset_id" integer, "asset_type" character varying(255), "created_at" timestamp NOT NULL, "updated_at" timestamp NOT NULL) [0m
  [1m[35m (1.0ms)[0m  CREATE INDEX "index_permissions_on_asset_id_and_asset_type" ON "permissions" ("asset_id", "asset_type")
  [1m[36m (1.0ms)[0m  [1mCREATE INDEX "index_permissions_on_user_id" ON "permissions" ("user_id")[0m
  [1m[35m (8.1ms)[0m  CREATE TABLE "preferences" ("id" serial primary key, "user_id" integer, "name" character varying(32) DEFAULT '' NOT NULL, "value" text, "created_at" timestamp NOT NULL, "updated_at" timestamp NOT NULL) 
  [1m[36m (7.6ms)[0m  [1mCREATE INDEX "index_preferences_on_user_id_and_name" ON "preferences" ("user_id", "name")[0m
  [1m[35m (4.9ms)[0m  CREATE TABLE "sessions" ("id" serial primary key, "session_id" character varying(255) NOT NULL, "data" text, "created_at" timestamp NOT NULL, "updated_at" timestamp NOT NULL) 
  [1m[36m (1.2ms)[0m  [1mCREATE INDEX "index_sessions_on_session_id" ON "sessions" ("session_id")[0m
  [1m[35m (1.1ms)[0m  CREATE INDEX "index_sessions_on_updated_at" ON "sessions" ("updated_at")
  [1m[36m (3.6ms)[0m  [1mCREATE TABLE "settings" ("id" serial primary key, "name" character varying(32) DEFAULT '' NOT NULL, "value" text, "created_at" timestamp NOT NULL, "updated_at" timestamp NOT NULL) [0m
  [1m[35m (1.0ms)[0m  CREATE INDEX "index_settings_on_name" ON "settings" ("name")
  [1m[36m (3.4ms)[0m  [1mCREATE TABLE "taggings" ("id" serial primary key, "tag_id" integer, "taggable_id" integer, "tagger_id" integer, "tagger_type" character varying(255), "taggable_type" character varying(255), "context" character varying(255), "created_at" timestamp) [0m
  [1m[35m (1.0ms)[0m  CREATE INDEX "index_taggings_on_tag_id" ON "taggings" ("tag_id")
  [1m[36m (1.3ms)[0m  [1mCREATE INDEX "index_taggings_on_taggable_id_and_taggable_type_and_context" ON "taggings" ("taggable_id", "taggable_type", "context")[0m
  [1m[35m (2.1ms)[0m  CREATE TABLE "tags" ("id" serial primary key, "name" character varying(255)) 
  [1m[36m (3.8ms)[0m  [1mCREATE TABLE "tasks" ("id" serial primary key, "user_id" integer, "assigned_to" integer, "completed_by" integer, "name" character varying(255) DEFAULT '' NOT NULL, "asset_id" integer, "asset_type" character varying(255), "priority" character varying(32), "category" character varying(32), "bucket" character varying(32), "due_at" timestamp, "completed_at" timestamp, "deleted_at" timestamp, "created_at" timestamp NOT NULL, "updated_at" timestamp NOT NULL, "background_info" character varying(255), "subscribed_users" text) [0m
  [1m[35m (0.8ms)[0m  CREATE INDEX "index_tasks_on_assigned_to" ON "tasks" ("assigned_to")
  [1m[36m (1.3ms)[0m  [1mCREATE UNIQUE INDEX "index_tasks_on_user_id_and_name_and_deleted_at" ON "tasks" ("user_id", "name", "deleted_at")[0m
  [1m[35m (4.9ms)[0m  CREATE TABLE "users" ("id" serial primary key, "username" character varying(32) DEFAULT '' NOT NULL, "email" character varying(64) DEFAULT '' NOT NULL, "first_name" character varying(32), "last_name" character varying(32), "title" character varying(64), "company" character varying(64), "alt_email" character varying(64), "phone" character varying(32), "mobile" character varying(32), "aim" character varying(32), "yahoo" character varying(32), "google" character varying(32), "skype" character varying(32), "password_hash" character varying(255) DEFAULT '' NOT NULL, "password_salt" character varying(255) DEFAULT '' NOT NULL, "persistence_token" character varying(255) DEFAULT '' NOT NULL, "perishable_token" character varying(255) DEFAULT '' NOT NULL, "last_request_at" timestamp, "last_login_at" timestamp, "current_login_at" timestamp, "last_login_ip" character varying(255), "current_login_ip" character varying(255), "login_count" integer DEFAULT 0 NOT NULL, "deleted_at" timestamp, "created_at" timestamp NOT NULL, "updated_at" timestamp NOT NULL, "admin" boolean DEFAULT 'f' NOT NULL, "suspended_at" timestamp, "single_access_token" character varying(255)) 
  [1m[36m (0.8ms)[0m  [1mCREATE INDEX "index_users_on_email" ON "users" ("email")[0m
  [1m[35m (0.9ms)[0m  CREATE INDEX "index_users_on_last_request_at" ON "users" ("last_request_at")
  [1m[36m (0.9ms)[0m  [1mCREATE INDEX "index_users_on_perishable_token" ON "users" ("perishable_token")[0m
  [1m[35m (1.0ms)[0m  CREATE INDEX "index_users_on_remember_token" ON "users" ("persistence_token")
  [1m[36m (1.0ms)[0m  [1mCREATE UNIQUE INDEX "index_users_on_username_and_deleted_at" ON "users" ("username", "deleted_at")[0m
  [1m[35m (3.0ms)[0m  CREATE TABLE "versions" ("id" serial primary key, "item_type" character varying(255) NOT NULL, "item_id" integer NOT NULL, "event" character varying(512) NOT NULL, "whodunnit" character varying(255), "object" text, "created_at" timestamp, "object_changes" text, "related_id" integer, "related_type" character varying(255)) 
  [1m[36m (1.2ms)[0m  [1mCREATE INDEX "index_versions_on_item_type_and_item_id" ON "versions" ("item_type", "item_id")[0m
  [1m[35m (1.0ms)[0m  CREATE INDEX "index_versions_on_whodunnit" ON "versions" ("whodunnit")
  [1m[36m (1.0ms)[0m  [1mCREATE TABLE "schema_migrations" ("version" character varying(255) NOT NULL) [0m
  [1m[35m (0.8ms)[0m  CREATE UNIQUE INDEX "unique_schema_migrations" ON "schema_migrations" ("version")
  [1m[36m (0.3ms)[0m  [1mSELECT version FROM "schema_migrations"[0m
  [1m[35m (0.4ms)[0m  INSERT INTO "schema_migrations" (version) VALUES ('20120528102124')
  [1m[36m (0.1ms)[0m  [1mBEGIN[0m
Started POST "/vend/register_sale" for 127.0.0.1 at 2013-03-05 23:25:56 +1300
Processing by VendController#register_sale as HTML
  Parameters: {"\n    {\n        \"id\": \"5e8b5134-a002-dd6b-b7c7-26126887c4ee\",\n        \"sale_date\": \"2012-11-13 16:40:06\",\n        \"status\": \"CLOSED\",\n        \"user_id\": \"9b2a8d5f-2d20-11e2-8057-080027706aa2\",\n        \"customer_id\": \"9b17ac9d-2d20-11e2-8057-080027706aa2\",\n        \"register_id\": \"9af85e69-2d20-11e2-8057-080027706aa2\",\n        \"market_id\": \"1\",\n        \"invoice_number\": \"144\",\n        \"short_code\": \"ne2zq\",\n        \"totals\": {\n            \"total_price\": \"4.87\",\n            \"total_tax\": \"0.69\",\n            \"total_payment\": \"5.55\",\n            \"total_to_pay\": \"0\"\n        },\n        \"note\": null,\n        \"updated_at\": \"2012-11-13 16:40:09\",\n        \"created_at\": \"2012-11-13 16:40:09\",\n        \"customer\": {\n            \"id\": \"9b17ac9d-2d20-11e2-8057-080027706aa2\",\n            \"customer_code\": \"WALKIN\",\n            \"balance\": \"-6.250\",\n            \"points\": 0,\n            \"note\": null,\n            \"year_to_date\": \"79945.92188\",\n            \"sex\": \"M\",\n            \"date_of_birth\": \"1950-05-25\",\n            \"updated_at\": \"2012-11-13 16:43:15\",\n            \"created_at\": \"2012-11-13 12:28:03\"\n        },\n        \"user\": {\n            \"id\": \"9b2a8d5f-2d20-11e2-8057-080027706aa2\",\n            \"name\": \"admin\",\n            \"display_name\": \"A admin this time\",\n            \"outlet_id\": \"9ae97219-2d20-11e2-8057-080027706aa2\",\n            \"target_daily\": null,\n            \"target_weekly\": null,\n            \"target_monthly\": null,\n            \"created_at\": \"2011-09-08 05:18:38\",\n            \"updated_at\": \"2011-09-08 05:18:38\"\n        },\n        \"register_sale_products\": "=>{"\n        {\n            \"id\": \"148793f0-475a-7d49-442d-fd761ce76339\",\n            \"product_id\": \"9fe945bc-2d20-11e2-8057-080027706aa2\",\n            \"quantity\": 1,\n            \"price\": \"1.90\",\n            \"price_set\": true,\n            \"tax\": \"0.24\",\n            \"price_total\": \"1.9\",\n            \"tax_total\": \"0.24\",\n            \"tax_id\": \"9a025ff0-2d20-11e2-8057-080027706aa2\",\n            \"tax_name\": \"NZ GST\",\n            \"tax_rate\": \"0.150000\"\n        },\n        {\n            \"id\": \"7d37dc0f-9462-06fa-cae0-0b4988b36539\",\n            \"product_id\": \"a0c0df02-2d20-11e2-8057-080027706aa2\",\n            \"quantity\": 3,\n            \"price\": \"0.99\",\n            \"price_set\": true,\n            \"tax\": \"0.15\",\n            \"price_total\": \"2.97\",\n            \"tax_total\": \"0.45\",\n            \"tax_id\": \"9a025ff0-2d20-11e2-8057-080027706aa2\",\n            \"tax_name\": \"NZ GST\",\n            \"tax_rate\": \"0.150000\"\n        }"=>{",\n        \"register_sale_payments\": "=>{"\n        {\n            \"id\": \"39948e3e-bf93-1b60-ff44-f46a777ed1d4\",\n            \"payment_date\": \"2012-11-13 16:40:06\",\n            \"amount\": \"5.55\",\n            \"retailer_payment_type_id\": \"9e9ba1ba-2d20-11e2-8057-080027706aa2\",\n            \"payment_type_id\": \"1\"\n        }"=>{"\n    }\n  "=>nil}}}}}
Completed 406 Not Acceptable in 1ms (ActiveRecord: 0.0ms)
  [1m[35m (0.3ms)[0m  ROLLBACK
  [1m[36m (0.1ms)[0m  [1mBEGIN[0m
  [1m[35m (0.1ms)[0m  ROLLBACK
Connecting to database specified by database.yml
  [1m[36mFieldGroup Load (4.1ms)[0m  [1mSELECT "field_groups".* FROM "field_groups" WHERE "field_groups"."klass_name" = 'Account' ORDER BY position[0m
  [1m[35mFieldGroup Load (0.9ms)[0m  SELECT "field_groups".* FROM "field_groups" WHERE "field_groups"."klass_name" = 'Campaign' ORDER BY position
  [1m[36mFieldGroup Load (0.8ms)[0m  [1mSELECT "field_groups".* FROM "field_groups" WHERE "field_groups"."klass_name" = 'Contact' ORDER BY position[0m
  [1m[35mFieldGroup Load (0.8ms)[0m  SELECT "field_groups".* FROM "field_groups" WHERE "field_groups"."klass_name" = 'Lead' ORDER BY position
  [1m[36mFieldGroup Load (0.9ms)[0m  [1mSELECT "field_groups".* FROM "field_groups" WHERE "field_groups"."klass_name" = 'Opportunity' ORDER BY position[0m
  [1m[35mFieldGroup Load (0.9ms)[0m  SELECT "field_groups".* FROM "field_groups" WHERE "field_groups"."klass_name" = 'Task' ORDER BY position
Creating scope :except. Overwriting existing method User.except.
  [1m[36m (208.6ms)[0m  [1mDROP DATABASE IF EXISTS "ffcrm_vend_test"[0m
  [1m[35m (379.4ms)[0m  CREATE DATABASE "ffcrm_vend_test" ENCODING = 'utf8'
  [1m[36m (43.2ms)[0m  [1mCREATE TABLE "account_contacts" ("id" serial primary key, "account_id" integer, "contact_id" integer, "deleted_at" timestamp, "created_at" timestamp NOT NULL, "updated_at" timestamp NOT NULL) [0m
  [1m[35m (23.2ms)[0m  CREATE TABLE "account_opportunities" ("id" serial primary key, "account_id" integer, "opportunity_id" integer, "deleted_at" timestamp, "created_at" timestamp NOT NULL, "updated_at" timestamp NOT NULL) 
  [1m[36m (52.1ms)[0m  [1mCREATE TABLE "accounts" ("id" serial primary key, "user_id" integer, "assigned_to" integer, "name" character varying(64) DEFAULT '' NOT NULL, "access" character varying(8) DEFAULT 'Public', "website" character varying(64), "toll_free_phone" character varying(32), "phone" character varying(32), "fax" character varying(32), "deleted_at" timestamp, "created_at" timestamp NOT NULL, "updated_at" timestamp NOT NULL, "email" character varying(64), "background_info" character varying(255), "rating" integer DEFAULT 0 NOT NULL, "category" character varying(32), "subscribed_users" text) [0m
  [1m[35m (4.6ms)[0m  CREATE INDEX "index_accounts_on_assigned_to" ON "accounts" ("assigned_to")
  [1m[36m (7.1ms)[0m  [1mCREATE UNIQUE INDEX "index_accounts_on_user_id_and_name_and_deleted_at" ON "accounts" ("user_id", "name", "deleted_at")[0m
  [1m[35m (20.7ms)[0m  CREATE TABLE "activities" ("id" serial primary key, "user_id" integer, "subject_id" integer, "subject_type" character varying(255), "action" character varying(32) DEFAULT 'created', "info" character varying(255) DEFAULT '', "private" boolean DEFAULT 'f', "created_at" timestamp NOT NULL, "updated_at" timestamp NOT NULL) 
  [1m[36m (6.1ms)[0m  [1mCREATE INDEX "index_activities_on_created_at" ON "activities" ("created_at")[0m
  [1m[35m (4.1ms)[0m  CREATE INDEX "index_activities_on_user_id" ON "activities" ("user_id")
  [1m[36m (18.5ms)[0m  [1mCREATE TABLE "addresses" ("id" serial primary key, "street1" character varying(255), "street2" character varying(255), "city" character varying(64), "state" character varying(64), "zipcode" character varying(16), "country" character varying(64), "full_address" character varying(255), "address_type" character varying(16), "addressable_id" integer, "addressable_type" character varying(255), "created_at" timestamp NOT NULL, "updated_at" timestamp NOT NULL, "deleted_at" timestamp) [0m
  [1m[35m (4.4ms)[0m  CREATE INDEX "index_addresses_on_addressable_id_and_addressable_type" ON "addresses" ("addressable_id", "addressable_type")
  [1m[36m (16.2ms)[0m  [1mCREATE TABLE "avatars" ("id" serial primary key, "user_id" integer, "entity_id" integer, "entity_type" character varying(255), "image_file_size" integer, "image_file_name" character varying(255), "image_content_type" character varying(255), "created_at" timestamp NOT NULL, "updated_at" timestamp NOT NULL) [0m
  [1m[35m (17.9ms)[0m  CREATE TABLE "campaigns" ("id" serial primary key, "user_id" integer, "assigned_to" integer, "name" character varying(64) DEFAULT '' NOT NULL, "access" character varying(8) DEFAULT 'Public', "status" character varying(64), "budget" decimal(12,2), "target_leads" integer, "target_conversion" float, "target_revenue" decimal(12,2), "leads_count" integer, "opportunities_count" integer, "revenue" decimal(12,2), "starts_on" date, "ends_on" date, "objectives" text, "deleted_at" timestamp, "created_at" timestamp NOT NULL, "updated_at" timestamp NOT NULL, "background_info" character varying(255), "subscribed_users" text) 
  [1m[36m (4.5ms)[0m  [1mCREATE INDEX "index_campaigns_on_assigned_to" ON "campaigns" ("assigned_to")[0m
  [1m[35m (5.4ms)[0m  CREATE UNIQUE INDEX "index_campaigns_on_user_id_and_name_and_deleted_at" ON "campaigns" ("user_id", "name", "deleted_at")
  [1m[36m (17.8ms)[0m  [1mCREATE TABLE "comments" ("id" serial primary key, "user_id" integer, "commentable_id" integer, "commentable_type" character varying(255), "private" boolean, "title" character varying(255) DEFAULT '', "comment" text, "created_at" timestamp NOT NULL, "updated_at" timestamp NOT NULL, "state" character varying(16) DEFAULT 'Expanded' NOT NULL) [0m
  [1m[35m (18.2ms)[0m  CREATE TABLE "contact_opportunities" ("id" serial primary key, "contact_id" integer, "opportunity_id" integer, "role" character varying(32), "deleted_at" timestamp, "created_at" timestamp NOT NULL, "updated_at" timestamp NOT NULL) 
  [1m[36m (26.9ms)[0m  [1mCREATE TABLE "contacts" ("id" serial primary key, "user_id" integer, "lead_id" integer, "assigned_to" integer, "reports_to" integer, "first_name" character varying(64) DEFAULT '' NOT NULL, "last_name" character varying(64) DEFAULT '' NOT NULL, "access" character varying(8) DEFAULT 'Public', "title" character varying(64), "department" character varying(64), "source" character varying(32), "email" character varying(64), "alt_email" character varying(64), "phone" character varying(32), "mobile" character varying(32), "fax" character varying(32), "blog" character varying(128), "linkedin" character varying(128), "facebook" character varying(128), "twitter" character varying(128), "born_on" date, "do_not_call" boolean DEFAULT 'f' NOT NULL, "deleted_at" timestamp, "created_at" timestamp NOT NULL, "updated_at" timestamp NOT NULL, "background_info" character varying(255), "skype" character varying(128), "subscribed_users" text) [0m
  [1m[35m (8.2ms)[0m  CREATE INDEX "index_contacts_on_assigned_to" ON "contacts" ("assigned_to")
  [1m[36m (12.0ms)[0m  [1mCREATE UNIQUE INDEX "id_last_name_deleted" ON "contacts" ("user_id", "last_name", "deleted_at")[0m
  [1m[35m (24.6ms)[0m  CREATE TABLE "emails" ("id" serial primary key, "imap_message_id" character varying(255) NOT NULL, "user_id" integer, "mediator_id" integer, "mediator_type" character varying(255), "sent_from" character varying(255) NOT NULL, "sent_to" character varying(255) NOT NULL, "cc" character varying(255), "bcc" character varying(255), "subject" character varying(255), "body" text, "header" text, "sent_at" timestamp, "received_at" timestamp, "deleted_at" timestamp, "created_at" timestamp NOT NULL, "updated_at" timestamp NOT NULL, "state" character varying(16) DEFAULT 'Expanded' NOT NULL) 
  [1m[36m (5.6ms)[0m  [1mCREATE INDEX "index_emails_on_mediator_id_and_mediator_type" ON "emails" ("mediator_id", "mediator_type")[0m
  [1m[35m (9.4ms)[0m  CREATE TABLE "field_groups" ("id" serial primary key, "name" character varying(64), "label" character varying(128), "position" integer, "hint" character varying(255), "created_at" timestamp NOT NULL, "updated_at" timestamp NOT NULL, "tag_id" integer, "klass_name" character varying(32)) 
  [1m[36m (24.2ms)[0m  [1mCREATE TABLE "fields" ("id" serial primary key, "type" character varying(255), "field_group_id" integer, "position" integer, "name" character varying(64), "label" character varying(128), "hint" character varying(255), "placeholder" character varying(255), "as" character varying(32), "collection" text, "disabled" boolean, "required" boolean, "maxlength" integer, "created_at" timestamp NOT NULL, "updated_at" timestamp NOT NULL) [0m
  [1m[35m (4.7ms)[0m  CREATE INDEX "index_fields_on_field_group_id" ON "fields" ("field_group_id")
  [1m[36m (5.9ms)[0m  [1mCREATE INDEX "index_fields_on_name" ON "fields" ("name")[0m
  [1m[35m (18.7ms)[0m  CREATE TABLE "leads" ("id" serial primary key, "user_id" integer, "campaign_id" integer, "assigned_to" integer, "first_name" character varying(64) DEFAULT '' NOT NULL, "last_name" character varying(64) DEFAULT '' NOT NULL, "access" character varying(8) DEFAULT 'Public', "title" character varying(64), "company" character varying(64), "source" character varying(32), "status" character varying(32), "referred_by" character varying(64), "email" character varying(64), "alt_email" character varying(64), "phone" character varying(32), "mobile" character varying(32), "blog" character varying(128), "linkedin" character varying(128), "facebook" character varying(128), "twitter" character varying(128), "rating" integer DEFAULT 0 NOT NULL, "do_not_call" boolean DEFAULT 'f' NOT NULL, "deleted_at" timestamp, "created_at" timestamp NOT NULL, "updated_at" timestamp NOT NULL, "background_info" character varying(255), "skype" character varying(128), "subscribed_users" text) 
  [1m[36m (4.8ms)[0m  [1mCREATE INDEX "index_leads_on_assigned_to" ON "leads" ("assigned_to")[0m
  [1m[35m (4.7ms)[0m  CREATE UNIQUE INDEX "index_leads_on_user_id_and_last_name_and_deleted_at" ON "leads" ("user_id", "last_name", "deleted_at")
  [1m[36m (12.6ms)[0m  [1mCREATE TABLE "lists" ("id" serial primary key, "name" character varying(255), "url" text, "created_at" timestamp NOT NULL, "updated_at" timestamp NOT NULL) [0m
  [1m[35m (21.0ms)[0m  CREATE TABLE "opportunities" ("id" serial primary key, "user_id" integer, "campaign_id" integer, "assigned_to" integer, "name" character varying(64) DEFAULT '' NOT NULL, "access" character varying(8) DEFAULT 'Public', "source" character varying(32), "stage" character varying(32), "probability" integer, "amount" decimal(12,2), "discount" decimal(12,2), "closes_on" date, "deleted_at" timestamp, "created_at" timestamp NOT NULL, "updated_at" timestamp NOT NULL, "background_info" character varying(255), "subscribed_users" text) 
  [1m[36m (3.7ms)[0m  [1mCREATE INDEX "index_opportunities_on_assigned_to" ON "opportunities" ("assigned_to")[0m
  [1m[35m (3.6ms)[0m  CREATE UNIQUE INDEX "id_name_deleted" ON "opportunities" ("user_id", "name", "deleted_at")
  [1m[36m (13.5ms)[0m  [1mCREATE TABLE "permissions" ("id" serial primary key, "user_id" integer, "asset_id" integer, "asset_type" character varying(255), "created_at" timestamp NOT NULL, "updated_at" timestamp NOT NULL) [0m
  [1m[35m (4.7ms)[0m  CREATE INDEX "index_permissions_on_asset_id_and_asset_type" ON "permissions" ("asset_id", "asset_type")
  [1m[36m (3.3ms)[0m  [1mCREATE INDEX "index_permissions_on_user_id" ON "permissions" ("user_id")[0m
  [1m[35m (14.3ms)[0m  CREATE TABLE "preferences" ("id" serial primary key, "user_id" integer, "name" character varying(32) DEFAULT '' NOT NULL, "value" text, "created_at" timestamp NOT NULL, "updated_at" timestamp NOT NULL) 
  [1m[36m (3.5ms)[0m  [1mCREATE INDEX "index_preferences_on_user_id_and_name" ON "preferences" ("user_id", "name")[0m
  [1m[35m (12.5ms)[0m  CREATE TABLE "sessions" ("id" serial primary key, "session_id" character varying(255) NOT NULL, "data" text, "created_at" timestamp NOT NULL, "updated_at" timestamp NOT NULL) 
  [1m[36m (5.3ms)[0m  [1mCREATE INDEX "index_sessions_on_session_id" ON "sessions" ("session_id")[0m
  [1m[35m (3.0ms)[0m  CREATE INDEX "index_sessions_on_updated_at" ON "sessions" ("updated_at")
  [1m[36m (12.1ms)[0m  [1mCREATE TABLE "settings" ("id" serial primary key, "name" character varying(32) DEFAULT '' NOT NULL, "value" text, "created_at" timestamp NOT NULL, "updated_at" timestamp NOT NULL) [0m
  [1m[35m (4.1ms)[0m  CREATE INDEX "index_settings_on_name" ON "settings" ("name")
  [1m[36m (14.4ms)[0m  [1mCREATE TABLE "taggings" ("id" serial primary key, "tag_id" integer, "taggable_id" integer, "tagger_id" integer, "tagger_type" character varying(255), "taggable_type" character varying(255), "context" character varying(255), "created_at" timestamp) [0m
  [1m[35m (3.1ms)[0m  CREATE INDEX "index_taggings_on_tag_id" ON "taggings" ("tag_id")
  [1m[36m (5.8ms)[0m  [1mCREATE INDEX "index_taggings_on_taggable_id_and_taggable_type_and_context" ON "taggings" ("taggable_id", "taggable_type", "context")[0m
  [1m[35m (11.5ms)[0m  CREATE TABLE "tags" ("id" serial primary key, "name" character varying(255)) 
  [1m[36m (14.8ms)[0m  [1mCREATE TABLE "tasks" ("id" serial primary key, "user_id" integer, "assigned_to" integer, "completed_by" integer, "name" character varying(255) DEFAULT '' NOT NULL, "asset_id" integer, "asset_type" character varying(255), "priority" character varying(32), "category" character varying(32), "bucket" character varying(32), "due_at" timestamp, "completed_at" timestamp, "deleted_at" timestamp, "created_at" timestamp NOT NULL, "updated_at" timestamp NOT NULL, "background_info" character varying(255), "subscribed_users" text) [0m
  [1m[35m (7.2ms)[0m  CREATE INDEX "index_tasks_on_assigned_to" ON "tasks" ("assigned_to")
  [1m[36m (3.8ms)[0m  [1mCREATE UNIQUE INDEX "index_tasks_on_user_id_and_name_and_deleted_at" ON "tasks" ("user_id", "name", "deleted_at")[0m
  [1m[35m (25.3ms)[0m  CREATE TABLE "users" ("id" serial primary key, "username" character varying(32) DEFAULT '' NOT NULL, "email" character varying(64) DEFAULT '' NOT NULL, "first_name" character varying(32), "last_name" character varying(32), "title" character varying(64), "company" character varying(64), "alt_email" character varying(64), "phone" character varying(32), "mobile" character varying(32), "aim" character varying(32), "yahoo" character varying(32), "google" character varying(32), "skype" character varying(32), "password_hash" character varying(255) DEFAULT '' NOT NULL, "password_salt" character varying(255) DEFAULT '' NOT NULL, "persistence_token" character varying(255) DEFAULT '' NOT NULL, "perishable_token" character varying(255) DEFAULT '' NOT NULL, "last_request_at" timestamp, "last_login_at" timestamp, "current_login_at" timestamp, "last_login_ip" character varying(255), "current_login_ip" character varying(255), "login_count" integer DEFAULT 0 NOT NULL, "deleted_at" timestamp, "created_at" timestamp NOT NULL, "updated_at" timestamp NOT NULL, "admin" boolean DEFAULT 'f' NOT NULL, "suspended_at" timestamp, "single_access_token" character varying(255)) 
  [1m[36m (3.6ms)[0m  [1mCREATE INDEX "index_users_on_email" ON "users" ("email")[0m
  [1m[35m (3.4ms)[0m  CREATE INDEX "index_users_on_last_request_at" ON "users" ("last_request_at")
  [1m[36m (3.3ms)[0m  [1mCREATE INDEX "index_users_on_perishable_token" ON "users" ("perishable_token")[0m
  [1m[35m (3.3ms)[0m  CREATE INDEX "index_users_on_remember_token" ON "users" ("persistence_token")
  [1m[36m (3.8ms)[0m  [1mCREATE UNIQUE INDEX "index_users_on_username_and_deleted_at" ON "users" ("username", "deleted_at")[0m
  [1m[35m (13.6ms)[0m  CREATE TABLE "versions" ("id" serial primary key, "item_type" character varying(255) NOT NULL, "item_id" integer NOT NULL, "event" character varying(512) NOT NULL, "whodunnit" character varying(255), "object" text, "created_at" timestamp, "object_changes" text, "related_id" integer, "related_type" character varying(255)) 
  [1m[36m (3.4ms)[0m  [1mCREATE INDEX "index_versions_on_item_type_and_item_id" ON "versions" ("item_type", "item_id")[0m
  [1m[35m (2.9ms)[0m  CREATE INDEX "index_versions_on_whodunnit" ON "versions" ("whodunnit")
  [1m[36m (3.0ms)[0m  [1mCREATE TABLE "schema_migrations" ("version" character varying(255) NOT NULL) [0m
  [1m[35m (22.2ms)[0m  CREATE UNIQUE INDEX "unique_schema_migrations" ON "schema_migrations" ("version")
  [1m[36m (1.1ms)[0m  [1mSELECT version FROM "schema_migrations"[0m
  [1m[35m (1.4ms)[0m  INSERT INTO "schema_migrations" (version) VALUES ('20120528102124')
  [1m[36m (4.1ms)[0m  [1mBEGIN[0m
  [1m[35m (0.8ms)[0m  ROLLBACK
  [1m[36m (0.3ms)[0m  [1mBEGIN[0m
Started POST "/vend/register_sale" for 127.0.0.1 at 2013-03-05 23:27:23 +1300
Processing by VendController#register_sale as HTML
  Parameters: {"\n    {\n        \"id\": \"5e8b5134-a002-dd6b-b7c7-26126887c4ee\",\n        \"sale_date\": \"2012-11-13 16:40:06\",\n        \"status\": \"CLOSED\",\n        \"user_id\": \"9b2a8d5f-2d20-11e2-8057-080027706aa2\",\n        \"customer_id\": \"9b17ac9d-2d20-11e2-8057-080027706aa2\",\n        \"register_id\": \"9af85e69-2d20-11e2-8057-080027706aa2\",\n        \"market_id\": \"1\",\n        \"invoice_number\": \"144\",\n        \"short_code\": \"ne2zq\",\n        \"totals\": {\n            \"total_price\": \"4.87\",\n            \"total_tax\": \"0.69\",\n            \"total_payment\": \"5.55\",\n            \"total_to_pay\": \"0\"\n        },\n        \"note\": null,\n        \"updated_at\": \"2012-11-13 16:40:09\",\n        \"created_at\": \"2012-11-13 16:40:09\",\n        \"customer\": {\n            \"id\": \"9b17ac9d-2d20-11e2-8057-080027706aa2\",\n            \"customer_code\": \"WALKIN\",\n            \"balance\": \"-6.250\",\n            \"points\": 0,\n            \"note\": null,\n            \"year_to_date\": \"79945.92188\",\n            \"sex\": \"M\",\n            \"date_of_birth\": \"1950-05-25\",\n            \"updated_at\": \"2012-11-13 16:43:15\",\n            \"created_at\": \"2012-11-13 12:28:03\"\n        },\n        \"user\": {\n            \"id\": \"9b2a8d5f-2d20-11e2-8057-080027706aa2\",\n            \"name\": \"admin\",\n            \"display_name\": \"A admin this time\",\n            \"outlet_id\": \"9ae97219-2d20-11e2-8057-080027706aa2\",\n            \"target_daily\": null,\n            \"target_weekly\": null,\n            \"target_monthly\": null,\n            \"created_at\": \"2011-09-08 05:18:38\",\n            \"updated_at\": \"2011-09-08 05:18:38\"\n        },\n        \"register_sale_products\": "=>{"\n        {\n            \"id\": \"148793f0-475a-7d49-442d-fd761ce76339\",\n            \"product_id\": \"9fe945bc-2d20-11e2-8057-080027706aa2\",\n            \"quantity\": 1,\n            \"price\": \"1.90\",\n            \"price_set\": true,\n            \"tax\": \"0.24\",\n            \"price_total\": \"1.9\",\n            \"tax_total\": \"0.24\",\n            \"tax_id\": \"9a025ff0-2d20-11e2-8057-080027706aa2\",\n            \"tax_name\": \"NZ GST\",\n            \"tax_rate\": \"0.150000\"\n        },\n        {\n            \"id\": \"7d37dc0f-9462-06fa-cae0-0b4988b36539\",\n            \"product_id\": \"a0c0df02-2d20-11e2-8057-080027706aa2\",\n            \"quantity\": 3,\n            \"price\": \"0.99\",\n            \"price_set\": true,\n            \"tax\": \"0.15\",\n            \"price_total\": \"2.97\",\n            \"tax_total\": \"0.45\",\n            \"tax_id\": \"9a025ff0-2d20-11e2-8057-080027706aa2\",\n            \"tax_name\": \"NZ GST\",\n            \"tax_rate\": \"0.150000\"\n        }"=>{",\n        \"register_sale_payments\": "=>{"\n        {\n            \"id\": \"39948e3e-bf93-1b60-ff44-f46a777ed1d4\",\n            \"payment_date\": \"2012-11-13 16:40:06\",\n            \"amount\": \"5.55\",\n            \"retailer_payment_type_id\": \"9e9ba1ba-2d20-11e2-8057-080027706aa2\",\n            \"payment_type_id\": \"1\"\n        }"=>{"\n    }\n  "=>nil}}}}}
Completed 406 Not Acceptable in 3ms (ActiveRecord: 0.0ms)
  [1m[35m (0.6ms)[0m  ROLLBACK
Connecting to database specified by database.yml
  [1m[36mFieldGroup Load (3.9ms)[0m  [1mSELECT "field_groups".* FROM "field_groups" WHERE "field_groups"."klass_name" = 'Account' ORDER BY position[0m
  [1m[35mFieldGroup Load (0.8ms)[0m  SELECT "field_groups".* FROM "field_groups" WHERE "field_groups"."klass_name" = 'Campaign' ORDER BY position
  [1m[36mFieldGroup Load (0.7ms)[0m  [1mSELECT "field_groups".* FROM "field_groups" WHERE "field_groups"."klass_name" = 'Contact' ORDER BY position[0m
  [1m[35mFieldGroup Load (0.8ms)[0m  SELECT "field_groups".* FROM "field_groups" WHERE "field_groups"."klass_name" = 'Lead' ORDER BY position
  [1m[36mFieldGroup Load (0.9ms)[0m  [1mSELECT "field_groups".* FROM "field_groups" WHERE "field_groups"."klass_name" = 'Opportunity' ORDER BY position[0m
  [1m[35mFieldGroup Load (0.8ms)[0m  SELECT "field_groups".* FROM "field_groups" WHERE "field_groups"."klass_name" = 'Task' ORDER BY position
Creating scope :except. Overwriting existing method User.except.
  [1m[36m (167.7ms)[0m  [1mDROP DATABASE IF EXISTS "ffcrm_vend_test"[0m
  [1m[35m (370.8ms)[0m  CREATE DATABASE "ffcrm_vend_test" ENCODING = 'utf8'
  [1m[36m (17.9ms)[0m  [1mCREATE TABLE "account_contacts" ("id" serial primary key, "account_id" integer, "contact_id" integer, "deleted_at" timestamp, "created_at" timestamp NOT NULL, "updated_at" timestamp NOT NULL) [0m
  [1m[35m (9.1ms)[0m  CREATE TABLE "account_opportunities" ("id" serial primary key, "account_id" integer, "opportunity_id" integer, "deleted_at" timestamp, "created_at" timestamp NOT NULL, "updated_at" timestamp NOT NULL) 
  [1m[36m (16.1ms)[0m  [1mCREATE TABLE "accounts" ("id" serial primary key, "user_id" integer, "assigned_to" integer, "name" character varying(64) DEFAULT '' NOT NULL, "access" character varying(8) DEFAULT 'Public', "website" character varying(64), "toll_free_phone" character varying(32), "phone" character varying(32), "fax" character varying(32), "deleted_at" timestamp, "created_at" timestamp NOT NULL, "updated_at" timestamp NOT NULL, "email" character varying(64), "background_info" character varying(255), "rating" integer DEFAULT 0 NOT NULL, "category" character varying(32), "subscribed_users" text) [0m
  [1m[35m (3.4ms)[0m  CREATE INDEX "index_accounts_on_assigned_to" ON "accounts" ("assigned_to")
  [1m[36m (6.9ms)[0m  [1mCREATE UNIQUE INDEX "index_accounts_on_user_id_and_name_and_deleted_at" ON "accounts" ("user_id", "name", "deleted_at")[0m
  [1m[35m (19.9ms)[0m  CREATE TABLE "activities" ("id" serial primary key, "user_id" integer, "subject_id" integer, "subject_type" character varying(255), "action" character varying(32) DEFAULT 'created', "info" character varying(255) DEFAULT '', "private" boolean DEFAULT 'f', "created_at" timestamp NOT NULL, "updated_at" timestamp NOT NULL) 
  [1m[36m (3.5ms)[0m  [1mCREATE INDEX "index_activities_on_created_at" ON "activities" ("created_at")[0m
  [1m[35m (3.1ms)[0m  CREATE INDEX "index_activities_on_user_id" ON "activities" ("user_id")
  [1m[36m (18.6ms)[0m  [1mCREATE TABLE "addresses" ("id" serial primary key, "street1" character varying(255), "street2" character varying(255), "city" character varying(64), "state" character varying(64), "zipcode" character varying(16), "country" character varying(64), "full_address" character varying(255), "address_type" character varying(16), "addressable_id" integer, "addressable_type" character varying(255), "created_at" timestamp NOT NULL, "updated_at" timestamp NOT NULL, "deleted_at" timestamp) [0m
  [1m[35m (3.5ms)[0m  CREATE INDEX "index_addresses_on_addressable_id_and_addressable_type" ON "addresses" ("addressable_id", "addressable_type")
  [1m[36m (13.8ms)[0m  [1mCREATE TABLE "avatars" ("id" serial primary key, "user_id" integer, "entity_id" integer, "entity_type" character varying(255), "image_file_size" integer, "image_file_name" character varying(255), "image_content_type" character varying(255), "created_at" timestamp NOT NULL, "updated_at" timestamp NOT NULL) [0m
  [1m[35m (15.9ms)[0m  CREATE TABLE "campaigns" ("id" serial primary key, "user_id" integer, "assigned_to" integer, "name" character varying(64) DEFAULT '' NOT NULL, "access" character varying(8) DEFAULT 'Public', "status" character varying(64), "budget" decimal(12,2), "target_leads" integer, "target_conversion" float, "target_revenue" decimal(12,2), "leads_count" integer, "opportunities_count" integer, "revenue" decimal(12,2), "starts_on" date, "ends_on" date, "objectives" text, "deleted_at" timestamp, "created_at" timestamp NOT NULL, "updated_at" timestamp NOT NULL, "background_info" character varying(255), "subscribed_users" text) 
  [1m[36m (2.6ms)[0m  [1mCREATE INDEX "index_campaigns_on_assigned_to" ON "campaigns" ("assigned_to")[0m
  [1m[35m (3.9ms)[0m  CREATE UNIQUE INDEX "index_campaigns_on_user_id_and_name_and_deleted_at" ON "campaigns" ("user_id", "name", "deleted_at")
  [1m[36m (13.4ms)[0m  [1mCREATE TABLE "comments" ("id" serial primary key, "user_id" integer, "commentable_id" integer, "commentable_type" character varying(255), "private" boolean, "title" character varying(255) DEFAULT '', "comment" text, "created_at" timestamp NOT NULL, "updated_at" timestamp NOT NULL, "state" character varying(16) DEFAULT 'Expanded' NOT NULL) [0m
  [1m[35m (9.1ms)[0m  CREATE TABLE "contact_opportunities" ("id" serial primary key, "contact_id" integer, "opportunity_id" integer, "role" character varying(32), "deleted_at" timestamp, "created_at" timestamp NOT NULL, "updated_at" timestamp NOT NULL) 
  [1m[36m (17.3ms)[0m  [1mCREATE TABLE "contacts" ("id" serial primary key, "user_id" integer, "lead_id" integer, "assigned_to" integer, "reports_to" integer, "first_name" character varying(64) DEFAULT '' NOT NULL, "last_name" character varying(64) DEFAULT '' NOT NULL, "access" character varying(8) DEFAULT 'Public', "title" character varying(64), "department" character varying(64), "source" character varying(32), "email" character varying(64), "alt_email" character varying(64), "phone" character varying(32), "mobile" character varying(32), "fax" character varying(32), "blog" character varying(128), "linkedin" character varying(128), "facebook" character varying(128), "twitter" character varying(128), "born_on" date, "do_not_call" boolean DEFAULT 'f' NOT NULL, "deleted_at" timestamp, "created_at" timestamp NOT NULL, "updated_at" timestamp NOT NULL, "background_info" character varying(255), "skype" character varying(128), "subscribed_users" text) [0m
  [1m[35m (3.0ms)[0m  CREATE INDEX "index_contacts_on_assigned_to" ON "contacts" ("assigned_to")
  [1m[36m (4.3ms)[0m  [1mCREATE UNIQUE INDEX "id_last_name_deleted" ON "contacts" ("user_id", "last_name", "deleted_at")[0m
  [1m[35m (13.6ms)[0m  CREATE TABLE "emails" ("id" serial primary key, "imap_message_id" character varying(255) NOT NULL, "user_id" integer, "mediator_id" integer, "mediator_type" character varying(255), "sent_from" character varying(255) NOT NULL, "sent_to" character varying(255) NOT NULL, "cc" character varying(255), "bcc" character varying(255), "subject" character varying(255), "body" text, "header" text, "sent_at" timestamp, "received_at" timestamp, "deleted_at" timestamp, "created_at" timestamp NOT NULL, "updated_at" timestamp NOT NULL, "state" character varying(16) DEFAULT 'Expanded' NOT NULL) 
  [1m[36m (2.4ms)[0m  [1mCREATE INDEX "index_emails_on_mediator_id_and_mediator_type" ON "emails" ("mediator_id", "mediator_type")[0m
  [1m[35m (9.9ms)[0m  CREATE TABLE "field_groups" ("id" serial primary key, "name" character varying(64), "label" character varying(128), "position" integer, "hint" character varying(255), "created_at" timestamp NOT NULL, "updated_at" timestamp NOT NULL, "tag_id" integer, "klass_name" character varying(32)) 
  [1m[36m (13.4ms)[0m  [1mCREATE TABLE "fields" ("id" serial primary key, "type" character varying(255), "field_group_id" integer, "position" integer, "name" character varying(64), "label" character varying(128), "hint" character varying(255), "placeholder" character varying(255), "as" character varying(32), "collection" text, "disabled" boolean, "required" boolean, "maxlength" integer, "created_at" timestamp NOT NULL, "updated_at" timestamp NOT NULL) [0m
  [1m[35m (3.1ms)[0m  CREATE INDEX "index_fields_on_field_group_id" ON "fields" ("field_group_id")
  [1m[36m (2.3ms)[0m  [1mCREATE INDEX "index_fields_on_name" ON "fields" ("name")[0m
  [1m[35m (16.9ms)[0m  CREATE TABLE "leads" ("id" serial primary key, "user_id" integer, "campaign_id" integer, "assigned_to" integer, "first_name" character varying(64) DEFAULT '' NOT NULL, "last_name" character varying(64) DEFAULT '' NOT NULL, "access" character varying(8) DEFAULT 'Public', "title" character varying(64), "company" character varying(64), "source" character varying(32), "status" character varying(32), "referred_by" character varying(64), "email" character varying(64), "alt_email" character varying(64), "phone" character varying(32), "mobile" character varying(32), "blog" character varying(128), "linkedin" character varying(128), "facebook" character varying(128), "twitter" character varying(128), "rating" integer DEFAULT 0 NOT NULL, "do_not_call" boolean DEFAULT 'f' NOT NULL, "deleted_at" timestamp, "created_at" timestamp NOT NULL, "updated_at" timestamp NOT NULL, "background_info" character varying(255), "skype" character varying(128), "subscribed_users" text) 
  [1m[36m (3.0ms)[0m  [1mCREATE INDEX "index_leads_on_assigned_to" ON "leads" ("assigned_to")[0m
  [1m[35m (4.2ms)[0m  CREATE UNIQUE INDEX "index_leads_on_user_id_and_last_name_and_deleted_at" ON "leads" ("user_id", "last_name", "deleted_at")
  [1m[36m (12.5ms)[0m  [1mCREATE TABLE "lists" ("id" serial primary key, "name" character varying(255), "url" text, "created_at" timestamp NOT NULL, "updated_at" timestamp NOT NULL) [0m
  [1m[35m (13.8ms)[0m  CREATE TABLE "opportunities" ("id" serial primary key, "user_id" integer, "campaign_id" integer, "assigned_to" integer, "name" character varying(64) DEFAULT '' NOT NULL, "access" character varying(8) DEFAULT 'Public', "source" character varying(32), "stage" character varying(32), "probability" integer, "amount" decimal(12,2), "discount" decimal(12,2), "closes_on" date, "deleted_at" timestamp, "created_at" timestamp NOT NULL, "updated_at" timestamp NOT NULL, "background_info" character varying(255), "subscribed_users" text) 
  [1m[36m (3.0ms)[0m  [1mCREATE INDEX "index_opportunities_on_assigned_to" ON "opportunities" ("assigned_to")[0m
  [1m[35m (3.3ms)[0m  CREATE UNIQUE INDEX "id_name_deleted" ON "opportunities" ("user_id", "name", "deleted_at")
  [1m[36m (9.2ms)[0m  [1mCREATE TABLE "permissions" ("id" serial primary key, "user_id" integer, "asset_id" integer, "asset_type" character varying(255), "created_at" timestamp NOT NULL, "updated_at" timestamp NOT NULL) [0m
  [1m[35m (3.3ms)[0m  CREATE INDEX "index_permissions_on_asset_id_and_asset_type" ON "permissions" ("asset_id", "asset_type")
  [1m[36m (3.0ms)[0m  [1mCREATE INDEX "index_permissions_on_user_id" ON "permissions" ("user_id")[0m
  [1m[35m (12.8ms)[0m  CREATE TABLE "preferences" ("id" serial primary key, "user_id" integer, "name" character varying(32) DEFAULT '' NOT NULL, "value" text, "created_at" timestamp NOT NULL, "updated_at" timestamp NOT NULL) 
  [1m[36m (3.3ms)[0m  [1mCREATE INDEX "index_preferences_on_user_id_and_name" ON "preferences" ("user_id", "name")[0m
  [1m[35m (12.1ms)[0m  CREATE TABLE "sessions" ("id" serial primary key, "session_id" character varying(255) NOT NULL, "data" text, "created_at" timestamp NOT NULL, "updated_at" timestamp NOT NULL) 
  [1m[36m (3.3ms)[0m  [1mCREATE INDEX "index_sessions_on_session_id" ON "sessions" ("session_id")[0m
  [1m[35m (3.0ms)[0m  CREATE INDEX "index_sessions_on_updated_at" ON "sessions" ("updated_at")
  [1m[36m (10.9ms)[0m  [1mCREATE TABLE "settings" ("id" serial primary key, "name" character varying(32) DEFAULT '' NOT NULL, "value" text, "created_at" timestamp NOT NULL, "updated_at" timestamp NOT NULL) [0m
  [1m[35m (3.3ms)[0m  CREATE INDEX "index_settings_on_name" ON "settings" ("name")
  [1m[36m (14.7ms)[0m  [1mCREATE TABLE "taggings" ("id" serial primary key, "tag_id" integer, "taggable_id" integer, "tagger_id" integer, "tagger_type" character varying(255), "taggable_type" character varying(255), "context" character varying(255), "created_at" timestamp) [0m
  [1m[35m (4.7ms)[0m  CREATE INDEX "index_taggings_on_tag_id" ON "taggings" ("tag_id")
  [1m[36m (3.7ms)[0m  [1mCREATE INDEX "index_taggings_on_taggable_id_and_taggable_type_and_context" ON "taggings" ("taggable_id", "taggable_type", "context")[0m
  [1m[35m (9.0ms)[0m  CREATE TABLE "tags" ("id" serial primary key, "name" character varying(255)) 
  [1m[36m (12.7ms)[0m  [1mCREATE TABLE "tasks" ("id" serial primary key, "user_id" integer, "assigned_to" integer, "completed_by" integer, "name" character varying(255) DEFAULT '' NOT NULL, "asset_id" integer, "asset_type" character varying(255), "priority" character varying(32), "category" character varying(32), "bucket" character varying(32), "due_at" timestamp, "completed_at" timestamp, "deleted_at" timestamp, "created_at" timestamp NOT NULL, "updated_at" timestamp NOT NULL, "background_info" character varying(255), "subscribed_users" text) [0m
  [1m[35m (2.9ms)[0m  CREATE INDEX "index_tasks_on_assigned_to" ON "tasks" ("assigned_to")
  [1m[36m (3.7ms)[0m  [1mCREATE UNIQUE INDEX "index_tasks_on_user_id_and_name_and_deleted_at" ON "tasks" ("user_id", "name", "deleted_at")[0m
  [1m[35m (18.0ms)[0m  CREATE TABLE "users" ("id" serial primary key, "username" character varying(32) DEFAULT '' NOT NULL, "email" character varying(64) DEFAULT '' NOT NULL, "first_name" character varying(32), "last_name" character varying(32), "title" character varying(64), "company" character varying(64), "alt_email" character varying(64), "phone" character varying(32), "mobile" character varying(32), "aim" character varying(32), "yahoo" character varying(32), "google" character varying(32), "skype" character varying(32), "password_hash" character varying(255) DEFAULT '' NOT NULL, "password_salt" character varying(255) DEFAULT '' NOT NULL, "persistence_token" character varying(255) DEFAULT '' NOT NULL, "perishable_token" character varying(255) DEFAULT '' NOT NULL, "last_request_at" timestamp, "last_login_at" timestamp, "current_login_at" timestamp, "last_login_ip" character varying(255), "current_login_ip" character varying(255), "login_count" integer DEFAULT 0 NOT NULL, "deleted_at" timestamp, "created_at" timestamp NOT NULL, "updated_at" timestamp NOT NULL, "admin" boolean DEFAULT 'f' NOT NULL, "suspended_at" timestamp, "single_access_token" character varying(255)) 
  [1m[36m (3.3ms)[0m  [1mCREATE INDEX "index_users_on_email" ON "users" ("email")[0m
  [1m[35m (3.0ms)[0m  CREATE INDEX "index_users_on_last_request_at" ON "users" ("last_request_at")
  [1m[36m (3.2ms)[0m  [1mCREATE INDEX "index_users_on_perishable_token" ON "users" ("perishable_token")[0m
  [1m[35m (3.3ms)[0m  CREATE INDEX "index_users_on_remember_token" ON "users" ("persistence_token")
  [1m[36m (3.6ms)[0m  [1mCREATE UNIQUE INDEX "index_users_on_username_and_deleted_at" ON "users" ("username", "deleted_at")[0m
  [1m[35m (13.7ms)[0m  CREATE TABLE "versions" ("id" serial primary key, "item_type" character varying(255) NOT NULL, "item_id" integer NOT NULL, "event" character varying(512) NOT NULL, "whodunnit" character varying(255), "object" text, "created_at" timestamp, "object_changes" text, "related_id" integer, "related_type" character varying(255)) 
  [1m[36m (10.7ms)[0m  [1mCREATE INDEX "index_versions_on_item_type_and_item_id" ON "versions" ("item_type", "item_id")[0m
  [1m[35m (4.4ms)[0m  CREATE INDEX "index_versions_on_whodunnit" ON "versions" ("whodunnit")
  [1m[36m (8.6ms)[0m  [1mCREATE TABLE "schema_migrations" ("version" character varying(255) NOT NULL) [0m
  [1m[35m (4.5ms)[0m  CREATE UNIQUE INDEX "unique_schema_migrations" ON "schema_migrations" ("version")
  [1m[36m (0.9ms)[0m  [1mSELECT version FROM "schema_migrations"[0m
  [1m[35m (2.9ms)[0m  INSERT INTO "schema_migrations" (version) VALUES ('20120528102124')
  [1m[36m (0.3ms)[0m  [1mBEGIN[0m
Started POST "/vend/register_sale" for 127.0.0.1 at 2013-03-05 23:28:20 +1300
Processing by VendController#register_sale as HTML
  Parameters: {"\n    {\n        \"id\": \"5e8b5134-a002-dd6b-b7c7-26126887c4ee\",\n        \"sale_date\": \"2012-11-13 16:40:06\",\n        \"status\": \"CLOSED\",\n        \"user_id\": \"9b2a8d5f-2d20-11e2-8057-080027706aa2\",\n        \"customer_id\": \"9b17ac9d-2d20-11e2-8057-080027706aa2\",\n        \"register_id\": \"9af85e69-2d20-11e2-8057-080027706aa2\",\n        \"market_id\": \"1\",\n        \"invoice_number\": \"144\",\n        \"short_code\": \"ne2zq\",\n        \"totals\": {\n            \"total_price\": \"4.87\",\n            \"total_tax\": \"0.69\",\n            \"total_payment\": \"5.55\",\n            \"total_to_pay\": \"0\"\n        },\n        \"note\": null,\n        \"updated_at\": \"2012-11-13 16:40:09\",\n        \"created_at\": \"2012-11-13 16:40:09\",\n        \"customer\": {\n            \"id\": \"9b17ac9d-2d20-11e2-8057-080027706aa2\",\n            \"customer_code\": \"WALKIN\",\n            \"balance\": \"-6.250\",\n            \"points\": 0,\n            \"note\": null,\n            \"year_to_date\": \"79945.92188\",\n            \"sex\": \"M\",\n            \"date_of_birth\": \"1950-05-25\",\n            \"updated_at\": \"2012-11-13 16:43:15\",\n            \"created_at\": \"2012-11-13 12:28:03\"\n        },\n        \"user\": {\n            \"id\": \"9b2a8d5f-2d20-11e2-8057-080027706aa2\",\n            \"name\": \"admin\",\n            \"display_name\": \"A admin this time\",\n            \"outlet_id\": \"9ae97219-2d20-11e2-8057-080027706aa2\",\n            \"target_daily\": null,\n            \"target_weekly\": null,\n            \"target_monthly\": null,\n            \"created_at\": \"2011-09-08 05:18:38\",\n            \"updated_at\": \"2011-09-08 05:18:38\"\n        },\n        \"register_sale_products\": "=>{"\n        {\n            \"id\": \"148793f0-475a-7d49-442d-fd761ce76339\",\n            \"product_id\": \"9fe945bc-2d20-11e2-8057-080027706aa2\",\n            \"quantity\": 1,\n            \"price\": \"1.90\",\n            \"price_set\": true,\n            \"tax\": \"0.24\",\n            \"price_total\": \"1.9\",\n            \"tax_total\": \"0.24\",\n            \"tax_id\": \"9a025ff0-2d20-11e2-8057-080027706aa2\",\n            \"tax_name\": \"NZ GST\",\n            \"tax_rate\": \"0.150000\"\n        },\n        {\n            \"id\": \"7d37dc0f-9462-06fa-cae0-0b4988b36539\",\n            \"product_id\": \"a0c0df02-2d20-11e2-8057-080027706aa2\",\n            \"quantity\": 3,\n            \"price\": \"0.99\",\n            \"price_set\": true,\n            \"tax\": \"0.15\",\n            \"price_total\": \"2.97\",\n            \"tax_total\": \"0.45\",\n            \"tax_id\": \"9a025ff0-2d20-11e2-8057-080027706aa2\",\n            \"tax_name\": \"NZ GST\",\n            \"tax_rate\": \"0.150000\"\n        }"=>{",\n        \"register_sale_payments\": "=>{"\n        {\n            \"id\": \"39948e3e-bf93-1b60-ff44-f46a777ed1d4\",\n            \"payment_date\": \"2012-11-13 16:40:06\",\n            \"amount\": \"5.55\",\n            \"retailer_payment_type_id\": \"9e9ba1ba-2d20-11e2-8057-080027706aa2\",\n            \"payment_type_id\": \"1\"\n        }"=>{"\n    }\n  "=>nil}}}}}
Completed 406 Not Acceptable in 3ms (ActiveRecord: 0.0ms)
  [1m[35m (0.7ms)[0m  ROLLBACK
  [1m[36m (0.3ms)[0m  [1mBEGIN[0m
  [1m[35m (0.3ms)[0m  ROLLBACK
Connecting to database specified by database.yml
  [1m[36mFieldGroup Load (3.9ms)[0m  [1mSELECT "field_groups".* FROM "field_groups" WHERE "field_groups"."klass_name" = 'Account' ORDER BY position[0m
  [1m[35mFieldGroup Load (0.7ms)[0m  SELECT "field_groups".* FROM "field_groups" WHERE "field_groups"."klass_name" = 'Campaign' ORDER BY position
  [1m[36mFieldGroup Load (1.2ms)[0m  [1mSELECT "field_groups".* FROM "field_groups" WHERE "field_groups"."klass_name" = 'Contact' ORDER BY position[0m
  [1m[35mFieldGroup Load (0.8ms)[0m  SELECT "field_groups".* FROM "field_groups" WHERE "field_groups"."klass_name" = 'Lead' ORDER BY position
  [1m[36mFieldGroup Load (1.0ms)[0m  [1mSELECT "field_groups".* FROM "field_groups" WHERE "field_groups"."klass_name" = 'Opportunity' ORDER BY position[0m
  [1m[35mFieldGroup Load (1.0ms)[0m  SELECT "field_groups".* FROM "field_groups" WHERE "field_groups"."klass_name" = 'Task' ORDER BY position
Creating scope :except. Overwriting existing method User.except.
  [1m[36m (175.1ms)[0m  [1mDROP DATABASE IF EXISTS "ffcrm_vend_test"[0m
  [1m[35m (374.9ms)[0m  CREATE DATABASE "ffcrm_vend_test" ENCODING = 'utf8'
  [1m[36m (17.2ms)[0m  [1mCREATE TABLE "account_contacts" ("id" serial primary key, "account_id" integer, "contact_id" integer, "deleted_at" timestamp, "created_at" timestamp NOT NULL, "updated_at" timestamp NOT NULL) [0m
  [1m[35m (7.3ms)[0m  CREATE TABLE "account_opportunities" ("id" serial primary key, "account_id" integer, "opportunity_id" integer, "deleted_at" timestamp, "created_at" timestamp NOT NULL, "updated_at" timestamp NOT NULL) 
  [1m[36m (14.9ms)[0m  [1mCREATE TABLE "accounts" ("id" serial primary key, "user_id" integer, "assigned_to" integer, "name" character varying(64) DEFAULT '' NOT NULL, "access" character varying(8) DEFAULT 'Public', "website" character varying(64), "toll_free_phone" character varying(32), "phone" character varying(32), "fax" character varying(32), "deleted_at" timestamp, "created_at" timestamp NOT NULL, "updated_at" timestamp NOT NULL, "email" character varying(64), "background_info" character varying(255), "rating" integer DEFAULT 0 NOT NULL, "category" character varying(32), "subscribed_users" text) [0m
  [1m[35m (2.6ms)[0m  CREATE INDEX "index_accounts_on_assigned_to" ON "accounts" ("assigned_to")
  [1m[36m (11.6ms)[0m  [1mCREATE UNIQUE INDEX "index_accounts_on_user_id_and_name_and_deleted_at" ON "accounts" ("user_id", "name", "deleted_at")[0m
  [1m[35m (16.5ms)[0m  CREATE TABLE "activities" ("id" serial primary key, "user_id" integer, "subject_id" integer, "subject_type" character varying(255), "action" character varying(32) DEFAULT 'created', "info" character varying(255) DEFAULT '', "private" boolean DEFAULT 'f', "created_at" timestamp NOT NULL, "updated_at" timestamp NOT NULL) 
  [1m[36m (5.8ms)[0m  [1mCREATE INDEX "index_activities_on_created_at" ON "activities" ("created_at")[0m
  [1m[35m (5.8ms)[0m  CREATE INDEX "index_activities_on_user_id" ON "activities" ("user_id")
  [1m[36m (10.8ms)[0m  [1mCREATE TABLE "addresses" ("id" serial primary key, "street1" character varying(255), "street2" character varying(255), "city" character varying(64), "state" character varying(64), "zipcode" character varying(16), "country" character varying(64), "full_address" character varying(255), "address_type" character varying(16), "addressable_id" integer, "addressable_type" character varying(255), "created_at" timestamp NOT NULL, "updated_at" timestamp NOT NULL, "deleted_at" timestamp) [0m
  [1m[35m (2.8ms)[0m  CREATE INDEX "index_addresses_on_addressable_id_and_addressable_type" ON "addresses" ("addressable_id", "addressable_type")
  [1m[36m (15.9ms)[0m  [1mCREATE TABLE "avatars" ("id" serial primary key, "user_id" integer, "entity_id" integer, "entity_type" character varying(255), "image_file_size" integer, "image_file_name" character varying(255), "image_content_type" character varying(255), "created_at" timestamp NOT NULL, "updated_at" timestamp NOT NULL) [0m
  [1m[35m (18.0ms)[0m  CREATE TABLE "campaigns" ("id" serial primary key, "user_id" integer, "assigned_to" integer, "name" character varying(64) DEFAULT '' NOT NULL, "access" character varying(8) DEFAULT 'Public', "status" character varying(64), "budget" decimal(12,2), "target_leads" integer, "target_conversion" float, "target_revenue" decimal(12,2), "leads_count" integer, "opportunities_count" integer, "revenue" decimal(12,2), "starts_on" date, "ends_on" date, "objectives" text, "deleted_at" timestamp, "created_at" timestamp NOT NULL, "updated_at" timestamp NOT NULL, "background_info" character varying(255), "subscribed_users" text) 
  [1m[36m (3.0ms)[0m  [1mCREATE INDEX "index_campaigns_on_assigned_to" ON "campaigns" ("assigned_to")[0m
  [1m[35m (3.1ms)[0m  CREATE UNIQUE INDEX "index_campaigns_on_user_id_and_name_and_deleted_at" ON "campaigns" ("user_id", "name", "deleted_at")
  [1m[36m (13.1ms)[0m  [1mCREATE TABLE "comments" ("id" serial primary key, "user_id" integer, "commentable_id" integer, "commentable_type" character varying(255), "private" boolean, "title" character varying(255) DEFAULT '', "comment" text, "created_at" timestamp NOT NULL, "updated_at" timestamp NOT NULL, "state" character varying(16) DEFAULT 'Expanded' NOT NULL) [0m
  [1m[35m (9.3ms)[0m  CREATE TABLE "contact_opportunities" ("id" serial primary key, "contact_id" integer, "opportunity_id" integer, "role" character varying(32), "deleted_at" timestamp, "created_at" timestamp NOT NULL, "updated_at" timestamp NOT NULL) 
  [1m[36m (14.8ms)[0m  [1mCREATE TABLE "contacts" ("id" serial primary key, "user_id" integer, "lead_id" integer, "assigned_to" integer, "reports_to" integer, "first_name" character varying(64) DEFAULT '' NOT NULL, "last_name" character varying(64) DEFAULT '' NOT NULL, "access" character varying(8) DEFAULT 'Public', "title" character varying(64), "department" character varying(64), "source" character varying(32), "email" character varying(64), "alt_email" character varying(64), "phone" character varying(32), "mobile" character varying(32), "fax" character varying(32), "blog" character varying(128), "linkedin" character varying(128), "facebook" character varying(128), "twitter" character varying(128), "born_on" date, "do_not_call" boolean DEFAULT 'f' NOT NULL, "deleted_at" timestamp, "created_at" timestamp NOT NULL, "updated_at" timestamp NOT NULL, "background_info" character varying(255), "skype" character varying(128), "subscribed_users" text) [0m
  [1m[35m (3.0ms)[0m  CREATE INDEX "index_contacts_on_assigned_to" ON "contacts" ("assigned_to")
  [1m[36m (3.5ms)[0m  [1mCREATE UNIQUE INDEX "id_last_name_deleted" ON "contacts" ("user_id", "last_name", "deleted_at")[0m
  [1m[35m (13.7ms)[0m  CREATE TABLE "emails" ("id" serial primary key, "imap_message_id" character varying(255) NOT NULL, "user_id" integer, "mediator_id" integer, "mediator_type" character varying(255), "sent_from" character varying(255) NOT NULL, "sent_to" character varying(255) NOT NULL, "cc" character varying(255), "bcc" character varying(255), "subject" character varying(255), "body" text, "header" text, "sent_at" timestamp, "received_at" timestamp, "deleted_at" timestamp, "created_at" timestamp NOT NULL, "updated_at" timestamp NOT NULL, "state" character varying(16) DEFAULT 'Expanded' NOT NULL) 
  [1m[36m (3.4ms)[0m  [1mCREATE INDEX "index_emails_on_mediator_id_and_mediator_type" ON "emails" ("mediator_id", "mediator_type")[0m
  [1m[35m (13.9ms)[0m  CREATE TABLE "field_groups" ("id" serial primary key, "name" character varying(64), "label" character varying(128), "position" integer, "hint" character varying(255), "created_at" timestamp NOT NULL, "updated_at" timestamp NOT NULL, "tag_id" integer, "klass_name" character varying(32)) 
  [1m[36m (12.8ms)[0m  [1mCREATE TABLE "fields" ("id" serial primary key, "type" character varying(255), "field_group_id" integer, "position" integer, "name" character varying(64), "label" character varying(128), "hint" character varying(255), "placeholder" character varying(255), "as" character varying(32), "collection" text, "disabled" boolean, "required" boolean, "maxlength" integer, "created_at" timestamp NOT NULL, "updated_at" timestamp NOT NULL) [0m
  [1m[35m (3.4ms)[0m  CREATE INDEX "index_fields_on_field_group_id" ON "fields" ("field_group_id")
  [1m[36m (3.2ms)[0m  [1mCREATE INDEX "index_fields_on_name" ON "fields" ("name")[0m
  [1m[35m (14.0ms)[0m  CREATE TABLE "leads" ("id" serial primary key, "user_id" integer, "campaign_id" integer, "assigned_to" integer, "first_name" character varying(64) DEFAULT '' NOT NULL, "last_name" character varying(64) DEFAULT '' NOT NULL, "access" character varying(8) DEFAULT 'Public', "title" character varying(64), "company" character varying(64), "source" character varying(32), "status" character varying(32), "referred_by" character varying(64), "email" character varying(64), "alt_email" character varying(64), "phone" character varying(32), "mobile" character varying(32), "blog" character varying(128), "linkedin" character varying(128), "facebook" character varying(128), "twitter" character varying(128), "rating" integer DEFAULT 0 NOT NULL, "do_not_call" boolean DEFAULT 'f' NOT NULL, "deleted_at" timestamp, "created_at" timestamp NOT NULL, "updated_at" timestamp NOT NULL, "background_info" character varying(255), "skype" character varying(128), "subscribed_users" text) 
  [1m[36m (4.3ms)[0m  [1mCREATE INDEX "index_leads_on_assigned_to" ON "leads" ("assigned_to")[0m
  [1m[35m (3.5ms)[0m  CREATE UNIQUE INDEX "index_leads_on_user_id_and_last_name_and_deleted_at" ON "leads" ("user_id", "last_name", "deleted_at")
  [1m[36m (11.4ms)[0m  [1mCREATE TABLE "lists" ("id" serial primary key, "name" character varying(255), "url" text, "created_at" timestamp NOT NULL, "updated_at" timestamp NOT NULL) [0m
  [1m[35m (15.2ms)[0m  CREATE TABLE "opportunities" ("id" serial primary key, "user_id" integer, "campaign_id" integer, "assigned_to" integer, "name" character varying(64) DEFAULT '' NOT NULL, "access" character varying(8) DEFAULT 'Public', "source" character varying(32), "stage" character varying(32), "probability" integer, "amount" decimal(12,2), "discount" decimal(12,2), "closes_on" date, "deleted_at" timestamp, "created_at" timestamp NOT NULL, "updated_at" timestamp NOT NULL, "background_info" character varying(255), "subscribed_users" text) 
  [1m[36m (3.0ms)[0m  [1mCREATE INDEX "index_opportunities_on_assigned_to" ON "opportunities" ("assigned_to")[0m
  [1m[35m (3.7ms)[0m  CREATE UNIQUE INDEX "id_name_deleted" ON "opportunities" ("user_id", "name", "deleted_at")
  [1m[36m (8.6ms)[0m  [1mCREATE TABLE "permissions" ("id" serial primary key, "user_id" integer, "asset_id" integer, "asset_type" character varying(255), "created_at" timestamp NOT NULL, "updated_at" timestamp NOT NULL) [0m
  [1m[35m (3.7ms)[0m  CREATE INDEX "index_permissions_on_asset_id_and_asset_type" ON "permissions" ("asset_id", "asset_type")
  [1m[36m (2.8ms)[0m  [1mCREATE INDEX "index_permissions_on_user_id" ON "permissions" ("user_id")[0m
  [1m[35m (10.4ms)[0m  CREATE TABLE "preferences" ("id" serial primary key, "user_id" integer, "name" character varying(32) DEFAULT '' NOT NULL, "value" text, "created_at" timestamp NOT NULL, "updated_at" timestamp NOT NULL) 
  [1m[36m (3.6ms)[0m  [1mCREATE INDEX "index_preferences_on_user_id_and_name" ON "preferences" ("user_id", "name")[0m
  [1m[35m (13.2ms)[0m  CREATE TABLE "sessions" ("id" serial primary key, "session_id" character varying(255) NOT NULL, "data" text, "created_at" timestamp NOT NULL, "updated_at" timestamp NOT NULL) 
  [1m[36m (3.3ms)[0m  [1mCREATE INDEX "index_sessions_on_session_id" ON "sessions" ("session_id")[0m
  [1m[35m (4.7ms)[0m  CREATE INDEX "index_sessions_on_updated_at" ON "sessions" ("updated_at")
  [1m[36m (12.9ms)[0m  [1mCREATE TABLE "settings" ("id" serial primary key, "name" character varying(32) DEFAULT '' NOT NULL, "value" text, "created_at" timestamp NOT NULL, "updated_at" timestamp NOT NULL) [0m
  [1m[35m (4.6ms)[0m  CREATE INDEX "index_settings_on_name" ON "settings" ("name")
  [1m[36m (17.4ms)[0m  [1mCREATE TABLE "taggings" ("id" serial primary key, "tag_id" integer, "taggable_id" integer, "tagger_id" integer, "tagger_type" character varying(255), "taggable_type" character varying(255), "context" character varying(255), "created_at" timestamp) [0m
  [1m[35m (4.1ms)[0m  CREATE INDEX "index_taggings_on_tag_id" ON "taggings" ("tag_id")
  [1m[36m (5.4ms)[0m  [1mCREATE INDEX "index_taggings_on_taggable_id_and_taggable_type_and_context" ON "taggings" ("taggable_id", "taggable_type", "context")[0m
  [1m[35m (9.2ms)[0m  CREATE TABLE "tags" ("id" serial primary key, "name" character varying(255)) 
  [1m[36m (12.7ms)[0m  [1mCREATE TABLE "tasks" ("id" serial primary key, "user_id" integer, "assigned_to" integer, "completed_by" integer, "name" character varying(255) DEFAULT '' NOT NULL, "asset_id" integer, "asset_type" character varying(255), "priority" character varying(32), "category" character varying(32), "bucket" character varying(32), "due_at" timestamp, "completed_at" timestamp, "deleted_at" timestamp, "created_at" timestamp NOT NULL, "updated_at" timestamp NOT NULL, "background_info" character varying(255), "subscribed_users" text) [0m
  [1m[35m (4.7ms)[0m  CREATE INDEX "index_tasks_on_assigned_to" ON "tasks" ("assigned_to")
  [1m[36m (3.5ms)[0m  [1mCREATE UNIQUE INDEX "index_tasks_on_user_id_and_name_and_deleted_at" ON "tasks" ("user_id", "name", "deleted_at")[0m
  [1m[35m (17.8ms)[0m  CREATE TABLE "users" ("id" serial primary key, "username" character varying(32) DEFAULT '' NOT NULL, "email" character varying(64) DEFAULT '' NOT NULL, "first_name" character varying(32), "last_name" character varying(32), "title" character varying(64), "company" character varying(64), "alt_email" character varying(64), "phone" character varying(32), "mobile" character varying(32), "aim" character varying(32), "yahoo" character varying(32), "google" character varying(32), "skype" character varying(32), "password_hash" character varying(255) DEFAULT '' NOT NULL, "password_salt" character varying(255) DEFAULT '' NOT NULL, "persistence_token" character varying(255) DEFAULT '' NOT NULL, "perishable_token" character varying(255) DEFAULT '' NOT NULL, "last_request_at" timestamp, "last_login_at" timestamp, "current_login_at" timestamp, "last_login_ip" character varying(255), "current_login_ip" character varying(255), "login_count" integer DEFAULT 0 NOT NULL, "deleted_at" timestamp, "created_at" timestamp NOT NULL, "updated_at" timestamp NOT NULL, "admin" boolean DEFAULT 'f' NOT NULL, "suspended_at" timestamp, "single_access_token" character varying(255)) 
  [1m[36m (4.0ms)[0m  [1mCREATE INDEX "index_users_on_email" ON "users" ("email")[0m
  [1m[35m (4.7ms)[0m  CREATE INDEX "index_users_on_last_request_at" ON "users" ("last_request_at")
  [1m[36m (11.3ms)[0m  [1mCREATE INDEX "index_users_on_perishable_token" ON "users" ("perishable_token")[0m
  [1m[35m (4.6ms)[0m  CREATE INDEX "index_users_on_remember_token" ON "users" ("persistence_token")
  [1m[36m (7.8ms)[0m  [1mCREATE UNIQUE INDEX "index_users_on_username_and_deleted_at" ON "users" ("username", "deleted_at")[0m
  [1m[35m (15.6ms)[0m  CREATE TABLE "versions" ("id" serial primary key, "item_type" character varying(255) NOT NULL, "item_id" integer NOT NULL, "event" character varying(512) NOT NULL, "whodunnit" character varying(255), "object" text, "created_at" timestamp, "object_changes" text, "related_id" integer, "related_type" character varying(255)) 
  [1m[36m (3.4ms)[0m  [1mCREATE INDEX "index_versions_on_item_type_and_item_id" ON "versions" ("item_type", "item_id")[0m
  [1m[35m (3.0ms)[0m  CREATE INDEX "index_versions_on_whodunnit" ON "versions" ("whodunnit")
  [1m[36m (2.6ms)[0m  [1mCREATE TABLE "schema_migrations" ("version" character varying(255) NOT NULL) [0m
  [1m[35m (13.1ms)[0m  CREATE UNIQUE INDEX "unique_schema_migrations" ON "schema_migrations" ("version")
  [1m[36m (0.8ms)[0m  [1mSELECT version FROM "schema_migrations"[0m
  [1m[35m (3.6ms)[0m  INSERT INTO "schema_migrations" (version) VALUES ('20120528102124')
  [1m[36m (0.4ms)[0m  [1mBEGIN[0m
  [1m[35m (0.6ms)[0m  ROLLBACK
  [1m[36m (0.2ms)[0m  [1mBEGIN[0m
Started POST "/vend/register_sale.json" for 127.0.0.1 at 2013-03-05 23:31:10 +1300
Processing by VendController#register_sale as JSON
  Parameters: {"\n    {\n        \"id\": \"5e8b5134-a002-dd6b-b7c7-26126887c4ee\",\n        \"sale_date\": \"2012-11-13 16:40:06\",\n        \"status\": \"CLOSED\",\n        \"user_id\": \"9b2a8d5f-2d20-11e2-8057-080027706aa2\",\n        \"customer_id\": \"9b17ac9d-2d20-11e2-8057-080027706aa2\",\n        \"register_id\": \"9af85e69-2d20-11e2-8057-080027706aa2\",\n        \"market_id\": \"1\",\n        \"invoice_number\": \"144\",\n        \"short_code\": \"ne2zq\",\n        \"totals\": {\n            \"total_price\": \"4.87\",\n            \"total_tax\": \"0.69\",\n            \"total_payment\": \"5.55\",\n            \"total_to_pay\": \"0\"\n        },\n        \"note\": null,\n        \"updated_at\": \"2012-11-13 16:40:09\",\n        \"created_at\": \"2012-11-13 16:40:09\",\n        \"customer\": {\n            \"id\": \"9b17ac9d-2d20-11e2-8057-080027706aa2\",\n            \"customer_code\": \"WALKIN\",\n            \"balance\": \"-6.250\",\n            \"points\": 0,\n            \"note\": null,\n            \"year_to_date\": \"79945.92188\",\n            \"sex\": \"M\",\n            \"date_of_birth\": \"1950-05-25\",\n            \"updated_at\": \"2012-11-13 16:43:15\",\n            \"created_at\": \"2012-11-13 12:28:03\"\n        },\n        \"user\": {\n            \"id\": \"9b2a8d5f-2d20-11e2-8057-080027706aa2\",\n            \"name\": \"admin\",\n            \"display_name\": \"A admin this time\",\n            \"outlet_id\": \"9ae97219-2d20-11e2-8057-080027706aa2\",\n            \"target_daily\": null,\n            \"target_weekly\": null,\n            \"target_monthly\": null,\n            \"created_at\": \"2011-09-08 05:18:38\",\n            \"updated_at\": \"2011-09-08 05:18:38\"\n        },\n        \"register_sale_products\": "=>{"\n        {\n            \"id\": \"148793f0-475a-7d49-442d-fd761ce76339\",\n            \"product_id\": \"9fe945bc-2d20-11e2-8057-080027706aa2\",\n            \"quantity\": 1,\n            \"price\": \"1.90\",\n            \"price_set\": true,\n            \"tax\": \"0.24\",\n            \"price_total\": \"1.9\",\n            \"tax_total\": \"0.24\",\n            \"tax_id\": \"9a025ff0-2d20-11e2-8057-080027706aa2\",\n            \"tax_name\": \"NZ GST\",\n            \"tax_rate\": \"0.150000\"\n        },\n        {\n            \"id\": \"7d37dc0f-9462-06fa-cae0-0b4988b36539\",\n            \"product_id\": \"a0c0df02-2d20-11e2-8057-080027706aa2\",\n            \"quantity\": 3,\n            \"price\": \"0.99\",\n            \"price_set\": true,\n            \"tax\": \"0.15\",\n            \"price_total\": \"2.97\",\n            \"tax_total\": \"0.45\",\n            \"tax_id\": \"9a025ff0-2d20-11e2-8057-080027706aa2\",\n            \"tax_name\": \"NZ GST\",\n            \"tax_rate\": \"0.150000\"\n        }"=>{",\n        \"register_sale_payments\": "=>{"\n        {\n            \"id\": \"39948e3e-bf93-1b60-ff44-f46a777ed1d4\",\n            \"payment_date\": \"2012-11-13 16:40:06\",\n            \"amount\": \"5.55\",\n            \"retailer_payment_type_id\": \"9e9ba1ba-2d20-11e2-8057-080027706aa2\",\n            \"payment_type_id\": \"1\"\n        }"=>{"\n    }\n  "=>nil}}}}}
Completed 500 Internal Server Error in 201ms
  [1m[35m (0.4ms)[0m  ROLLBACK
Connecting to database specified by database.yml
Connecting to database specified by database.yml
  [1m[36mFieldGroup Load (3.8ms)[0m  [1mSELECT "field_groups".* FROM "field_groups" WHERE "field_groups"."klass_name" = 'Account' ORDER BY position[0m
  [1m[35mFieldGroup Load (0.9ms)[0m  SELECT "field_groups".* FROM "field_groups" WHERE "field_groups"."klass_name" = 'Campaign' ORDER BY position
  [1m[36mFieldGroup Load (1.0ms)[0m  [1mSELECT "field_groups".* FROM "field_groups" WHERE "field_groups"."klass_name" = 'Contact' ORDER BY position[0m
  [1m[35mFieldGroup Load (0.9ms)[0m  SELECT "field_groups".* FROM "field_groups" WHERE "field_groups"."klass_name" = 'Lead' ORDER BY position
  [1m[36mFieldGroup Load (0.6ms)[0m  [1mSELECT "field_groups".* FROM "field_groups" WHERE "field_groups"."klass_name" = 'Opportunity' ORDER BY position[0m
  [1m[35mFieldGroup Load (0.8ms)[0m  SELECT "field_groups".* FROM "field_groups" WHERE "field_groups"."klass_name" = 'Task' ORDER BY position
Creating scope :except. Overwriting existing method User.except.
  [1m[36m (180.3ms)[0m  [1mDROP DATABASE IF EXISTS "ffcrm_vend_test"[0m
  [1m[35m (396.3ms)[0m  CREATE DATABASE "ffcrm_vend_test" ENCODING = 'utf8'
  [1m[36m (22.1ms)[0m  [1mCREATE TABLE "account_contacts" ("id" serial primary key, "account_id" integer, "contact_id" integer, "deleted_at" timestamp, "created_at" timestamp NOT NULL, "updated_at" timestamp NOT NULL) [0m
  [1m[35m (13.0ms)[0m  CREATE TABLE "account_opportunities" ("id" serial primary key, "account_id" integer, "opportunity_id" integer, "deleted_at" timestamp, "created_at" timestamp NOT NULL, "updated_at" timestamp NOT NULL) 
  [1m[36m (18.6ms)[0m  [1mCREATE TABLE "accounts" ("id" serial primary key, "user_id" integer, "assigned_to" integer, "name" character varying(64) DEFAULT '' NOT NULL, "access" character varying(8) DEFAULT 'Public', "website" character varying(64), "toll_free_phone" character varying(32), "phone" character varying(32), "fax" character varying(32), "deleted_at" timestamp, "created_at" timestamp NOT NULL, "updated_at" timestamp NOT NULL, "email" character varying(64), "background_info" character varying(255), "rating" integer DEFAULT 0 NOT NULL, "category" character varying(32), "subscribed_users" text) [0m
  [1m[35m (5.2ms)[0m  CREATE INDEX "index_accounts_on_assigned_to" ON "accounts" ("assigned_to")
  [1m[36m (4.9ms)[0m  [1mCREATE UNIQUE INDEX "index_accounts_on_user_id_and_name_and_deleted_at" ON "accounts" ("user_id", "name", "deleted_at")[0m
  [1m[35m (14.9ms)[0m  CREATE TABLE "activities" ("id" serial primary key, "user_id" integer, "subject_id" integer, "subject_type" character varying(255), "action" character varying(32) DEFAULT 'created', "info" character varying(255) DEFAULT '', "private" boolean DEFAULT 'f', "created_at" timestamp NOT NULL, "updated_at" timestamp NOT NULL) 
  [1m[36m (3.7ms)[0m  [1mCREATE INDEX "index_activities_on_created_at" ON "activities" ("created_at")[0m
  [1m[35m (3.2ms)[0m  CREATE INDEX "index_activities_on_user_id" ON "activities" ("user_id")
  [1m[36m (12.5ms)[0m  [1mCREATE TABLE "addresses" ("id" serial primary key, "street1" character varying(255), "street2" character varying(255), "city" character varying(64), "state" character varying(64), "zipcode" character varying(16), "country" character varying(64), "full_address" character varying(255), "address_type" character varying(16), "addressable_id" integer, "addressable_type" character varying(255), "created_at" timestamp NOT NULL, "updated_at" timestamp NOT NULL, "deleted_at" timestamp) [0m
  [1m[35m (5.6ms)[0m  CREATE INDEX "index_addresses_on_addressable_id_and_addressable_type" ON "addresses" ("addressable_id", "addressable_type")
  [1m[36m (12.5ms)[0m  [1mCREATE TABLE "avatars" ("id" serial primary key, "user_id" integer, "entity_id" integer, "entity_type" character varying(255), "image_file_size" integer, "image_file_name" character varying(255), "image_content_type" character varying(255), "created_at" timestamp NOT NULL, "updated_at" timestamp NOT NULL) [0m
  [1m[35m (12.2ms)[0m  CREATE TABLE "campaigns" ("id" serial primary key, "user_id" integer, "assigned_to" integer, "name" character varying(64) DEFAULT '' NOT NULL, "access" character varying(8) DEFAULT 'Public', "status" character varying(64), "budget" decimal(12,2), "target_leads" integer, "target_conversion" float, "target_revenue" decimal(12,2), "leads_count" integer, "opportunities_count" integer, "revenue" decimal(12,2), "starts_on" date, "ends_on" date, "objectives" text, "deleted_at" timestamp, "created_at" timestamp NOT NULL, "updated_at" timestamp NOT NULL, "background_info" character varying(255), "subscribed_users" text) 
  [1m[36m (3.0ms)[0m  [1mCREATE INDEX "index_campaigns_on_assigned_to" ON "campaigns" ("assigned_to")[0m
  [1m[35m (3.2ms)[0m  CREATE UNIQUE INDEX "index_campaigns_on_user_id_and_name_and_deleted_at" ON "campaigns" ("user_id", "name", "deleted_at")
  [1m[36m (12.6ms)[0m  [1mCREATE TABLE "comments" ("id" serial primary key, "user_id" integer, "commentable_id" integer, "commentable_type" character varying(255), "private" boolean, "title" character varying(255) DEFAULT '', "comment" text, "created_at" timestamp NOT NULL, "updated_at" timestamp NOT NULL, "state" character varying(16) DEFAULT 'Expanded' NOT NULL) [0m
  [1m[35m (9.5ms)[0m  CREATE TABLE "contact_opportunities" ("id" serial primary key, "contact_id" integer, "opportunity_id" integer, "role" character varying(32), "deleted_at" timestamp, "created_at" timestamp NOT NULL, "updated_at" timestamp NOT NULL) 
  [1m[36m (15.4ms)[0m  [1mCREATE TABLE "contacts" ("id" serial primary key, "user_id" integer, "lead_id" integer, "assigned_to" integer, "reports_to" integer, "first_name" character varying(64) DEFAULT '' NOT NULL, "last_name" character varying(64) DEFAULT '' NOT NULL, "access" character varying(8) DEFAULT 'Public', "title" character varying(64), "department" character varying(64), "source" character varying(32), "email" character varying(64), "alt_email" character varying(64), "phone" character varying(32), "mobile" character varying(32), "fax" character varying(32), "blog" character varying(128), "linkedin" character varying(128), "facebook" character varying(128), "twitter" character varying(128), "born_on" date, "do_not_call" boolean DEFAULT 'f' NOT NULL, "deleted_at" timestamp, "created_at" timestamp NOT NULL, "updated_at" timestamp NOT NULL, "background_info" character varying(255), "skype" character varying(128), "subscribed_users" text) [0m
  [1m[35m (3.8ms)[0m  CREATE INDEX "index_contacts_on_assigned_to" ON "contacts" ("assigned_to")
  [1m[36m (4.6ms)[0m  [1mCREATE UNIQUE INDEX "id_last_name_deleted" ON "contacts" ("user_id", "last_name", "deleted_at")[0m
  [1m[35m (13.9ms)[0m  CREATE TABLE "emails" ("id" serial primary key, "imap_message_id" character varying(255) NOT NULL, "user_id" integer, "mediator_id" integer, "mediator_type" character varying(255), "sent_from" character varying(255) NOT NULL, "sent_to" character varying(255) NOT NULL, "cc" character varying(255), "bcc" character varying(255), "subject" character varying(255), "body" text, "header" text, "sent_at" timestamp, "received_at" timestamp, "deleted_at" timestamp, "created_at" timestamp NOT NULL, "updated_at" timestamp NOT NULL, "state" character varying(16) DEFAULT 'Expanded' NOT NULL) 
  [1m[36m (2.9ms)[0m  [1mCREATE INDEX "index_emails_on_mediator_id_and_mediator_type" ON "emails" ("mediator_id", "mediator_type")[0m
  [1m[35m (8.0ms)[0m  CREATE TABLE "field_groups" ("id" serial primary key, "name" character varying(64), "label" character varying(128), "position" integer, "hint" character varying(255), "created_at" timestamp NOT NULL, "updated_at" timestamp NOT NULL, "tag_id" integer, "klass_name" character varying(32)) 
  [1m[36m (13.2ms)[0m  [1mCREATE TABLE "fields" ("id" serial primary key, "type" character varying(255), "field_group_id" integer, "position" integer, "name" character varying(64), "label" character varying(128), "hint" character varying(255), "placeholder" character varying(255), "as" character varying(32), "collection" text, "disabled" boolean, "required" boolean, "maxlength" integer, "created_at" timestamp NOT NULL, "updated_at" timestamp NOT NULL) [0m
  [1m[35m (3.1ms)[0m  CREATE INDEX "index_fields_on_field_group_id" ON "fields" ("field_group_id")
  [1m[36m (3.0ms)[0m  [1mCREATE INDEX "index_fields_on_name" ON "fields" ("name")[0m
  [1m[35m (16.2ms)[0m  CREATE TABLE "leads" ("id" serial primary key, "user_id" integer, "campaign_id" integer, "assigned_to" integer, "first_name" character varying(64) DEFAULT '' NOT NULL, "last_name" character varying(64) DEFAULT '' NOT NULL, "access" character varying(8) DEFAULT 'Public', "title" character varying(64), "company" character varying(64), "source" character varying(32), "status" character varying(32), "referred_by" character varying(64), "email" character varying(64), "alt_email" character varying(64), "phone" character varying(32), "mobile" character varying(32), "blog" character varying(128), "linkedin" character varying(128), "facebook" character varying(128), "twitter" character varying(128), "rating" integer DEFAULT 0 NOT NULL, "do_not_call" boolean DEFAULT 'f' NOT NULL, "deleted_at" timestamp, "created_at" timestamp NOT NULL, "updated_at" timestamp NOT NULL, "background_info" character varying(255), "skype" character varying(128), "subscribed_users" text) 
  [1m[36m (3.2ms)[0m  [1mCREATE INDEX "index_leads_on_assigned_to" ON "leads" ("assigned_to")[0m
  [1m[35m (3.6ms)[0m  CREATE UNIQUE INDEX "index_leads_on_user_id_and_last_name_and_deleted_at" ON "leads" ("user_id", "last_name", "deleted_at")
  [1m[36m (10.8ms)[0m  [1mCREATE TABLE "lists" ("id" serial primary key, "name" character varying(255), "url" text, "created_at" timestamp NOT NULL, "updated_at" timestamp NOT NULL) [0m
  [1m[35m (15.8ms)[0m  CREATE TABLE "opportunities" ("id" serial primary key, "user_id" integer, "campaign_id" integer, "assigned_to" integer, "name" character varying(64) DEFAULT '' NOT NULL, "access" character varying(8) DEFAULT 'Public', "source" character varying(32), "stage" character varying(32), "probability" integer, "amount" decimal(12,2), "discount" decimal(12,2), "closes_on" date, "deleted_at" timestamp, "created_at" timestamp NOT NULL, "updated_at" timestamp NOT NULL, "background_info" character varying(255), "subscribed_users" text) 
  [1m[36m (3.0ms)[0m  [1mCREATE INDEX "index_opportunities_on_assigned_to" ON "opportunities" ("assigned_to")[0m
  [1m[35m (2.9ms)[0m  CREATE UNIQUE INDEX "id_name_deleted" ON "opportunities" ("user_id", "name", "deleted_at")
  [1m[36m (10.1ms)[0m  [1mCREATE TABLE "permissions" ("id" serial primary key, "user_id" integer, "asset_id" integer, "asset_type" character varying(255), "created_at" timestamp NOT NULL, "updated_at" timestamp NOT NULL) [0m
  [1m[35m (3.6ms)[0m  CREATE INDEX "index_permissions_on_asset_id_and_asset_type" ON "permissions" ("asset_id", "asset_type")
  [1m[36m (2.8ms)[0m  [1mCREATE INDEX "index_permissions_on_user_id" ON "permissions" ("user_id")[0m
  [1m[35m (11.5ms)[0m  CREATE TABLE "preferences" ("id" serial primary key, "user_id" integer, "name" character varying(32) DEFAULT '' NOT NULL, "value" text, "created_at" timestamp NOT NULL, "updated_at" timestamp NOT NULL) 
  [1m[36m (4.9ms)[0m  [1mCREATE INDEX "index_preferences_on_user_id_and_name" ON "preferences" ("user_id", "name")[0m
  [1m[35m (10.8ms)[0m  CREATE TABLE "sessions" ("id" serial primary key, "session_id" character varying(255) NOT NULL, "data" text, "created_at" timestamp NOT NULL, "updated_at" timestamp NOT NULL) 
  [1m[36m (3.0ms)[0m  [1mCREATE INDEX "index_sessions_on_session_id" ON "sessions" ("session_id")[0m
  [1m[35m (2.1ms)[0m  CREATE INDEX "index_sessions_on_updated_at" ON "sessions" ("updated_at")
  [1m[36m (13.2ms)[0m  [1mCREATE TABLE "settings" ("id" serial primary key, "name" character varying(32) DEFAULT '' NOT NULL, "value" text, "created_at" timestamp NOT NULL, "updated_at" timestamp NOT NULL) [0m
  [1m[35m (3.5ms)[0m  CREATE INDEX "index_settings_on_name" ON "settings" ("name")
  [1m[36m (15.0ms)[0m  [1mCREATE TABLE "taggings" ("id" serial primary key, "tag_id" integer, "taggable_id" integer, "tagger_id" integer, "tagger_type" character varying(255), "taggable_type" character varying(255), "context" character varying(255), "created_at" timestamp) [0m
  [1m[35m (4.1ms)[0m  CREATE INDEX "index_taggings_on_tag_id" ON "taggings" ("tag_id")
  [1m[36m (5.3ms)[0m  [1mCREATE INDEX "index_taggings_on_taggable_id_and_taggable_type_and_context" ON "taggings" ("taggable_id", "taggable_type", "context")[0m
  [1m[35m (6.7ms)[0m  CREATE TABLE "tags" ("id" serial primary key, "name" character varying(255)) 
  [1m[36m (13.6ms)[0m  [1mCREATE TABLE "tasks" ("id" serial primary key, "user_id" integer, "assigned_to" integer, "completed_by" integer, "name" character varying(255) DEFAULT '' NOT NULL, "asset_id" integer, "asset_type" character varying(255), "priority" character varying(32), "category" character varying(32), "bucket" character varying(32), "due_at" timestamp, "completed_at" timestamp, "deleted_at" timestamp, "created_at" timestamp NOT NULL, "updated_at" timestamp NOT NULL, "background_info" character varying(255), "subscribed_users" text) [0m
  [1m[35m (3.4ms)[0m  CREATE INDEX "index_tasks_on_assigned_to" ON "tasks" ("assigned_to")
  [1m[36m (3.7ms)[0m  [1mCREATE UNIQUE INDEX "index_tasks_on_user_id_and_name_and_deleted_at" ON "tasks" ("user_id", "name", "deleted_at")[0m
  [1m[35m (16.2ms)[0m  CREATE TABLE "users" ("id" serial primary key, "username" character varying(32) DEFAULT '' NOT NULL, "email" character varying(64) DEFAULT '' NOT NULL, "first_name" character varying(32), "last_name" character varying(32), "title" character varying(64), "company" character varying(64), "alt_email" character varying(64), "phone" character varying(32), "mobile" character varying(32), "aim" character varying(32), "yahoo" character varying(32), "google" character varying(32), "skype" character varying(32), "password_hash" character varying(255) DEFAULT '' NOT NULL, "password_salt" character varying(255) DEFAULT '' NOT NULL, "persistence_token" character varying(255) DEFAULT '' NOT NULL, "perishable_token" character varying(255) DEFAULT '' NOT NULL, "last_request_at" timestamp, "last_login_at" timestamp, "current_login_at" timestamp, "last_login_ip" character varying(255), "current_login_ip" character varying(255), "login_count" integer DEFAULT 0 NOT NULL, "deleted_at" timestamp, "created_at" timestamp NOT NULL, "updated_at" timestamp NOT NULL, "admin" boolean DEFAULT 'f' NOT NULL, "suspended_at" timestamp, "single_access_token" character varying(255)) 
  [1m[36m (5.0ms)[0m  [1mCREATE INDEX "index_users_on_email" ON "users" ("email")[0m
  [1m[35m (3.3ms)[0m  CREATE INDEX "index_users_on_last_request_at" ON "users" ("last_request_at")
  [1m[36m (2.9ms)[0m  [1mCREATE INDEX "index_users_on_perishable_token" ON "users" ("perishable_token")[0m
  [1m[35m (3.3ms)[0m  CREATE INDEX "index_users_on_remember_token" ON "users" ("persistence_token")
  [1m[36m (8.2ms)[0m  [1mCREATE UNIQUE INDEX "index_users_on_username_and_deleted_at" ON "users" ("username", "deleted_at")[0m
  [1m[35m (12.1ms)[0m  CREATE TABLE "versions" ("id" serial primary key, "item_type" character varying(255) NOT NULL, "item_id" integer NOT NULL, "event" character varying(512) NOT NULL, "whodunnit" character varying(255), "object" text, "created_at" timestamp, "object_changes" text, "related_id" integer, "related_type" character varying(255)) 
  [1m[36m (3.7ms)[0m  [1mCREATE INDEX "index_versions_on_item_type_and_item_id" ON "versions" ("item_type", "item_id")[0m
  [1m[35m (3.1ms)[0m  CREATE INDEX "index_versions_on_whodunnit" ON "versions" ("whodunnit")
  [1m[36m (3.9ms)[0m  [1mCREATE TABLE "schema_migrations" ("version" character varying(255) NOT NULL) [0m
  [1m[35m (3.1ms)[0m  CREATE UNIQUE INDEX "unique_schema_migrations" ON "schema_migrations" ("version")
  [1m[36m (0.9ms)[0m  [1mSELECT version FROM "schema_migrations"[0m
  [1m[35m (1.3ms)[0m  INSERT INTO "schema_migrations" (version) VALUES ('20120528102124')
  [1m[36m (0.4ms)[0m  [1mBEGIN[0m
Started POST "/vend/register_sale" for 127.0.0.1 at 2013-03-05 23:35:46 +1300
Processing by VendController#register_sale as JSON
  Parameters: {"\n    {\n        \"id\": \"5e8b5134-a002-dd6b-b7c7-26126887c4ee\",\n        \"sale_date\": \"2012-11-13 16:40:06\",\n        \"status\": \"CLOSED\",\n        \"user_id\": \"9b2a8d5f-2d20-11e2-8057-080027706aa2\",\n        \"customer_id\": \"9b17ac9d-2d20-11e2-8057-080027706aa2\",\n        \"register_id\": \"9af85e69-2d20-11e2-8057-080027706aa2\",\n        \"market_id\": \"1\",\n        \"invoice_number\": \"144\",\n        \"short_code\": \"ne2zq\",\n        \"totals\": {\n            \"total_price\": \"4.87\",\n            \"total_tax\": \"0.69\",\n            \"total_payment\": \"5.55\",\n            \"total_to_pay\": \"0\"\n        },\n        \"note\": null,\n        \"updated_at\": \"2012-11-13 16:40:09\",\n        \"created_at\": \"2012-11-13 16:40:09\",\n        \"customer\": {\n            \"id\": \"9b17ac9d-2d20-11e2-8057-080027706aa2\",\n            \"customer_code\": \"WALKIN\",\n            \"balance\": \"-6.250\",\n            \"points\": 0,\n            \"note\": null,\n            \"year_to_date\": \"79945.92188\",\n            \"sex\": \"M\",\n            \"date_of_birth\": \"1950-05-25\",\n            \"updated_at\": \"2012-11-13 16:43:15\",\n            \"created_at\": \"2012-11-13 12:28:03\"\n        },\n        \"user\": {\n            \"id\": \"9b2a8d5f-2d20-11e2-8057-080027706aa2\",\n            \"name\": \"admin\",\n            \"display_name\": \"A admin this time\",\n            \"outlet_id\": \"9ae97219-2d20-11e2-8057-080027706aa2\",\n            \"target_daily\": null,\n            \"target_weekly\": null,\n            \"target_monthly\": null,\n            \"created_at\": \"2011-09-08 05:18:38\",\n            \"updated_at\": \"2011-09-08 05:18:38\"\n        },\n        \"register_sale_products\": "=>{"\n        {\n            \"id\": \"148793f0-475a-7d49-442d-fd761ce76339\",\n            \"product_id\": \"9fe945bc-2d20-11e2-8057-080027706aa2\",\n            \"quantity\": 1,\n            \"price\": \"1.90\",\n            \"price_set\": true,\n            \"tax\": \"0.24\",\n            \"price_total\": \"1.9\",\n            \"tax_total\": \"0.24\",\n            \"tax_id\": \"9a025ff0-2d20-11e2-8057-080027706aa2\",\n            \"tax_name\": \"NZ GST\",\n            \"tax_rate\": \"0.150000\"\n        },\n        {\n            \"id\": \"7d37dc0f-9462-06fa-cae0-0b4988b36539\",\n            \"product_id\": \"a0c0df02-2d20-11e2-8057-080027706aa2\",\n            \"quantity\": 3,\n            \"price\": \"0.99\",\n            \"price_set\": true,\n            \"tax\": \"0.15\",\n            \"price_total\": \"2.97\",\n            \"tax_total\": \"0.45\",\n            \"tax_id\": \"9a025ff0-2d20-11e2-8057-080027706aa2\",\n            \"tax_name\": \"NZ GST\",\n            \"tax_rate\": \"0.150000\"\n        }"=>{",\n        \"register_sale_payments\": "=>{"\n        {\n            \"id\": \"39948e3e-bf93-1b60-ff44-f46a777ed1d4\",\n            \"payment_date\": \"2012-11-13 16:40:06\",\n            \"amount\": \"5.55\",\n            \"retailer_payment_type_id\": \"9e9ba1ba-2d20-11e2-8057-080027706aa2\",\n            \"payment_type_id\": \"1\"\n        }"=>{"\n    }\n  "=>nil}}}}}
Completed 201 Created in 184ms (Views: 0.7ms | ActiveRecord: 0.0ms)
  [1m[35m (0.9ms)[0m  ROLLBACK
  [1m[36m (0.2ms)[0m  [1mBEGIN[0m
  [1m[35m (0.3ms)[0m  ROLLBACK
Connecting to database specified by database.yml
  [1m[36mFieldGroup Load (2.4ms)[0m  [1mSELECT "field_groups".* FROM "field_groups" WHERE "field_groups"."klass_name" = 'Account' ORDER BY position[0m
  [1m[35mFieldGroup Load (0.8ms)[0m  SELECT "field_groups".* FROM "field_groups" WHERE "field_groups"."klass_name" = 'Campaign' ORDER BY position
  [1m[36mFieldGroup Load (0.8ms)[0m  [1mSELECT "field_groups".* FROM "field_groups" WHERE "field_groups"."klass_name" = 'Contact' ORDER BY position[0m
  [1m[35mFieldGroup Load (0.7ms)[0m  SELECT "field_groups".* FROM "field_groups" WHERE "field_groups"."klass_name" = 'Lead' ORDER BY position
  [1m[36mFieldGroup Load (0.8ms)[0m  [1mSELECT "field_groups".* FROM "field_groups" WHERE "field_groups"."klass_name" = 'Opportunity' ORDER BY position[0m
  [1m[35mFieldGroup Load (0.9ms)[0m  SELECT "field_groups".* FROM "field_groups" WHERE "field_groups"."klass_name" = 'Task' ORDER BY position
Creating scope :except. Overwriting existing method User.except.
  [1m[36m (177.0ms)[0m  [1mDROP DATABASE IF EXISTS "ffcrm_vend_test"[0m
  [1m[35m (360.9ms)[0m  CREATE DATABASE "ffcrm_vend_test" ENCODING = 'utf8'
  [1m[36m (22.1ms)[0m  [1mCREATE TABLE "account_contacts" ("id" serial primary key, "account_id" integer, "contact_id" integer, "deleted_at" timestamp, "created_at" timestamp NOT NULL, "updated_at" timestamp NOT NULL) [0m
  [1m[35m (9.6ms)[0m  CREATE TABLE "account_opportunities" ("id" serial primary key, "account_id" integer, "opportunity_id" integer, "deleted_at" timestamp, "created_at" timestamp NOT NULL, "updated_at" timestamp NOT NULL) 
  [1m[36m (19.6ms)[0m  [1mCREATE TABLE "accounts" ("id" serial primary key, "user_id" integer, "assigned_to" integer, "name" character varying(64) DEFAULT '' NOT NULL, "access" character varying(8) DEFAULT 'Public', "website" character varying(64), "toll_free_phone" character varying(32), "phone" character varying(32), "fax" character varying(32), "deleted_at" timestamp, "created_at" timestamp NOT NULL, "updated_at" timestamp NOT NULL, "email" character varying(64), "background_info" character varying(255), "rating" integer DEFAULT 0 NOT NULL, "category" character varying(32), "subscribed_users" text) [0m
  [1m[35m (3.4ms)[0m  CREATE INDEX "index_accounts_on_assigned_to" ON "accounts" ("assigned_to")
  [1m[36m (9.4ms)[0m  [1mCREATE UNIQUE INDEX "index_accounts_on_user_id_and_name_and_deleted_at" ON "accounts" ("user_id", "name", "deleted_at")[0m
  [1m[35m (34.1ms)[0m  CREATE TABLE "activities" ("id" serial primary key, "user_id" integer, "subject_id" integer, "subject_type" character varying(255), "action" character varying(32) DEFAULT 'created', "info" character varying(255) DEFAULT '', "private" boolean DEFAULT 'f', "created_at" timestamp NOT NULL, "updated_at" timestamp NOT NULL) 
  [1m[36m (27.7ms)[0m  [1mCREATE INDEX "index_activities_on_created_at" ON "activities" ("created_at")[0m
  [1m[35m (5.2ms)[0m  CREATE INDEX "index_activities_on_user_id" ON "activities" ("user_id")
  [1m[36m (13.9ms)[0m  [1mCREATE TABLE "addresses" ("id" serial primary key, "street1" character varying(255), "street2" character varying(255), "city" character varying(64), "state" character varying(64), "zipcode" character varying(16), "country" character varying(64), "full_address" character varying(255), "address_type" character varying(16), "addressable_id" integer, "addressable_type" character varying(255), "created_at" timestamp NOT NULL, "updated_at" timestamp NOT NULL, "deleted_at" timestamp) [0m
  [1m[35m (7.1ms)[0m  CREATE INDEX "index_addresses_on_addressable_id_and_addressable_type" ON "addresses" ("addressable_id", "addressable_type")
  [1m[36m (19.7ms)[0m  [1mCREATE TABLE "avatars" ("id" serial primary key, "user_id" integer, "entity_id" integer, "entity_type" character varying(255), "image_file_size" integer, "image_file_name" character varying(255), "image_content_type" character varying(255), "created_at" timestamp NOT NULL, "updated_at" timestamp NOT NULL) [0m
  [1m[35m (18.8ms)[0m  CREATE TABLE "campaigns" ("id" serial primary key, "user_id" integer, "assigned_to" integer, "name" character varying(64) DEFAULT '' NOT NULL, "access" character varying(8) DEFAULT 'Public', "status" character varying(64), "budget" decimal(12,2), "target_leads" integer, "target_conversion" float, "target_revenue" decimal(12,2), "leads_count" integer, "opportunities_count" integer, "revenue" decimal(12,2), "starts_on" date, "ends_on" date, "objectives" text, "deleted_at" timestamp, "created_at" timestamp NOT NULL, "updated_at" timestamp NOT NULL, "background_info" character varying(255), "subscribed_users" text) 
  [1m[36m (3.3ms)[0m  [1mCREATE INDEX "index_campaigns_on_assigned_to" ON "campaigns" ("assigned_to")[0m
  [1m[35m (3.7ms)[0m  CREATE UNIQUE INDEX "index_campaigns_on_user_id_and_name_and_deleted_at" ON "campaigns" ("user_id", "name", "deleted_at")
  [1m[36m (12.6ms)[0m  [1mCREATE TABLE "comments" ("id" serial primary key, "user_id" integer, "commentable_id" integer, "commentable_type" character varying(255), "private" boolean, "title" character varying(255) DEFAULT '', "comment" text, "created_at" timestamp NOT NULL, "updated_at" timestamp NOT NULL, "state" character varying(16) DEFAULT 'Expanded' NOT NULL) [0m
  [1m[35m (9.5ms)[0m  CREATE TABLE "contact_opportunities" ("id" serial primary key, "contact_id" integer, "opportunity_id" integer, "role" character varying(32), "deleted_at" timestamp, "created_at" timestamp NOT NULL, "updated_at" timestamp NOT NULL) 
  [1m[36m (16.6ms)[0m  [1mCREATE TABLE "contacts" ("id" serial primary key, "user_id" integer, "lead_id" integer, "assigned_to" integer, "reports_to" integer, "first_name" character varying(64) DEFAULT '' NOT NULL, "last_name" character varying(64) DEFAULT '' NOT NULL, "access" character varying(8) DEFAULT 'Public', "title" character varying(64), "department" character varying(64), "source" character varying(32), "email" character varying(64), "alt_email" character varying(64), "phone" character varying(32), "mobile" character varying(32), "fax" character varying(32), "blog" character varying(128), "linkedin" character varying(128), "facebook" character varying(128), "twitter" character varying(128), "born_on" date, "do_not_call" boolean DEFAULT 'f' NOT NULL, "deleted_at" timestamp, "created_at" timestamp NOT NULL, "updated_at" timestamp NOT NULL, "background_info" character varying(255), "skype" character varying(128), "subscribed_users" text) [0m
  [1m[35m (2.8ms)[0m  CREATE INDEX "index_contacts_on_assigned_to" ON "contacts" ("assigned_to")
  [1m[36m (2.7ms)[0m  [1mCREATE UNIQUE INDEX "id_last_name_deleted" ON "contacts" ("user_id", "last_name", "deleted_at")[0m
  [1m[35m (9.7ms)[0m  CREATE TABLE "emails" ("id" serial primary key, "imap_message_id" character varying(255) NOT NULL, "user_id" integer, "mediator_id" integer, "mediator_type" character varying(255), "sent_from" character varying(255) NOT NULL, "sent_to" character varying(255) NOT NULL, "cc" character varying(255), "bcc" character varying(255), "subject" character varying(255), "body" text, "header" text, "sent_at" timestamp, "received_at" timestamp, "deleted_at" timestamp, "created_at" timestamp NOT NULL, "updated_at" timestamp NOT NULL, "state" character varying(16) DEFAULT 'Expanded' NOT NULL) 
  [1m[36m (3.4ms)[0m  [1mCREATE INDEX "index_emails_on_mediator_id_and_mediator_type" ON "emails" ("mediator_id", "mediator_type")[0m
  [1m[35m (9.5ms)[0m  CREATE TABLE "field_groups" ("id" serial primary key, "name" character varying(64), "label" character varying(128), "position" integer, "hint" character varying(255), "created_at" timestamp NOT NULL, "updated_at" timestamp NOT NULL, "tag_id" integer, "klass_name" character varying(32)) 
  [1m[36m (13.4ms)[0m  [1mCREATE TABLE "fields" ("id" serial primary key, "type" character varying(255), "field_group_id" integer, "position" integer, "name" character varying(64), "label" character varying(128), "hint" character varying(255), "placeholder" character varying(255), "as" character varying(32), "collection" text, "disabled" boolean, "required" boolean, "maxlength" integer, "created_at" timestamp NOT NULL, "updated_at" timestamp NOT NULL) [0m
  [1m[35m (4.2ms)[0m  CREATE INDEX "index_fields_on_field_group_id" ON "fields" ("field_group_id")
  [1m[36m (2.9ms)[0m  [1mCREATE INDEX "index_fields_on_name" ON "fields" ("name")[0m
  [1m[35m (17.2ms)[0m  CREATE TABLE "leads" ("id" serial primary key, "user_id" integer, "campaign_id" integer, "assigned_to" integer, "first_name" character varying(64) DEFAULT '' NOT NULL, "last_name" character varying(64) DEFAULT '' NOT NULL, "access" character varying(8) DEFAULT 'Public', "title" character varying(64), "company" character varying(64), "source" character varying(32), "status" character varying(32), "referred_by" character varying(64), "email" character varying(64), "alt_email" character varying(64), "phone" character varying(32), "mobile" character varying(32), "blog" character varying(128), "linkedin" character varying(128), "facebook" character varying(128), "twitter" character varying(128), "rating" integer DEFAULT 0 NOT NULL, "do_not_call" boolean DEFAULT 'f' NOT NULL, "deleted_at" timestamp, "created_at" timestamp NOT NULL, "updated_at" timestamp NOT NULL, "background_info" character varying(255), "skype" character varying(128), "subscribed_users" text) 
  [1m[36m (3.6ms)[0m  [1mCREATE INDEX "index_leads_on_assigned_to" ON "leads" ("assigned_to")[0m
  [1m[35m (3.6ms)[0m  CREATE UNIQUE INDEX "index_leads_on_user_id_and_last_name_and_deleted_at" ON "leads" ("user_id", "last_name", "deleted_at")
  [1m[36m (11.6ms)[0m  [1mCREATE TABLE "lists" ("id" serial primary key, "name" character varying(255), "url" text, "created_at" timestamp NOT NULL, "updated_at" timestamp NOT NULL) [0m
  [1m[35m (15.1ms)[0m  CREATE TABLE "opportunities" ("id" serial primary key, "user_id" integer, "campaign_id" integer, "assigned_to" integer, "name" character varying(64) DEFAULT '' NOT NULL, "access" character varying(8) DEFAULT 'Public', "source" character varying(32), "stage" character varying(32), "probability" integer, "amount" decimal(12,2), "discount" decimal(12,2), "closes_on" date, "deleted_at" timestamp, "created_at" timestamp NOT NULL, "updated_at" timestamp NOT NULL, "background_info" character varying(255), "subscribed_users" text) 
  [1m[36m (3.4ms)[0m  [1mCREATE INDEX "index_opportunities_on_assigned_to" ON "opportunities" ("assigned_to")[0m
  [1m[35m (3.5ms)[0m  CREATE UNIQUE INDEX "id_name_deleted" ON "opportunities" ("user_id", "name", "deleted_at")
  [1m[36m (6.3ms)[0m  [1mCREATE TABLE "permissions" ("id" serial primary key, "user_id" integer, "asset_id" integer, "asset_type" character varying(255), "created_at" timestamp NOT NULL, "updated_at" timestamp NOT NULL) [0m
  [1m[35m (3.4ms)[0m  CREATE INDEX "index_permissions_on_asset_id_and_asset_type" ON "permissions" ("asset_id", "asset_type")
  [1m[36m (2.8ms)[0m  [1mCREATE INDEX "index_permissions_on_user_id" ON "permissions" ("user_id")[0m
  [1m[35m (10.7ms)[0m  CREATE TABLE "preferences" ("id" serial primary key, "user_id" integer, "name" character varying(32) DEFAULT '' NOT NULL, "value" text, "created_at" timestamp NOT NULL, "updated_at" timestamp NOT NULL) 
  [1m[36m (3.3ms)[0m  [1mCREATE INDEX "index_preferences_on_user_id_and_name" ON "preferences" ("user_id", "name")[0m
  [1m[35m (13.9ms)[0m  CREATE TABLE "sessions" ("id" serial primary key, "session_id" character varying(255) NOT NULL, "data" text, "created_at" timestamp NOT NULL, "updated_at" timestamp NOT NULL) 
  [1m[36m (2.2ms)[0m  [1mCREATE INDEX "index_sessions_on_session_id" ON "sessions" ("session_id")[0m
  [1m[35m (2.8ms)[0m  CREATE INDEX "index_sessions_on_updated_at" ON "sessions" ("updated_at")
  [1m[36m (11.5ms)[0m  [1mCREATE TABLE "settings" ("id" serial primary key, "name" character varying(32) DEFAULT '' NOT NULL, "value" text, "created_at" timestamp NOT NULL, "updated_at" timestamp NOT NULL) [0m
  [1m[35m (3.3ms)[0m  CREATE INDEX "index_settings_on_name" ON "settings" ("name")
  [1m[36m (15.5ms)[0m  [1mCREATE TABLE "taggings" ("id" serial primary key, "tag_id" integer, "taggable_id" integer, "tagger_id" integer, "tagger_type" character varying(255), "taggable_type" character varying(255), "context" character varying(255), "created_at" timestamp) [0m
  [1m[35m (2.5ms)[0m  CREATE INDEX "index_taggings_on_tag_id" ON "taggings" ("tag_id")
  [1m[36m (4.4ms)[0m  [1mCREATE INDEX "index_taggings_on_taggable_id_and_taggable_type_and_context" ON "taggings" ("taggable_id", "taggable_type", "context")[0m
  [1m[35m (7.5ms)[0m  CREATE TABLE "tags" ("id" serial primary key, "name" character varying(255)) 
  [1m[36m (11.9ms)[0m  [1mCREATE TABLE "tasks" ("id" serial primary key, "user_id" integer, "assigned_to" integer, "completed_by" integer, "name" character varying(255) DEFAULT '' NOT NULL, "asset_id" integer, "asset_type" character varying(255), "priority" character varying(32), "category" character varying(32), "bucket" character varying(32), "due_at" timestamp, "completed_at" timestamp, "deleted_at" timestamp, "created_at" timestamp NOT NULL, "updated_at" timestamp NOT NULL, "background_info" character varying(255), "subscribed_users" text) [0m
  [1m[35m (3.4ms)[0m  CREATE INDEX "index_tasks_on_assigned_to" ON "tasks" ("assigned_to")
  [1m[36m (4.6ms)[0m  [1mCREATE UNIQUE INDEX "index_tasks_on_user_id_and_name_and_deleted_at" ON "tasks" ("user_id", "name", "deleted_at")[0m
  [1m[35m (18.9ms)[0m  CREATE TABLE "users" ("id" serial primary key, "username" character varying(32) DEFAULT '' NOT NULL, "email" character varying(64) DEFAULT '' NOT NULL, "first_name" character varying(32), "last_name" character varying(32), "title" character varying(64), "company" character varying(64), "alt_email" character varying(64), "phone" character varying(32), "mobile" character varying(32), "aim" character varying(32), "yahoo" character varying(32), "google" character varying(32), "skype" character varying(32), "password_hash" character varying(255) DEFAULT '' NOT NULL, "password_salt" character varying(255) DEFAULT '' NOT NULL, "persistence_token" character varying(255) DEFAULT '' NOT NULL, "perishable_token" character varying(255) DEFAULT '' NOT NULL, "last_request_at" timestamp, "last_login_at" timestamp, "current_login_at" timestamp, "last_login_ip" character varying(255), "current_login_ip" character varying(255), "login_count" integer DEFAULT 0 NOT NULL, "deleted_at" timestamp, "created_at" timestamp NOT NULL, "updated_at" timestamp NOT NULL, "admin" boolean DEFAULT 'f' NOT NULL, "suspended_at" timestamp, "single_access_token" character varying(255)) 
  [1m[36m (3.7ms)[0m  [1mCREATE INDEX "index_users_on_email" ON "users" ("email")[0m
  [1m[35m (3.1ms)[0m  CREATE INDEX "index_users_on_last_request_at" ON "users" ("last_request_at")
  [1m[36m (3.7ms)[0m  [1mCREATE INDEX "index_users_on_perishable_token" ON "users" ("perishable_token")[0m
  [1m[35m (2.4ms)[0m  CREATE INDEX "index_users_on_remember_token" ON "users" ("persistence_token")
  [1m[36m (3.5ms)[0m  [1mCREATE UNIQUE INDEX "index_users_on_username_and_deleted_at" ON "users" ("username", "deleted_at")[0m
  [1m[35m (11.0ms)[0m  CREATE TABLE "versions" ("id" serial primary key, "item_type" character varying(255) NOT NULL, "item_id" integer NOT NULL, "event" character varying(512) NOT NULL, "whodunnit" character varying(255), "object" text, "created_at" timestamp, "object_changes" text, "related_id" integer, "related_type" character varying(255)) 
  [1m[36m (10.4ms)[0m  [1mCREATE INDEX "index_versions_on_item_type_and_item_id" ON "versions" ("item_type", "item_id")[0m
  [1m[35m (4.3ms)[0m  CREATE INDEX "index_versions_on_whodunnit" ON "versions" ("whodunnit")
  [1m[36m (2.5ms)[0m  [1mCREATE TABLE "schema_migrations" ("version" character varying(255) NOT NULL) [0m
  [1m[35m (2.4ms)[0m  CREATE UNIQUE INDEX "unique_schema_migrations" ON "schema_migrations" ("version")
  [1m[36m (0.7ms)[0m  [1mSELECT version FROM "schema_migrations"[0m
  [1m[35m (10.4ms)[0m  INSERT INTO "schema_migrations" (version) VALUES ('20120528102124')
  [1m[36m (0.3ms)[0m  [1mBEGIN[0m
Started POST "/vend/register_sale" for 127.0.0.1 at 2013-03-05 23:37:06 +1300
Processing by VendController#register_sale as JSON
  Parameters: {"\n    {\n        \"id\": \"5e8b5134-a002-dd6b-b7c7-26126887c4ee\",\n        \"sale_date\": \"2012-11-13 16:40:06\",\n        \"status\": \"CLOSED\",\n        \"user_id\": \"9b2a8d5f-2d20-11e2-8057-080027706aa2\",\n        \"customer_id\": \"9b17ac9d-2d20-11e2-8057-080027706aa2\",\n        \"register_id\": \"9af85e69-2d20-11e2-8057-080027706aa2\",\n        \"market_id\": \"1\",\n        \"invoice_number\": \"144\",\n        \"short_code\": \"ne2zq\",\n        \"totals\": {\n            \"total_price\": \"4.87\",\n            \"total_tax\": \"0.69\",\n            \"total_payment\": \"5.55\",\n            \"total_to_pay\": \"0\"\n        },\n        \"note\": null,\n        \"updated_at\": \"2012-11-13 16:40:09\",\n        \"created_at\": \"2012-11-13 16:40:09\",\n        \"customer\": {\n            \"id\": \"9b17ac9d-2d20-11e2-8057-080027706aa2\",\n            \"customer_code\": \"WALKIN\",\n            \"balance\": \"-6.250\",\n            \"points\": 0,\n            \"note\": null,\n            \"year_to_date\": \"79945.92188\",\n            \"sex\": \"M\",\n            \"date_of_birth\": \"1950-05-25\",\n            \"updated_at\": \"2012-11-13 16:43:15\",\n            \"created_at\": \"2012-11-13 12:28:03\"\n        },\n        \"user\": {\n            \"id\": \"9b2a8d5f-2d20-11e2-8057-080027706aa2\",\n            \"name\": \"admin\",\n            \"display_name\": \"A admin this time\",\n            \"outlet_id\": \"9ae97219-2d20-11e2-8057-080027706aa2\",\n            \"target_daily\": null,\n            \"target_weekly\": null,\n            \"target_monthly\": null,\n            \"created_at\": \"2011-09-08 05:18:38\",\n            \"updated_at\": \"2011-09-08 05:18:38\"\n        },\n        \"register_sale_products\": "=>{"\n        {\n            \"id\": \"148793f0-475a-7d49-442d-fd761ce76339\",\n            \"product_id\": \"9fe945bc-2d20-11e2-8057-080027706aa2\",\n            \"quantity\": 1,\n            \"price\": \"1.90\",\n            \"price_set\": true,\n            \"tax\": \"0.24\",\n            \"price_total\": \"1.9\",\n            \"tax_total\": \"0.24\",\n            \"tax_id\": \"9a025ff0-2d20-11e2-8057-080027706aa2\",\n            \"tax_name\": \"NZ GST\",\n            \"tax_rate\": \"0.150000\"\n        },\n        {\n            \"id\": \"7d37dc0f-9462-06fa-cae0-0b4988b36539\",\n            \"product_id\": \"a0c0df02-2d20-11e2-8057-080027706aa2\",\n            \"quantity\": 3,\n            \"price\": \"0.99\",\n            \"price_set\": true,\n            \"tax\": \"0.15\",\n            \"price_total\": \"2.97\",\n            \"tax_total\": \"0.45\",\n            \"tax_id\": \"9a025ff0-2d20-11e2-8057-080027706aa2\",\n            \"tax_name\": \"NZ GST\",\n            \"tax_rate\": \"0.150000\"\n        }"=>{",\n        \"register_sale_payments\": "=>{"\n        {\n            \"id\": \"39948e3e-bf93-1b60-ff44-f46a777ed1d4\",\n            \"payment_date\": \"2012-11-13 16:40:06\",\n            \"amount\": \"5.55\",\n            \"retailer_payment_type_id\": \"9e9ba1ba-2d20-11e2-8057-080027706aa2\",\n            \"payment_type_id\": \"1\"\n        }"=>{"\n    }\n  "=>nil}}}}}
Completed 201 Created in 182ms (Views: 0.8ms | ActiveRecord: 0.0ms)
  [1m[35m (0.6ms)[0m  ROLLBACK
  [1m[36m (0.2ms)[0m  [1mBEGIN[0m
  [1m[35m (0.3ms)[0m  ROLLBACK
Connecting to database specified by database.yml
  [1m[36mFieldGroup Load (4.2ms)[0m  [1mSELECT "field_groups".* FROM "field_groups" WHERE "field_groups"."klass_name" = 'Account' ORDER BY position[0m
  [1m[35mFieldGroup Load (0.7ms)[0m  SELECT "field_groups".* FROM "field_groups" WHERE "field_groups"."klass_name" = 'Campaign' ORDER BY position
  [1m[36mFieldGroup Load (0.8ms)[0m  [1mSELECT "field_groups".* FROM "field_groups" WHERE "field_groups"."klass_name" = 'Contact' ORDER BY position[0m
  [1m[35mFieldGroup Load (0.8ms)[0m  SELECT "field_groups".* FROM "field_groups" WHERE "field_groups"."klass_name" = 'Lead' ORDER BY position
  [1m[36mFieldGroup Load (0.9ms)[0m  [1mSELECT "field_groups".* FROM "field_groups" WHERE "field_groups"."klass_name" = 'Opportunity' ORDER BY position[0m
  [1m[35mFieldGroup Load (0.9ms)[0m  SELECT "field_groups".* FROM "field_groups" WHERE "field_groups"."klass_name" = 'Task' ORDER BY position
Creating scope :except. Overwriting existing method User.except.
  [1m[36m (160.7ms)[0m  [1mDROP DATABASE IF EXISTS "ffcrm_vend_test"[0m
  [1m[35m (387.3ms)[0m  CREATE DATABASE "ffcrm_vend_test" ENCODING = 'utf8'
  [1m[36m (18.1ms)[0m  [1mCREATE TABLE "account_contacts" ("id" serial primary key, "account_id" integer, "contact_id" integer, "deleted_at" timestamp, "created_at" timestamp NOT NULL, "updated_at" timestamp NOT NULL) [0m
  [1m[35m (7.4ms)[0m  CREATE TABLE "account_opportunities" ("id" serial primary key, "account_id" integer, "opportunity_id" integer, "deleted_at" timestamp, "created_at" timestamp NOT NULL, "updated_at" timestamp NOT NULL) 
  [1m[36m (23.1ms)[0m  [1mCREATE TABLE "accounts" ("id" serial primary key, "user_id" integer, "assigned_to" integer, "name" character varying(64) DEFAULT '' NOT NULL, "access" character varying(8) DEFAULT 'Public', "website" character varying(64), "toll_free_phone" character varying(32), "phone" character varying(32), "fax" character varying(32), "deleted_at" timestamp, "created_at" timestamp NOT NULL, "updated_at" timestamp NOT NULL, "email" character varying(64), "background_info" character varying(255), "rating" integer DEFAULT 0 NOT NULL, "category" character varying(32), "subscribed_users" text) [0m
  [1m[35m (5.9ms)[0m  CREATE INDEX "index_accounts_on_assigned_to" ON "accounts" ("assigned_to")
  [1m[36m (6.0ms)[0m  [1mCREATE UNIQUE INDEX "index_accounts_on_user_id_and_name_and_deleted_at" ON "accounts" ("user_id", "name", "deleted_at")[0m
  [1m[35m (15.6ms)[0m  CREATE TABLE "activities" ("id" serial primary key, "user_id" integer, "subject_id" integer, "subject_type" character varying(255), "action" character varying(32) DEFAULT 'created', "info" character varying(255) DEFAULT '', "private" boolean DEFAULT 'f', "created_at" timestamp NOT NULL, "updated_at" timestamp NOT NULL) 
  [1m[36m (3.7ms)[0m  [1mCREATE INDEX "index_activities_on_created_at" ON "activities" ("created_at")[0m
  [1m[35m (4.0ms)[0m  CREATE INDEX "index_activities_on_user_id" ON "activities" ("user_id")
  [1m[36m (12.4ms)[0m  [1mCREATE TABLE "addresses" ("id" serial primary key, "street1" character varying(255), "street2" character varying(255), "city" character varying(64), "state" character varying(64), "zipcode" character varying(16), "country" character varying(64), "full_address" character varying(255), "address_type" character varying(16), "addressable_id" integer, "addressable_type" character varying(255), "created_at" timestamp NOT NULL, "updated_at" timestamp NOT NULL, "deleted_at" timestamp) [0m
  [1m[35m (5.7ms)[0m  CREATE INDEX "index_addresses_on_addressable_id_and_addressable_type" ON "addresses" ("addressable_id", "addressable_type")
  [1m[36m (11.6ms)[0m  [1mCREATE TABLE "avatars" ("id" serial primary key, "user_id" integer, "entity_id" integer, "entity_type" character varying(255), "image_file_size" integer, "image_file_name" character varying(255), "image_content_type" character varying(255), "created_at" timestamp NOT NULL, "updated_at" timestamp NOT NULL) [0m
  [1m[35m (15.7ms)[0m  CREATE TABLE "campaigns" ("id" serial primary key, "user_id" integer, "assigned_to" integer, "name" character varying(64) DEFAULT '' NOT NULL, "access" character varying(8) DEFAULT 'Public', "status" character varying(64), "budget" decimal(12,2), "target_leads" integer, "target_conversion" float, "target_revenue" decimal(12,2), "leads_count" integer, "opportunities_count" integer, "revenue" decimal(12,2), "starts_on" date, "ends_on" date, "objectives" text, "deleted_at" timestamp, "created_at" timestamp NOT NULL, "updated_at" timestamp NOT NULL, "background_info" character varying(255), "subscribed_users" text) 
  [1m[36m (2.8ms)[0m  [1mCREATE INDEX "index_campaigns_on_assigned_to" ON "campaigns" ("assigned_to")[0m
  [1m[35m (3.7ms)[0m  CREATE UNIQUE INDEX "index_campaigns_on_user_id_and_name_and_deleted_at" ON "campaigns" ("user_id", "name", "deleted_at")
  [1m[36m (13.8ms)[0m  [1mCREATE TABLE "comments" ("id" serial primary key, "user_id" integer, "commentable_id" integer, "commentable_type" character varying(255), "private" boolean, "title" character varying(255) DEFAULT '', "comment" text, "created_at" timestamp NOT NULL, "updated_at" timestamp NOT NULL, "state" character varying(16) DEFAULT 'Expanded' NOT NULL) [0m
  [1m[35m (9.5ms)[0m  CREATE TABLE "contact_opportunities" ("id" serial primary key, "contact_id" integer, "opportunity_id" integer, "role" character varying(32), "deleted_at" timestamp, "created_at" timestamp NOT NULL, "updated_at" timestamp NOT NULL) 
  [1m[36m (13.2ms)[0m  [1mCREATE TABLE "contacts" ("id" serial primary key, "user_id" integer, "lead_id" integer, "assigned_to" integer, "reports_to" integer, "first_name" character varying(64) DEFAULT '' NOT NULL, "last_name" character varying(64) DEFAULT '' NOT NULL, "access" character varying(8) DEFAULT 'Public', "title" character varying(64), "department" character varying(64), "source" character varying(32), "email" character varying(64), "alt_email" character varying(64), "phone" character varying(32), "mobile" character varying(32), "fax" character varying(32), "blog" character varying(128), "linkedin" character varying(128), "facebook" character varying(128), "twitter" character varying(128), "born_on" date, "do_not_call" boolean DEFAULT 'f' NOT NULL, "deleted_at" timestamp, "created_at" timestamp NOT NULL, "updated_at" timestamp NOT NULL, "background_info" character varying(255), "skype" character varying(128), "subscribed_users" text) [0m
  [1m[35m (3.0ms)[0m  CREATE INDEX "index_contacts_on_assigned_to" ON "contacts" ("assigned_to")
  [1m[36m (4.0ms)[0m  [1mCREATE UNIQUE INDEX "id_last_name_deleted" ON "contacts" ("user_id", "last_name", "deleted_at")[0m
  [1m[35m (13.8ms)[0m  CREATE TABLE "emails" ("id" serial primary key, "imap_message_id" character varying(255) NOT NULL, "user_id" integer, "mediator_id" integer, "mediator_type" character varying(255), "sent_from" character varying(255) NOT NULL, "sent_to" character varying(255) NOT NULL, "cc" character varying(255), "bcc" character varying(255), "subject" character varying(255), "body" text, "header" text, "sent_at" timestamp, "received_at" timestamp, "deleted_at" timestamp, "created_at" timestamp NOT NULL, "updated_at" timestamp NOT NULL, "state" character varying(16) DEFAULT 'Expanded' NOT NULL) 
  [1m[36m (3.9ms)[0m  [1mCREATE INDEX "index_emails_on_mediator_id_and_mediator_type" ON "emails" ("mediator_id", "mediator_type")[0m
  [1m[35m (10.3ms)[0m  CREATE TABLE "field_groups" ("id" serial primary key, "name" character varying(64), "label" character varying(128), "position" integer, "hint" character varying(255), "created_at" timestamp NOT NULL, "updated_at" timestamp NOT NULL, "tag_id" integer, "klass_name" character varying(32)) 
  [1m[36m (10.7ms)[0m  [1mCREATE TABLE "fields" ("id" serial primary key, "type" character varying(255), "field_group_id" integer, "position" integer, "name" character varying(64), "label" character varying(128), "hint" character varying(255), "placeholder" character varying(255), "as" character varying(32), "collection" text, "disabled" boolean, "required" boolean, "maxlength" integer, "created_at" timestamp NOT NULL, "updated_at" timestamp NOT NULL) [0m
  [1m[35m (7.9ms)[0m  CREATE INDEX "index_fields_on_field_group_id" ON "fields" ("field_group_id")
  [1m[36m (3.2ms)[0m  [1mCREATE INDEX "index_fields_on_name" ON "fields" ("name")[0m
  [1m[35m (17.8ms)[0m  CREATE TABLE "leads" ("id" serial primary key, "user_id" integer, "campaign_id" integer, "assigned_to" integer, "first_name" character varying(64) DEFAULT '' NOT NULL, "last_name" character varying(64) DEFAULT '' NOT NULL, "access" character varying(8) DEFAULT 'Public', "title" character varying(64), "company" character varying(64), "source" character varying(32), "status" character varying(32), "referred_by" character varying(64), "email" character varying(64), "alt_email" character varying(64), "phone" character varying(32), "mobile" character varying(32), "blog" character varying(128), "linkedin" character varying(128), "facebook" character varying(128), "twitter" character varying(128), "rating" integer DEFAULT 0 NOT NULL, "do_not_call" boolean DEFAULT 'f' NOT NULL, "deleted_at" timestamp, "created_at" timestamp NOT NULL, "updated_at" timestamp NOT NULL, "background_info" character varying(255), "skype" character varying(128), "subscribed_users" text) 
  [1m[36m (3.9ms)[0m  [1mCREATE INDEX "index_leads_on_assigned_to" ON "leads" ("assigned_to")[0m
  [1m[35m (3.8ms)[0m  CREATE UNIQUE INDEX "index_leads_on_user_id_and_last_name_and_deleted_at" ON "leads" ("user_id", "last_name", "deleted_at")
  [1m[36m (11.2ms)[0m  [1mCREATE TABLE "lists" ("id" serial primary key, "name" character varying(255), "url" text, "created_at" timestamp NOT NULL, "updated_at" timestamp NOT NULL) [0m
  [1m[35m (15.2ms)[0m  CREATE TABLE "opportunities" ("id" serial primary key, "user_id" integer, "campaign_id" integer, "assigned_to" integer, "name" character varying(64) DEFAULT '' NOT NULL, "access" character varying(8) DEFAULT 'Public', "source" character varying(32), "stage" character varying(32), "probability" integer, "amount" decimal(12,2), "discount" decimal(12,2), "closes_on" date, "deleted_at" timestamp, "created_at" timestamp NOT NULL, "updated_at" timestamp NOT NULL, "background_info" character varying(255), "subscribed_users" text) 
  [1m[36m (3.4ms)[0m  [1mCREATE INDEX "index_opportunities_on_assigned_to" ON "opportunities" ("assigned_to")[0m
  [1m[35m (4.2ms)[0m  CREATE UNIQUE INDEX "id_name_deleted" ON "opportunities" ("user_id", "name", "deleted_at")
  [1m[36m (9.6ms)[0m  [1mCREATE TABLE "permissions" ("id" serial primary key, "user_id" integer, "asset_id" integer, "asset_type" character varying(255), "created_at" timestamp NOT NULL, "updated_at" timestamp NOT NULL) [0m
  [1m[35m (3.5ms)[0m  CREATE INDEX "index_permissions_on_asset_id_and_asset_type" ON "permissions" ("asset_id", "asset_type")
  [1m[36m (2.6ms)[0m  [1mCREATE INDEX "index_permissions_on_user_id" ON "permissions" ("user_id")[0m
  [1m[35m (12.7ms)[0m  CREATE TABLE "preferences" ("id" serial primary key, "user_id" integer, "name" character varying(32) DEFAULT '' NOT NULL, "value" text, "created_at" timestamp NOT NULL, "updated_at" timestamp NOT NULL) 
  [1m[36m (4.2ms)[0m  [1mCREATE INDEX "index_preferences_on_user_id_and_name" ON "preferences" ("user_id", "name")[0m
  [1m[35m (11.3ms)[0m  CREATE TABLE "sessions" ("id" serial primary key, "session_id" character varying(255) NOT NULL, "data" text, "created_at" timestamp NOT NULL, "updated_at" timestamp NOT NULL) 
  [1m[36m (3.0ms)[0m  [1mCREATE INDEX "index_sessions_on_session_id" ON "sessions" ("session_id")[0m
  [1m[35m (4.6ms)[0m  CREATE INDEX "index_sessions_on_updated_at" ON "sessions" ("updated_at")
  [1m[36m (11.0ms)[0m  [1mCREATE TABLE "settings" ("id" serial primary key, "name" character varying(32) DEFAULT '' NOT NULL, "value" text, "created_at" timestamp NOT NULL, "updated_at" timestamp NOT NULL) [0m
  [1m[35m (3.2ms)[0m  CREATE INDEX "index_settings_on_name" ON "settings" ("name")
  [1m[36m (12.1ms)[0m  [1mCREATE TABLE "taggings" ("id" serial primary key, "tag_id" integer, "taggable_id" integer, "tagger_id" integer, "tagger_type" character varying(255), "taggable_type" character varying(255), "context" character varying(255), "created_at" timestamp) [0m
  [1m[35m (2.8ms)[0m  CREATE INDEX "index_taggings_on_tag_id" ON "taggings" ("tag_id")
  [1m[36m (3.5ms)[0m  [1mCREATE INDEX "index_taggings_on_taggable_id_and_taggable_type_and_context" ON "taggings" ("taggable_id", "taggable_type", "context")[0m
  [1m[35m (6.7ms)[0m  CREATE TABLE "tags" ("id" serial primary key, "name" character varying(255)) 
  [1m[36m (15.4ms)[0m  [1mCREATE TABLE "tasks" ("id" serial primary key, "user_id" integer, "assigned_to" integer, "completed_by" integer, "name" character varying(255) DEFAULT '' NOT NULL, "asset_id" integer, "asset_type" character varying(255), "priority" character varying(32), "category" character varying(32), "bucket" character varying(32), "due_at" timestamp, "completed_at" timestamp, "deleted_at" timestamp, "created_at" timestamp NOT NULL, "updated_at" timestamp NOT NULL, "background_info" character varying(255), "subscribed_users" text) [0m
  [1m[35m (3.0ms)[0m  CREATE INDEX "index_tasks_on_assigned_to" ON "tasks" ("assigned_to")
  [1m[36m (3.7ms)[0m  [1mCREATE UNIQUE INDEX "index_tasks_on_user_id_and_name_and_deleted_at" ON "tasks" ("user_id", "name", "deleted_at")[0m
  [1m[35m (18.8ms)[0m  CREATE TABLE "users" ("id" serial primary key, "username" character varying(32) DEFAULT '' NOT NULL, "email" character varying(64) DEFAULT '' NOT NULL, "first_name" character varying(32), "last_name" character varying(32), "title" character varying(64), "company" character varying(64), "alt_email" character varying(64), "phone" character varying(32), "mobile" character varying(32), "aim" character varying(32), "yahoo" character varying(32), "google" character varying(32), "skype" character varying(32), "password_hash" character varying(255) DEFAULT '' NOT NULL, "password_salt" character varying(255) DEFAULT '' NOT NULL, "persistence_token" character varying(255) DEFAULT '' NOT NULL, "perishable_token" character varying(255) DEFAULT '' NOT NULL, "last_request_at" timestamp, "last_login_at" timestamp, "current_login_at" timestamp, "last_login_ip" character varying(255), "current_login_ip" character varying(255), "login_count" integer DEFAULT 0 NOT NULL, "deleted_at" timestamp, "created_at" timestamp NOT NULL, "updated_at" timestamp NOT NULL, "admin" boolean DEFAULT 'f' NOT NULL, "suspended_at" timestamp, "single_access_token" character varying(255)) 
  [1m[36m (3.0ms)[0m  [1mCREATE INDEX "index_users_on_email" ON "users" ("email")[0m
  [1m[35m (3.0ms)[0m  CREATE INDEX "index_users_on_last_request_at" ON "users" ("last_request_at")
  [1m[36m (3.7ms)[0m  [1mCREATE INDEX "index_users_on_perishable_token" ON "users" ("perishable_token")[0m
  [1m[35m (3.3ms)[0m  CREATE INDEX "index_users_on_remember_token" ON "users" ("persistence_token")
  [1m[36m (5.5ms)[0m  [1mCREATE UNIQUE INDEX "index_users_on_username_and_deleted_at" ON "users" ("username", "deleted_at")[0m
  [1m[35m (20.5ms)[0m  CREATE TABLE "versions" ("id" serial primary key, "item_type" character varying(255) NOT NULL, "item_id" integer NOT NULL, "event" character varying(512) NOT NULL, "whodunnit" character varying(255), "object" text, "created_at" timestamp, "object_changes" text, "related_id" integer, "related_type" character varying(255)) 
  [1m[36m (3.3ms)[0m  [1mCREATE INDEX "index_versions_on_item_type_and_item_id" ON "versions" ("item_type", "item_id")[0m
  [1m[35m (3.0ms)[0m  CREATE INDEX "index_versions_on_whodunnit" ON "versions" ("whodunnit")
  [1m[36m (3.3ms)[0m  [1mCREATE TABLE "schema_migrations" ("version" character varying(255) NOT NULL) [0m
  [1m[35m (2.5ms)[0m  CREATE UNIQUE INDEX "unique_schema_migrations" ON "schema_migrations" ("version")
  [1m[36m (1.0ms)[0m  [1mSELECT version FROM "schema_migrations"[0m
  [1m[35m (1.2ms)[0m  INSERT INTO "schema_migrations" (version) VALUES ('20120528102124')
  [1m[36m (0.4ms)[0m  [1mBEGIN[0m
Started POST "/vend/register_sale" for 127.0.0.1 at 2013-03-05 23:37:38 +1300
Processing by VendController#register_sale as JSON
  Parameters: {"\n    {\n        \"id\": \"5e8b5134-a002-dd6b-b7c7-26126887c4ee\",\n        \"sale_date\": \"2012-11-13 16:40:06\",\n        \"status\": \"CLOSED\",\n        \"user_id\": \"9b2a8d5f-2d20-11e2-8057-080027706aa2\",\n        \"customer_id\": \"9b17ac9d-2d20-11e2-8057-080027706aa2\",\n        \"register_id\": \"9af85e69-2d20-11e2-8057-080027706aa2\",\n        \"market_id\": \"1\",\n        \"invoice_number\": \"144\",\n        \"short_code\": \"ne2zq\",\n        \"totals\": {\n            \"total_price\": \"4.87\",\n            \"total_tax\": \"0.69\",\n            \"total_payment\": \"5.55\",\n            \"total_to_pay\": \"0\"\n        },\n        \"note\": null,\n        \"updated_at\": \"2012-11-13 16:40:09\",\n        \"created_at\": \"2012-11-13 16:40:09\",\n        \"customer\": {\n            \"id\": \"9b17ac9d-2d20-11e2-8057-080027706aa2\",\n            \"customer_code\": \"WALKIN\",\n            \"balance\": \"-6.250\",\n            \"points\": 0,\n            \"note\": null,\n            \"year_to_date\": \"79945.92188\",\n            \"sex\": \"M\",\n            \"date_of_birth\": \"1950-05-25\",\n            \"updated_at\": \"2012-11-13 16:43:15\",\n            \"created_at\": \"2012-11-13 12:28:03\"\n        },\n        \"user\": {\n            \"id\": \"9b2a8d5f-2d20-11e2-8057-080027706aa2\",\n            \"name\": \"admin\",\n            \"display_name\": \"A admin this time\",\n            \"outlet_id\": \"9ae97219-2d20-11e2-8057-080027706aa2\",\n            \"target_daily\": null,\n            \"target_weekly\": null,\n            \"target_monthly\": null,\n            \"created_at\": \"2011-09-08 05:18:38\",\n            \"updated_at\": \"2011-09-08 05:18:38\"\n        },\n        \"register_sale_products\": "=>{"\n        {\n            \"id\": \"148793f0-475a-7d49-442d-fd761ce76339\",\n            \"product_id\": \"9fe945bc-2d20-11e2-8057-080027706aa2\",\n            \"quantity\": 1,\n            \"price\": \"1.90\",\n            \"price_set\": true,\n            \"tax\": \"0.24\",\n            \"price_total\": \"1.9\",\n            \"tax_total\": \"0.24\",\n            \"tax_id\": \"9a025ff0-2d20-11e2-8057-080027706aa2\",\n            \"tax_name\": \"NZ GST\",\n            \"tax_rate\": \"0.150000\"\n        },\n        {\n            \"id\": \"7d37dc0f-9462-06fa-cae0-0b4988b36539\",\n            \"product_id\": \"a0c0df02-2d20-11e2-8057-080027706aa2\",\n            \"quantity\": 3,\n            \"price\": \"0.99\",\n            \"price_set\": true,\n            \"tax\": \"0.15\",\n            \"price_total\": \"2.97\",\n            \"tax_total\": \"0.45\",\n            \"tax_id\": \"9a025ff0-2d20-11e2-8057-080027706aa2\",\n            \"tax_name\": \"NZ GST\",\n            \"tax_rate\": \"0.150000\"\n        }"=>{",\n        \"register_sale_payments\": "=>{"\n        {\n            \"id\": \"39948e3e-bf93-1b60-ff44-f46a777ed1d4\",\n            \"payment_date\": \"2012-11-13 16:40:06\",\n            \"amount\": \"5.55\",\n            \"retailer_payment_type_id\": \"9e9ba1ba-2d20-11e2-8057-080027706aa2\",\n            \"payment_type_id\": \"1\"\n        }"=>{"\n    }\n  "=>nil}}}}}
Completed 201 Created in 169ms (Views: 0.4ms | ActiveRecord: 0.0ms)
  [1m[35m (0.7ms)[0m  ROLLBACK
  [1m[36m (0.2ms)[0m  [1mBEGIN[0m
  [1m[35m (0.3ms)[0m  ROLLBACK
Connecting to database specified by database.yml
  [1m[36mFieldGroup Load (4.6ms)[0m  [1mSELECT "field_groups".* FROM "field_groups" WHERE "field_groups"."klass_name" = 'Account' ORDER BY position[0m
  [1m[35mFieldGroup Load (0.3ms)[0m  SELECT "field_groups".* FROM "field_groups" WHERE "field_groups"."klass_name" = 'Campaign' ORDER BY position
  [1m[36mFieldGroup Load (0.3ms)[0m  [1mSELECT "field_groups".* FROM "field_groups" WHERE "field_groups"."klass_name" = 'Contact' ORDER BY position[0m
  [1m[35mFieldGroup Load (0.3ms)[0m  SELECT "field_groups".* FROM "field_groups" WHERE "field_groups"."klass_name" = 'Lead' ORDER BY position
  [1m[36mFieldGroup Load (0.2ms)[0m  [1mSELECT "field_groups".* FROM "field_groups" WHERE "field_groups"."klass_name" = 'Opportunity' ORDER BY position[0m
  [1m[35mFieldGroup Load (0.3ms)[0m  SELECT "field_groups".* FROM "field_groups" WHERE "field_groups"."klass_name" = 'Task' ORDER BY position
Creating scope :except. Overwriting existing method User.except.
  [1m[36m (125.9ms)[0m  [1mDROP DATABASE IF EXISTS "ffcrm_vend_test"[0m
  [1m[35m (365.0ms)[0m  CREATE DATABASE "ffcrm_vend_test" ENCODING = 'utf8'
  [1m[36m (8.3ms)[0m  [1mCREATE TABLE "account_contacts" ("id" serial primary key, "account_id" integer, "contact_id" integer, "deleted_at" timestamp, "created_at" timestamp NOT NULL, "updated_at" timestamp NOT NULL) [0m
  [1m[35m (2.8ms)[0m  CREATE TABLE "account_opportunities" ("id" serial primary key, "account_id" integer, "opportunity_id" integer, "deleted_at" timestamp, "created_at" timestamp NOT NULL, "updated_at" timestamp NOT NULL) 
  [1m[36m (5.4ms)[0m  [1mCREATE TABLE "accounts" ("id" serial primary key, "user_id" integer, "assigned_to" integer, "name" character varying(64) DEFAULT '' NOT NULL, "access" character varying(8) DEFAULT 'Public', "website" character varying(64), "toll_free_phone" character varying(32), "phone" character varying(32), "fax" character varying(32), "deleted_at" timestamp, "created_at" timestamp NOT NULL, "updated_at" timestamp NOT NULL, "email" character varying(64), "background_info" character varying(255), "rating" integer DEFAULT 0 NOT NULL, "category" character varying(32), "subscribed_users" text) [0m
  [1m[35m (1.2ms)[0m  CREATE INDEX "index_accounts_on_assigned_to" ON "accounts" ("assigned_to")
  [1m[36m (1.2ms)[0m  [1mCREATE UNIQUE INDEX "index_accounts_on_user_id_and_name_and_deleted_at" ON "accounts" ("user_id", "name", "deleted_at")[0m
  [1m[35m (4.5ms)[0m  CREATE TABLE "activities" ("id" serial primary key, "user_id" integer, "subject_id" integer, "subject_type" character varying(255), "action" character varying(32) DEFAULT 'created', "info" character varying(255) DEFAULT '', "private" boolean DEFAULT 'f', "created_at" timestamp NOT NULL, "updated_at" timestamp NOT NULL) 
  [1m[36m (0.9ms)[0m  [1mCREATE INDEX "index_activities_on_created_at" ON "activities" ("created_at")[0m
  [1m[35m (1.0ms)[0m  CREATE INDEX "index_activities_on_user_id" ON "activities" ("user_id")
  [1m[36m (3.7ms)[0m  [1mCREATE TABLE "addresses" ("id" serial primary key, "street1" character varying(255), "street2" character varying(255), "city" character varying(64), "state" character varying(64), "zipcode" character varying(16), "country" character varying(64), "full_address" character varying(255), "address_type" character varying(16), "addressable_id" integer, "addressable_type" character varying(255), "created_at" timestamp NOT NULL, "updated_at" timestamp NOT NULL, "deleted_at" timestamp) [0m
  [1m[35m (1.1ms)[0m  CREATE INDEX "index_addresses_on_addressable_id_and_addressable_type" ON "addresses" ("addressable_id", "addressable_type")
  [1m[36m (4.3ms)[0m  [1mCREATE TABLE "avatars" ("id" serial primary key, "user_id" integer, "entity_id" integer, "entity_type" character varying(255), "image_file_size" integer, "image_file_name" character varying(255), "image_content_type" character varying(255), "created_at" timestamp NOT NULL, "updated_at" timestamp NOT NULL) [0m
  [1m[35m (5.0ms)[0m  CREATE TABLE "campaigns" ("id" serial primary key, "user_id" integer, "assigned_to" integer, "name" character varying(64) DEFAULT '' NOT NULL, "access" character varying(8) DEFAULT 'Public', "status" character varying(64), "budget" decimal(12,2), "target_leads" integer, "target_conversion" float, "target_revenue" decimal(12,2), "leads_count" integer, "opportunities_count" integer, "revenue" decimal(12,2), "starts_on" date, "ends_on" date, "objectives" text, "deleted_at" timestamp, "created_at" timestamp NOT NULL, "updated_at" timestamp NOT NULL, "background_info" character varying(255), "subscribed_users" text) 
  [1m[36m (1.0ms)[0m  [1mCREATE INDEX "index_campaigns_on_assigned_to" ON "campaigns" ("assigned_to")[0m
  [1m[35m (1.3ms)[0m  CREATE UNIQUE INDEX "index_campaigns_on_user_id_and_name_and_deleted_at" ON "campaigns" ("user_id", "name", "deleted_at")
  [1m[36m (4.6ms)[0m  [1mCREATE TABLE "comments" ("id" serial primary key, "user_id" integer, "commentable_id" integer, "commentable_type" character varying(255), "private" boolean, "title" character varying(255) DEFAULT '', "comment" text, "created_at" timestamp NOT NULL, "updated_at" timestamp NOT NULL, "state" character varying(16) DEFAULT 'Expanded' NOT NULL) [0m
  [1m[35m (2.9ms)[0m  CREATE TABLE "contact_opportunities" ("id" serial primary key, "contact_id" integer, "opportunity_id" integer, "role" character varying(32), "deleted_at" timestamp, "created_at" timestamp NOT NULL, "updated_at" timestamp NOT NULL) 
  [1m[36m (5.8ms)[0m  [1mCREATE TABLE "contacts" ("id" serial primary key, "user_id" integer, "lead_id" integer, "assigned_to" integer, "reports_to" integer, "first_name" character varying(64) DEFAULT '' NOT NULL, "last_name" character varying(64) DEFAULT '' NOT NULL, "access" character varying(8) DEFAULT 'Public', "title" character varying(64), "department" character varying(64), "source" character varying(32), "email" character varying(64), "alt_email" character varying(64), "phone" character varying(32), "mobile" character varying(32), "fax" character varying(32), "blog" character varying(128), "linkedin" character varying(128), "facebook" character varying(128), "twitter" character varying(128), "born_on" date, "do_not_call" boolean DEFAULT 'f' NOT NULL, "deleted_at" timestamp, "created_at" timestamp NOT NULL, "updated_at" timestamp NOT NULL, "background_info" character varying(255), "skype" character varying(128), "subscribed_users" text) [0m
  [1m[35m (1.2ms)[0m  CREATE INDEX "index_contacts_on_assigned_to" ON "contacts" ("assigned_to")
  [1m[36m (1.4ms)[0m  [1mCREATE UNIQUE INDEX "id_last_name_deleted" ON "contacts" ("user_id", "last_name", "deleted_at")[0m
  [1m[35m (7.5ms)[0m  CREATE TABLE "emails" ("id" serial primary key, "imap_message_id" character varying(255) NOT NULL, "user_id" integer, "mediator_id" integer, "mediator_type" character varying(255), "sent_from" character varying(255) NOT NULL, "sent_to" character varying(255) NOT NULL, "cc" character varying(255), "bcc" character varying(255), "subject" character varying(255), "body" text, "header" text, "sent_at" timestamp, "received_at" timestamp, "deleted_at" timestamp, "created_at" timestamp NOT NULL, "updated_at" timestamp NOT NULL, "state" character varying(16) DEFAULT 'Expanded' NOT NULL) 
  [1m[36m (1.1ms)[0m  [1mCREATE INDEX "index_emails_on_mediator_id_and_mediator_type" ON "emails" ("mediator_id", "mediator_type")[0m
  [1m[35m (2.9ms)[0m  CREATE TABLE "field_groups" ("id" serial primary key, "name" character varying(64), "label" character varying(128), "position" integer, "hint" character varying(255), "created_at" timestamp NOT NULL, "updated_at" timestamp NOT NULL, "tag_id" integer, "klass_name" character varying(32)) 
  [1m[36m (3.8ms)[0m  [1mCREATE TABLE "fields" ("id" serial primary key, "type" character varying(255), "field_group_id" integer, "position" integer, "name" character varying(64), "label" character varying(128), "hint" character varying(255), "placeholder" character varying(255), "as" character varying(32), "collection" text, "disabled" boolean, "required" boolean, "maxlength" integer, "created_at" timestamp NOT NULL, "updated_at" timestamp NOT NULL) [0m
  [1m[35m (0.9ms)[0m  CREATE INDEX "index_fields_on_field_group_id" ON "fields" ("field_group_id")
  [1m[36m (1.1ms)[0m  [1mCREATE INDEX "index_fields_on_name" ON "fields" ("name")[0m
  [1m[35m (5.3ms)[0m  CREATE TABLE "leads" ("id" serial primary key, "user_id" integer, "campaign_id" integer, "assigned_to" integer, "first_name" character varying(64) DEFAULT '' NOT NULL, "last_name" character varying(64) DEFAULT '' NOT NULL, "access" character varying(8) DEFAULT 'Public', "title" character varying(64), "company" character varying(64), "source" character varying(32), "status" character varying(32), "referred_by" character varying(64), "email" character varying(64), "alt_email" character varying(64), "phone" character varying(32), "mobile" character varying(32), "blog" character varying(128), "linkedin" character varying(128), "facebook" character varying(128), "twitter" character varying(128), "rating" integer DEFAULT 0 NOT NULL, "do_not_call" boolean DEFAULT 'f' NOT NULL, "deleted_at" timestamp, "created_at" timestamp NOT NULL, "updated_at" timestamp NOT NULL, "background_info" character varying(255), "skype" character varying(128), "subscribed_users" text) 
  [1m[36m (1.2ms)[0m  [1mCREATE INDEX "index_leads_on_assigned_to" ON "leads" ("assigned_to")[0m
  [1m[35m (1.3ms)[0m  CREATE UNIQUE INDEX "index_leads_on_user_id_and_last_name_and_deleted_at" ON "leads" ("user_id", "last_name", "deleted_at")
  [1m[36m (3.5ms)[0m  [1mCREATE TABLE "lists" ("id" serial primary key, "name" character varying(255), "url" text, "created_at" timestamp NOT NULL, "updated_at" timestamp NOT NULL) [0m
  [1m[35m (5.1ms)[0m  CREATE TABLE "opportunities" ("id" serial primary key, "user_id" integer, "campaign_id" integer, "assigned_to" integer, "name" character varying(64) DEFAULT '' NOT NULL, "access" character varying(8) DEFAULT 'Public', "source" character varying(32), "stage" character varying(32), "probability" integer, "amount" decimal(12,2), "discount" decimal(12,2), "closes_on" date, "deleted_at" timestamp, "created_at" timestamp NOT NULL, "updated_at" timestamp NOT NULL, "background_info" character varying(255), "subscribed_users" text) 
  [1m[36m (0.8ms)[0m  [1mCREATE INDEX "index_opportunities_on_assigned_to" ON "opportunities" ("assigned_to")[0m
  [1m[35m (1.2ms)[0m  CREATE UNIQUE INDEX "id_name_deleted" ON "opportunities" ("user_id", "name", "deleted_at")
  [1m[36m (3.1ms)[0m  [1mCREATE TABLE "permissions" ("id" serial primary key, "user_id" integer, "asset_id" integer, "asset_type" character varying(255), "created_at" timestamp NOT NULL, "updated_at" timestamp NOT NULL) [0m
  [1m[35m (1.1ms)[0m  CREATE INDEX "index_permissions_on_asset_id_and_asset_type" ON "permissions" ("asset_id", "asset_type")
  [1m[36m (1.0ms)[0m  [1mCREATE INDEX "index_permissions_on_user_id" ON "permissions" ("user_id")[0m
  [1m[35m (4.0ms)[0m  CREATE TABLE "preferences" ("id" serial primary key, "user_id" integer, "name" character varying(32) DEFAULT '' NOT NULL, "value" text, "created_at" timestamp NOT NULL, "updated_at" timestamp NOT NULL) 
  [1m[36m (1.1ms)[0m  [1mCREATE INDEX "index_preferences_on_user_id_and_name" ON "preferences" ("user_id", "name")[0m
  [1m[35m (4.0ms)[0m  CREATE TABLE "sessions" ("id" serial primary key, "session_id" character varying(255) NOT NULL, "data" text, "created_at" timestamp NOT NULL, "updated_at" timestamp NOT NULL) 
  [1m[36m (1.1ms)[0m  [1mCREATE INDEX "index_sessions_on_session_id" ON "sessions" ("session_id")[0m
  [1m[35m (1.2ms)[0m  CREATE INDEX "index_sessions_on_updated_at" ON "sessions" ("updated_at")
  [1m[36m (4.3ms)[0m  [1mCREATE TABLE "settings" ("id" serial primary key, "name" character varying(32) DEFAULT '' NOT NULL, "value" text, "created_at" timestamp NOT NULL, "updated_at" timestamp NOT NULL) [0m
  [1m[35m (1.0ms)[0m  CREATE INDEX "index_settings_on_name" ON "settings" ("name")
  [1m[36m (4.4ms)[0m  [1mCREATE TABLE "taggings" ("id" serial primary key, "tag_id" integer, "taggable_id" integer, "tagger_id" integer, "tagger_type" character varying(255), "taggable_type" character varying(255), "context" character varying(255), "created_at" timestamp) [0m
  [1m[35m (1.1ms)[0m  CREATE INDEX "index_taggings_on_tag_id" ON "taggings" ("tag_id")
  [1m[36m (1.2ms)[0m  [1mCREATE INDEX "index_taggings_on_taggable_id_and_taggable_type_and_context" ON "taggings" ("taggable_id", "taggable_type", "context")[0m
  [1m[35m (2.4ms)[0m  CREATE TABLE "tags" ("id" serial primary key, "name" character varying(255)) 
  [1m[36m (3.2ms)[0m  [1mCREATE TABLE "tasks" ("id" serial primary key, "user_id" integer, "assigned_to" integer, "completed_by" integer, "name" character varying(255) DEFAULT '' NOT NULL, "asset_id" integer, "asset_type" character varying(255), "priority" character varying(32), "category" character varying(32), "bucket" character varying(32), "due_at" timestamp, "completed_at" timestamp, "deleted_at" timestamp, "created_at" timestamp NOT NULL, "updated_at" timestamp NOT NULL, "background_info" character varying(255), "subscribed_users" text) [0m
  [1m[35m (0.8ms)[0m  CREATE INDEX "index_tasks_on_assigned_to" ON "tasks" ("assigned_to")
  [1m[36m (1.4ms)[0m  [1mCREATE UNIQUE INDEX "index_tasks_on_user_id_and_name_and_deleted_at" ON "tasks" ("user_id", "name", "deleted_at")[0m
  [1m[35m (4.3ms)[0m  CREATE TABLE "users" ("id" serial primary key, "username" character varying(32) DEFAULT '' NOT NULL, "email" character varying(64) DEFAULT '' NOT NULL, "first_name" character varying(32), "last_name" character varying(32), "title" character varying(64), "company" character varying(64), "alt_email" character varying(64), "phone" character varying(32), "mobile" character varying(32), "aim" character varying(32), "yahoo" character varying(32), "google" character varying(32), "skype" character varying(32), "password_hash" character varying(255) DEFAULT '' NOT NULL, "password_salt" character varying(255) DEFAULT '' NOT NULL, "persistence_token" character varying(255) DEFAULT '' NOT NULL, "perishable_token" character varying(255) DEFAULT '' NOT NULL, "last_request_at" timestamp, "last_login_at" timestamp, "current_login_at" timestamp, "last_login_ip" character varying(255), "current_login_ip" character varying(255), "login_count" integer DEFAULT 0 NOT NULL, "deleted_at" timestamp, "created_at" timestamp NOT NULL, "updated_at" timestamp NOT NULL, "admin" boolean DEFAULT 'f' NOT NULL, "suspended_at" timestamp, "single_access_token" character varying(255)) 
  [1m[36m (1.2ms)[0m  [1mCREATE INDEX "index_users_on_email" ON "users" ("email")[0m
  [1m[35m (1.0ms)[0m  CREATE INDEX "index_users_on_last_request_at" ON "users" ("last_request_at")
  [1m[36m (0.9ms)[0m  [1mCREATE INDEX "index_users_on_perishable_token" ON "users" ("perishable_token")[0m
  [1m[35m (0.9ms)[0m  CREATE INDEX "index_users_on_remember_token" ON "users" ("persistence_token")
  [1m[36m (1.5ms)[0m  [1mCREATE UNIQUE INDEX "index_users_on_username_and_deleted_at" ON "users" ("username", "deleted_at")[0m
  [1m[35m (4.2ms)[0m  CREATE TABLE "versions" ("id" serial primary key, "item_type" character varying(255) NOT NULL, "item_id" integer NOT NULL, "event" character varying(512) NOT NULL, "whodunnit" character varying(255), "object" text, "created_at" timestamp, "object_changes" text, "related_id" integer, "related_type" character varying(255)) 
  [1m[36m (1.1ms)[0m  [1mCREATE INDEX "index_versions_on_item_type_and_item_id" ON "versions" ("item_type", "item_id")[0m
  [1m[35m (1.0ms)[0m  CREATE INDEX "index_versions_on_whodunnit" ON "versions" ("whodunnit")
  [1m[36m (1.0ms)[0m  [1mCREATE TABLE "schema_migrations" ("version" character varying(255) NOT NULL) [0m
  [1m[35m (0.9ms)[0m  CREATE UNIQUE INDEX "unique_schema_migrations" ON "schema_migrations" ("version")
  [1m[36m (0.2ms)[0m  [1mSELECT version FROM "schema_migrations"[0m
  [1m[35m (0.4ms)[0m  INSERT INTO "schema_migrations" (version) VALUES ('20120528102124')
  [1m[36m (0.1ms)[0m  [1mBEGIN[0m
  [1m[35m (0.4ms)[0m  ROLLBACK
  [1m[36m (0.1ms)[0m  [1mBEGIN[0m
Started POST "/vend/register_sale" for 127.0.0.1 at 2013-03-06 09:09:22 +1300
Processing by VendController#register_sale as JSON
  Parameters: {"\n    {\n        \"id\": \"5e8b5134-a002-dd6b-b7c7-26126887c4ee\",\n        \"sale_date\": \"2012-11-13 16:40:06\",\n        \"status\": \"CLOSED\",\n        \"user_id\": \"9b2a8d5f-2d20-11e2-8057-080027706aa2\",\n        \"customer_id\": \"9b17ac9d-2d20-11e2-8057-080027706aa2\",\n        \"register_id\": \"9af85e69-2d20-11e2-8057-080027706aa2\",\n        \"market_id\": \"1\",\n        \"invoice_number\": \"144\",\n        \"short_code\": \"ne2zq\",\n        \"totals\": {\n            \"total_price\": \"4.87\",\n            \"total_tax\": \"0.69\",\n            \"total_payment\": \"5.55\",\n            \"total_to_pay\": \"0\"\n        },\n        \"note\": null,\n        \"updated_at\": \"2012-11-13 16:40:09\",\n        \"created_at\": \"2012-11-13 16:40:09\",\n        \"customer\": {\n            \"id\": \"9b17ac9d-2d20-11e2-8057-080027706aa2\",\n            \"customer_code\": \"WALKIN\",\n            \"balance\": \"-6.250\",\n            \"points\": 0,\n            \"note\": null,\n            \"year_to_date\": \"79945.92188\",\n            \"sex\": \"M\",\n            \"date_of_birth\": \"1950-05-25\",\n            \"updated_at\": \"2012-11-13 16:43:15\",\n            \"created_at\": \"2012-11-13 12:28:03\"\n        },\n        \"user\": {\n            \"id\": \"9b2a8d5f-2d20-11e2-8057-080027706aa2\",\n            \"name\": \"admin\",\n            \"display_name\": \"A admin this time\",\n            \"outlet_id\": \"9ae97219-2d20-11e2-8057-080027706aa2\",\n            \"target_daily\": null,\n            \"target_weekly\": null,\n            \"target_monthly\": null,\n            \"created_at\": \"2011-09-08 05:18:38\",\n            \"updated_at\": \"2011-09-08 05:18:38\"\n        },\n        \"register_sale_products\": "=>{"\n        {\n            \"id\": \"148793f0-475a-7d49-442d-fd761ce76339\",\n            \"product_id\": \"9fe945bc-2d20-11e2-8057-080027706aa2\",\n            \"quantity\": 1,\n            \"price\": \"1.90\",\n            \"price_set\": true,\n            \"tax\": \"0.24\",\n            \"price_total\": \"1.9\",\n            \"tax_total\": \"0.24\",\n            \"tax_id\": \"9a025ff0-2d20-11e2-8057-080027706aa2\",\n            \"tax_name\": \"NZ GST\",\n            \"tax_rate\": \"0.150000\"\n        },\n        {\n            \"id\": \"7d37dc0f-9462-06fa-cae0-0b4988b36539\",\n            \"product_id\": \"a0c0df02-2d20-11e2-8057-080027706aa2\",\n            \"quantity\": 3,\n            \"price\": \"0.99\",\n            \"price_set\": true,\n            \"tax\": \"0.15\",\n            \"price_total\": \"2.97\",\n            \"tax_total\": \"0.45\",\n            \"tax_id\": \"9a025ff0-2d20-11e2-8057-080027706aa2\",\n            \"tax_name\": \"NZ GST\",\n            \"tax_rate\": \"0.150000\"\n        }"=>{",\n        \"register_sale_payments\": "=>{"\n        {\n            \"id\": \"39948e3e-bf93-1b60-ff44-f46a777ed1d4\",\n            \"payment_date\": \"2012-11-13 16:40:06\",\n            \"amount\": \"5.55\",\n            \"retailer_payment_type_id\": \"9e9ba1ba-2d20-11e2-8057-080027706aa2\",\n            \"payment_type_id\": \"1\"\n        }"=>{"\n    }\n  "=>nil}}}}}
Completed 500 Internal Server Error in 4ms
  [1m[35m (0.1ms)[0m  ROLLBACK
Connecting to database specified by database.yml
  [1m[36mFieldGroup Load (1.4ms)[0m  [1mSELECT "field_groups".* FROM "field_groups" WHERE "field_groups"."klass_name" = 'Account' ORDER BY position[0m
  [1m[35mFieldGroup Load (0.3ms)[0m  SELECT "field_groups".* FROM "field_groups" WHERE "field_groups"."klass_name" = 'Campaign' ORDER BY position
  [1m[36mFieldGroup Load (0.2ms)[0m  [1mSELECT "field_groups".* FROM "field_groups" WHERE "field_groups"."klass_name" = 'Contact' ORDER BY position[0m
  [1m[35mFieldGroup Load (0.3ms)[0m  SELECT "field_groups".* FROM "field_groups" WHERE "field_groups"."klass_name" = 'Lead' ORDER BY position
  [1m[36mFieldGroup Load (0.2ms)[0m  [1mSELECT "field_groups".* FROM "field_groups" WHERE "field_groups"."klass_name" = 'Opportunity' ORDER BY position[0m
  [1m[35mFieldGroup Load (0.3ms)[0m  SELECT "field_groups".* FROM "field_groups" WHERE "field_groups"."klass_name" = 'Task' ORDER BY position
Creating scope :except. Overwriting existing method User.except.
  [1m[36m (124.1ms)[0m  [1mDROP DATABASE IF EXISTS "ffcrm_vend_test"[0m
  [1m[35m (246.7ms)[0m  CREATE DATABASE "ffcrm_vend_test" ENCODING = 'utf8'
  [1m[36m (6.3ms)[0m  [1mCREATE TABLE "account_contacts" ("id" serial primary key, "account_id" integer, "contact_id" integer, "deleted_at" timestamp, "created_at" timestamp NOT NULL, "updated_at" timestamp NOT NULL) [0m
  [1m[35m (3.0ms)[0m  CREATE TABLE "account_opportunities" ("id" serial primary key, "account_id" integer, "opportunity_id" integer, "deleted_at" timestamp, "created_at" timestamp NOT NULL, "updated_at" timestamp NOT NULL) 
  [1m[36m (4.8ms)[0m  [1mCREATE TABLE "accounts" ("id" serial primary key, "user_id" integer, "assigned_to" integer, "name" character varying(64) DEFAULT '' NOT NULL, "access" character varying(8) DEFAULT 'Public', "website" character varying(64), "toll_free_phone" character varying(32), "phone" character varying(32), "fax" character varying(32), "deleted_at" timestamp, "created_at" timestamp NOT NULL, "updated_at" timestamp NOT NULL, "email" character varying(64), "background_info" character varying(255), "rating" integer DEFAULT 0 NOT NULL, "category" character varying(32), "subscribed_users" text) [0m
  [1m[35m (1.5ms)[0m  CREATE INDEX "index_accounts_on_assigned_to" ON "accounts" ("assigned_to")
  [1m[36m (1.2ms)[0m  [1mCREATE UNIQUE INDEX "index_accounts_on_user_id_and_name_and_deleted_at" ON "accounts" ("user_id", "name", "deleted_at")[0m
  [1m[35m (4.6ms)[0m  CREATE TABLE "activities" ("id" serial primary key, "user_id" integer, "subject_id" integer, "subject_type" character varying(255), "action" character varying(32) DEFAULT 'created', "info" character varying(255) DEFAULT '', "private" boolean DEFAULT 'f', "created_at" timestamp NOT NULL, "updated_at" timestamp NOT NULL) 
  [1m[36m (1.0ms)[0m  [1mCREATE INDEX "index_activities_on_created_at" ON "activities" ("created_at")[0m
  [1m[35m (1.0ms)[0m  CREATE INDEX "index_activities_on_user_id" ON "activities" ("user_id")
  [1m[36m (4.2ms)[0m  [1mCREATE TABLE "addresses" ("id" serial primary key, "street1" character varying(255), "street2" character varying(255), "city" character varying(64), "state" character varying(64), "zipcode" character varying(16), "country" character varying(64), "full_address" character varying(255), "address_type" character varying(16), "addressable_id" integer, "addressable_type" character varying(255), "created_at" timestamp NOT NULL, "updated_at" timestamp NOT NULL, "deleted_at" timestamp) [0m
  [1m[35m (1.3ms)[0m  CREATE INDEX "index_addresses_on_addressable_id_and_addressable_type" ON "addresses" ("addressable_id", "addressable_type")
  [1m[36m (3.0ms)[0m  [1mCREATE TABLE "avatars" ("id" serial primary key, "user_id" integer, "entity_id" integer, "entity_type" character varying(255), "image_file_size" integer, "image_file_name" character varying(255), "image_content_type" character varying(255), "created_at" timestamp NOT NULL, "updated_at" timestamp NOT NULL) [0m
  [1m[35m (4.4ms)[0m  CREATE TABLE "campaigns" ("id" serial primary key, "user_id" integer, "assigned_to" integer, "name" character varying(64) DEFAULT '' NOT NULL, "access" character varying(8) DEFAULT 'Public', "status" character varying(64), "budget" decimal(12,2), "target_leads" integer, "target_conversion" float, "target_revenue" decimal(12,2), "leads_count" integer, "opportunities_count" integer, "revenue" decimal(12,2), "starts_on" date, "ends_on" date, "objectives" text, "deleted_at" timestamp, "created_at" timestamp NOT NULL, "updated_at" timestamp NOT NULL, "background_info" character varying(255), "subscribed_users" text) 
  [1m[36m (1.0ms)[0m  [1mCREATE INDEX "index_campaigns_on_assigned_to" ON "campaigns" ("assigned_to")[0m
  [1m[35m (1.2ms)[0m  CREATE UNIQUE INDEX "index_campaigns_on_user_id_and_name_and_deleted_at" ON "campaigns" ("user_id", "name", "deleted_at")
  [1m[36m (4.2ms)[0m  [1mCREATE TABLE "comments" ("id" serial primary key, "user_id" integer, "commentable_id" integer, "commentable_type" character varying(255), "private" boolean, "title" character varying(255) DEFAULT '', "comment" text, "created_at" timestamp NOT NULL, "updated_at" timestamp NOT NULL, "state" character varying(16) DEFAULT 'Expanded' NOT NULL) [0m
  [1m[35m (3.0ms)[0m  CREATE TABLE "contact_opportunities" ("id" serial primary key, "contact_id" integer, "opportunity_id" integer, "role" character varying(32), "deleted_at" timestamp, "created_at" timestamp NOT NULL, "updated_at" timestamp NOT NULL) 
  [1m[36m (4.2ms)[0m  [1mCREATE TABLE "contacts" ("id" serial primary key, "user_id" integer, "lead_id" integer, "assigned_to" integer, "reports_to" integer, "first_name" character varying(64) DEFAULT '' NOT NULL, "last_name" character varying(64) DEFAULT '' NOT NULL, "access" character varying(8) DEFAULT 'Public', "title" character varying(64), "department" character varying(64), "source" character varying(32), "email" character varying(64), "alt_email" character varying(64), "phone" character varying(32), "mobile" character varying(32), "fax" character varying(32), "blog" character varying(128), "linkedin" character varying(128), "facebook" character varying(128), "twitter" character varying(128), "born_on" date, "do_not_call" boolean DEFAULT 'f' NOT NULL, "deleted_at" timestamp, "created_at" timestamp NOT NULL, "updated_at" timestamp NOT NULL, "background_info" character varying(255), "skype" character varying(128), "subscribed_users" text) [0m
  [1m[35m (1.1ms)[0m  CREATE INDEX "index_contacts_on_assigned_to" ON "contacts" ("assigned_to")
  [1m[36m (1.4ms)[0m  [1mCREATE UNIQUE INDEX "id_last_name_deleted" ON "contacts" ("user_id", "last_name", "deleted_at")[0m
  [1m[35m (3.8ms)[0m  CREATE TABLE "emails" ("id" serial primary key, "imap_message_id" character varying(255) NOT NULL, "user_id" integer, "mediator_id" integer, "mediator_type" character varying(255), "sent_from" character varying(255) NOT NULL, "sent_to" character varying(255) NOT NULL, "cc" character varying(255), "bcc" character varying(255), "subject" character varying(255), "body" text, "header" text, "sent_at" timestamp, "received_at" timestamp, "deleted_at" timestamp, "created_at" timestamp NOT NULL, "updated_at" timestamp NOT NULL, "state" character varying(16) DEFAULT 'Expanded' NOT NULL) 
  [1m[36m (0.9ms)[0m  [1mCREATE INDEX "index_emails_on_mediator_id_and_mediator_type" ON "emails" ("mediator_id", "mediator_type")[0m
  [1m[35m (3.0ms)[0m  CREATE TABLE "field_groups" ("id" serial primary key, "name" character varying(64), "label" character varying(128), "position" integer, "hint" character varying(255), "created_at" timestamp NOT NULL, "updated_at" timestamp NOT NULL, "tag_id" integer, "klass_name" character varying(32)) 
  [1m[36m (4.0ms)[0m  [1mCREATE TABLE "fields" ("id" serial primary key, "type" character varying(255), "field_group_id" integer, "position" integer, "name" character varying(64), "label" character varying(128), "hint" character varying(255), "placeholder" character varying(255), "as" character varying(32), "collection" text, "disabled" boolean, "required" boolean, "maxlength" integer, "created_at" timestamp NOT NULL, "updated_at" timestamp NOT NULL) [0m
  [1m[35m (0.9ms)[0m  CREATE INDEX "index_fields_on_field_group_id" ON "fields" ("field_group_id")
  [1m[36m (1.1ms)[0m  [1mCREATE INDEX "index_fields_on_name" ON "fields" ("name")[0m
  [1m[35m (5.1ms)[0m  CREATE TABLE "leads" ("id" serial primary key, "user_id" integer, "campaign_id" integer, "assigned_to" integer, "first_name" character varying(64) DEFAULT '' NOT NULL, "last_name" character varying(64) DEFAULT '' NOT NULL, "access" character varying(8) DEFAULT 'Public', "title" character varying(64), "company" character varying(64), "source" character varying(32), "status" character varying(32), "referred_by" character varying(64), "email" character varying(64), "alt_email" character varying(64), "phone" character varying(32), "mobile" character varying(32), "blog" character varying(128), "linkedin" character varying(128), "facebook" character varying(128), "twitter" character varying(128), "rating" integer DEFAULT 0 NOT NULL, "do_not_call" boolean DEFAULT 'f' NOT NULL, "deleted_at" timestamp, "created_at" timestamp NOT NULL, "updated_at" timestamp NOT NULL, "background_info" character varying(255), "skype" character varying(128), "subscribed_users" text) 
  [1m[36m (1.1ms)[0m  [1mCREATE INDEX "index_leads_on_assigned_to" ON "leads" ("assigned_to")[0m
  [1m[35m (12.7ms)[0m  CREATE UNIQUE INDEX "index_leads_on_user_id_and_last_name_and_deleted_at" ON "leads" ("user_id", "last_name", "deleted_at")
  [1m[36m (5.7ms)[0m  [1mCREATE TABLE "lists" ("id" serial primary key, "name" character varying(255), "url" text, "created_at" timestamp NOT NULL, "updated_at" timestamp NOT NULL) [0m
  [1m[35m (5.0ms)[0m  CREATE TABLE "opportunities" ("id" serial primary key, "user_id" integer, "campaign_id" integer, "assigned_to" integer, "name" character varying(64) DEFAULT '' NOT NULL, "access" character varying(8) DEFAULT 'Public', "source" character varying(32), "stage" character varying(32), "probability" integer, "amount" decimal(12,2), "discount" decimal(12,2), "closes_on" date, "deleted_at" timestamp, "created_at" timestamp NOT NULL, "updated_at" timestamp NOT NULL, "background_info" character varying(255), "subscribed_users" text) 
  [1m[36m (1.0ms)[0m  [1mCREATE INDEX "index_opportunities_on_assigned_to" ON "opportunities" ("assigned_to")[0m
  [1m[35m (1.3ms)[0m  CREATE UNIQUE INDEX "id_name_deleted" ON "opportunities" ("user_id", "name", "deleted_at")
  [1m[36m (3.2ms)[0m  [1mCREATE TABLE "permissions" ("id" serial primary key, "user_id" integer, "asset_id" integer, "asset_type" character varying(255), "created_at" timestamp NOT NULL, "updated_at" timestamp NOT NULL) [0m
  [1m[35m (7.0ms)[0m  CREATE INDEX "index_permissions_on_asset_id_and_asset_type" ON "permissions" ("asset_id", "asset_type")
  [1m[36m (1.4ms)[0m  [1mCREATE INDEX "index_permissions_on_user_id" ON "permissions" ("user_id")[0m
  [1m[35m (5.2ms)[0m  CREATE TABLE "preferences" ("id" serial primary key, "user_id" integer, "name" character varying(32) DEFAULT '' NOT NULL, "value" text, "created_at" timestamp NOT NULL, "updated_at" timestamp NOT NULL) 
  [1m[36m (1.3ms)[0m  [1mCREATE INDEX "index_preferences_on_user_id_and_name" ON "preferences" ("user_id", "name")[0m
  [1m[35m (3.2ms)[0m  CREATE TABLE "sessions" ("id" serial primary key, "session_id" character varying(255) NOT NULL, "data" text, "created_at" timestamp NOT NULL, "updated_at" timestamp NOT NULL) 
  [1m[36m (1.1ms)[0m  [1mCREATE INDEX "index_sessions_on_session_id" ON "sessions" ("session_id")[0m
  [1m[35m (0.8ms)[0m  CREATE INDEX "index_sessions_on_updated_at" ON "sessions" ("updated_at")
  [1m[36m (4.2ms)[0m  [1mCREATE TABLE "settings" ("id" serial primary key, "name" character varying(32) DEFAULT '' NOT NULL, "value" text, "created_at" timestamp NOT NULL, "updated_at" timestamp NOT NULL) [0m
  [1m[35m (1.0ms)[0m  CREATE INDEX "index_settings_on_name" ON "settings" ("name")
  [1m[36m (9.4ms)[0m  [1mCREATE TABLE "taggings" ("id" serial primary key, "tag_id" integer, "taggable_id" integer, "tagger_id" integer, "tagger_type" character varying(255), "taggable_type" character varying(255), "context" character varying(255), "created_at" timestamp) [0m
  [1m[35m (1.1ms)[0m  CREATE INDEX "index_taggings_on_tag_id" ON "taggings" ("tag_id")
  [1m[36m (1.2ms)[0m  [1mCREATE INDEX "index_taggings_on_taggable_id_and_taggable_type_and_context" ON "taggings" ("taggable_id", "taggable_type", "context")[0m
  [1m[35m (3.0ms)[0m  CREATE TABLE "tags" ("id" serial primary key, "name" character varying(255)) 
  [1m[36m (4.5ms)[0m  [1mCREATE TABLE "tasks" ("id" serial primary key, "user_id" integer, "assigned_to" integer, "completed_by" integer, "name" character varying(255) DEFAULT '' NOT NULL, "asset_id" integer, "asset_type" character varying(255), "priority" character varying(32), "category" character varying(32), "bucket" character varying(32), "due_at" timestamp, "completed_at" timestamp, "deleted_at" timestamp, "created_at" timestamp NOT NULL, "updated_at" timestamp NOT NULL, "background_info" character varying(255), "subscribed_users" text) [0m
  [1m[35m (1.0ms)[0m  CREATE INDEX "index_tasks_on_assigned_to" ON "tasks" ("assigned_to")
  [1m[36m (1.4ms)[0m  [1mCREATE UNIQUE INDEX "index_tasks_on_user_id_and_name_and_deleted_at" ON "tasks" ("user_id", "name", "deleted_at")[0m
  [1m[35m (5.1ms)[0m  CREATE TABLE "users" ("id" serial primary key, "username" character varying(32) DEFAULT '' NOT NULL, "email" character varying(64) DEFAULT '' NOT NULL, "first_name" character varying(32), "last_name" character varying(32), "title" character varying(64), "company" character varying(64), "alt_email" character varying(64), "phone" character varying(32), "mobile" character varying(32), "aim" character varying(32), "yahoo" character varying(32), "google" character varying(32), "skype" character varying(32), "password_hash" character varying(255) DEFAULT '' NOT NULL, "password_salt" character varying(255) DEFAULT '' NOT NULL, "persistence_token" character varying(255) DEFAULT '' NOT NULL, "perishable_token" character varying(255) DEFAULT '' NOT NULL, "last_request_at" timestamp, "last_login_at" timestamp, "current_login_at" timestamp, "last_login_ip" character varying(255), "current_login_ip" character varying(255), "login_count" integer DEFAULT 0 NOT NULL, "deleted_at" timestamp, "created_at" timestamp NOT NULL, "updated_at" timestamp NOT NULL, "admin" boolean DEFAULT 'f' NOT NULL, "suspended_at" timestamp, "single_access_token" character varying(255)) 
  [1m[36m (1.2ms)[0m  [1mCREATE INDEX "index_users_on_email" ON "users" ("email")[0m
  [1m[35m (1.2ms)[0m  CREATE INDEX "index_users_on_last_request_at" ON "users" ("last_request_at")
  [1m[36m (1.1ms)[0m  [1mCREATE INDEX "index_users_on_perishable_token" ON "users" ("perishable_token")[0m
  [1m[35m (1.2ms)[0m  CREATE INDEX "index_users_on_remember_token" ON "users" ("persistence_token")
  [1m[36m (1.1ms)[0m  [1mCREATE UNIQUE INDEX "index_users_on_username_and_deleted_at" ON "users" ("username", "deleted_at")[0m
  [1m[35m (4.4ms)[0m  CREATE TABLE "versions" ("id" serial primary key, "item_type" character varying(255) NOT NULL, "item_id" integer NOT NULL, "event" character varying(512) NOT NULL, "whodunnit" character varying(255), "object" text, "created_at" timestamp, "object_changes" text, "related_id" integer, "related_type" character varying(255)) 
  [1m[36m (1.1ms)[0m  [1mCREATE INDEX "index_versions_on_item_type_and_item_id" ON "versions" ("item_type", "item_id")[0m
  [1m[35m (1.2ms)[0m  CREATE INDEX "index_versions_on_whodunnit" ON "versions" ("whodunnit")
  [1m[36m (0.9ms)[0m  [1mCREATE TABLE "schema_migrations" ("version" character varying(255) NOT NULL) [0m
  [1m[35m (1.0ms)[0m  CREATE UNIQUE INDEX "unique_schema_migrations" ON "schema_migrations" ("version")
  [1m[36m (0.3ms)[0m  [1mSELECT version FROM "schema_migrations"[0m
  [1m[35m (0.4ms)[0m  INSERT INTO "schema_migrations" (version) VALUES ('20120528102124')
  [1m[36m (0.2ms)[0m  [1mBEGIN[0m
Started POST "/vend/register_sale" for 127.0.0.1 at 2013-03-06 09:12:17 +1300
Processing by VendController#register_sale as JSON
  Parameters: {"\n    {\n        \"id\": \"5e8b5134-a002-dd6b-b7c7-26126887c4ee\",\n        \"sale_date\": \"2012-11-13 16:40:06\",\n        \"status\": \"CLOSED\",\n        \"user_id\": \"9b2a8d5f-2d20-11e2-8057-080027706aa2\",\n        \"customer_id\": \"9b17ac9d-2d20-11e2-8057-080027706aa2\",\n        \"register_id\": \"9af85e69-2d20-11e2-8057-080027706aa2\",\n        \"market_id\": \"1\",\n        \"invoice_number\": \"144\",\n        \"short_code\": \"ne2zq\",\n        \"totals\": {\n            \"total_price\": \"4.87\",\n            \"total_tax\": \"0.69\",\n            \"total_payment\": \"5.55\",\n            \"total_to_pay\": \"0\"\n        },\n        \"note\": null,\n        \"updated_at\": \"2012-11-13 16:40:09\",\n        \"created_at\": \"2012-11-13 16:40:09\",\n        \"customer\": {\n            \"id\": \"9b17ac9d-2d20-11e2-8057-080027706aa2\",\n            \"customer_code\": \"WALKIN\",\n            \"balance\": \"-6.250\",\n            \"points\": 0,\n            \"note\": null,\n            \"year_to_date\": \"79945.92188\",\n            \"sex\": \"M\",\n            \"date_of_birth\": \"1950-05-25\",\n            \"updated_at\": \"2012-11-13 16:43:15\",\n            \"created_at\": \"2012-11-13 12:28:03\"\n        },\n        \"user\": {\n            \"id\": \"9b2a8d5f-2d20-11e2-8057-080027706aa2\",\n            \"name\": \"admin\",\n            \"display_name\": \"A admin this time\",\n            \"outlet_id\": \"9ae97219-2d20-11e2-8057-080027706aa2\",\n            \"target_daily\": null,\n            \"target_weekly\": null,\n            \"target_monthly\": null,\n            \"created_at\": \"2011-09-08 05:18:38\",\n            \"updated_at\": \"2011-09-08 05:18:38\"\n        },\n        \"register_sale_products\": "=>{"\n        {\n            \"id\": \"148793f0-475a-7d49-442d-fd761ce76339\",\n            \"product_id\": \"9fe945bc-2d20-11e2-8057-080027706aa2\",\n            \"quantity\": 1,\n            \"price\": \"1.90\",\n            \"price_set\": true,\n            \"tax\": \"0.24\",\n            \"price_total\": \"1.9\",\n            \"tax_total\": \"0.24\",\n            \"tax_id\": \"9a025ff0-2d20-11e2-8057-080027706aa2\",\n            \"tax_name\": \"NZ GST\",\n            \"tax_rate\": \"0.150000\"\n        },\n        {\n            \"id\": \"7d37dc0f-9462-06fa-cae0-0b4988b36539\",\n            \"product_id\": \"a0c0df02-2d20-11e2-8057-080027706aa2\",\n            \"quantity\": 3,\n            \"price\": \"0.99\",\n            \"price_set\": true,\n            \"tax\": \"0.15\",\n            \"price_total\": \"2.97\",\n            \"tax_total\": \"0.45\",\n            \"tax_id\": \"9a025ff0-2d20-11e2-8057-080027706aa2\",\n            \"tax_name\": \"NZ GST\",\n            \"tax_rate\": \"0.150000\"\n        }"=>{",\n        \"register_sale_payments\": "=>{"\n        {\n            \"id\": \"39948e3e-bf93-1b60-ff44-f46a777ed1d4\",\n            \"payment_date\": \"2012-11-13 16:40:06\",\n            \"amount\": \"5.55\",\n            \"retailer_payment_type_id\": \"9e9ba1ba-2d20-11e2-8057-080027706aa2\",\n            \"payment_type_id\": \"1\"\n        }"=>{"\n    }\n  "=>nil}}}}}
Completed 500 Internal Server Error in 5ms
  [1m[35m (0.3ms)[0m  ROLLBACK
  [1m[36m (0.1ms)[0m  [1mBEGIN[0m
  [1m[35m (0.1ms)[0m  ROLLBACK
Connecting to database specified by database.yml
  [1m[36mFieldGroup Load (1.2ms)[0m  [1mSELECT "field_groups".* FROM "field_groups" WHERE "field_groups"."klass_name" = 'Account' ORDER BY position[0m
  [1m[35mFieldGroup Load (0.3ms)[0m  SELECT "field_groups".* FROM "field_groups" WHERE "field_groups"."klass_name" = 'Campaign' ORDER BY position
  [1m[36mFieldGroup Load (0.2ms)[0m  [1mSELECT "field_groups".* FROM "field_groups" WHERE "field_groups"."klass_name" = 'Contact' ORDER BY position[0m
  [1m[35mFieldGroup Load (0.3ms)[0m  SELECT "field_groups".* FROM "field_groups" WHERE "field_groups"."klass_name" = 'Lead' ORDER BY position
  [1m[36mFieldGroup Load (0.3ms)[0m  [1mSELECT "field_groups".* FROM "field_groups" WHERE "field_groups"."klass_name" = 'Opportunity' ORDER BY position[0m
  [1m[35mFieldGroup Load (0.3ms)[0m  SELECT "field_groups".* FROM "field_groups" WHERE "field_groups"."klass_name" = 'Task' ORDER BY position
Creating scope :except. Overwriting existing method User.except.
  [1m[36m (122.4ms)[0m  [1mDROP DATABASE IF EXISTS "ffcrm_vend_test"[0m
  [1m[35m (251.3ms)[0m  CREATE DATABASE "ffcrm_vend_test" ENCODING = 'utf8'
  [1m[36m (6.1ms)[0m  [1mCREATE TABLE "account_contacts" ("id" serial primary key, "account_id" integer, "contact_id" integer, "deleted_at" timestamp, "created_at" timestamp NOT NULL, "updated_at" timestamp NOT NULL) [0m
  [1m[35m (2.7ms)[0m  CREATE TABLE "account_opportunities" ("id" serial primary key, "account_id" integer, "opportunity_id" integer, "deleted_at" timestamp, "created_at" timestamp NOT NULL, "updated_at" timestamp NOT NULL) 
  [1m[36m (4.6ms)[0m  [1mCREATE TABLE "accounts" ("id" serial primary key, "user_id" integer, "assigned_to" integer, "name" character varying(64) DEFAULT '' NOT NULL, "access" character varying(8) DEFAULT 'Public', "website" character varying(64), "toll_free_phone" character varying(32), "phone" character varying(32), "fax" character varying(32), "deleted_at" timestamp, "created_at" timestamp NOT NULL, "updated_at" timestamp NOT NULL, "email" character varying(64), "background_info" character varying(255), "rating" integer DEFAULT 0 NOT NULL, "category" character varying(32), "subscribed_users" text) [0m
  [1m[35m (1.2ms)[0m  CREATE INDEX "index_accounts_on_assigned_to" ON "accounts" ("assigned_to")
  [1m[36m (1.8ms)[0m  [1mCREATE UNIQUE INDEX "index_accounts_on_user_id_and_name_and_deleted_at" ON "accounts" ("user_id", "name", "deleted_at")[0m
  [1m[35m (5.0ms)[0m  CREATE TABLE "activities" ("id" serial primary key, "user_id" integer, "subject_id" integer, "subject_type" character varying(255), "action" character varying(32) DEFAULT 'created', "info" character varying(255) DEFAULT '', "private" boolean DEFAULT 'f', "created_at" timestamp NOT NULL, "updated_at" timestamp NOT NULL) 
  [1m[36m (1.0ms)[0m  [1mCREATE INDEX "index_activities_on_created_at" ON "activities" ("created_at")[0m
  [1m[35m (1.0ms)[0m  CREATE INDEX "index_activities_on_user_id" ON "activities" ("user_id")
  [1m[36m (4.5ms)[0m  [1mCREATE TABLE "addresses" ("id" serial primary key, "street1" character varying(255), "street2" character varying(255), "city" character varying(64), "state" character varying(64), "zipcode" character varying(16), "country" character varying(64), "full_address" character varying(255), "address_type" character varying(16), "addressable_id" integer, "addressable_type" character varying(255), "created_at" timestamp NOT NULL, "updated_at" timestamp NOT NULL, "deleted_at" timestamp) [0m
  [1m[35m (1.0ms)[0m  CREATE INDEX "index_addresses_on_addressable_id_and_addressable_type" ON "addresses" ("addressable_id", "addressable_type")
  [1m[36m (4.3ms)[0m  [1mCREATE TABLE "avatars" ("id" serial primary key, "user_id" integer, "entity_id" integer, "entity_type" character varying(255), "image_file_size" integer, "image_file_name" character varying(255), "image_content_type" character varying(255), "created_at" timestamp NOT NULL, "updated_at" timestamp NOT NULL) [0m
  [1m[35m (4.6ms)[0m  CREATE TABLE "campaigns" ("id" serial primary key, "user_id" integer, "assigned_to" integer, "name" character varying(64) DEFAULT '' NOT NULL, "access" character varying(8) DEFAULT 'Public', "status" character varying(64), "budget" decimal(12,2), "target_leads" integer, "target_conversion" float, "target_revenue" decimal(12,2), "leads_count" integer, "opportunities_count" integer, "revenue" decimal(12,2), "starts_on" date, "ends_on" date, "objectives" text, "deleted_at" timestamp, "created_at" timestamp NOT NULL, "updated_at" timestamp NOT NULL, "background_info" character varying(255), "subscribed_users" text) 
  [1m[36m (1.4ms)[0m  [1mCREATE INDEX "index_campaigns_on_assigned_to" ON "campaigns" ("assigned_to")[0m
  [1m[35m (1.2ms)[0m  CREATE UNIQUE INDEX "index_campaigns_on_user_id_and_name_and_deleted_at" ON "campaigns" ("user_id", "name", "deleted_at")
  [1m[36m (4.5ms)[0m  [1mCREATE TABLE "comments" ("id" serial primary key, "user_id" integer, "commentable_id" integer, "commentable_type" character varying(255), "private" boolean, "title" character varying(255) DEFAULT '', "comment" text, "created_at" timestamp NOT NULL, "updated_at" timestamp NOT NULL, "state" character varying(16) DEFAULT 'Expanded' NOT NULL) [0m
  [1m[35m (3.3ms)[0m  CREATE TABLE "contact_opportunities" ("id" serial primary key, "contact_id" integer, "opportunity_id" integer, "role" character varying(32), "deleted_at" timestamp, "created_at" timestamp NOT NULL, "updated_at" timestamp NOT NULL) 
  [1m[36m (5.0ms)[0m  [1mCREATE TABLE "contacts" ("id" serial primary key, "user_id" integer, "lead_id" integer, "assigned_to" integer, "reports_to" integer, "first_name" character varying(64) DEFAULT '' NOT NULL, "last_name" character varying(64) DEFAULT '' NOT NULL, "access" character varying(8) DEFAULT 'Public', "title" character varying(64), "department" character varying(64), "source" character varying(32), "email" character varying(64), "alt_email" character varying(64), "phone" character varying(32), "mobile" character varying(32), "fax" character varying(32), "blog" character varying(128), "linkedin" character varying(128), "facebook" character varying(128), "twitter" character varying(128), "born_on" date, "do_not_call" boolean DEFAULT 'f' NOT NULL, "deleted_at" timestamp, "created_at" timestamp NOT NULL, "updated_at" timestamp NOT NULL, "background_info" character varying(255), "skype" character varying(128), "subscribed_users" text) [0m
  [1m[35m (0.8ms)[0m  CREATE INDEX "index_contacts_on_assigned_to" ON "contacts" ("assigned_to")
  [1m[36m (1.1ms)[0m  [1mCREATE UNIQUE INDEX "id_last_name_deleted" ON "contacts" ("user_id", "last_name", "deleted_at")[0m
  [1m[35m (3.8ms)[0m  CREATE TABLE "emails" ("id" serial primary key, "imap_message_id" character varying(255) NOT NULL, "user_id" integer, "mediator_id" integer, "mediator_type" character varying(255), "sent_from" character varying(255) NOT NULL, "sent_to" character varying(255) NOT NULL, "cc" character varying(255), "bcc" character varying(255), "subject" character varying(255), "body" text, "header" text, "sent_at" timestamp, "received_at" timestamp, "deleted_at" timestamp, "created_at" timestamp NOT NULL, "updated_at" timestamp NOT NULL, "state" character varying(16) DEFAULT 'Expanded' NOT NULL) 
  [1m[36m (1.7ms)[0m  [1mCREATE INDEX "index_emails_on_mediator_id_and_mediator_type" ON "emails" ("mediator_id", "mediator_type")[0m
  [1m[35m (3.6ms)[0m  CREATE TABLE "field_groups" ("id" serial primary key, "name" character varying(64), "label" character varying(128), "position" integer, "hint" character varying(255), "created_at" timestamp NOT NULL, "updated_at" timestamp NOT NULL, "tag_id" integer, "klass_name" character varying(32)) 
  [1m[36m (3.9ms)[0m  [1mCREATE TABLE "fields" ("id" serial primary key, "type" character varying(255), "field_group_id" integer, "position" integer, "name" character varying(64), "label" character varying(128), "hint" character varying(255), "placeholder" character varying(255), "as" character varying(32), "collection" text, "disabled" boolean, "required" boolean, "maxlength" integer, "created_at" timestamp NOT NULL, "updated_at" timestamp NOT NULL) [0m
  [1m[35m (1.1ms)[0m  CREATE INDEX "index_fields_on_field_group_id" ON "fields" ("field_group_id")
  [1m[36m (1.3ms)[0m  [1mCREATE INDEX "index_fields_on_name" ON "fields" ("name")[0m
  [1m[35m (26.4ms)[0m  CREATE TABLE "leads" ("id" serial primary key, "user_id" integer, "campaign_id" integer, "assigned_to" integer, "first_name" character varying(64) DEFAULT '' NOT NULL, "last_name" character varying(64) DEFAULT '' NOT NULL, "access" character varying(8) DEFAULT 'Public', "title" character varying(64), "company" character varying(64), "source" character varying(32), "status" character varying(32), "referred_by" character varying(64), "email" character varying(64), "alt_email" character varying(64), "phone" character varying(32), "mobile" character varying(32), "blog" character varying(128), "linkedin" character varying(128), "facebook" character varying(128), "twitter" character varying(128), "rating" integer DEFAULT 0 NOT NULL, "do_not_call" boolean DEFAULT 'f' NOT NULL, "deleted_at" timestamp, "created_at" timestamp NOT NULL, "updated_at" timestamp NOT NULL, "background_info" character varying(255), "skype" character varying(128), "subscribed_users" text) 
  [1m[36m (1.1ms)[0m  [1mCREATE INDEX "index_leads_on_assigned_to" ON "leads" ("assigned_to")[0m
  [1m[35m (1.2ms)[0m  CREATE UNIQUE INDEX "index_leads_on_user_id_and_last_name_and_deleted_at" ON "leads" ("user_id", "last_name", "deleted_at")
  [1m[36m (4.4ms)[0m  [1mCREATE TABLE "lists" ("id" serial primary key, "name" character varying(255), "url" text, "created_at" timestamp NOT NULL, "updated_at" timestamp NOT NULL) [0m
  [1m[35m (13.1ms)[0m  CREATE TABLE "opportunities" ("id" serial primary key, "user_id" integer, "campaign_id" integer, "assigned_to" integer, "name" character varying(64) DEFAULT '' NOT NULL, "access" character varying(8) DEFAULT 'Public', "source" character varying(32), "stage" character varying(32), "probability" integer, "amount" decimal(12,2), "discount" decimal(12,2), "closes_on" date, "deleted_at" timestamp, "created_at" timestamp NOT NULL, "updated_at" timestamp NOT NULL, "background_info" character varying(255), "subscribed_users" text) 
  [1m[36m (7.0ms)[0m  [1mCREATE INDEX "index_opportunities_on_assigned_to" ON "opportunities" ("assigned_to")[0m
  [1m[35m (1.4ms)[0m  CREATE UNIQUE INDEX "id_name_deleted" ON "opportunities" ("user_id", "name", "deleted_at")
  [1m[36m (2.9ms)[0m  [1mCREATE TABLE "permissions" ("id" serial primary key, "user_id" integer, "asset_id" integer, "asset_type" character varying(255), "created_at" timestamp NOT NULL, "updated_at" timestamp NOT NULL) [0m
  [1m[35m (1.2ms)[0m  CREATE INDEX "index_permissions_on_asset_id_and_asset_type" ON "permissions" ("asset_id", "asset_type")
  [1m[36m (1.0ms)[0m  [1mCREATE INDEX "index_permissions_on_user_id" ON "permissions" ("user_id")[0m
  [1m[35m (3.7ms)[0m  CREATE TABLE "preferences" ("id" serial primary key, "user_id" integer, "name" character varying(32) DEFAULT '' NOT NULL, "value" text, "created_at" timestamp NOT NULL, "updated_at" timestamp NOT NULL) 
  [1m[36m (0.9ms)[0m  [1mCREATE INDEX "index_preferences_on_user_id_and_name" ON "preferences" ("user_id", "name")[0m
  [1m[35m (13.5ms)[0m  CREATE TABLE "sessions" ("id" serial primary key, "session_id" character varying(255) NOT NULL, "data" text, "created_at" timestamp NOT NULL, "updated_at" timestamp NOT NULL) 
  [1m[36m (1.0ms)[0m  [1mCREATE INDEX "index_sessions_on_session_id" ON "sessions" ("session_id")[0m
  [1m[35m (1.0ms)[0m  CREATE INDEX "index_sessions_on_updated_at" ON "sessions" ("updated_at")
  [1m[36m (4.2ms)[0m  [1mCREATE TABLE "settings" ("id" serial primary key, "name" character varying(32) DEFAULT '' NOT NULL, "value" text, "created_at" timestamp NOT NULL, "updated_at" timestamp NOT NULL) [0m
  [1m[35m (1.2ms)[0m  CREATE INDEX "index_settings_on_name" ON "settings" ("name")
  [1m[36m (5.9ms)[0m  [1mCREATE TABLE "taggings" ("id" serial primary key, "tag_id" integer, "taggable_id" integer, "tagger_id" integer, "tagger_type" character varying(255), "taggable_type" character varying(255), "context" character varying(255), "created_at" timestamp) [0m
  [1m[35m (1.1ms)[0m  CREATE INDEX "index_taggings_on_tag_id" ON "taggings" ("tag_id")
  [1m[36m (1.1ms)[0m  [1mCREATE INDEX "index_taggings_on_taggable_id_and_taggable_type_and_context" ON "taggings" ("taggable_id", "taggable_type", "context")[0m
  [1m[35m (3.0ms)[0m  CREATE TABLE "tags" ("id" serial primary key, "name" character varying(255)) 
  [1m[36m (4.0ms)[0m  [1mCREATE TABLE "tasks" ("id" serial primary key, "user_id" integer, "assigned_to" integer, "completed_by" integer, "name" character varying(255) DEFAULT '' NOT NULL, "asset_id" integer, "asset_type" character varying(255), "priority" character varying(32), "category" character varying(32), "bucket" character varying(32), "due_at" timestamp, "completed_at" timestamp, "deleted_at" timestamp, "created_at" timestamp NOT NULL, "updated_at" timestamp NOT NULL, "background_info" character varying(255), "subscribed_users" text) [0m
  [1m[35m (1.1ms)[0m  CREATE INDEX "index_tasks_on_assigned_to" ON "tasks" ("assigned_to")
  [1m[36m (1.0ms)[0m  [1mCREATE UNIQUE INDEX "index_tasks_on_user_id_and_name_and_deleted_at" ON "tasks" ("user_id", "name", "deleted_at")[0m
  [1m[35m (4.4ms)[0m  CREATE TABLE "users" ("id" serial primary key, "username" character varying(32) DEFAULT '' NOT NULL, "email" character varying(64) DEFAULT '' NOT NULL, "first_name" character varying(32), "last_name" character varying(32), "title" character varying(64), "company" character varying(64), "alt_email" character varying(64), "phone" character varying(32), "mobile" character varying(32), "aim" character varying(32), "yahoo" character varying(32), "google" character varying(32), "skype" character varying(32), "password_hash" character varying(255) DEFAULT '' NOT NULL, "password_salt" character varying(255) DEFAULT '' NOT NULL, "persistence_token" character varying(255) DEFAULT '' NOT NULL, "perishable_token" character varying(255) DEFAULT '' NOT NULL, "last_request_at" timestamp, "last_login_at" timestamp, "current_login_at" timestamp, "last_login_ip" character varying(255), "current_login_ip" character varying(255), "login_count" integer DEFAULT 0 NOT NULL, "deleted_at" timestamp, "created_at" timestamp NOT NULL, "updated_at" timestamp NOT NULL, "admin" boolean DEFAULT 'f' NOT NULL, "suspended_at" timestamp, "single_access_token" character varying(255)) 
  [1m[36m (1.2ms)[0m  [1mCREATE INDEX "index_users_on_email" ON "users" ("email")[0m
  [1m[35m (1.0ms)[0m  CREATE INDEX "index_users_on_last_request_at" ON "users" ("last_request_at")
  [1m[36m (1.2ms)[0m  [1mCREATE INDEX "index_users_on_perishable_token" ON "users" ("perishable_token")[0m
  [1m[35m (1.4ms)[0m  CREATE INDEX "index_users_on_remember_token" ON "users" ("persistence_token")
  [1m[36m (1.2ms)[0m  [1mCREATE UNIQUE INDEX "index_users_on_username_and_deleted_at" ON "users" ("username", "deleted_at")[0m
  [1m[35m (4.3ms)[0m  CREATE TABLE "versions" ("id" serial primary key, "item_type" character varying(255) NOT NULL, "item_id" integer NOT NULL, "event" character varying(512) NOT NULL, "whodunnit" character varying(255), "object" text, "created_at" timestamp, "object_changes" text, "related_id" integer, "related_type" character varying(255)) 
  [1m[36m (1.1ms)[0m  [1mCREATE INDEX "index_versions_on_item_type_and_item_id" ON "versions" ("item_type", "item_id")[0m
  [1m[35m (1.2ms)[0m  CREATE INDEX "index_versions_on_whodunnit" ON "versions" ("whodunnit")
  [1m[36m (0.9ms)[0m  [1mCREATE TABLE "schema_migrations" ("version" character varying(255) NOT NULL) [0m
  [1m[35m (1.0ms)[0m  CREATE UNIQUE INDEX "unique_schema_migrations" ON "schema_migrations" ("version")
  [1m[36m (0.3ms)[0m  [1mSELECT version FROM "schema_migrations"[0m
  [1m[35m (0.5ms)[0m  INSERT INTO "schema_migrations" (version) VALUES ('20120528102124')
  [1m[36m (0.1ms)[0m  [1mBEGIN[0m
Started POST "/vend/register_sale" for 127.0.0.1 at 2013-03-06 09:12:52 +1300
Processing by VendController#register_sale as JSON
  Parameters: {"\n    {\n        \"id\": \"5e8b5134-a002-dd6b-b7c7-26126887c4ee\",\n        \"sale_date\": \"2012-11-13 16:40:06\",\n        \"status\": \"CLOSED\",\n        \"user_id\": \"9b2a8d5f-2d20-11e2-8057-080027706aa2\",\n        \"customer_id\": \"9b17ac9d-2d20-11e2-8057-080027706aa2\",\n        \"register_id\": \"9af85e69-2d20-11e2-8057-080027706aa2\",\n        \"market_id\": \"1\",\n        \"invoice_number\": \"144\",\n        \"short_code\": \"ne2zq\",\n        \"totals\": {\n            \"total_price\": \"4.87\",\n            \"total_tax\": \"0.69\",\n            \"total_payment\": \"5.55\",\n            \"total_to_pay\": \"0\"\n        },\n        \"note\": null,\n        \"updated_at\": \"2012-11-13 16:40:09\",\n        \"created_at\": \"2012-11-13 16:40:09\",\n        \"customer\": {\n            \"id\": \"9b17ac9d-2d20-11e2-8057-080027706aa2\",\n            \"customer_code\": \"WALKIN\",\n            \"balance\": \"-6.250\",\n            \"points\": 0,\n            \"note\": null,\n            \"year_to_date\": \"79945.92188\",\n            \"sex\": \"M\",\n            \"date_of_birth\": \"1950-05-25\",\n            \"updated_at\": \"2012-11-13 16:43:15\",\n            \"created_at\": \"2012-11-13 12:28:03\"\n        },\n        \"user\": {\n            \"id\": \"9b2a8d5f-2d20-11e2-8057-080027706aa2\",\n            \"name\": \"admin\",\n            \"display_name\": \"A admin this time\",\n            \"outlet_id\": \"9ae97219-2d20-11e2-8057-080027706aa2\",\n            \"target_daily\": null,\n            \"target_weekly\": null,\n            \"target_monthly\": null,\n            \"created_at\": \"2011-09-08 05:18:38\",\n            \"updated_at\": \"2011-09-08 05:18:38\"\n        },\n        \"register_sale_products\": "=>{"\n        {\n            \"id\": \"148793f0-475a-7d49-442d-fd761ce76339\",\n            \"product_id\": \"9fe945bc-2d20-11e2-8057-080027706aa2\",\n            \"quantity\": 1,\n            \"price\": \"1.90\",\n            \"price_set\": true,\n            \"tax\": \"0.24\",\n            \"price_total\": \"1.9\",\n            \"tax_total\": \"0.24\",\n            \"tax_id\": \"9a025ff0-2d20-11e2-8057-080027706aa2\",\n            \"tax_name\": \"NZ GST\",\n            \"tax_rate\": \"0.150000\"\n        },\n        {\n            \"id\": \"7d37dc0f-9462-06fa-cae0-0b4988b36539\",\n            \"product_id\": \"a0c0df02-2d20-11e2-8057-080027706aa2\",\n            \"quantity\": 3,\n            \"price\": \"0.99\",\n            \"price_set\": true,\n            \"tax\": \"0.15\",\n            \"price_total\": \"2.97\",\n            \"tax_total\": \"0.45\",\n            \"tax_id\": \"9a025ff0-2d20-11e2-8057-080027706aa2\",\n            \"tax_name\": \"NZ GST\",\n            \"tax_rate\": \"0.150000\"\n        }"=>{",\n        \"register_sale_payments\": "=>{"\n        {\n            \"id\": \"39948e3e-bf93-1b60-ff44-f46a777ed1d4\",\n            \"payment_date\": \"2012-11-13 16:40:06\",\n            \"amount\": \"5.55\",\n            \"retailer_payment_type_id\": \"9e9ba1ba-2d20-11e2-8057-080027706aa2\",\n            \"payment_type_id\": \"1\"\n        }"=>{"\n    }\n  "=>nil}}}}}
Completed 500 Internal Server Error in 5ms
  [1m[35m (0.3ms)[0m  ROLLBACK
  [1m[36m (0.1ms)[0m  [1mBEGIN[0m
  [1m[35m (0.1ms)[0m  ROLLBACK
Connecting to database specified by database.yml
  [1m[36mFieldGroup Load (4.3ms)[0m  [1mSELECT "field_groups".* FROM "field_groups" WHERE "field_groups"."klass_name" = 'Account' ORDER BY position[0m
  [1m[35mFieldGroup Load (0.3ms)[0m  SELECT "field_groups".* FROM "field_groups" WHERE "field_groups"."klass_name" = 'Campaign' ORDER BY position
  [1m[36mFieldGroup Load (0.2ms)[0m  [1mSELECT "field_groups".* FROM "field_groups" WHERE "field_groups"."klass_name" = 'Contact' ORDER BY position[0m
  [1m[35mFieldGroup Load (0.3ms)[0m  SELECT "field_groups".* FROM "field_groups" WHERE "field_groups"."klass_name" = 'Lead' ORDER BY position
  [1m[36mFieldGroup Load (0.2ms)[0m  [1mSELECT "field_groups".* FROM "field_groups" WHERE "field_groups"."klass_name" = 'Opportunity' ORDER BY position[0m
  [1m[35mFieldGroup Load (0.3ms)[0m  SELECT "field_groups".* FROM "field_groups" WHERE "field_groups"."klass_name" = 'Task' ORDER BY position
Creating scope :except. Overwriting existing method User.except.
  [1m[36m (144.1ms)[0m  [1mDROP DATABASE IF EXISTS "ffcrm_vend_test"[0m
  [1m[35m (383.4ms)[0m  CREATE DATABASE "ffcrm_vend_test" ENCODING = 'utf8'
  [1m[36m (7.0ms)[0m  [1mCREATE TABLE "account_contacts" ("id" serial primary key, "account_id" integer, "contact_id" integer, "deleted_at" timestamp, "created_at" timestamp NOT NULL, "updated_at" timestamp NOT NULL) [0m
  [1m[35m (2.2ms)[0m  CREATE TABLE "account_opportunities" ("id" serial primary key, "account_id" integer, "opportunity_id" integer, "deleted_at" timestamp, "created_at" timestamp NOT NULL, "updated_at" timestamp NOT NULL) 
  [1m[36m (5.2ms)[0m  [1mCREATE TABLE "accounts" ("id" serial primary key, "user_id" integer, "assigned_to" integer, "name" character varying(64) DEFAULT '' NOT NULL, "access" character varying(8) DEFAULT 'Public', "website" character varying(64), "toll_free_phone" character varying(32), "phone" character varying(32), "fax" character varying(32), "deleted_at" timestamp, "created_at" timestamp NOT NULL, "updated_at" timestamp NOT NULL, "email" character varying(64), "background_info" character varying(255), "rating" integer DEFAULT 0 NOT NULL, "category" character varying(32), "subscribed_users" text) [0m
  [1m[35m (1.2ms)[0m  CREATE INDEX "index_accounts_on_assigned_to" ON "accounts" ("assigned_to")
  [1m[36m (1.5ms)[0m  [1mCREATE UNIQUE INDEX "index_accounts_on_user_id_and_name_and_deleted_at" ON "accounts" ("user_id", "name", "deleted_at")[0m
  [1m[35m (4.8ms)[0m  CREATE TABLE "activities" ("id" serial primary key, "user_id" integer, "subject_id" integer, "subject_type" character varying(255), "action" character varying(32) DEFAULT 'created', "info" character varying(255) DEFAULT '', "private" boolean DEFAULT 'f', "created_at" timestamp NOT NULL, "updated_at" timestamp NOT NULL) 
  [1m[36m (0.9ms)[0m  [1mCREATE INDEX "index_activities_on_created_at" ON "activities" ("created_at")[0m
  [1m[35m (0.9ms)[0m  CREATE INDEX "index_activities_on_user_id" ON "activities" ("user_id")
  [1m[36m (3.4ms)[0m  [1mCREATE TABLE "addresses" ("id" serial primary key, "street1" character varying(255), "street2" character varying(255), "city" character varying(64), "state" character varying(64), "zipcode" character varying(16), "country" character varying(64), "full_address" character varying(255), "address_type" character varying(16), "addressable_id" integer, "addressable_type" character varying(255), "created_at" timestamp NOT NULL, "updated_at" timestamp NOT NULL, "deleted_at" timestamp) [0m
  [1m[35m (1.1ms)[0m  CREATE INDEX "index_addresses_on_addressable_id_and_addressable_type" ON "addresses" ("addressable_id", "addressable_type")
  [1m[36m (4.1ms)[0m  [1mCREATE TABLE "avatars" ("id" serial primary key, "user_id" integer, "entity_id" integer, "entity_type" character varying(255), "image_file_size" integer, "image_file_name" character varying(255), "image_content_type" character varying(255), "created_at" timestamp NOT NULL, "updated_at" timestamp NOT NULL) [0m
  [1m[35m (5.5ms)[0m  CREATE TABLE "campaigns" ("id" serial primary key, "user_id" integer, "assigned_to" integer, "name" character varying(64) DEFAULT '' NOT NULL, "access" character varying(8) DEFAULT 'Public', "status" character varying(64), "budget" decimal(12,2), "target_leads" integer, "target_conversion" float, "target_revenue" decimal(12,2), "leads_count" integer, "opportunities_count" integer, "revenue" decimal(12,2), "starts_on" date, "ends_on" date, "objectives" text, "deleted_at" timestamp, "created_at" timestamp NOT NULL, "updated_at" timestamp NOT NULL, "background_info" character varying(255), "subscribed_users" text) 
  [1m[36m (1.1ms)[0m  [1mCREATE INDEX "index_campaigns_on_assigned_to" ON "campaigns" ("assigned_to")[0m
  [1m[35m (1.4ms)[0m  CREATE UNIQUE INDEX "index_campaigns_on_user_id_and_name_and_deleted_at" ON "campaigns" ("user_id", "name", "deleted_at")
  [1m[36m (4.7ms)[0m  [1mCREATE TABLE "comments" ("id" serial primary key, "user_id" integer, "commentable_id" integer, "commentable_type" character varying(255), "private" boolean, "title" character varying(255) DEFAULT '', "comment" text, "created_at" timestamp NOT NULL, "updated_at" timestamp NOT NULL, "state" character varying(16) DEFAULT 'Expanded' NOT NULL) [0m
  [1m[35m (2.8ms)[0m  CREATE TABLE "contact_opportunities" ("id" serial primary key, "contact_id" integer, "opportunity_id" integer, "role" character varying(32), "deleted_at" timestamp, "created_at" timestamp NOT NULL, "updated_at" timestamp NOT NULL) 
  [1m[36m (5.2ms)[0m  [1mCREATE TABLE "contacts" ("id" serial primary key, "user_id" integer, "lead_id" integer, "assigned_to" integer, "reports_to" integer, "first_name" character varying(64) DEFAULT '' NOT NULL, "last_name" character varying(64) DEFAULT '' NOT NULL, "access" character varying(8) DEFAULT 'Public', "title" character varying(64), "department" character varying(64), "source" character varying(32), "email" character varying(64), "alt_email" character varying(64), "phone" character varying(32), "mobile" character varying(32), "fax" character varying(32), "blog" character varying(128), "linkedin" character varying(128), "facebook" character varying(128), "twitter" character varying(128), "born_on" date, "do_not_call" boolean DEFAULT 'f' NOT NULL, "deleted_at" timestamp, "created_at" timestamp NOT NULL, "updated_at" timestamp NOT NULL, "background_info" character varying(255), "skype" character varying(128), "subscribed_users" text) [0m
  [1m[35m (1.1ms)[0m  CREATE INDEX "index_contacts_on_assigned_to" ON "contacts" ("assigned_to")
  [1m[36m (1.3ms)[0m  [1mCREATE UNIQUE INDEX "id_last_name_deleted" ON "contacts" ("user_id", "last_name", "deleted_at")[0m
  [1m[35m (3.7ms)[0m  CREATE TABLE "emails" ("id" serial primary key, "imap_message_id" character varying(255) NOT NULL, "user_id" integer, "mediator_id" integer, "mediator_type" character varying(255), "sent_from" character varying(255) NOT NULL, "sent_to" character varying(255) NOT NULL, "cc" character varying(255), "bcc" character varying(255), "subject" character varying(255), "body" text, "header" text, "sent_at" timestamp, "received_at" timestamp, "deleted_at" timestamp, "created_at" timestamp NOT NULL, "updated_at" timestamp NOT NULL, "state" character varying(16) DEFAULT 'Expanded' NOT NULL) 
  [1m[36m (1.4ms)[0m  [1mCREATE INDEX "index_emails_on_mediator_id_and_mediator_type" ON "emails" ("mediator_id", "mediator_type")[0m
  [1m[35m (3.4ms)[0m  CREATE TABLE "field_groups" ("id" serial primary key, "name" character varying(64), "label" character varying(128), "position" integer, "hint" character varying(255), "created_at" timestamp NOT NULL, "updated_at" timestamp NOT NULL, "tag_id" integer, "klass_name" character varying(32)) 
  [1m[36m (3.8ms)[0m  [1mCREATE TABLE "fields" ("id" serial primary key, "type" character varying(255), "field_group_id" integer, "position" integer, "name" character varying(64), "label" character varying(128), "hint" character varying(255), "placeholder" character varying(255), "as" character varying(32), "collection" text, "disabled" boolean, "required" boolean, "maxlength" integer, "created_at" timestamp NOT NULL, "updated_at" timestamp NOT NULL) [0m
  [1m[35m (0.8ms)[0m  CREATE INDEX "index_fields_on_field_group_id" ON "fields" ("field_group_id")
  [1m[36m (1.0ms)[0m  [1mCREATE INDEX "index_fields_on_name" ON "fields" ("name")[0m
  [1m[35m (5.1ms)[0m  CREATE TABLE "leads" ("id" serial primary key, "user_id" integer, "campaign_id" integer, "assigned_to" integer, "first_name" character varying(64) DEFAULT '' NOT NULL, "last_name" character varying(64) DEFAULT '' NOT NULL, "access" character varying(8) DEFAULT 'Public', "title" character varying(64), "company" character varying(64), "source" character varying(32), "status" character varying(32), "referred_by" character varying(64), "email" character varying(64), "alt_email" character varying(64), "phone" character varying(32), "mobile" character varying(32), "blog" character varying(128), "linkedin" character varying(128), "facebook" character varying(128), "twitter" character varying(128), "rating" integer DEFAULT 0 NOT NULL, "do_not_call" boolean DEFAULT 'f' NOT NULL, "deleted_at" timestamp, "created_at" timestamp NOT NULL, "updated_at" timestamp NOT NULL, "background_info" character varying(255), "skype" character varying(128), "subscribed_users" text) 
  [1m[36m (1.3ms)[0m  [1mCREATE INDEX "index_leads_on_assigned_to" ON "leads" ("assigned_to")[0m
  [1m[35m (1.4ms)[0m  CREATE UNIQUE INDEX "index_leads_on_user_id_and_last_name_and_deleted_at" ON "leads" ("user_id", "last_name", "deleted_at")
  [1m[36m (2.9ms)[0m  [1mCREATE TABLE "lists" ("id" serial primary key, "name" character varying(255), "url" text, "created_at" timestamp NOT NULL, "updated_at" timestamp NOT NULL) [0m
  [1m[35m (5.2ms)[0m  CREATE TABLE "opportunities" ("id" serial primary key, "user_id" integer, "campaign_id" integer, "assigned_to" integer, "name" character varying(64) DEFAULT '' NOT NULL, "access" character varying(8) DEFAULT 'Public', "source" character varying(32), "stage" character varying(32), "probability" integer, "amount" decimal(12,2), "discount" decimal(12,2), "closes_on" date, "deleted_at" timestamp, "created_at" timestamp NOT NULL, "updated_at" timestamp NOT NULL, "background_info" character varying(255), "subscribed_users" text) 
  [1m[36m (1.2ms)[0m  [1mCREATE INDEX "index_opportunities_on_assigned_to" ON "opportunities" ("assigned_to")[0m
  [1m[35m (1.2ms)[0m  CREATE UNIQUE INDEX "id_name_deleted" ON "opportunities" ("user_id", "name", "deleted_at")
  [1m[36m (3.1ms)[0m  [1mCREATE TABLE "permissions" ("id" serial primary key, "user_id" integer, "asset_id" integer, "asset_type" character varying(255), "created_at" timestamp NOT NULL, "updated_at" timestamp NOT NULL) [0m
  [1m[35m (1.0ms)[0m  CREATE INDEX "index_permissions_on_asset_id_and_asset_type" ON "permissions" ("asset_id", "asset_type")
  [1m[36m (1.1ms)[0m  [1mCREATE INDEX "index_permissions_on_user_id" ON "permissions" ("user_id")[0m
  [1m[35m (4.2ms)[0m  CREATE TABLE "preferences" ("id" serial primary key, "user_id" integer, "name" character varying(32) DEFAULT '' NOT NULL, "value" text, "created_at" timestamp NOT NULL, "updated_at" timestamp NOT NULL) 
  [1m[36m (1.1ms)[0m  [1mCREATE INDEX "index_preferences_on_user_id_and_name" ON "preferences" ("user_id", "name")[0m
  [1m[35m (3.6ms)[0m  CREATE TABLE "sessions" ("id" serial primary key, "session_id" character varying(255) NOT NULL, "data" text, "created_at" timestamp NOT NULL, "updated_at" timestamp NOT NULL) 
  [1m[36m (1.2ms)[0m  [1mCREATE INDEX "index_sessions_on_session_id" ON "sessions" ("session_id")[0m
  [1m[35m (0.8ms)[0m  CREATE INDEX "index_sessions_on_updated_at" ON "sessions" ("updated_at")
  [1m[36m (4.5ms)[0m  [1mCREATE TABLE "settings" ("id" serial primary key, "name" character varying(32) DEFAULT '' NOT NULL, "value" text, "created_at" timestamp NOT NULL, "updated_at" timestamp NOT NULL) [0m
  [1m[35m (1.0ms)[0m  CREATE INDEX "index_settings_on_name" ON "settings" ("name")
  [1m[36m (6.1ms)[0m  [1mCREATE TABLE "taggings" ("id" serial primary key, "tag_id" integer, "taggable_id" integer, "tagger_id" integer, "tagger_type" character varying(255), "taggable_type" character varying(255), "context" character varying(255), "created_at" timestamp) [0m
  [1m[35m (1.3ms)[0m  CREATE INDEX "index_taggings_on_tag_id" ON "taggings" ("tag_id")
  [1m[36m (1.3ms)[0m  [1mCREATE INDEX "index_taggings_on_taggable_id_and_taggable_type_and_context" ON "taggings" ("taggable_id", "taggable_type", "context")[0m
  [1m[35m (2.6ms)[0m  CREATE TABLE "tags" ("id" serial primary key, "name" character varying(255)) 
  [1m[36m (4.9ms)[0m  [1mCREATE TABLE "tasks" ("id" serial primary key, "user_id" integer, "assigned_to" integer, "completed_by" integer, "name" character varying(255) DEFAULT '' NOT NULL, "asset_id" integer, "asset_type" character varying(255), "priority" character varying(32), "category" character varying(32), "bucket" character varying(32), "due_at" timestamp, "completed_at" timestamp, "deleted_at" timestamp, "created_at" timestamp NOT NULL, "updated_at" timestamp NOT NULL, "background_info" character varying(255), "subscribed_users" text) [0m
  [1m[35m (1.1ms)[0m  CREATE INDEX "index_tasks_on_assigned_to" ON "tasks" ("assigned_to")
  [1m[36m (1.1ms)[0m  [1mCREATE UNIQUE INDEX "index_tasks_on_user_id_and_name_and_deleted_at" ON "tasks" ("user_id", "name", "deleted_at")[0m
  [1m[35m (6.2ms)[0m  CREATE TABLE "users" ("id" serial primary key, "username" character varying(32) DEFAULT '' NOT NULL, "email" character varying(64) DEFAULT '' NOT NULL, "first_name" character varying(32), "last_name" character varying(32), "title" character varying(64), "company" character varying(64), "alt_email" character varying(64), "phone" character varying(32), "mobile" character varying(32), "aim" character varying(32), "yahoo" character varying(32), "google" character varying(32), "skype" character varying(32), "password_hash" character varying(255) DEFAULT '' NOT NULL, "password_salt" character varying(255) DEFAULT '' NOT NULL, "persistence_token" character varying(255) DEFAULT '' NOT NULL, "perishable_token" character varying(255) DEFAULT '' NOT NULL, "last_request_at" timestamp, "last_login_at" timestamp, "current_login_at" timestamp, "last_login_ip" character varying(255), "current_login_ip" character varying(255), "login_count" integer DEFAULT 0 NOT NULL, "deleted_at" timestamp, "created_at" timestamp NOT NULL, "updated_at" timestamp NOT NULL, "admin" boolean DEFAULT 'f' NOT NULL, "suspended_at" timestamp, "single_access_token" character varying(255)) 
  [1m[36m (1.0ms)[0m  [1mCREATE INDEX "index_users_on_email" ON "users" ("email")[0m
  [1m[35m (1.2ms)[0m  CREATE INDEX "index_users_on_last_request_at" ON "users" ("last_request_at")
  [1m[36m (1.0ms)[0m  [1mCREATE INDEX "index_users_on_perishable_token" ON "users" ("perishable_token")[0m
  [1m[35m (1.1ms)[0m  CREATE INDEX "index_users_on_remember_token" ON "users" ("persistence_token")
  [1m[36m (1.0ms)[0m  [1mCREATE UNIQUE INDEX "index_users_on_username_and_deleted_at" ON "users" ("username", "deleted_at")[0m
  [1m[35m (4.0ms)[0m  CREATE TABLE "versions" ("id" serial primary key, "item_type" character varying(255) NOT NULL, "item_id" integer NOT NULL, "event" character varying(512) NOT NULL, "whodunnit" character varying(255), "object" text, "created_at" timestamp, "object_changes" text, "related_id" integer, "related_type" character varying(255)) 
  [1m[36m (1.2ms)[0m  [1mCREATE INDEX "index_versions_on_item_type_and_item_id" ON "versions" ("item_type", "item_id")[0m
  [1m[35m (1.1ms)[0m  CREATE INDEX "index_versions_on_whodunnit" ON "versions" ("whodunnit")
  [1m[36m (1.0ms)[0m  [1mCREATE TABLE "schema_migrations" ("version" character varying(255) NOT NULL) [0m
  [1m[35m (1.0ms)[0m  CREATE UNIQUE INDEX "unique_schema_migrations" ON "schema_migrations" ("version")
  [1m[36m (0.3ms)[0m  [1mSELECT version FROM "schema_migrations"[0m
  [1m[35m (0.5ms)[0m  INSERT INTO "schema_migrations" (version) VALUES ('20120528102124')
  [1m[36m (0.1ms)[0m  [1mBEGIN[0m
  [1m[35m (0.3ms)[0m  ROLLBACK
  [1m[36m (0.1ms)[0m  [1mBEGIN[0m
Started POST "/vend/register_sale" for 127.0.0.1 at 2013-03-06 19:47:33 +1300
Processing by VendController#register_sale as JSON
  Parameters: {"\n    {\n      \"payload\": {\n        \"id\": \"5e8b5134-a002-dd6b-b7c7-26126887c4ee\",\n        \"sale_date\": \"2012-11-13 16:40:06\",\n        \"status\": \"CLOSED\",\n        \"user_id\": \"9b2a8d5f-2d20-11e2-8057-080027706aa2\",\n        \"customer_id\": \"9b17ac9d-2d20-11e2-8057-080027706aa2\",\n        \"register_id\": \"9af85e69-2d20-11e2-8057-080027706aa2\",\n        \"market_id\": \"1\",\n        \"invoice_number\": \"144\",\n        \"short_code\": \"ne2zq\",\n        \"totals\": {\n          \"total_price\": \"4.87\",\n          \"total_tax\": \"0.69\",\n          \"total_payment\": \"5.55\",\n          \"total_to_pay\": \"0\"\n        },\n        \"note\": null,\n        \"updated_at\": \"2012-11-13 16:40:09\",\n        \"created_at\": \"2012-11-13 16:40:09\",\n        \"customer\": {\n          \"id\": \"9b17ac9d-2d20-11e2-8057-080027706aa2\",\n          \"customer_code\": \"WALKIN\",\n          \"balance\": \"-6.250\",\n          \"points\": 0,\n          \"note\": null,\n          \"year_to_date\": \"79945.92188\",\n          \"sex\": \"M\",\n          \"date_of_birth\": \"1950-05-25\",\n          \"updated_at\": \"2012-11-13 16:43:15\",\n          \"created_at\": \"2012-11-13 12:28:03\"\n        },\n        \"user\": {\n          \"id\": \"9b2a8d5f-2d20-11e2-8057-080027706aa2\",\n          \"name\": \"admin\",\n          \"display_name\": \"A admin this time\",\n          \"outlet_id\": \"9ae97219-2d20-11e2-8057-080027706aa2\",\n          \"target_daily\": null,\n          \"target_weekly\": null,\n          \"target_monthly\": null,\n          \"created_at\": \"2011-09-08 05:18:38\",\n          \"updated_at\": \"2011-09-08 05:18:38\"\n        },\n        \"register_sale_products\": "=>{"\n        {\n          \"id\": \"148793f0-475a-7d49-442d-fd761ce76339\",\n          \"product_id\": \"9fe945bc-2d20-11e2-8057-080027706aa2\",\n          \"quantity\": 1,\n          \"price\": \"1.90\",\n          \"price_set\": true,\n          \"tax\": \"0.24\",\n          \"price_total\": \"1.9\",\n          \"tax_total\": \"0.24\",\n          \"tax_id\": \"9a025ff0-2d20-11e2-8057-080027706aa2\",\n          \"tax_name\": \"NZ GST\",\n          \"tax_rate\": \"0.150000\"\n        },\n        {\n          \"id\": \"7d37dc0f-9462-06fa-cae0-0b4988b36539\",\n          \"product_id\": \"a0c0df02-2d20-11e2-8057-080027706aa2\",\n          \"quantity\": 3,\n          \"price\": \"0.99\",\n          \"price_set\": true,\n          \"tax\": \"0.15\",\n          \"price_total\": \"2.97\",\n          \"tax_total\": \"0.45\",\n          \"tax_id\": \"9a025ff0-2d20-11e2-8057-080027706aa2\",\n          \"tax_name\": \"NZ GST\",\n          \"tax_rate\": \"0.150000\"\n        }"=>{",\n        \"register_sale_payments\": "=>{"\n        {\n          \"id\": \"39948e3e-bf93-1b60-ff44-f46a777ed1d4\",\n          \"payment_date\": \"2012-11-13 16:40:06\",\n          \"amount\": \"5.55\",\n          \"retailer_payment_type_id\": \"9e9ba1ba-2d20-11e2-8057-080027706aa2\",\n          \"payment_type_id\": \"1\"\n        }"=>{"\n      }\n    }\n  "=>nil}}}}}
Completed 500 Internal Server Error in 4ms
  [1m[35m (0.1ms)[0m  ROLLBACK
Connecting to database specified by database.yml
  [1m[36mFieldGroup Load (1.2ms)[0m  [1mSELECT "field_groups".* FROM "field_groups" WHERE "field_groups"."klass_name" = 'Account' ORDER BY position[0m
  [1m[35mFieldGroup Load (0.3ms)[0m  SELECT "field_groups".* FROM "field_groups" WHERE "field_groups"."klass_name" = 'Campaign' ORDER BY position
  [1m[36mFieldGroup Load (0.2ms)[0m  [1mSELECT "field_groups".* FROM "field_groups" WHERE "field_groups"."klass_name" = 'Contact' ORDER BY position[0m
  [1m[35mFieldGroup Load (0.3ms)[0m  SELECT "field_groups".* FROM "field_groups" WHERE "field_groups"."klass_name" = 'Lead' ORDER BY position
  [1m[36mFieldGroup Load (0.3ms)[0m  [1mSELECT "field_groups".* FROM "field_groups" WHERE "field_groups"."klass_name" = 'Opportunity' ORDER BY position[0m
  [1m[35mFieldGroup Load (0.3ms)[0m  SELECT "field_groups".* FROM "field_groups" WHERE "field_groups"."klass_name" = 'Task' ORDER BY position
Creating scope :except. Overwriting existing method User.except.
  [1m[36m (131.6ms)[0m  [1mDROP DATABASE IF EXISTS "ffcrm_vend_test"[0m
  [1m[35m (252.7ms)[0m  CREATE DATABASE "ffcrm_vend_test" ENCODING = 'utf8'
  [1m[36m (6.8ms)[0m  [1mCREATE TABLE "account_contacts" ("id" serial primary key, "account_id" integer, "contact_id" integer, "deleted_at" timestamp, "created_at" timestamp NOT NULL, "updated_at" timestamp NOT NULL) [0m
  [1m[35m (2.6ms)[0m  CREATE TABLE "account_opportunities" ("id" serial primary key, "account_id" integer, "opportunity_id" integer, "deleted_at" timestamp, "created_at" timestamp NOT NULL, "updated_at" timestamp NOT NULL) 
  [1m[36m (5.1ms)[0m  [1mCREATE TABLE "accounts" ("id" serial primary key, "user_id" integer, "assigned_to" integer, "name" character varying(64) DEFAULT '' NOT NULL, "access" character varying(8) DEFAULT 'Public', "website" character varying(64), "toll_free_phone" character varying(32), "phone" character varying(32), "fax" character varying(32), "deleted_at" timestamp, "created_at" timestamp NOT NULL, "updated_at" timestamp NOT NULL, "email" character varying(64), "background_info" character varying(255), "rating" integer DEFAULT 0 NOT NULL, "category" character varying(32), "subscribed_users" text) [0m
  [1m[35m (1.1ms)[0m  CREATE INDEX "index_accounts_on_assigned_to" ON "accounts" ("assigned_to")
  [1m[36m (1.3ms)[0m  [1mCREATE UNIQUE INDEX "index_accounts_on_user_id_and_name_and_deleted_at" ON "accounts" ("user_id", "name", "deleted_at")[0m
  [1m[35m (4.0ms)[0m  CREATE TABLE "activities" ("id" serial primary key, "user_id" integer, "subject_id" integer, "subject_type" character varying(255), "action" character varying(32) DEFAULT 'created', "info" character varying(255) DEFAULT '', "private" boolean DEFAULT 'f', "created_at" timestamp NOT NULL, "updated_at" timestamp NOT NULL) 
  [1m[36m (1.0ms)[0m  [1mCREATE INDEX "index_activities_on_created_at" ON "activities" ("created_at")[0m
  [1m[35m (1.1ms)[0m  CREATE INDEX "index_activities_on_user_id" ON "activities" ("user_id")
  [1m[36m (4.2ms)[0m  [1mCREATE TABLE "addresses" ("id" serial primary key, "street1" character varying(255), "street2" character varying(255), "city" character varying(64), "state" character varying(64), "zipcode" character varying(16), "country" character varying(64), "full_address" character varying(255), "address_type" character varying(16), "addressable_id" integer, "addressable_type" character varying(255), "created_at" timestamp NOT NULL, "updated_at" timestamp NOT NULL, "deleted_at" timestamp) [0m
  [1m[35m (1.3ms)[0m  CREATE INDEX "index_addresses_on_addressable_id_and_addressable_type" ON "addresses" ("addressable_id", "addressable_type")
  [1m[36m (3.7ms)[0m  [1mCREATE TABLE "avatars" ("id" serial primary key, "user_id" integer, "entity_id" integer, "entity_type" character varying(255), "image_file_size" integer, "image_file_name" character varying(255), "image_content_type" character varying(255), "created_at" timestamp NOT NULL, "updated_at" timestamp NOT NULL) [0m
  [1m[35m (5.4ms)[0m  CREATE TABLE "campaigns" ("id" serial primary key, "user_id" integer, "assigned_to" integer, "name" character varying(64) DEFAULT '' NOT NULL, "access" character varying(8) DEFAULT 'Public', "status" character varying(64), "budget" decimal(12,2), "target_leads" integer, "target_conversion" float, "target_revenue" decimal(12,2), "leads_count" integer, "opportunities_count" integer, "revenue" decimal(12,2), "starts_on" date, "ends_on" date, "objectives" text, "deleted_at" timestamp, "created_at" timestamp NOT NULL, "updated_at" timestamp NOT NULL, "background_info" character varying(255), "subscribed_users" text) 
  [1m[36m (1.1ms)[0m  [1mCREATE INDEX "index_campaigns_on_assigned_to" ON "campaigns" ("assigned_to")[0m
  [1m[35m (1.1ms)[0m  CREATE UNIQUE INDEX "index_campaigns_on_user_id_and_name_and_deleted_at" ON "campaigns" ("user_id", "name", "deleted_at")
  [1m[36m (4.5ms)[0m  [1mCREATE TABLE "comments" ("id" serial primary key, "user_id" integer, "commentable_id" integer, "commentable_type" character varying(255), "private" boolean, "title" character varying(255) DEFAULT '', "comment" text, "created_at" timestamp NOT NULL, "updated_at" timestamp NOT NULL, "state" character varying(16) DEFAULT 'Expanded' NOT NULL) [0m
  [1m[35m (3.3ms)[0m  CREATE TABLE "contact_opportunities" ("id" serial primary key, "contact_id" integer, "opportunity_id" integer, "role" character varying(32), "deleted_at" timestamp, "created_at" timestamp NOT NULL, "updated_at" timestamp NOT NULL) 
  [1m[36m (5.6ms)[0m  [1mCREATE TABLE "contacts" ("id" serial primary key, "user_id" integer, "lead_id" integer, "assigned_to" integer, "reports_to" integer, "first_name" character varying(64) DEFAULT '' NOT NULL, "last_name" character varying(64) DEFAULT '' NOT NULL, "access" character varying(8) DEFAULT 'Public', "title" character varying(64), "department" character varying(64), "source" character varying(32), "email" character varying(64), "alt_email" character varying(64), "phone" character varying(32), "mobile" character varying(32), "fax" character varying(32), "blog" character varying(128), "linkedin" character varying(128), "facebook" character varying(128), "twitter" character varying(128), "born_on" date, "do_not_call" boolean DEFAULT 'f' NOT NULL, "deleted_at" timestamp, "created_at" timestamp NOT NULL, "updated_at" timestamp NOT NULL, "background_info" character varying(255), "skype" character varying(128), "subscribed_users" text) [0m
  [1m[35m (0.9ms)[0m  CREATE INDEX "index_contacts_on_assigned_to" ON "contacts" ("assigned_to")
  [1m[36m (1.1ms)[0m  [1mCREATE UNIQUE INDEX "id_last_name_deleted" ON "contacts" ("user_id", "last_name", "deleted_at")[0m
  [1m[35m (4.2ms)[0m  CREATE TABLE "emails" ("id" serial primary key, "imap_message_id" character varying(255) NOT NULL, "user_id" integer, "mediator_id" integer, "mediator_type" character varying(255), "sent_from" character varying(255) NOT NULL, "sent_to" character varying(255) NOT NULL, "cc" character varying(255), "bcc" character varying(255), "subject" character varying(255), "body" text, "header" text, "sent_at" timestamp, "received_at" timestamp, "deleted_at" timestamp, "created_at" timestamp NOT NULL, "updated_at" timestamp NOT NULL, "state" character varying(16) DEFAULT 'Expanded' NOT NULL) 
  [1m[36m (1.1ms)[0m  [1mCREATE INDEX "index_emails_on_mediator_id_and_mediator_type" ON "emails" ("mediator_id", "mediator_type")[0m
  [1m[35m (3.3ms)[0m  CREATE TABLE "field_groups" ("id" serial primary key, "name" character varying(64), "label" character varying(128), "position" integer, "hint" character varying(255), "created_at" timestamp NOT NULL, "updated_at" timestamp NOT NULL, "tag_id" integer, "klass_name" character varying(32)) 
  [1m[36m (4.8ms)[0m  [1mCREATE TABLE "fields" ("id" serial primary key, "type" character varying(255), "field_group_id" integer, "position" integer, "name" character varying(64), "label" character varying(128), "hint" character varying(255), "placeholder" character varying(255), "as" character varying(32), "collection" text, "disabled" boolean, "required" boolean, "maxlength" integer, "created_at" timestamp NOT NULL, "updated_at" timestamp NOT NULL) [0m
  [1m[35m (1.0ms)[0m  CREATE INDEX "index_fields_on_field_group_id" ON "fields" ("field_group_id")
  [1m[36m (1.3ms)[0m  [1mCREATE INDEX "index_fields_on_name" ON "fields" ("name")[0m
  [1m[35m (5.8ms)[0m  CREATE TABLE "leads" ("id" serial primary key, "user_id" integer, "campaign_id" integer, "assigned_to" integer, "first_name" character varying(64) DEFAULT '' NOT NULL, "last_name" character varying(64) DEFAULT '' NOT NULL, "access" character varying(8) DEFAULT 'Public', "title" character varying(64), "company" character varying(64), "source" character varying(32), "status" character varying(32), "referred_by" character varying(64), "email" character varying(64), "alt_email" character varying(64), "phone" character varying(32), "mobile" character varying(32), "blog" character varying(128), "linkedin" character varying(128), "facebook" character varying(128), "twitter" character varying(128), "rating" integer DEFAULT 0 NOT NULL, "do_not_call" boolean DEFAULT 'f' NOT NULL, "deleted_at" timestamp, "created_at" timestamp NOT NULL, "updated_at" timestamp NOT NULL, "background_info" character varying(255), "skype" character varying(128), "subscribed_users" text) 
  [1m[36m (1.3ms)[0m  [1mCREATE INDEX "index_leads_on_assigned_to" ON "leads" ("assigned_to")[0m
  [1m[35m (1.2ms)[0m  CREATE UNIQUE INDEX "index_leads_on_user_id_and_last_name_and_deleted_at" ON "leads" ("user_id", "last_name", "deleted_at")
  [1m[36m (3.7ms)[0m  [1mCREATE TABLE "lists" ("id" serial primary key, "name" character varying(255), "url" text, "created_at" timestamp NOT NULL, "updated_at" timestamp NOT NULL) [0m
  [1m[35m (4.3ms)[0m  CREATE TABLE "opportunities" ("id" serial primary key, "user_id" integer, "campaign_id" integer, "assigned_to" integer, "name" character varying(64) DEFAULT '' NOT NULL, "access" character varying(8) DEFAULT 'Public', "source" character varying(32), "stage" character varying(32), "probability" integer, "amount" decimal(12,2), "discount" decimal(12,2), "closes_on" date, "deleted_at" timestamp, "created_at" timestamp NOT NULL, "updated_at" timestamp NOT NULL, "background_info" character varying(255), "subscribed_users" text) 
  [1m[36m (1.0ms)[0m  [1mCREATE INDEX "index_opportunities_on_assigned_to" ON "opportunities" ("assigned_to")[0m
  [1m[35m (1.2ms)[0m  CREATE UNIQUE INDEX "id_name_deleted" ON "opportunities" ("user_id", "name", "deleted_at")
  [1m[36m (2.7ms)[0m  [1mCREATE TABLE "permissions" ("id" serial primary key, "user_id" integer, "asset_id" integer, "asset_type" character varying(255), "created_at" timestamp NOT NULL, "updated_at" timestamp NOT NULL) [0m
  [1m[35m (0.9ms)[0m  CREATE INDEX "index_permissions_on_asset_id_and_asset_type" ON "permissions" ("asset_id", "asset_type")
  [1m[36m (1.2ms)[0m  [1mCREATE INDEX "index_permissions_on_user_id" ON "permissions" ("user_id")[0m
  [1m[35m (3.9ms)[0m  CREATE TABLE "preferences" ("id" serial primary key, "user_id" integer, "name" character varying(32) DEFAULT '' NOT NULL, "value" text, "created_at" timestamp NOT NULL, "updated_at" timestamp NOT NULL) 
  [1m[36m (1.2ms)[0m  [1mCREATE INDEX "index_preferences_on_user_id_and_name" ON "preferences" ("user_id", "name")[0m
  [1m[35m (4.3ms)[0m  CREATE TABLE "sessions" ("id" serial primary key, "session_id" character varying(255) NOT NULL, "data" text, "created_at" timestamp NOT NULL, "updated_at" timestamp NOT NULL) 
  [1m[36m (1.1ms)[0m  [1mCREATE INDEX "index_sessions_on_session_id" ON "sessions" ("session_id")[0m
  [1m[35m (0.9ms)[0m  CREATE INDEX "index_sessions_on_updated_at" ON "sessions" ("updated_at")
  [1m[36m (3.7ms)[0m  [1mCREATE TABLE "settings" ("id" serial primary key, "name" character varying(32) DEFAULT '' NOT NULL, "value" text, "created_at" timestamp NOT NULL, "updated_at" timestamp NOT NULL) [0m
  [1m[35m (1.2ms)[0m  CREATE INDEX "index_settings_on_name" ON "settings" ("name")
  [1m[36m (4.5ms)[0m  [1mCREATE TABLE "taggings" ("id" serial primary key, "tag_id" integer, "taggable_id" integer, "tagger_id" integer, "tagger_type" character varying(255), "taggable_type" character varying(255), "context" character varying(255), "created_at" timestamp) [0m
  [1m[35m (0.9ms)[0m  CREATE INDEX "index_taggings_on_tag_id" ON "taggings" ("tag_id")
  [1m[36m (1.5ms)[0m  [1mCREATE INDEX "index_taggings_on_taggable_id_and_taggable_type_and_context" ON "taggings" ("taggable_id", "taggable_type", "context")[0m
  [1m[35m (2.5ms)[0m  CREATE TABLE "tags" ("id" serial primary key, "name" character varying(255)) 
  [1m[36m (4.5ms)[0m  [1mCREATE TABLE "tasks" ("id" serial primary key, "user_id" integer, "assigned_to" integer, "completed_by" integer, "name" character varying(255) DEFAULT '' NOT NULL, "asset_id" integer, "asset_type" character varying(255), "priority" character varying(32), "category" character varying(32), "bucket" character varying(32), "due_at" timestamp, "completed_at" timestamp, "deleted_at" timestamp, "created_at" timestamp NOT NULL, "updated_at" timestamp NOT NULL, "background_info" character varying(255), "subscribed_users" text) [0m
  [1m[35m (1.0ms)[0m  CREATE INDEX "index_tasks_on_assigned_to" ON "tasks" ("assigned_to")
  [1m[36m (1.1ms)[0m  [1mCREATE UNIQUE INDEX "index_tasks_on_user_id_and_name_and_deleted_at" ON "tasks" ("user_id", "name", "deleted_at")[0m
  [1m[35m (6.2ms)[0m  CREATE TABLE "users" ("id" serial primary key, "username" character varying(32) DEFAULT '' NOT NULL, "email" character varying(64) DEFAULT '' NOT NULL, "first_name" character varying(32), "last_name" character varying(32), "title" character varying(64), "company" character varying(64), "alt_email" character varying(64), "phone" character varying(32), "mobile" character varying(32), "aim" character varying(32), "yahoo" character varying(32), "google" character varying(32), "skype" character varying(32), "password_hash" character varying(255) DEFAULT '' NOT NULL, "password_salt" character varying(255) DEFAULT '' NOT NULL, "persistence_token" character varying(255) DEFAULT '' NOT NULL, "perishable_token" character varying(255) DEFAULT '' NOT NULL, "last_request_at" timestamp, "last_login_at" timestamp, "current_login_at" timestamp, "last_login_ip" character varying(255), "current_login_ip" character varying(255), "login_count" integer DEFAULT 0 NOT NULL, "deleted_at" timestamp, "created_at" timestamp NOT NULL, "updated_at" timestamp NOT NULL, "admin" boolean DEFAULT 'f' NOT NULL, "suspended_at" timestamp, "single_access_token" character varying(255)) 
  [1m[36m (1.0ms)[0m  [1mCREATE INDEX "index_users_on_email" ON "users" ("email")[0m
  [1m[35m (1.0ms)[0m  CREATE INDEX "index_users_on_last_request_at" ON "users" ("last_request_at")
  [1m[36m (1.3ms)[0m  [1mCREATE INDEX "index_users_on_perishable_token" ON "users" ("perishable_token")[0m
  [1m[35m (1.1ms)[0m  CREATE INDEX "index_users_on_remember_token" ON "users" ("persistence_token")
  [1m[36m (1.5ms)[0m  [1mCREATE UNIQUE INDEX "index_users_on_username_and_deleted_at" ON "users" ("username", "deleted_at")[0m
  [1m[35m (3.7ms)[0m  CREATE TABLE "versions" ("id" serial primary key, "item_type" character varying(255) NOT NULL, "item_id" integer NOT NULL, "event" character varying(512) NOT NULL, "whodunnit" character varying(255), "object" text, "created_at" timestamp, "object_changes" text, "related_id" integer, "related_type" character varying(255)) 
  [1m[36m (1.2ms)[0m  [1mCREATE INDEX "index_versions_on_item_type_and_item_id" ON "versions" ("item_type", "item_id")[0m
  [1m[35m (1.1ms)[0m  CREATE INDEX "index_versions_on_whodunnit" ON "versions" ("whodunnit")
  [1m[36m (1.0ms)[0m  [1mCREATE TABLE "schema_migrations" ("version" character varying(255) NOT NULL) [0m
  [1m[35m (1.3ms)[0m  CREATE UNIQUE INDEX "unique_schema_migrations" ON "schema_migrations" ("version")
  [1m[36m (0.4ms)[0m  [1mSELECT version FROM "schema_migrations"[0m
  [1m[35m (0.6ms)[0m  INSERT INTO "schema_migrations" (version) VALUES ('20120528102124')
  [1m[36m (0.2ms)[0m  [1mBEGIN[0m
Started POST "/vend/register_sale" for 127.0.0.1 at 2013-03-06 19:52:38 +1300
Processing by VendController#register_sale as JSON
  Parameters: {"\n    {\n      \"payload\": {\n        \"id\": \"5e8b5134-a002-dd6b-b7c7-26126887c4ee\",\n        \"sale_date\": \"2012-11-13 16:40:06\",\n        \"status\": \"CLOSED\",\n        \"user_id\": \"9b2a8d5f-2d20-11e2-8057-080027706aa2\",\n        \"customer_id\": \"9b17ac9d-2d20-11e2-8057-080027706aa2\",\n        \"register_id\": \"9af85e69-2d20-11e2-8057-080027706aa2\",\n        \"market_id\": \"1\",\n        \"invoice_number\": \"144\",\n        \"short_code\": \"ne2zq\",\n        \"totals\": {\n          \"total_price\": \"4.87\",\n          \"total_tax\": \"0.69\",\n          \"total_payment\": \"5.55\",\n          \"total_to_pay\": \"0\"\n        },\n        \"note\": null,\n        \"updated_at\": \"2012-11-13 16:40:09\",\n        \"created_at\": \"2012-11-13 16:40:09\",\n        \"customer\": {\n          \"id\": \"9b17ac9d-2d20-11e2-8057-080027706aa2\",\n          \"customer_code\": \"WALKIN\",\n          \"balance\": \"-6.250\",\n          \"points\": 0,\n          \"note\": null,\n          \"year_to_date\": \"79945.92188\",\n          \"sex\": \"M\",\n          \"date_of_birth\": \"1950-05-25\",\n          \"updated_at\": \"2012-11-13 16:43:15\",\n          \"created_at\": \"2012-11-13 12:28:03\"\n        },\n        \"user\": {\n          \"id\": \"9b2a8d5f-2d20-11e2-8057-080027706aa2\",\n          \"name\": \"admin\",\n          \"display_name\": \"A admin this time\",\n          \"outlet_id\": \"9ae97219-2d20-11e2-8057-080027706aa2\",\n          \"target_daily\": null,\n          \"target_weekly\": null,\n          \"target_monthly\": null,\n          \"created_at\": \"2011-09-08 05:18:38\",\n          \"updated_at\": \"2011-09-08 05:18:38\"\n        },\n        \"register_sale_products\": "=>{"\n        {\n          \"id\": \"148793f0-475a-7d49-442d-fd761ce76339\",\n          \"product_id\": \"9fe945bc-2d20-11e2-8057-080027706aa2\",\n          \"quantity\": 1,\n          \"price\": \"1.90\",\n          \"price_set\": true,\n          \"tax\": \"0.24\",\n          \"price_total\": \"1.9\",\n          \"tax_total\": \"0.24\",\n          \"tax_id\": \"9a025ff0-2d20-11e2-8057-080027706aa2\",\n          \"tax_name\": \"NZ GST\",\n          \"tax_rate\": \"0.150000\"\n        },\n        {\n          \"id\": \"7d37dc0f-9462-06fa-cae0-0b4988b36539\",\n          \"product_id\": \"a0c0df02-2d20-11e2-8057-080027706aa2\",\n          \"quantity\": 3,\n          \"price\": \"0.99\",\n          \"price_set\": true,\n          \"tax\": \"0.15\",\n          \"price_total\": \"2.97\",\n          \"tax_total\": \"0.45\",\n          \"tax_id\": \"9a025ff0-2d20-11e2-8057-080027706aa2\",\n          \"tax_name\": \"NZ GST\",\n          \"tax_rate\": \"0.150000\"\n        }"=>{",\n        \"register_sale_payments\": "=>{"\n        {\n          \"id\": \"39948e3e-bf93-1b60-ff44-f46a777ed1d4\",\n          \"payment_date\": \"2012-11-13 16:40:06\",\n          \"amount\": \"5.55\",\n          \"retailer_payment_type_id\": \"9e9ba1ba-2d20-11e2-8057-080027706aa2\",\n          \"payment_type_id\": \"1\"\n        }"=>{"\n      }\n    }\n  "=>nil}}}}}
Completed 500 Internal Server Error in 5ms
  [1m[35m (0.5ms)[0m  ROLLBACK
  [1m[36m (0.1ms)[0m  [1mBEGIN[0m
  [1m[35m (0.1ms)[0m  ROLLBACK
Connecting to database specified by database.yml
  [1m[36mFieldGroup Load (1.0ms)[0m  [1mSELECT "field_groups".* FROM "field_groups" WHERE "field_groups"."klass_name" = 'Account' ORDER BY position[0m
  [1m[35mFieldGroup Load (0.3ms)[0m  SELECT "field_groups".* FROM "field_groups" WHERE "field_groups"."klass_name" = 'Campaign' ORDER BY position
  [1m[36mFieldGroup Load (0.3ms)[0m  [1mSELECT "field_groups".* FROM "field_groups" WHERE "field_groups"."klass_name" = 'Contact' ORDER BY position[0m
  [1m[35mFieldGroup Load (0.2ms)[0m  SELECT "field_groups".* FROM "field_groups" WHERE "field_groups"."klass_name" = 'Lead' ORDER BY position
  [1m[36mFieldGroup Load (0.3ms)[0m  [1mSELECT "field_groups".* FROM "field_groups" WHERE "field_groups"."klass_name" = 'Opportunity' ORDER BY position[0m
  [1m[35mFieldGroup Load (0.2ms)[0m  SELECT "field_groups".* FROM "field_groups" WHERE "field_groups"."klass_name" = 'Task' ORDER BY position
Creating scope :except. Overwriting existing method User.except.
  [1m[36m (121.6ms)[0m  [1mDROP DATABASE IF EXISTS "ffcrm_vend_test"[0m
  [1m[35m (249.1ms)[0m  CREATE DATABASE "ffcrm_vend_test" ENCODING = 'utf8'
  [1m[36m (7.0ms)[0m  [1mCREATE TABLE "account_contacts" ("id" serial primary key, "account_id" integer, "contact_id" integer, "deleted_at" timestamp, "created_at" timestamp NOT NULL, "updated_at" timestamp NOT NULL) [0m
  [1m[35m (3.3ms)[0m  CREATE TABLE "account_opportunities" ("id" serial primary key, "account_id" integer, "opportunity_id" integer, "deleted_at" timestamp, "created_at" timestamp NOT NULL, "updated_at" timestamp NOT NULL) 
  [1m[36m (5.1ms)[0m  [1mCREATE TABLE "accounts" ("id" serial primary key, "user_id" integer, "assigned_to" integer, "name" character varying(64) DEFAULT '' NOT NULL, "access" character varying(8) DEFAULT 'Public', "website" character varying(64), "toll_free_phone" character varying(32), "phone" character varying(32), "fax" character varying(32), "deleted_at" timestamp, "created_at" timestamp NOT NULL, "updated_at" timestamp NOT NULL, "email" character varying(64), "background_info" character varying(255), "rating" integer DEFAULT 0 NOT NULL, "category" character varying(32), "subscribed_users" text) [0m
  [1m[35m (1.1ms)[0m  CREATE INDEX "index_accounts_on_assigned_to" ON "accounts" ("assigned_to")
  [1m[36m (1.2ms)[0m  [1mCREATE UNIQUE INDEX "index_accounts_on_user_id_and_name_and_deleted_at" ON "accounts" ("user_id", "name", "deleted_at")[0m
  [1m[35m (4.7ms)[0m  CREATE TABLE "activities" ("id" serial primary key, "user_id" integer, "subject_id" integer, "subject_type" character varying(255), "action" character varying(32) DEFAULT 'created', "info" character varying(255) DEFAULT '', "private" boolean DEFAULT 'f', "created_at" timestamp NOT NULL, "updated_at" timestamp NOT NULL) 
  [1m[36m (1.2ms)[0m  [1mCREATE INDEX "index_activities_on_created_at" ON "activities" ("created_at")[0m
  [1m[35m (1.2ms)[0m  CREATE INDEX "index_activities_on_user_id" ON "activities" ("user_id")
  [1m[36m (4.1ms)[0m  [1mCREATE TABLE "addresses" ("id" serial primary key, "street1" character varying(255), "street2" character varying(255), "city" character varying(64), "state" character varying(64), "zipcode" character varying(16), "country" character varying(64), "full_address" character varying(255), "address_type" character varying(16), "addressable_id" integer, "addressable_type" character varying(255), "created_at" timestamp NOT NULL, "updated_at" timestamp NOT NULL, "deleted_at" timestamp) [0m
  [1m[35m (1.6ms)[0m  CREATE INDEX "index_addresses_on_addressable_id_and_addressable_type" ON "addresses" ("addressable_id", "addressable_type")
  [1m[36m (4.0ms)[0m  [1mCREATE TABLE "avatars" ("id" serial primary key, "user_id" integer, "entity_id" integer, "entity_type" character varying(255), "image_file_size" integer, "image_file_name" character varying(255), "image_content_type" character varying(255), "created_at" timestamp NOT NULL, "updated_at" timestamp NOT NULL) [0m
  [1m[35m (4.5ms)[0m  CREATE TABLE "campaigns" ("id" serial primary key, "user_id" integer, "assigned_to" integer, "name" character varying(64) DEFAULT '' NOT NULL, "access" character varying(8) DEFAULT 'Public', "status" character varying(64), "budget" decimal(12,2), "target_leads" integer, "target_conversion" float, "target_revenue" decimal(12,2), "leads_count" integer, "opportunities_count" integer, "revenue" decimal(12,2), "starts_on" date, "ends_on" date, "objectives" text, "deleted_at" timestamp, "created_at" timestamp NOT NULL, "updated_at" timestamp NOT NULL, "background_info" character varying(255), "subscribed_users" text) 
  [1m[36m (1.1ms)[0m  [1mCREATE INDEX "index_campaigns_on_assigned_to" ON "campaigns" ("assigned_to")[0m
  [1m[35m (1.5ms)[0m  CREATE UNIQUE INDEX "index_campaigns_on_user_id_and_name_and_deleted_at" ON "campaigns" ("user_id", "name", "deleted_at")
  [1m[36m (3.5ms)[0m  [1mCREATE TABLE "comments" ("id" serial primary key, "user_id" integer, "commentable_id" integer, "commentable_type" character varying(255), "private" boolean, "title" character varying(255) DEFAULT '', "comment" text, "created_at" timestamp NOT NULL, "updated_at" timestamp NOT NULL, "state" character varying(16) DEFAULT 'Expanded' NOT NULL) [0m
  [1m[35m (2.6ms)[0m  CREATE TABLE "contact_opportunities" ("id" serial primary key, "contact_id" integer, "opportunity_id" integer, "role" character varying(32), "deleted_at" timestamp, "created_at" timestamp NOT NULL, "updated_at" timestamp NOT NULL) 
  [1m[36m (6.0ms)[0m  [1mCREATE TABLE "contacts" ("id" serial primary key, "user_id" integer, "lead_id" integer, "assigned_to" integer, "reports_to" integer, "first_name" character varying(64) DEFAULT '' NOT NULL, "last_name" character varying(64) DEFAULT '' NOT NULL, "access" character varying(8) DEFAULT 'Public', "title" character varying(64), "department" character varying(64), "source" character varying(32), "email" character varying(64), "alt_email" character varying(64), "phone" character varying(32), "mobile" character varying(32), "fax" character varying(32), "blog" character varying(128), "linkedin" character varying(128), "facebook" character varying(128), "twitter" character varying(128), "born_on" date, "do_not_call" boolean DEFAULT 'f' NOT NULL, "deleted_at" timestamp, "created_at" timestamp NOT NULL, "updated_at" timestamp NOT NULL, "background_info" character varying(255), "skype" character varying(128), "subscribed_users" text) [0m
  [1m[35m (1.3ms)[0m  CREATE INDEX "index_contacts_on_assigned_to" ON "contacts" ("assigned_to")
  [1m[36m (1.1ms)[0m  [1mCREATE UNIQUE INDEX "id_last_name_deleted" ON "contacts" ("user_id", "last_name", "deleted_at")[0m
  [1m[35m (4.4ms)[0m  CREATE TABLE "emails" ("id" serial primary key, "imap_message_id" character varying(255) NOT NULL, "user_id" integer, "mediator_id" integer, "mediator_type" character varying(255), "sent_from" character varying(255) NOT NULL, "sent_to" character varying(255) NOT NULL, "cc" character varying(255), "bcc" character varying(255), "subject" character varying(255), "body" text, "header" text, "sent_at" timestamp, "received_at" timestamp, "deleted_at" timestamp, "created_at" timestamp NOT NULL, "updated_at" timestamp NOT NULL, "state" character varying(16) DEFAULT 'Expanded' NOT NULL) 
  [1m[36m (1.2ms)[0m  [1mCREATE INDEX "index_emails_on_mediator_id_and_mediator_type" ON "emails" ("mediator_id", "mediator_type")[0m
  [1m[35m (2.9ms)[0m  CREATE TABLE "field_groups" ("id" serial primary key, "name" character varying(64), "label" character varying(128), "position" integer, "hint" character varying(255), "created_at" timestamp NOT NULL, "updated_at" timestamp NOT NULL, "tag_id" integer, "klass_name" character varying(32)) 
  [1m[36m (4.3ms)[0m  [1mCREATE TABLE "fields" ("id" serial primary key, "type" character varying(255), "field_group_id" integer, "position" integer, "name" character varying(64), "label" character varying(128), "hint" character varying(255), "placeholder" character varying(255), "as" character varying(32), "collection" text, "disabled" boolean, "required" boolean, "maxlength" integer, "created_at" timestamp NOT NULL, "updated_at" timestamp NOT NULL) [0m
  [1m[35m (1.0ms)[0m  CREATE INDEX "index_fields_on_field_group_id" ON "fields" ("field_group_id")
  [1m[36m (0.9ms)[0m  [1mCREATE INDEX "index_fields_on_name" ON "fields" ("name")[0m
  [1m[35m (5.9ms)[0m  CREATE TABLE "leads" ("id" serial primary key, "user_id" integer, "campaign_id" integer, "assigned_to" integer, "first_name" character varying(64) DEFAULT '' NOT NULL, "last_name" character varying(64) DEFAULT '' NOT NULL, "access" character varying(8) DEFAULT 'Public', "title" character varying(64), "company" character varying(64), "source" character varying(32), "status" character varying(32), "referred_by" character varying(64), "email" character varying(64), "alt_email" character varying(64), "phone" character varying(32), "mobile" character varying(32), "blog" character varying(128), "linkedin" character varying(128), "facebook" character varying(128), "twitter" character varying(128), "rating" integer DEFAULT 0 NOT NULL, "do_not_call" boolean DEFAULT 'f' NOT NULL, "deleted_at" timestamp, "created_at" timestamp NOT NULL, "updated_at" timestamp NOT NULL, "background_info" character varying(255), "skype" character varying(128), "subscribed_users" text) 
  [1m[36m (1.2ms)[0m  [1mCREATE INDEX "index_leads_on_assigned_to" ON "leads" ("assigned_to")[0m
  [1m[35m (1.0ms)[0m  CREATE UNIQUE INDEX "index_leads_on_user_id_and_last_name_and_deleted_at" ON "leads" ("user_id", "last_name", "deleted_at")
  [1m[36m (2.9ms)[0m  [1mCREATE TABLE "lists" ("id" serial primary key, "name" character varying(255), "url" text, "created_at" timestamp NOT NULL, "updated_at" timestamp NOT NULL) [0m
  [1m[35m (4.2ms)[0m  CREATE TABLE "opportunities" ("id" serial primary key, "user_id" integer, "campaign_id" integer, "assigned_to" integer, "name" character varying(64) DEFAULT '' NOT NULL, "access" character varying(8) DEFAULT 'Public', "source" character varying(32), "stage" character varying(32), "probability" integer, "amount" decimal(12,2), "discount" decimal(12,2), "closes_on" date, "deleted_at" timestamp, "created_at" timestamp NOT NULL, "updated_at" timestamp NOT NULL, "background_info" character varying(255), "subscribed_users" text) 
  [1m[36m (1.3ms)[0m  [1mCREATE INDEX "index_opportunities_on_assigned_to" ON "opportunities" ("assigned_to")[0m
  [1m[35m (1.3ms)[0m  CREATE UNIQUE INDEX "id_name_deleted" ON "opportunities" ("user_id", "name", "deleted_at")
  [1m[36m (2.8ms)[0m  [1mCREATE TABLE "permissions" ("id" serial primary key, "user_id" integer, "asset_id" integer, "asset_type" character varying(255), "created_at" timestamp NOT NULL, "updated_at" timestamp NOT NULL) [0m
  [1m[35m (1.3ms)[0m  CREATE INDEX "index_permissions_on_asset_id_and_asset_type" ON "permissions" ("asset_id", "asset_type")
  [1m[36m (1.0ms)[0m  [1mCREATE INDEX "index_permissions_on_user_id" ON "permissions" ("user_id")[0m
  [1m[35m (3.4ms)[0m  CREATE TABLE "preferences" ("id" serial primary key, "user_id" integer, "name" character varying(32) DEFAULT '' NOT NULL, "value" text, "created_at" timestamp NOT NULL, "updated_at" timestamp NOT NULL) 
  [1m[36m (1.0ms)[0m  [1mCREATE INDEX "index_preferences_on_user_id_and_name" ON "preferences" ("user_id", "name")[0m
  [1m[35m (3.3ms)[0m  CREATE TABLE "sessions" ("id" serial primary key, "session_id" character varying(255) NOT NULL, "data" text, "created_at" timestamp NOT NULL, "updated_at" timestamp NOT NULL) 
  [1m[36m (1.1ms)[0m  [1mCREATE INDEX "index_sessions_on_session_id" ON "sessions" ("session_id")[0m
  [1m[35m (1.0ms)[0m  CREATE INDEX "index_sessions_on_updated_at" ON "sessions" ("updated_at")
  [1m[36m (3.6ms)[0m  [1mCREATE TABLE "settings" ("id" serial primary key, "name" character varying(32) DEFAULT '' NOT NULL, "value" text, "created_at" timestamp NOT NULL, "updated_at" timestamp NOT NULL) [0m
  [1m[35m (0.9ms)[0m  CREATE INDEX "index_settings_on_name" ON "settings" ("name")
  [1m[36m (5.0ms)[0m  [1mCREATE TABLE "taggings" ("id" serial primary key, "tag_id" integer, "taggable_id" integer, "tagger_id" integer, "tagger_type" character varying(255), "taggable_type" character varying(255), "context" character varying(255), "created_at" timestamp) [0m
  [1m[35m (1.2ms)[0m  CREATE INDEX "index_taggings_on_tag_id" ON "taggings" ("tag_id")
  [1m[36m (1.5ms)[0m  [1mCREATE INDEX "index_taggings_on_taggable_id_and_taggable_type_and_context" ON "taggings" ("taggable_id", "taggable_type", "context")[0m
  [1m[35m (3.3ms)[0m  CREATE TABLE "tags" ("id" serial primary key, "name" character varying(255)) 
  [1m[36m (4.0ms)[0m  [1mCREATE TABLE "tasks" ("id" serial primary key, "user_id" integer, "assigned_to" integer, "completed_by" integer, "name" character varying(255) DEFAULT '' NOT NULL, "asset_id" integer, "asset_type" character varying(255), "priority" character varying(32), "category" character varying(32), "bucket" character varying(32), "due_at" timestamp, "completed_at" timestamp, "deleted_at" timestamp, "created_at" timestamp NOT NULL, "updated_at" timestamp NOT NULL, "background_info" character varying(255), "subscribed_users" text) [0m
  [1m[35m (1.5ms)[0m  CREATE INDEX "index_tasks_on_assigned_to" ON "tasks" ("assigned_to")
  [1m[36m (1.3ms)[0m  [1mCREATE UNIQUE INDEX "index_tasks_on_user_id_and_name_and_deleted_at" ON "tasks" ("user_id", "name", "deleted_at")[0m
  [1m[35m (5.5ms)[0m  CREATE TABLE "users" ("id" serial primary key, "username" character varying(32) DEFAULT '' NOT NULL, "email" character varying(64) DEFAULT '' NOT NULL, "first_name" character varying(32), "last_name" character varying(32), "title" character varying(64), "company" character varying(64), "alt_email" character varying(64), "phone" character varying(32), "mobile" character varying(32), "aim" character varying(32), "yahoo" character varying(32), "google" character varying(32), "skype" character varying(32), "password_hash" character varying(255) DEFAULT '' NOT NULL, "password_salt" character varying(255) DEFAULT '' NOT NULL, "persistence_token" character varying(255) DEFAULT '' NOT NULL, "perishable_token" character varying(255) DEFAULT '' NOT NULL, "last_request_at" timestamp, "last_login_at" timestamp, "current_login_at" timestamp, "last_login_ip" character varying(255), "current_login_ip" character varying(255), "login_count" integer DEFAULT 0 NOT NULL, "deleted_at" timestamp, "created_at" timestamp NOT NULL, "updated_at" timestamp NOT NULL, "admin" boolean DEFAULT 'f' NOT NULL, "suspended_at" timestamp, "single_access_token" character varying(255)) 
  [1m[36m (0.9ms)[0m  [1mCREATE INDEX "index_users_on_email" ON "users" ("email")[0m
  [1m[35m (1.4ms)[0m  CREATE INDEX "index_users_on_last_request_at" ON "users" ("last_request_at")
  [1m[36m (1.3ms)[0m  [1mCREATE INDEX "index_users_on_perishable_token" ON "users" ("perishable_token")[0m
  [1m[35m (1.1ms)[0m  CREATE INDEX "index_users_on_remember_token" ON "users" ("persistence_token")
  [1m[36m (1.2ms)[0m  [1mCREATE UNIQUE INDEX "index_users_on_username_and_deleted_at" ON "users" ("username", "deleted_at")[0m
  [1m[35m (4.1ms)[0m  CREATE TABLE "versions" ("id" serial primary key, "item_type" character varying(255) NOT NULL, "item_id" integer NOT NULL, "event" character varying(512) NOT NULL, "whodunnit" character varying(255), "object" text, "created_at" timestamp, "object_changes" text, "related_id" integer, "related_type" character varying(255)) 
  [1m[36m (1.1ms)[0m  [1mCREATE INDEX "index_versions_on_item_type_and_item_id" ON "versions" ("item_type", "item_id")[0m
  [1m[35m (0.8ms)[0m  CREATE INDEX "index_versions_on_whodunnit" ON "versions" ("whodunnit")
  [1m[36m (1.0ms)[0m  [1mCREATE TABLE "schema_migrations" ("version" character varying(255) NOT NULL) [0m
  [1m[35m (0.9ms)[0m  CREATE UNIQUE INDEX "unique_schema_migrations" ON "schema_migrations" ("version")
  [1m[36m (0.3ms)[0m  [1mSELECT version FROM "schema_migrations"[0m
  [1m[35m (0.5ms)[0m  INSERT INTO "schema_migrations" (version) VALUES ('20120528102124')
  [1m[36m (0.1ms)[0m  [1mBEGIN[0m
Started POST "/vend/register_sale" for 127.0.0.1 at 2013-03-06 19:53:17 +1300
Processing by VendController#register_sale as JSON
  Parameters: {"\n    {\n      \"payload\": {\n        \"id\": \"5e8b5134-a002-dd6b-b7c7-26126887c4ee\",\n        \"sale_date\": \"2012-11-13 16:40:06\",\n        \"status\": \"CLOSED\",\n        \"user_id\": \"9b2a8d5f-2d20-11e2-8057-080027706aa2\",\n        \"customer_id\": \"9b17ac9d-2d20-11e2-8057-080027706aa2\",\n        \"register_id\": \"9af85e69-2d20-11e2-8057-080027706aa2\",\n        \"market_id\": \"1\",\n        \"invoice_number\": \"144\",\n        \"short_code\": \"ne2zq\",\n        \"totals\": {\n          \"total_price\": \"4.87\",\n          \"total_tax\": \"0.69\",\n          \"total_payment\": \"5.55\",\n          \"total_to_pay\": \"0\"\n        },\n        \"note\": null,\n        \"updated_at\": \"2012-11-13 16:40:09\",\n        \"created_at\": \"2012-11-13 16:40:09\",\n        \"customer\": {\n          \"id\": \"9b17ac9d-2d20-11e2-8057-080027706aa2\",\n          \"customer_code\": \"WALKIN\",\n          \"balance\": \"-6.250\",\n          \"points\": 0,\n          \"note\": null,\n          \"year_to_date\": \"79945.92188\",\n          \"sex\": \"M\",\n          \"date_of_birth\": \"1950-05-25\",\n          \"updated_at\": \"2012-11-13 16:43:15\",\n          \"created_at\": \"2012-11-13 12:28:03\"\n        },\n        \"user\": {\n          \"id\": \"9b2a8d5f-2d20-11e2-8057-080027706aa2\",\n          \"name\": \"admin\",\n          \"display_name\": \"A admin this time\",\n          \"outlet_id\": \"9ae97219-2d20-11e2-8057-080027706aa2\",\n          \"target_daily\": null,\n          \"target_weekly\": null,\n          \"target_monthly\": null,\n          \"created_at\": \"2011-09-08 05:18:38\",\n          \"updated_at\": \"2011-09-08 05:18:38\"\n        },\n        \"register_sale_products\": "=>{"\n        {\n          \"id\": \"148793f0-475a-7d49-442d-fd761ce76339\",\n          \"product_id\": \"9fe945bc-2d20-11e2-8057-080027706aa2\",\n          \"quantity\": 1,\n          \"price\": \"1.90\",\n          \"price_set\": true,\n          \"tax\": \"0.24\",\n          \"price_total\": \"1.9\",\n          \"tax_total\": \"0.24\",\n          \"tax_id\": \"9a025ff0-2d20-11e2-8057-080027706aa2\",\n          \"tax_name\": \"NZ GST\",\n          \"tax_rate\": \"0.150000\"\n        },\n        {\n          \"id\": \"7d37dc0f-9462-06fa-cae0-0b4988b36539\",\n          \"product_id\": \"a0c0df02-2d20-11e2-8057-080027706aa2\",\n          \"quantity\": 3,\n          \"price\": \"0.99\",\n          \"price_set\": true,\n          \"tax\": \"0.15\",\n          \"price_total\": \"2.97\",\n          \"tax_total\": \"0.45\",\n          \"tax_id\": \"9a025ff0-2d20-11e2-8057-080027706aa2\",\n          \"tax_name\": \"NZ GST\",\n          \"tax_rate\": \"0.150000\"\n        }"=>{",\n        \"register_sale_payments\": "=>{"\n        {\n          \"id\": \"39948e3e-bf93-1b60-ff44-f46a777ed1d4\",\n          \"payment_date\": \"2012-11-13 16:40:06\",\n          \"amount\": \"5.55\",\n          \"retailer_payment_type_id\": \"9e9ba1ba-2d20-11e2-8057-080027706aa2\",\n          \"payment_type_id\": \"1\"\n        }"=>{"\n      }\n    }\n  "=>nil}}}}}
Completed 500 Internal Server Error in 4ms
  [1m[35m (0.3ms)[0m  ROLLBACK
  [1m[36m (0.1ms)[0m  [1mBEGIN[0m
  [1m[35m (0.1ms)[0m  ROLLBACK
Connecting to database specified by database.yml
  [1m[36mFieldGroup Load (1.2ms)[0m  [1mSELECT "field_groups".* FROM "field_groups" WHERE "field_groups"."klass_name" = 'Account' ORDER BY position[0m
  [1m[35mFieldGroup Load (0.2ms)[0m  SELECT "field_groups".* FROM "field_groups" WHERE "field_groups"."klass_name" = 'Campaign' ORDER BY position
  [1m[36mFieldGroup Load (0.3ms)[0m  [1mSELECT "field_groups".* FROM "field_groups" WHERE "field_groups"."klass_name" = 'Contact' ORDER BY position[0m
  [1m[35mFieldGroup Load (0.3ms)[0m  SELECT "field_groups".* FROM "field_groups" WHERE "field_groups"."klass_name" = 'Lead' ORDER BY position
  [1m[36mFieldGroup Load (0.3ms)[0m  [1mSELECT "field_groups".* FROM "field_groups" WHERE "field_groups"."klass_name" = 'Opportunity' ORDER BY position[0m
  [1m[35mFieldGroup Load (0.3ms)[0m  SELECT "field_groups".* FROM "field_groups" WHERE "field_groups"."klass_name" = 'Task' ORDER BY position
Creating scope :except. Overwriting existing method User.except.
  [1m[36m (121.9ms)[0m  [1mDROP DATABASE IF EXISTS "ffcrm_vend_test"[0m
  [1m[35m (251.2ms)[0m  CREATE DATABASE "ffcrm_vend_test" ENCODING = 'utf8'
  [1m[36m (5.8ms)[0m  [1mCREATE TABLE "account_contacts" ("id" serial primary key, "account_id" integer, "contact_id" integer, "deleted_at" timestamp, "created_at" timestamp NOT NULL, "updated_at" timestamp NOT NULL) [0m
  [1m[35m (2.7ms)[0m  CREATE TABLE "account_opportunities" ("id" serial primary key, "account_id" integer, "opportunity_id" integer, "deleted_at" timestamp, "created_at" timestamp NOT NULL, "updated_at" timestamp NOT NULL) 
  [1m[36m (6.1ms)[0m  [1mCREATE TABLE "accounts" ("id" serial primary key, "user_id" integer, "assigned_to" integer, "name" character varying(64) DEFAULT '' NOT NULL, "access" character varying(8) DEFAULT 'Public', "website" character varying(64), "toll_free_phone" character varying(32), "phone" character varying(32), "fax" character varying(32), "deleted_at" timestamp, "created_at" timestamp NOT NULL, "updated_at" timestamp NOT NULL, "email" character varying(64), "background_info" character varying(255), "rating" integer DEFAULT 0 NOT NULL, "category" character varying(32), "subscribed_users" text) [0m
  [1m[35m (1.1ms)[0m  CREATE INDEX "index_accounts_on_assigned_to" ON "accounts" ("assigned_to")
  [1m[36m (1.3ms)[0m  [1mCREATE UNIQUE INDEX "index_accounts_on_user_id_and_name_and_deleted_at" ON "accounts" ("user_id", "name", "deleted_at")[0m
  [1m[35m (4.6ms)[0m  CREATE TABLE "activities" ("id" serial primary key, "user_id" integer, "subject_id" integer, "subject_type" character varying(255), "action" character varying(32) DEFAULT 'created', "info" character varying(255) DEFAULT '', "private" boolean DEFAULT 'f', "created_at" timestamp NOT NULL, "updated_at" timestamp NOT NULL) 
  [1m[36m (0.9ms)[0m  [1mCREATE INDEX "index_activities_on_created_at" ON "activities" ("created_at")[0m
  [1m[35m (1.1ms)[0m  CREATE INDEX "index_activities_on_user_id" ON "activities" ("user_id")
  [1m[36m (5.3ms)[0m  [1mCREATE TABLE "addresses" ("id" serial primary key, "street1" character varying(255), "street2" character varying(255), "city" character varying(64), "state" character varying(64), "zipcode" character varying(16), "country" character varying(64), "full_address" character varying(255), "address_type" character varying(16), "addressable_id" integer, "addressable_type" character varying(255), "created_at" timestamp NOT NULL, "updated_at" timestamp NOT NULL, "deleted_at" timestamp) [0m
  [1m[35m (2.0ms)[0m  CREATE INDEX "index_addresses_on_addressable_id_and_addressable_type" ON "addresses" ("addressable_id", "addressable_type")
  [1m[36m (4.3ms)[0m  [1mCREATE TABLE "avatars" ("id" serial primary key, "user_id" integer, "entity_id" integer, "entity_type" character varying(255), "image_file_size" integer, "image_file_name" character varying(255), "image_content_type" character varying(255), "created_at" timestamp NOT NULL, "updated_at" timestamp NOT NULL) [0m
  [1m[35m (5.1ms)[0m  CREATE TABLE "campaigns" ("id" serial primary key, "user_id" integer, "assigned_to" integer, "name" character varying(64) DEFAULT '' NOT NULL, "access" character varying(8) DEFAULT 'Public', "status" character varying(64), "budget" decimal(12,2), "target_leads" integer, "target_conversion" float, "target_revenue" decimal(12,2), "leads_count" integer, "opportunities_count" integer, "revenue" decimal(12,2), "starts_on" date, "ends_on" date, "objectives" text, "deleted_at" timestamp, "created_at" timestamp NOT NULL, "updated_at" timestamp NOT NULL, "background_info" character varying(255), "subscribed_users" text) 
  [1m[36m (1.1ms)[0m  [1mCREATE INDEX "index_campaigns_on_assigned_to" ON "campaigns" ("assigned_to")[0m
  [1m[35m (1.0ms)[0m  CREATE UNIQUE INDEX "index_campaigns_on_user_id_and_name_and_deleted_at" ON "campaigns" ("user_id", "name", "deleted_at")
  [1m[36m (4.2ms)[0m  [1mCREATE TABLE "comments" ("id" serial primary key, "user_id" integer, "commentable_id" integer, "commentable_type" character varying(255), "private" boolean, "title" character varying(255) DEFAULT '', "comment" text, "created_at" timestamp NOT NULL, "updated_at" timestamp NOT NULL, "state" character varying(16) DEFAULT 'Expanded' NOT NULL) [0m
  [1m[35m (3.2ms)[0m  CREATE TABLE "contact_opportunities" ("id" serial primary key, "contact_id" integer, "opportunity_id" integer, "role" character varying(32), "deleted_at" timestamp, "created_at" timestamp NOT NULL, "updated_at" timestamp NOT NULL) 
  [1m[36m (5.6ms)[0m  [1mCREATE TABLE "contacts" ("id" serial primary key, "user_id" integer, "lead_id" integer, "assigned_to" integer, "reports_to" integer, "first_name" character varying(64) DEFAULT '' NOT NULL, "last_name" character varying(64) DEFAULT '' NOT NULL, "access" character varying(8) DEFAULT 'Public', "title" character varying(64), "department" character varying(64), "source" character varying(32), "email" character varying(64), "alt_email" character varying(64), "phone" character varying(32), "mobile" character varying(32), "fax" character varying(32), "blog" character varying(128), "linkedin" character varying(128), "facebook" character varying(128), "twitter" character varying(128), "born_on" date, "do_not_call" boolean DEFAULT 'f' NOT NULL, "deleted_at" timestamp, "created_at" timestamp NOT NULL, "updated_at" timestamp NOT NULL, "background_info" character varying(255), "skype" character varying(128), "subscribed_users" text) [0m
  [1m[35m (1.1ms)[0m  CREATE INDEX "index_contacts_on_assigned_to" ON "contacts" ("assigned_to")
  [1m[36m (1.4ms)[0m  [1mCREATE UNIQUE INDEX "id_last_name_deleted" ON "contacts" ("user_id", "last_name", "deleted_at")[0m
  [1m[35m (4.5ms)[0m  CREATE TABLE "emails" ("id" serial primary key, "imap_message_id" character varying(255) NOT NULL, "user_id" integer, "mediator_id" integer, "mediator_type" character varying(255), "sent_from" character varying(255) NOT NULL, "sent_to" character varying(255) NOT NULL, "cc" character varying(255), "bcc" character varying(255), "subject" character varying(255), "body" text, "header" text, "sent_at" timestamp, "received_at" timestamp, "deleted_at" timestamp, "created_at" timestamp NOT NULL, "updated_at" timestamp NOT NULL, "state" character varying(16) DEFAULT 'Expanded' NOT NULL) 
  [1m[36m (1.1ms)[0m  [1mCREATE INDEX "index_emails_on_mediator_id_and_mediator_type" ON "emails" ("mediator_id", "mediator_type")[0m
  [1m[35m (3.1ms)[0m  CREATE TABLE "field_groups" ("id" serial primary key, "name" character varying(64), "label" character varying(128), "position" integer, "hint" character varying(255), "created_at" timestamp NOT NULL, "updated_at" timestamp NOT NULL, "tag_id" integer, "klass_name" character varying(32)) 
  [1m[36m (3.7ms)[0m  [1mCREATE TABLE "fields" ("id" serial primary key, "type" character varying(255), "field_group_id" integer, "position" integer, "name" character varying(64), "label" character varying(128), "hint" character varying(255), "placeholder" character varying(255), "as" character varying(32), "collection" text, "disabled" boolean, "required" boolean, "maxlength" integer, "created_at" timestamp NOT NULL, "updated_at" timestamp NOT NULL) [0m
  [1m[35m (1.3ms)[0m  CREATE INDEX "index_fields_on_field_group_id" ON "fields" ("field_group_id")
  [1m[36m (1.1ms)[0m  [1mCREATE INDEX "index_fields_on_name" ON "fields" ("name")[0m
  [1m[35m (6.1ms)[0m  CREATE TABLE "leads" ("id" serial primary key, "user_id" integer, "campaign_id" integer, "assigned_to" integer, "first_name" character varying(64) DEFAULT '' NOT NULL, "last_name" character varying(64) DEFAULT '' NOT NULL, "access" character varying(8) DEFAULT 'Public', "title" character varying(64), "company" character varying(64), "source" character varying(32), "status" character varying(32), "referred_by" character varying(64), "email" character varying(64), "alt_email" character varying(64), "phone" character varying(32), "mobile" character varying(32), "blog" character varying(128), "linkedin" character varying(128), "facebook" character varying(128), "twitter" character varying(128), "rating" integer DEFAULT 0 NOT NULL, "do_not_call" boolean DEFAULT 'f' NOT NULL, "deleted_at" timestamp, "created_at" timestamp NOT NULL, "updated_at" timestamp NOT NULL, "background_info" character varying(255), "skype" character varying(128), "subscribed_users" text) 
  [1m[36m (1.0ms)[0m  [1mCREATE INDEX "index_leads_on_assigned_to" ON "leads" ("assigned_to")[0m
  [1m[35m (1.4ms)[0m  CREATE UNIQUE INDEX "index_leads_on_user_id_and_last_name_and_deleted_at" ON "leads" ("user_id", "last_name", "deleted_at")
  [1m[36m (3.5ms)[0m  [1mCREATE TABLE "lists" ("id" serial primary key, "name" character varying(255), "url" text, "created_at" timestamp NOT NULL, "updated_at" timestamp NOT NULL) [0m
  [1m[35m (4.3ms)[0m  CREATE TABLE "opportunities" ("id" serial primary key, "user_id" integer, "campaign_id" integer, "assigned_to" integer, "name" character varying(64) DEFAULT '' NOT NULL, "access" character varying(8) DEFAULT 'Public', "source" character varying(32), "stage" character varying(32), "probability" integer, "amount" decimal(12,2), "discount" decimal(12,2), "closes_on" date, "deleted_at" timestamp, "created_at" timestamp NOT NULL, "updated_at" timestamp NOT NULL, "background_info" character varying(255), "subscribed_users" text) 
  [1m[36m (1.0ms)[0m  [1mCREATE INDEX "index_opportunities_on_assigned_to" ON "opportunities" ("assigned_to")[0m
  [1m[35m (1.4ms)[0m  CREATE UNIQUE INDEX "id_name_deleted" ON "opportunities" ("user_id", "name", "deleted_at")
  [1m[36m (2.9ms)[0m  [1mCREATE TABLE "permissions" ("id" serial primary key, "user_id" integer, "asset_id" integer, "asset_type" character varying(255), "created_at" timestamp NOT NULL, "updated_at" timestamp NOT NULL) [0m
  [1m[35m (1.1ms)[0m  CREATE INDEX "index_permissions_on_asset_id_and_asset_type" ON "permissions" ("asset_id", "asset_type")
  [1m[36m (1.2ms)[0m  [1mCREATE INDEX "index_permissions_on_user_id" ON "permissions" ("user_id")[0m
  [1m[35m (3.3ms)[0m  CREATE TABLE "preferences" ("id" serial primary key, "user_id" integer, "name" character varying(32) DEFAULT '' NOT NULL, "value" text, "created_at" timestamp NOT NULL, "updated_at" timestamp NOT NULL) 
  [1m[36m (1.1ms)[0m  [1mCREATE INDEX "index_preferences_on_user_id_and_name" ON "preferences" ("user_id", "name")[0m
  [1m[35m (4.1ms)[0m  CREATE TABLE "sessions" ("id" serial primary key, "session_id" character varying(255) NOT NULL, "data" text, "created_at" timestamp NOT NULL, "updated_at" timestamp NOT NULL) 
  [1m[36m (1.0ms)[0m  [1mCREATE INDEX "index_sessions_on_session_id" ON "sessions" ("session_id")[0m
  [1m[35m (0.9ms)[0m  CREATE INDEX "index_sessions_on_updated_at" ON "sessions" ("updated_at")
  [1m[36m (5.2ms)[0m  [1mCREATE TABLE "settings" ("id" serial primary key, "name" character varying(32) DEFAULT '' NOT NULL, "value" text, "created_at" timestamp NOT NULL, "updated_at" timestamp NOT NULL) [0m
  [1m[35m (0.9ms)[0m  CREATE INDEX "index_settings_on_name" ON "settings" ("name")
  [1m[36m (4.6ms)[0m  [1mCREATE TABLE "taggings" ("id" serial primary key, "tag_id" integer, "taggable_id" integer, "tagger_id" integer, "tagger_type" character varying(255), "taggable_type" character varying(255), "context" character varying(255), "created_at" timestamp) [0m
  [1m[35m (1.0ms)[0m  CREATE INDEX "index_taggings_on_tag_id" ON "taggings" ("tag_id")
  [1m[36m (1.0ms)[0m  [1mCREATE INDEX "index_taggings_on_taggable_id_and_taggable_type_and_context" ON "taggings" ("taggable_id", "taggable_type", "context")[0m
  [1m[35m (2.8ms)[0m  CREATE TABLE "tags" ("id" serial primary key, "name" character varying(255)) 
  [1m[36m (4.6ms)[0m  [1mCREATE TABLE "tasks" ("id" serial primary key, "user_id" integer, "assigned_to" integer, "completed_by" integer, "name" character varying(255) DEFAULT '' NOT NULL, "asset_id" integer, "asset_type" character varying(255), "priority" character varying(32), "category" character varying(32), "bucket" character varying(32), "due_at" timestamp, "completed_at" timestamp, "deleted_at" timestamp, "created_at" timestamp NOT NULL, "updated_at" timestamp NOT NULL, "background_info" character varying(255), "subscribed_users" text) [0m
  [1m[35m (1.1ms)[0m  CREATE INDEX "index_tasks_on_assigned_to" ON "tasks" ("assigned_to")
  [1m[36m (1.2ms)[0m  [1mCREATE UNIQUE INDEX "index_tasks_on_user_id_and_name_and_deleted_at" ON "tasks" ("user_id", "name", "deleted_at")[0m
  [1m[35m (6.6ms)[0m  CREATE TABLE "users" ("id" serial primary key, "username" character varying(32) DEFAULT '' NOT NULL, "email" character varying(64) DEFAULT '' NOT NULL, "first_name" character varying(32), "last_name" character varying(32), "title" character varying(64), "company" character varying(64), "alt_email" character varying(64), "phone" character varying(32), "mobile" character varying(32), "aim" character varying(32), "yahoo" character varying(32), "google" character varying(32), "skype" character varying(32), "password_hash" character varying(255) DEFAULT '' NOT NULL, "password_salt" character varying(255) DEFAULT '' NOT NULL, "persistence_token" character varying(255) DEFAULT '' NOT NULL, "perishable_token" character varying(255) DEFAULT '' NOT NULL, "last_request_at" timestamp, "last_login_at" timestamp, "current_login_at" timestamp, "last_login_ip" character varying(255), "current_login_ip" character varying(255), "login_count" integer DEFAULT 0 NOT NULL, "deleted_at" timestamp, "created_at" timestamp NOT NULL, "updated_at" timestamp NOT NULL, "admin" boolean DEFAULT 'f' NOT NULL, "suspended_at" timestamp, "single_access_token" character varying(255)) 
  [1m[36m (1.1ms)[0m  [1mCREATE INDEX "index_users_on_email" ON "users" ("email")[0m
  [1m[35m (1.0ms)[0m  CREATE INDEX "index_users_on_last_request_at" ON "users" ("last_request_at")
  [1m[36m (0.9ms)[0m  [1mCREATE INDEX "index_users_on_perishable_token" ON "users" ("perishable_token")[0m
  [1m[35m (1.2ms)[0m  CREATE INDEX "index_users_on_remember_token" ON "users" ("persistence_token")
  [1m[36m (1.3ms)[0m  [1mCREATE UNIQUE INDEX "index_users_on_username_and_deleted_at" ON "users" ("username", "deleted_at")[0m
  [1m[35m (3.9ms)[0m  CREATE TABLE "versions" ("id" serial primary key, "item_type" character varying(255) NOT NULL, "item_id" integer NOT NULL, "event" character varying(512) NOT NULL, "whodunnit" character varying(255), "object" text, "created_at" timestamp, "object_changes" text, "related_id" integer, "related_type" character varying(255)) 
  [1m[36m (0.9ms)[0m  [1mCREATE INDEX "index_versions_on_item_type_and_item_id" ON "versions" ("item_type", "item_id")[0m
  [1m[35m (0.8ms)[0m  CREATE INDEX "index_versions_on_whodunnit" ON "versions" ("whodunnit")
  [1m[36m (0.7ms)[0m  [1mCREATE TABLE "schema_migrations" ("version" character varying(255) NOT NULL) [0m
  [1m[35m (0.8ms)[0m  CREATE UNIQUE INDEX "unique_schema_migrations" ON "schema_migrations" ("version")
  [1m[36m (0.3ms)[0m  [1mSELECT version FROM "schema_migrations"[0m
  [1m[35m (0.5ms)[0m  INSERT INTO "schema_migrations" (version) VALUES ('20120528102124')
  [1m[36m (0.1ms)[0m  [1mBEGIN[0m
Started POST "/vend/register_sale" for 127.0.0.1 at 2013-03-06 19:54:11 +1300
Processing by VendController#register_sale as JSON
  Parameters: {"\n    {\n      \"payload\": {\n        \"id\": \"5e8b5134-a002-dd6b-b7c7-26126887c4ee\",\n        \"sale_date\": \"2012-11-13 16:40:06\",\n        \"status\": \"CLOSED\",\n        \"user_id\": \"9b2a8d5f-2d20-11e2-8057-080027706aa2\",\n        \"customer_id\": \"9b17ac9d-2d20-11e2-8057-080027706aa2\",\n        \"register_id\": \"9af85e69-2d20-11e2-8057-080027706aa2\",\n        \"market_id\": \"1\",\n        \"invoice_number\": \"144\",\n        \"short_code\": \"ne2zq\",\n        \"totals\": {\n          \"total_price\": \"4.87\",\n          \"total_tax\": \"0.69\",\n          \"total_payment\": \"5.55\",\n          \"total_to_pay\": \"0\"\n        },\n        \"note\": null,\n        \"updated_at\": \"2012-11-13 16:40:09\",\n        \"created_at\": \"2012-11-13 16:40:09\",\n        \"customer\": {\n          \"id\": \"9b17ac9d-2d20-11e2-8057-080027706aa2\",\n          \"customer_code\": \"WALKIN\",\n          \"balance\": \"-6.250\",\n          \"points\": 0,\n          \"note\": null,\n          \"year_to_date\": \"79945.92188\",\n          \"sex\": \"M\",\n          \"date_of_birth\": \"1950-05-25\",\n          \"updated_at\": \"2012-11-13 16:43:15\",\n          \"created_at\": \"2012-11-13 12:28:03\"\n        },\n        \"user\": {\n          \"id\": \"9b2a8d5f-2d20-11e2-8057-080027706aa2\",\n          \"name\": \"admin\",\n          \"display_name\": \"A admin this time\",\n          \"outlet_id\": \"9ae97219-2d20-11e2-8057-080027706aa2\",\n          \"target_daily\": null,\n          \"target_weekly\": null,\n          \"target_monthly\": null,\n          \"created_at\": \"2011-09-08 05:18:38\",\n          \"updated_at\": \"2011-09-08 05:18:38\"\n        },\n        \"register_sale_products\": "=>{"\n        {\n          \"id\": \"148793f0-475a-7d49-442d-fd761ce76339\",\n          \"product_id\": \"9fe945bc-2d20-11e2-8057-080027706aa2\",\n          \"quantity\": 1,\n          \"price\": \"1.90\",\n          \"price_set\": true,\n          \"tax\": \"0.24\",\n          \"price_total\": \"1.9\",\n          \"tax_total\": \"0.24\",\n          \"tax_id\": \"9a025ff0-2d20-11e2-8057-080027706aa2\",\n          \"tax_name\": \"NZ GST\",\n          \"tax_rate\": \"0.150000\"\n        },\n        {\n          \"id\": \"7d37dc0f-9462-06fa-cae0-0b4988b36539\",\n          \"product_id\": \"a0c0df02-2d20-11e2-8057-080027706aa2\",\n          \"quantity\": 3,\n          \"price\": \"0.99\",\n          \"price_set\": true,\n          \"tax\": \"0.15\",\n          \"price_total\": \"2.97\",\n          \"tax_total\": \"0.45\",\n          \"tax_id\": \"9a025ff0-2d20-11e2-8057-080027706aa2\",\n          \"tax_name\": \"NZ GST\",\n          \"tax_rate\": \"0.150000\"\n        }"=>{",\n        \"register_sale_payments\": "=>{"\n        {\n          \"id\": \"39948e3e-bf93-1b60-ff44-f46a777ed1d4\",\n          \"payment_date\": \"2012-11-13 16:40:06\",\n          \"amount\": \"5.55\",\n          \"retailer_payment_type_id\": \"9e9ba1ba-2d20-11e2-8057-080027706aa2\",\n          \"payment_type_id\": \"1\"\n        }"=>{"\n      }\n    }\n  "=>nil}}}}}
Completed 500 Internal Server Error in 1ms
  [1m[35m (0.3ms)[0m  ROLLBACK
  [1m[36m (0.1ms)[0m  [1mBEGIN[0m
  [1m[35m (0.1ms)[0m  ROLLBACK
Connecting to database specified by database.yml
  [1m[36mFieldGroup Load (4.7ms)[0m  [1mSELECT "field_groups".* FROM "field_groups" WHERE "field_groups"."klass_name" = 'Account' ORDER BY position[0m
  [1m[35mFieldGroup Load (0.2ms)[0m  SELECT "field_groups".* FROM "field_groups" WHERE "field_groups"."klass_name" = 'Campaign' ORDER BY position
  [1m[36mFieldGroup Load (0.2ms)[0m  [1mSELECT "field_groups".* FROM "field_groups" WHERE "field_groups"."klass_name" = 'Contact' ORDER BY position[0m
  [1m[35mFieldGroup Load (0.2ms)[0m  SELECT "field_groups".* FROM "field_groups" WHERE "field_groups"."klass_name" = 'Lead' ORDER BY position
  [1m[36mFieldGroup Load (0.2ms)[0m  [1mSELECT "field_groups".* FROM "field_groups" WHERE "field_groups"."klass_name" = 'Opportunity' ORDER BY position[0m
  [1m[35mFieldGroup Load (0.4ms)[0m  SELECT "field_groups".* FROM "field_groups" WHERE "field_groups"."klass_name" = 'Task' ORDER BY position
Creating scope :except. Overwriting existing method User.except.
  [1m[36m (153.4ms)[0m  [1mDROP DATABASE IF EXISTS "ffcrm_vend_test"[0m
  [1m[35m (347.3ms)[0m  CREATE DATABASE "ffcrm_vend_test" ENCODING = 'utf8'
  [1m[36m (5.9ms)[0m  [1mCREATE TABLE "account_contacts" ("id" serial primary key, "account_id" integer, "contact_id" integer, "deleted_at" timestamp, "created_at" timestamp NOT NULL, "updated_at" timestamp NOT NULL) [0m
  [1m[35m (2.2ms)[0m  CREATE TABLE "account_opportunities" ("id" serial primary key, "account_id" integer, "opportunity_id" integer, "deleted_at" timestamp, "created_at" timestamp NOT NULL, "updated_at" timestamp NOT NULL) 
  [1m[36m (5.0ms)[0m  [1mCREATE TABLE "accounts" ("id" serial primary key, "user_id" integer, "assigned_to" integer, "name" character varying(64) DEFAULT '' NOT NULL, "access" character varying(8) DEFAULT 'Public', "website" character varying(64), "toll_free_phone" character varying(32), "phone" character varying(32), "fax" character varying(32), "deleted_at" timestamp, "created_at" timestamp NOT NULL, "updated_at" timestamp NOT NULL, "email" character varying(64), "background_info" character varying(255), "rating" integer DEFAULT 0 NOT NULL, "category" character varying(32), "subscribed_users" text) [0m
  [1m[35m (1.0ms)[0m  CREATE INDEX "index_accounts_on_assigned_to" ON "accounts" ("assigned_to")
  [1m[36m (1.5ms)[0m  [1mCREATE UNIQUE INDEX "index_accounts_on_user_id_and_name_and_deleted_at" ON "accounts" ("user_id", "name", "deleted_at")[0m
  [1m[35m (4.3ms)[0m  CREATE TABLE "activities" ("id" serial primary key, "user_id" integer, "subject_id" integer, "subject_type" character varying(255), "action" character varying(32) DEFAULT 'created', "info" character varying(255) DEFAULT '', "private" boolean DEFAULT 'f', "created_at" timestamp NOT NULL, "updated_at" timestamp NOT NULL) 
  [1m[36m (0.9ms)[0m  [1mCREATE INDEX "index_activities_on_created_at" ON "activities" ("created_at")[0m
  [1m[35m (1.1ms)[0m  CREATE INDEX "index_activities_on_user_id" ON "activities" ("user_id")
  [1m[36m (17.2ms)[0m  [1mCREATE TABLE "addresses" ("id" serial primary key, "street1" character varying(255), "street2" character varying(255), "city" character varying(64), "state" character varying(64), "zipcode" character varying(16), "country" character varying(64), "full_address" character varying(255), "address_type" character varying(16), "addressable_id" integer, "addressable_type" character varying(255), "created_at" timestamp NOT NULL, "updated_at" timestamp NOT NULL, "deleted_at" timestamp) [0m
  [1m[35m (1.8ms)[0m  CREATE INDEX "index_addresses_on_addressable_id_and_addressable_type" ON "addresses" ("addressable_id", "addressable_type")
  [1m[36m (4.4ms)[0m  [1mCREATE TABLE "avatars" ("id" serial primary key, "user_id" integer, "entity_id" integer, "entity_type" character varying(255), "image_file_size" integer, "image_file_name" character varying(255), "image_content_type" character varying(255), "created_at" timestamp NOT NULL, "updated_at" timestamp NOT NULL) [0m
  [1m[35m (4.4ms)[0m  CREATE TABLE "campaigns" ("id" serial primary key, "user_id" integer, "assigned_to" integer, "name" character varying(64) DEFAULT '' NOT NULL, "access" character varying(8) DEFAULT 'Public', "status" character varying(64), "budget" decimal(12,2), "target_leads" integer, "target_conversion" float, "target_revenue" decimal(12,2), "leads_count" integer, "opportunities_count" integer, "revenue" decimal(12,2), "starts_on" date, "ends_on" date, "objectives" text, "deleted_at" timestamp, "created_at" timestamp NOT NULL, "updated_at" timestamp NOT NULL, "background_info" character varying(255), "subscribed_users" text) 
  [1m[36m (1.0ms)[0m  [1mCREATE INDEX "index_campaigns_on_assigned_to" ON "campaigns" ("assigned_to")[0m
  [1m[35m (9.5ms)[0m  CREATE UNIQUE INDEX "index_campaigns_on_user_id_and_name_and_deleted_at" ON "campaigns" ("user_id", "name", "deleted_at")
  [1m[36m (6.3ms)[0m  [1mCREATE TABLE "comments" ("id" serial primary key, "user_id" integer, "commentable_id" integer, "commentable_type" character varying(255), "private" boolean, "title" character varying(255) DEFAULT '', "comment" text, "created_at" timestamp NOT NULL, "updated_at" timestamp NOT NULL, "state" character varying(16) DEFAULT 'Expanded' NOT NULL) [0m
  [1m[35m (3.4ms)[0m  CREATE TABLE "contact_opportunities" ("id" serial primary key, "contact_id" integer, "opportunity_id" integer, "role" character varying(32), "deleted_at" timestamp, "created_at" timestamp NOT NULL, "updated_at" timestamp NOT NULL) 
  [1m[36m (5.5ms)[0m  [1mCREATE TABLE "contacts" ("id" serial primary key, "user_id" integer, "lead_id" integer, "assigned_to" integer, "reports_to" integer, "first_name" character varying(64) DEFAULT '' NOT NULL, "last_name" character varying(64) DEFAULT '' NOT NULL, "access" character varying(8) DEFAULT 'Public', "title" character varying(64), "department" character varying(64), "source" character varying(32), "email" character varying(64), "alt_email" character varying(64), "phone" character varying(32), "mobile" character varying(32), "fax" character varying(32), "blog" character varying(128), "linkedin" character varying(128), "facebook" character varying(128), "twitter" character varying(128), "born_on" date, "do_not_call" boolean DEFAULT 'f' NOT NULL, "deleted_at" timestamp, "created_at" timestamp NOT NULL, "updated_at" timestamp NOT NULL, "background_info" character varying(255), "skype" character varying(128), "subscribed_users" text) [0m
  [1m[35m (0.9ms)[0m  CREATE INDEX "index_contacts_on_assigned_to" ON "contacts" ("assigned_to")
  [1m[36m (1.2ms)[0m  [1mCREATE UNIQUE INDEX "id_last_name_deleted" ON "contacts" ("user_id", "last_name", "deleted_at")[0m
  [1m[35m (14.6ms)[0m  CREATE TABLE "emails" ("id" serial primary key, "imap_message_id" character varying(255) NOT NULL, "user_id" integer, "mediator_id" integer, "mediator_type" character varying(255), "sent_from" character varying(255) NOT NULL, "sent_to" character varying(255) NOT NULL, "cc" character varying(255), "bcc" character varying(255), "subject" character varying(255), "body" text, "header" text, "sent_at" timestamp, "received_at" timestamp, "deleted_at" timestamp, "created_at" timestamp NOT NULL, "updated_at" timestamp NOT NULL, "state" character varying(16) DEFAULT 'Expanded' NOT NULL) 
  [1m[36m (1.2ms)[0m  [1mCREATE INDEX "index_emails_on_mediator_id_and_mediator_type" ON "emails" ("mediator_id", "mediator_type")[0m
  [1m[35m (10.4ms)[0m  CREATE TABLE "field_groups" ("id" serial primary key, "name" character varying(64), "label" character varying(128), "position" integer, "hint" character varying(255), "created_at" timestamp NOT NULL, "updated_at" timestamp NOT NULL, "tag_id" integer, "klass_name" character varying(32)) 
  [1m[36m (3.2ms)[0m  [1mCREATE TABLE "fields" ("id" serial primary key, "type" character varying(255), "field_group_id" integer, "position" integer, "name" character varying(64), "label" character varying(128), "hint" character varying(255), "placeholder" character varying(255), "as" character varying(32), "collection" text, "disabled" boolean, "required" boolean, "maxlength" integer, "created_at" timestamp NOT NULL, "updated_at" timestamp NOT NULL) [0m
  [1m[35m (1.0ms)[0m  CREATE INDEX "index_fields_on_field_group_id" ON "fields" ("field_group_id")
  [1m[36m (1.0ms)[0m  [1mCREATE INDEX "index_fields_on_name" ON "fields" ("name")[0m
  [1m[35m (4.8ms)[0m  CREATE TABLE "leads" ("id" serial primary key, "user_id" integer, "campaign_id" integer, "assigned_to" integer, "first_name" character varying(64) DEFAULT '' NOT NULL, "last_name" character varying(64) DEFAULT '' NOT NULL, "access" character varying(8) DEFAULT 'Public', "title" character varying(64), "company" character varying(64), "source" character varying(32), "status" character varying(32), "referred_by" character varying(64), "email" character varying(64), "alt_email" character varying(64), "phone" character varying(32), "mobile" character varying(32), "blog" character varying(128), "linkedin" character varying(128), "facebook" character varying(128), "twitter" character varying(128), "rating" integer DEFAULT 0 NOT NULL, "do_not_call" boolean DEFAULT 'f' NOT NULL, "deleted_at" timestamp, "created_at" timestamp NOT NULL, "updated_at" timestamp NOT NULL, "background_info" character varying(255), "skype" character varying(128), "subscribed_users" text) 
  [1m[36m (0.9ms)[0m  [1mCREATE INDEX "index_leads_on_assigned_to" ON "leads" ("assigned_to")[0m
  [1m[35m (1.4ms)[0m  CREATE UNIQUE INDEX "index_leads_on_user_id_and_last_name_and_deleted_at" ON "leads" ("user_id", "last_name", "deleted_at")
  [1m[36m (4.2ms)[0m  [1mCREATE TABLE "lists" ("id" serial primary key, "name" character varying(255), "url" text, "created_at" timestamp NOT NULL, "updated_at" timestamp NOT NULL) [0m
  [1m[35m (5.7ms)[0m  CREATE TABLE "opportunities" ("id" serial primary key, "user_id" integer, "campaign_id" integer, "assigned_to" integer, "name" character varying(64) DEFAULT '' NOT NULL, "access" character varying(8) DEFAULT 'Public', "source" character varying(32), "stage" character varying(32), "probability" integer, "amount" decimal(12,2), "discount" decimal(12,2), "closes_on" date, "deleted_at" timestamp, "created_at" timestamp NOT NULL, "updated_at" timestamp NOT NULL, "background_info" character varying(255), "subscribed_users" text) 
  [1m[36m (0.9ms)[0m  [1mCREATE INDEX "index_opportunities_on_assigned_to" ON "opportunities" ("assigned_to")[0m
  [1m[35m (1.8ms)[0m  CREATE UNIQUE INDEX "id_name_deleted" ON "opportunities" ("user_id", "name", "deleted_at")
  [1m[36m (3.4ms)[0m  [1mCREATE TABLE "permissions" ("id" serial primary key, "user_id" integer, "asset_id" integer, "asset_type" character varying(255), "created_at" timestamp NOT NULL, "updated_at" timestamp NOT NULL) [0m
  [1m[35m (1.0ms)[0m  CREATE INDEX "index_permissions_on_asset_id_and_asset_type" ON "permissions" ("asset_id", "asset_type")
  [1m[36m (1.0ms)[0m  [1mCREATE INDEX "index_permissions_on_user_id" ON "permissions" ("user_id")[0m
  [1m[35m (4.7ms)[0m  CREATE TABLE "preferences" ("id" serial primary key, "user_id" integer, "name" character varying(32) DEFAULT '' NOT NULL, "value" text, "created_at" timestamp NOT NULL, "updated_at" timestamp NOT NULL) 
  [1m[36m (1.2ms)[0m  [1mCREATE INDEX "index_preferences_on_user_id_and_name" ON "preferences" ("user_id", "name")[0m
  [1m[35m (3.4ms)[0m  CREATE TABLE "sessions" ("id" serial primary key, "session_id" character varying(255) NOT NULL, "data" text, "created_at" timestamp NOT NULL, "updated_at" timestamp NOT NULL) 
  [1m[36m (1.0ms)[0m  [1mCREATE INDEX "index_sessions_on_session_id" ON "sessions" ("session_id")[0m
  [1m[35m (0.9ms)[0m  CREATE INDEX "index_sessions_on_updated_at" ON "sessions" ("updated_at")
  [1m[36m (4.0ms)[0m  [1mCREATE TABLE "settings" ("id" serial primary key, "name" character varying(32) DEFAULT '' NOT NULL, "value" text, "created_at" timestamp NOT NULL, "updated_at" timestamp NOT NULL) [0m
  [1m[35m (1.1ms)[0m  CREATE INDEX "index_settings_on_name" ON "settings" ("name")
  [1m[36m (4.9ms)[0m  [1mCREATE TABLE "taggings" ("id" serial primary key, "tag_id" integer, "taggable_id" integer, "tagger_id" integer, "tagger_type" character varying(255), "taggable_type" character varying(255), "context" character varying(255), "created_at" timestamp) [0m
  [1m[35m (1.1ms)[0m  CREATE INDEX "index_taggings_on_tag_id" ON "taggings" ("tag_id")
  [1m[36m (1.2ms)[0m  [1mCREATE INDEX "index_taggings_on_taggable_id_and_taggable_type_and_context" ON "taggings" ("taggable_id", "taggable_type", "context")[0m
  [1m[35m (5.1ms)[0m  CREATE TABLE "tags" ("id" serial primary key, "name" character varying(255)) 
  [1m[36m (4.5ms)[0m  [1mCREATE TABLE "tasks" ("id" serial primary key, "user_id" integer, "assigned_to" integer, "completed_by" integer, "name" character varying(255) DEFAULT '' NOT NULL, "asset_id" integer, "asset_type" character varying(255), "priority" character varying(32), "category" character varying(32), "bucket" character varying(32), "due_at" timestamp, "completed_at" timestamp, "deleted_at" timestamp, "created_at" timestamp NOT NULL, "updated_at" timestamp NOT NULL, "background_info" character varying(255), "subscribed_users" text) [0m
  [1m[35m (1.5ms)[0m  CREATE INDEX "index_tasks_on_assigned_to" ON "tasks" ("assigned_to")
  [1m[36m (1.1ms)[0m  [1mCREATE UNIQUE INDEX "index_tasks_on_user_id_and_name_and_deleted_at" ON "tasks" ("user_id", "name", "deleted_at")[0m
  [1m[35m (25.5ms)[0m  CREATE TABLE "users" ("id" serial primary key, "username" character varying(32) DEFAULT '' NOT NULL, "email" character varying(64) DEFAULT '' NOT NULL, "first_name" character varying(32), "last_name" character varying(32), "title" character varying(64), "company" character varying(64), "alt_email" character varying(64), "phone" character varying(32), "mobile" character varying(32), "aim" character varying(32), "yahoo" character varying(32), "google" character varying(32), "skype" character varying(32), "password_hash" character varying(255) DEFAULT '' NOT NULL, "password_salt" character varying(255) DEFAULT '' NOT NULL, "persistence_token" character varying(255) DEFAULT '' NOT NULL, "perishable_token" character varying(255) DEFAULT '' NOT NULL, "last_request_at" timestamp, "last_login_at" timestamp, "current_login_at" timestamp, "last_login_ip" character varying(255), "current_login_ip" character varying(255), "login_count" integer DEFAULT 0 NOT NULL, "deleted_at" timestamp, "created_at" timestamp NOT NULL, "updated_at" timestamp NOT NULL, "admin" boolean DEFAULT 'f' NOT NULL, "suspended_at" timestamp, "single_access_token" character varying(255)) 
  [1m[36m (1.0ms)[0m  [1mCREATE INDEX "index_users_on_email" ON "users" ("email")[0m
  [1m[35m (0.9ms)[0m  CREATE INDEX "index_users_on_last_request_at" ON "users" ("last_request_at")
  [1m[36m (1.0ms)[0m  [1mCREATE INDEX "index_users_on_perishable_token" ON "users" ("perishable_token")[0m
  [1m[35m (1.4ms)[0m  CREATE INDEX "index_users_on_remember_token" ON "users" ("persistence_token")
  [1m[36m (6.8ms)[0m  [1mCREATE UNIQUE INDEX "index_users_on_username_and_deleted_at" ON "users" ("username", "deleted_at")[0m
  [1m[35m (5.3ms)[0m  CREATE TABLE "versions" ("id" serial primary key, "item_type" character varying(255) NOT NULL, "item_id" integer NOT NULL, "event" character varying(512) NOT NULL, "whodunnit" character varying(255), "object" text, "created_at" timestamp, "object_changes" text, "related_id" integer, "related_type" character varying(255)) 
  [1m[36m (1.3ms)[0m  [1mCREATE INDEX "index_versions_on_item_type_and_item_id" ON "versions" ("item_type", "item_id")[0m
  [1m[35m (0.9ms)[0m  CREATE INDEX "index_versions_on_whodunnit" ON "versions" ("whodunnit")
  [1m[36m (0.9ms)[0m  [1mCREATE TABLE "schema_migrations" ("version" character varying(255) NOT NULL) [0m
  [1m[35m (1.8ms)[0m  CREATE UNIQUE INDEX "unique_schema_migrations" ON "schema_migrations" ("version")
  [1m[36m (0.3ms)[0m  [1mSELECT version FROM "schema_migrations"[0m
  [1m[35m (0.5ms)[0m  INSERT INTO "schema_migrations" (version) VALUES ('20120528102124')
  [1m[36m (0.1ms)[0m  [1mBEGIN[0m
Started POST "/vend/register_sale" for 127.0.0.1 at 2013-03-06 23:09:56 +1300
Processing by VendController#register_sale as JSON
  Parameters: {"\n    {\n      \"payload\": {\n        \"id\": \"5e8b5134-a002-dd6b-b7c7-26126887c4ee\",\n        \"sale_date\": \"2012-11-13 16:40:06\",\n        \"status\": \"CLOSED\",\n        \"user_id\": \"9b2a8d5f-2d20-11e2-8057-080027706aa2\",\n        \"customer_id\": \"9b17ac9d-2d20-11e2-8057-080027706aa2\",\n        \"register_id\": \"9af85e69-2d20-11e2-8057-080027706aa2\",\n        \"market_id\": \"1\",\n        \"invoice_number\": \"144\",\n        \"short_code\": \"ne2zq\",\n        \"totals\": {\n          \"total_price\": \"4.87\",\n          \"total_tax\": \"0.69\",\n          \"total_payment\": \"5.55\",\n          \"total_to_pay\": \"0\"\n        },\n        \"note\": null,\n        \"updated_at\": \"2012-11-13 16:40:09\",\n        \"created_at\": \"2012-11-13 16:40:09\",\n        \"customer\": {\n          \"id\": \"9b17ac9d-2d20-11e2-8057-080027706aa2\",\n          \"customer_code\": \"WALKIN\",\n          \"balance\": \"-6.250\",\n          \"points\": 0,\n          \"note\": null,\n          \"year_to_date\": \"79945.92188\",\n          \"sex\": \"M\",\n          \"date_of_birth\": \"1950-05-25\",\n          \"updated_at\": \"2012-11-13 16:43:15\",\n          \"created_at\": \"2012-11-13 12:28:03\"\n        },\n        \"user\": {\n          \"id\": \"9b2a8d5f-2d20-11e2-8057-080027706aa2\",\n          \"name\": \"admin\",\n          \"display_name\": \"A admin this time\",\n          \"outlet_id\": \"9ae97219-2d20-11e2-8057-080027706aa2\",\n          \"target_daily\": null,\n          \"target_weekly\": null,\n          \"target_monthly\": null,\n          \"created_at\": \"2011-09-08 05:18:38\",\n          \"updated_at\": \"2011-09-08 05:18:38\"\n        },\n        \"register_sale_products\": "=>{"\n        {\n          \"id\": \"148793f0-475a-7d49-442d-fd761ce76339\",\n          \"product_id\": \"9fe945bc-2d20-11e2-8057-080027706aa2\",\n          \"quantity\": 1,\n          \"price\": \"1.90\",\n          \"price_set\": true,\n          \"tax\": \"0.24\",\n          \"price_total\": \"1.9\",\n          \"tax_total\": \"0.24\",\n          \"tax_id\": \"9a025ff0-2d20-11e2-8057-080027706aa2\",\n          \"tax_name\": \"NZ GST\",\n          \"tax_rate\": \"0.150000\"\n        },\n        {\n          \"id\": \"7d37dc0f-9462-06fa-cae0-0b4988b36539\",\n          \"product_id\": \"a0c0df02-2d20-11e2-8057-080027706aa2\",\n          \"quantity\": 3,\n          \"price\": \"0.99\",\n          \"price_set\": true,\n          \"tax\": \"0.15\",\n          \"price_total\": \"2.97\",\n          \"tax_total\": \"0.45\",\n          \"tax_id\": \"9a025ff0-2d20-11e2-8057-080027706aa2\",\n          \"tax_name\": \"NZ GST\",\n          \"tax_rate\": \"0.150000\"\n        }"=>{",\n        \"register_sale_payments\": "=>{"\n        {\n          \"id\": \"39948e3e-bf93-1b60-ff44-f46a777ed1d4\",\n          \"payment_date\": \"2012-11-13 16:40:06\",\n          \"amount\": \"5.55\",\n          \"retailer_payment_type_id\": \"9e9ba1ba-2d20-11e2-8057-080027706aa2\",\n          \"payment_type_id\": \"1\"\n        }"=>{"\n      }\n    }\n  "=>nil}}}}}
Completed 500 Internal Server Error in 1ms
  [1m[35m (0.3ms)[0m  ROLLBACK
  [1m[36m (0.1ms)[0m  [1mBEGIN[0m
  [1m[35m (1.9ms)[0m  ROLLBACK
Connecting to database specified by database.yml
  [1m[36mFieldGroup Load (0.9ms)[0m  [1mSELECT "field_groups".* FROM "field_groups" WHERE "field_groups"."klass_name" = 'Account' ORDER BY position[0m
  [1m[35mFieldGroup Load (0.3ms)[0m  SELECT "field_groups".* FROM "field_groups" WHERE "field_groups"."klass_name" = 'Campaign' ORDER BY position
  [1m[36mFieldGroup Load (0.3ms)[0m  [1mSELECT "field_groups".* FROM "field_groups" WHERE "field_groups"."klass_name" = 'Contact' ORDER BY position[0m
  [1m[35mFieldGroup Load (0.3ms)[0m  SELECT "field_groups".* FROM "field_groups" WHERE "field_groups"."klass_name" = 'Lead' ORDER BY position
  [1m[36mFieldGroup Load (0.3ms)[0m  [1mSELECT "field_groups".* FROM "field_groups" WHERE "field_groups"."klass_name" = 'Opportunity' ORDER BY position[0m
  [1m[35mFieldGroup Load (0.3ms)[0m  SELECT "field_groups".* FROM "field_groups" WHERE "field_groups"."klass_name" = 'Task' ORDER BY position
Creating scope :except. Overwriting existing method User.except.
  [1m[36m (125.2ms)[0m  [1mDROP DATABASE IF EXISTS "ffcrm_vend_test"[0m
  [1m[35m (242.5ms)[0m  CREATE DATABASE "ffcrm_vend_test" ENCODING = 'utf8'
  [1m[36m (16.1ms)[0m  [1mCREATE TABLE "account_contacts" ("id" serial primary key, "account_id" integer, "contact_id" integer, "deleted_at" timestamp, "created_at" timestamp NOT NULL, "updated_at" timestamp NOT NULL) [0m
  [1m[35m (2.8ms)[0m  CREATE TABLE "account_opportunities" ("id" serial primary key, "account_id" integer, "opportunity_id" integer, "deleted_at" timestamp, "created_at" timestamp NOT NULL, "updated_at" timestamp NOT NULL) 
  [1m[36m (5.4ms)[0m  [1mCREATE TABLE "accounts" ("id" serial primary key, "user_id" integer, "assigned_to" integer, "name" character varying(64) DEFAULT '' NOT NULL, "access" character varying(8) DEFAULT 'Public', "website" character varying(64), "toll_free_phone" character varying(32), "phone" character varying(32), "fax" character varying(32), "deleted_at" timestamp, "created_at" timestamp NOT NULL, "updated_at" timestamp NOT NULL, "email" character varying(64), "background_info" character varying(255), "rating" integer DEFAULT 0 NOT NULL, "category" character varying(32), "subscribed_users" text) [0m
  [1m[35m (1.2ms)[0m  CREATE INDEX "index_accounts_on_assigned_to" ON "accounts" ("assigned_to")
  [1m[36m (1.3ms)[0m  [1mCREATE UNIQUE INDEX "index_accounts_on_user_id_and_name_and_deleted_at" ON "accounts" ("user_id", "name", "deleted_at")[0m
  [1m[35m (15.9ms)[0m  CREATE TABLE "activities" ("id" serial primary key, "user_id" integer, "subject_id" integer, "subject_type" character varying(255), "action" character varying(32) DEFAULT 'created', "info" character varying(255) DEFAULT '', "private" boolean DEFAULT 'f', "created_at" timestamp NOT NULL, "updated_at" timestamp NOT NULL) 
  [1m[36m (1.0ms)[0m  [1mCREATE INDEX "index_activities_on_created_at" ON "activities" ("created_at")[0m
  [1m[35m (0.8ms)[0m  CREATE INDEX "index_activities_on_user_id" ON "activities" ("user_id")
  [1m[36m (16.1ms)[0m  [1mCREATE TABLE "addresses" ("id" serial primary key, "street1" character varying(255), "street2" character varying(255), "city" character varying(64), "state" character varying(64), "zipcode" character varying(16), "country" character varying(64), "full_address" character varying(255), "address_type" character varying(16), "addressable_id" integer, "addressable_type" character varying(255), "created_at" timestamp NOT NULL, "updated_at" timestamp NOT NULL, "deleted_at" timestamp) [0m
  [1m[35m (1.6ms)[0m  CREATE INDEX "index_addresses_on_addressable_id_and_addressable_type" ON "addresses" ("addressable_id", "addressable_type")
  [1m[36m (3.2ms)[0m  [1mCREATE TABLE "avatars" ("id" serial primary key, "user_id" integer, "entity_id" integer, "entity_type" character varying(255), "image_file_size" integer, "image_file_name" character varying(255), "image_content_type" character varying(255), "created_at" timestamp NOT NULL, "updated_at" timestamp NOT NULL) [0m
  [1m[35m (3.9ms)[0m  CREATE TABLE "campaigns" ("id" serial primary key, "user_id" integer, "assigned_to" integer, "name" character varying(64) DEFAULT '' NOT NULL, "access" character varying(8) DEFAULT 'Public', "status" character varying(64), "budget" decimal(12,2), "target_leads" integer, "target_conversion" float, "target_revenue" decimal(12,2), "leads_count" integer, "opportunities_count" integer, "revenue" decimal(12,2), "starts_on" date, "ends_on" date, "objectives" text, "deleted_at" timestamp, "created_at" timestamp NOT NULL, "updated_at" timestamp NOT NULL, "background_info" character varying(255), "subscribed_users" text) 
  [1m[36m (0.8ms)[0m  [1mCREATE INDEX "index_campaigns_on_assigned_to" ON "campaigns" ("assigned_to")[0m
  [1m[35m (3.0ms)[0m  CREATE UNIQUE INDEX "index_campaigns_on_user_id_and_name_and_deleted_at" ON "campaigns" ("user_id", "name", "deleted_at")
  [1m[36m (3.2ms)[0m  [1mCREATE TABLE "comments" ("id" serial primary key, "user_id" integer, "commentable_id" integer, "commentable_type" character varying(255), "private" boolean, "title" character varying(255) DEFAULT '', "comment" text, "created_at" timestamp NOT NULL, "updated_at" timestamp NOT NULL, "state" character varying(16) DEFAULT 'Expanded' NOT NULL) [0m
  [1m[35m (3.6ms)[0m  CREATE TABLE "contact_opportunities" ("id" serial primary key, "contact_id" integer, "opportunity_id" integer, "role" character varying(32), "deleted_at" timestamp, "created_at" timestamp NOT NULL, "updated_at" timestamp NOT NULL) 
  [1m[36m (4.3ms)[0m  [1mCREATE TABLE "contacts" ("id" serial primary key, "user_id" integer, "lead_id" integer, "assigned_to" integer, "reports_to" integer, "first_name" character varying(64) DEFAULT '' NOT NULL, "last_name" character varying(64) DEFAULT '' NOT NULL, "access" character varying(8) DEFAULT 'Public', "title" character varying(64), "department" character varying(64), "source" character varying(32), "email" character varying(64), "alt_email" character varying(64), "phone" character varying(32), "mobile" character varying(32), "fax" character varying(32), "blog" character varying(128), "linkedin" character varying(128), "facebook" character varying(128), "twitter" character varying(128), "born_on" date, "do_not_call" boolean DEFAULT 'f' NOT NULL, "deleted_at" timestamp, "created_at" timestamp NOT NULL, "updated_at" timestamp NOT NULL, "background_info" character varying(255), "skype" character varying(128), "subscribed_users" text) [0m
  [1m[35m (1.0ms)[0m  CREATE INDEX "index_contacts_on_assigned_to" ON "contacts" ("assigned_to")
  [1m[36m (1.1ms)[0m  [1mCREATE UNIQUE INDEX "id_last_name_deleted" ON "contacts" ("user_id", "last_name", "deleted_at")[0m
  [1m[35m (3.6ms)[0m  CREATE TABLE "emails" ("id" serial primary key, "imap_message_id" character varying(255) NOT NULL, "user_id" integer, "mediator_id" integer, "mediator_type" character varying(255), "sent_from" character varying(255) NOT NULL, "sent_to" character varying(255) NOT NULL, "cc" character varying(255), "bcc" character varying(255), "subject" character varying(255), "body" text, "header" text, "sent_at" timestamp, "received_at" timestamp, "deleted_at" timestamp, "created_at" timestamp NOT NULL, "updated_at" timestamp NOT NULL, "state" character varying(16) DEFAULT 'Expanded' NOT NULL) 
  [1m[36m (1.1ms)[0m  [1mCREATE INDEX "index_emails_on_mediator_id_and_mediator_type" ON "emails" ("mediator_id", "mediator_type")[0m
  [1m[35m (2.4ms)[0m  CREATE TABLE "field_groups" ("id" serial primary key, "name" character varying(64), "label" character varying(128), "position" integer, "hint" character varying(255), "created_at" timestamp NOT NULL, "updated_at" timestamp NOT NULL, "tag_id" integer, "klass_name" character varying(32)) 
  [1m[36m (3.1ms)[0m  [1mCREATE TABLE "fields" ("id" serial primary key, "type" character varying(255), "field_group_id" integer, "position" integer, "name" character varying(64), "label" character varying(128), "hint" character varying(255), "placeholder" character varying(255), "as" character varying(32), "collection" text, "disabled" boolean, "required" boolean, "maxlength" integer, "created_at" timestamp NOT NULL, "updated_at" timestamp NOT NULL) [0m
  [1m[35m (1.2ms)[0m  CREATE INDEX "index_fields_on_field_group_id" ON "fields" ("field_group_id")
  [1m[36m (0.9ms)[0m  [1mCREATE INDEX "index_fields_on_name" ON "fields" ("name")[0m
  [1m[35m (5.7ms)[0m  CREATE TABLE "leads" ("id" serial primary key, "user_id" integer, "campaign_id" integer, "assigned_to" integer, "first_name" character varying(64) DEFAULT '' NOT NULL, "last_name" character varying(64) DEFAULT '' NOT NULL, "access" character varying(8) DEFAULT 'Public', "title" character varying(64), "company" character varying(64), "source" character varying(32), "status" character varying(32), "referred_by" character varying(64), "email" character varying(64), "alt_email" character varying(64), "phone" character varying(32), "mobile" character varying(32), "blog" character varying(128), "linkedin" character varying(128), "facebook" character varying(128), "twitter" character varying(128), "rating" integer DEFAULT 0 NOT NULL, "do_not_call" boolean DEFAULT 'f' NOT NULL, "deleted_at" timestamp, "created_at" timestamp NOT NULL, "updated_at" timestamp NOT NULL, "background_info" character varying(255), "skype" character varying(128), "subscribed_users" text) 
  [1m[36m (1.0ms)[0m  [1mCREATE INDEX "index_leads_on_assigned_to" ON "leads" ("assigned_to")[0m
  [1m[35m (1.0ms)[0m  CREATE UNIQUE INDEX "index_leads_on_user_id_and_last_name_and_deleted_at" ON "leads" ("user_id", "last_name", "deleted_at")
  [1m[36m (3.0ms)[0m  [1mCREATE TABLE "lists" ("id" serial primary key, "name" character varying(255), "url" text, "created_at" timestamp NOT NULL, "updated_at" timestamp NOT NULL) [0m
  [1m[35m (3.9ms)[0m  CREATE TABLE "opportunities" ("id" serial primary key, "user_id" integer, "campaign_id" integer, "assigned_to" integer, "name" character varying(64) DEFAULT '' NOT NULL, "access" character varying(8) DEFAULT 'Public', "source" character varying(32), "stage" character varying(32), "probability" integer, "amount" decimal(12,2), "discount" decimal(12,2), "closes_on" date, "deleted_at" timestamp, "created_at" timestamp NOT NULL, "updated_at" timestamp NOT NULL, "background_info" character varying(255), "subscribed_users" text) 
  [1m[36m (0.9ms)[0m  [1mCREATE INDEX "index_opportunities_on_assigned_to" ON "opportunities" ("assigned_to")[0m
  [1m[35m (1.0ms)[0m  CREATE UNIQUE INDEX "id_name_deleted" ON "opportunities" ("user_id", "name", "deleted_at")
  [1m[36m (2.2ms)[0m  [1mCREATE TABLE "permissions" ("id" serial primary key, "user_id" integer, "asset_id" integer, "asset_type" character varying(255), "created_at" timestamp NOT NULL, "updated_at" timestamp NOT NULL) [0m
  [1m[35m (1.0ms)[0m  CREATE INDEX "index_permissions_on_asset_id_and_asset_type" ON "permissions" ("asset_id", "asset_type")
  [1m[36m (0.8ms)[0m  [1mCREATE INDEX "index_permissions_on_user_id" ON "permissions" ("user_id")[0m
  [1m[35m (3.2ms)[0m  CREATE TABLE "preferences" ("id" serial primary key, "user_id" integer, "name" character varying(32) DEFAULT '' NOT NULL, "value" text, "created_at" timestamp NOT NULL, "updated_at" timestamp NOT NULL) 
  [1m[36m (1.2ms)[0m  [1mCREATE INDEX "index_preferences_on_user_id_and_name" ON "preferences" ("user_id", "name")[0m
  [1m[35m (4.3ms)[0m  CREATE TABLE "sessions" ("id" serial primary key, "session_id" character varying(255) NOT NULL, "data" text, "created_at" timestamp NOT NULL, "updated_at" timestamp NOT NULL) 
  [1m[36m (0.8ms)[0m  [1mCREATE INDEX "index_sessions_on_session_id" ON "sessions" ("session_id")[0m
  [1m[35m (0.8ms)[0m  CREATE INDEX "index_sessions_on_updated_at" ON "sessions" ("updated_at")
  [1m[36m (3.1ms)[0m  [1mCREATE TABLE "settings" ("id" serial primary key, "name" character varying(32) DEFAULT '' NOT NULL, "value" text, "created_at" timestamp NOT NULL, "updated_at" timestamp NOT NULL) [0m
  [1m[35m (1.0ms)[0m  CREATE INDEX "index_settings_on_name" ON "settings" ("name")
  [1m[36m (4.5ms)[0m  [1mCREATE TABLE "taggings" ("id" serial primary key, "tag_id" integer, "taggable_id" integer, "tagger_id" integer, "tagger_type" character varying(255), "taggable_type" character varying(255), "context" character varying(255), "created_at" timestamp) [0m
  [1m[35m (1.0ms)[0m  CREATE INDEX "index_taggings_on_tag_id" ON "taggings" ("tag_id")
  [1m[36m (1.0ms)[0m  [1mCREATE INDEX "index_taggings_on_taggable_id_and_taggable_type_and_context" ON "taggings" ("taggable_id", "taggable_type", "context")[0m
  [1m[35m (2.9ms)[0m  CREATE TABLE "tags" ("id" serial primary key, "name" character varying(255)) 
  [1m[36m (3.8ms)[0m  [1mCREATE TABLE "tasks" ("id" serial primary key, "user_id" integer, "assigned_to" integer, "completed_by" integer, "name" character varying(255) DEFAULT '' NOT NULL, "asset_id" integer, "asset_type" character varying(255), "priority" character varying(32), "category" character varying(32), "bucket" character varying(32), "due_at" timestamp, "completed_at" timestamp, "deleted_at" timestamp, "created_at" timestamp NOT NULL, "updated_at" timestamp NOT NULL, "background_info" character varying(255), "subscribed_users" text) [0m
  [1m[35m (1.0ms)[0m  CREATE INDEX "index_tasks_on_assigned_to" ON "tasks" ("assigned_to")
  [1m[36m (1.1ms)[0m  [1mCREATE UNIQUE INDEX "index_tasks_on_user_id_and_name_and_deleted_at" ON "tasks" ("user_id", "name", "deleted_at")[0m
  [1m[35m (4.2ms)[0m  CREATE TABLE "users" ("id" serial primary key, "username" character varying(32) DEFAULT '' NOT NULL, "email" character varying(64) DEFAULT '' NOT NULL, "first_name" character varying(32), "last_name" character varying(32), "title" character varying(64), "company" character varying(64), "alt_email" character varying(64), "phone" character varying(32), "mobile" character varying(32), "aim" character varying(32), "yahoo" character varying(32), "google" character varying(32), "skype" character varying(32), "password_hash" character varying(255) DEFAULT '' NOT NULL, "password_salt" character varying(255) DEFAULT '' NOT NULL, "persistence_token" character varying(255) DEFAULT '' NOT NULL, "perishable_token" character varying(255) DEFAULT '' NOT NULL, "last_request_at" timestamp, "last_login_at" timestamp, "current_login_at" timestamp, "last_login_ip" character varying(255), "current_login_ip" character varying(255), "login_count" integer DEFAULT 0 NOT NULL, "deleted_at" timestamp, "created_at" timestamp NOT NULL, "updated_at" timestamp NOT NULL, "admin" boolean DEFAULT 'f' NOT NULL, "suspended_at" timestamp, "single_access_token" character varying(255)) 
  [1m[36m (0.9ms)[0m  [1mCREATE INDEX "index_users_on_email" ON "users" ("email")[0m
  [1m[35m (1.0ms)[0m  CREATE INDEX "index_users_on_last_request_at" ON "users" ("last_request_at")
  [1m[36m (0.9ms)[0m  [1mCREATE INDEX "index_users_on_perishable_token" ON "users" ("perishable_token")[0m
  [1m[35m (16.3ms)[0m  CREATE INDEX "index_users_on_remember_token" ON "users" ("persistence_token")
  [1m[36m (1.2ms)[0m  [1mCREATE UNIQUE INDEX "index_users_on_username_and_deleted_at" ON "users" ("username", "deleted_at")[0m
  [1m[35m (3.4ms)[0m  CREATE TABLE "versions" ("id" serial primary key, "item_type" character varying(255) NOT NULL, "item_id" integer NOT NULL, "event" character varying(512) NOT NULL, "whodunnit" character varying(255), "object" text, "created_at" timestamp, "object_changes" text, "related_id" integer, "related_type" character varying(255)) 
  [1m[36m (1.1ms)[0m  [1mCREATE INDEX "index_versions_on_item_type_and_item_id" ON "versions" ("item_type", "item_id")[0m
  [1m[35m (1.1ms)[0m  CREATE INDEX "index_versions_on_whodunnit" ON "versions" ("whodunnit")
  [1m[36m (0.7ms)[0m  [1mCREATE TABLE "schema_migrations" ("version" character varying(255) NOT NULL) [0m
  [1m[35m (1.0ms)[0m  CREATE UNIQUE INDEX "unique_schema_migrations" ON "schema_migrations" ("version")
  [1m[36m (0.2ms)[0m  [1mSELECT version FROM "schema_migrations"[0m
  [1m[35m (0.4ms)[0m  INSERT INTO "schema_migrations" (version) VALUES ('20120528102124')
  [1m[36m (0.3ms)[0m  [1mBEGIN[0m
Started POST "/vend/register_sale" for 127.0.0.1 at 2013-03-06 23:14:06 +1300
Processing by VendController#register_sale as JSON
  Parameters: {"\n    {\n      \"payload\": {\n        \"id\": \"5e8b5134-a002-dd6b-b7c7-26126887c4ee\",\n        \"sale_date\": \"2012-11-13 16:40:06\",\n        \"status\": \"CLOSED\",\n        \"user_id\": \"9b2a8d5f-2d20-11e2-8057-080027706aa2\",\n        \"customer_id\": \"9b17ac9d-2d20-11e2-8057-080027706aa2\",\n        \"register_id\": \"9af85e69-2d20-11e2-8057-080027706aa2\",\n        \"market_id\": \"1\",\n        \"invoice_number\": \"144\",\n        \"short_code\": \"ne2zq\",\n        \"totals\": {\n          \"total_price\": \"4.87\",\n          \"total_tax\": \"0.69\",\n          \"total_payment\": \"5.55\",\n          \"total_to_pay\": \"0\"\n        },\n        \"note\": null,\n        \"updated_at\": \"2012-11-13 16:40:09\",\n        \"created_at\": \"2012-11-13 16:40:09\",\n        \"customer\": {\n          \"id\": \"9b17ac9d-2d20-11e2-8057-080027706aa2\",\n          \"customer_code\": \"WALKIN\",\n          \"balance\": \"-6.250\",\n          \"points\": 0,\n          \"note\": null,\n          \"year_to_date\": \"79945.92188\",\n          \"sex\": \"M\",\n          \"date_of_birth\": \"1950-05-25\",\n          \"updated_at\": \"2012-11-13 16:43:15\",\n          \"created_at\": \"2012-11-13 12:28:03\"\n        },\n        \"user\": {\n          \"id\": \"9b2a8d5f-2d20-11e2-8057-080027706aa2\",\n          \"name\": \"admin\",\n          \"display_name\": \"A admin this time\",\n          \"outlet_id\": \"9ae97219-2d20-11e2-8057-080027706aa2\",\n          \"target_daily\": null,\n          \"target_weekly\": null,\n          \"target_monthly\": null,\n          \"created_at\": \"2011-09-08 05:18:38\",\n          \"updated_at\": \"2011-09-08 05:18:38\"\n        },\n        \"register_sale_products\": "=>{"\n        {\n          \"id\": \"148793f0-475a-7d49-442d-fd761ce76339\",\n          \"product_id\": \"9fe945bc-2d20-11e2-8057-080027706aa2\",\n          \"quantity\": 1,\n          \"price\": \"1.90\",\n          \"price_set\": true,\n          \"tax\": \"0.24\",\n          \"price_total\": \"1.9\",\n          \"tax_total\": \"0.24\",\n          \"tax_id\": \"9a025ff0-2d20-11e2-8057-080027706aa2\",\n          \"tax_name\": \"NZ GST\",\n          \"tax_rate\": \"0.150000\"\n        },\n        {\n          \"id\": \"7d37dc0f-9462-06fa-cae0-0b4988b36539\",\n          \"product_id\": \"a0c0df02-2d20-11e2-8057-080027706aa2\",\n          \"quantity\": 3,\n          \"price\": \"0.99\",\n          \"price_set\": true,\n          \"tax\": \"0.15\",\n          \"price_total\": \"2.97\",\n          \"tax_total\": \"0.45\",\n          \"tax_id\": \"9a025ff0-2d20-11e2-8057-080027706aa2\",\n          \"tax_name\": \"NZ GST\",\n          \"tax_rate\": \"0.150000\"\n        }"=>{",\n        \"register_sale_payments\": "=>{"\n        {\n          \"id\": \"39948e3e-bf93-1b60-ff44-f46a777ed1d4\",\n          \"payment_date\": \"2012-11-13 16:40:06\",\n          \"amount\": \"5.55\",\n          \"retailer_payment_type_id\": \"9e9ba1ba-2d20-11e2-8057-080027706aa2\",\n          \"payment_type_id\": \"1\"\n        }"=>{"\n      }\n    }\n  "=>nil}}}}}
Completed 500 Internal Server Error in 1ms
  [1m[35m (0.3ms)[0m  ROLLBACK
  [1m[36m (0.1ms)[0m  [1mBEGIN[0m
  [1m[35m (0.1ms)[0m  ROLLBACK
Connecting to database specified by database.yml
  [1m[36mFieldGroup Load (1.4ms)[0m  [1mSELECT "field_groups".* FROM "field_groups" WHERE "field_groups"."klass_name" = 'Account' ORDER BY position[0m
  [1m[35mFieldGroup Load (0.3ms)[0m  SELECT "field_groups".* FROM "field_groups" WHERE "field_groups"."klass_name" = 'Campaign' ORDER BY position
  [1m[36mFieldGroup Load (0.3ms)[0m  [1mSELECT "field_groups".* FROM "field_groups" WHERE "field_groups"."klass_name" = 'Contact' ORDER BY position[0m
  [1m[35mFieldGroup Load (0.3ms)[0m  SELECT "field_groups".* FROM "field_groups" WHERE "field_groups"."klass_name" = 'Lead' ORDER BY position
  [1m[36mFieldGroup Load (0.3ms)[0m  [1mSELECT "field_groups".* FROM "field_groups" WHERE "field_groups"."klass_name" = 'Opportunity' ORDER BY position[0m
  [1m[35mFieldGroup Load (0.2ms)[0m  SELECT "field_groups".* FROM "field_groups" WHERE "field_groups"."klass_name" = 'Task' ORDER BY position
Creating scope :except. Overwriting existing method User.except.
  [1m[36m (122.5ms)[0m  [1mDROP DATABASE IF EXISTS "ffcrm_vend_test"[0m
  [1m[35m (241.1ms)[0m  CREATE DATABASE "ffcrm_vend_test" ENCODING = 'utf8'
  [1m[36m (20.1ms)[0m  [1mCREATE TABLE "account_contacts" ("id" serial primary key, "account_id" integer, "contact_id" integer, "deleted_at" timestamp, "created_at" timestamp NOT NULL, "updated_at" timestamp NOT NULL) [0m
  [1m[35m (2.3ms)[0m  CREATE TABLE "account_opportunities" ("id" serial primary key, "account_id" integer, "opportunity_id" integer, "deleted_at" timestamp, "created_at" timestamp NOT NULL, "updated_at" timestamp NOT NULL) 
  [1m[36m (4.0ms)[0m  [1mCREATE TABLE "accounts" ("id" serial primary key, "user_id" integer, "assigned_to" integer, "name" character varying(64) DEFAULT '' NOT NULL, "access" character varying(8) DEFAULT 'Public', "website" character varying(64), "toll_free_phone" character varying(32), "phone" character varying(32), "fax" character varying(32), "deleted_at" timestamp, "created_at" timestamp NOT NULL, "updated_at" timestamp NOT NULL, "email" character varying(64), "background_info" character varying(255), "rating" integer DEFAULT 0 NOT NULL, "category" character varying(32), "subscribed_users" text) [0m
  [1m[35m (1.2ms)[0m  CREATE INDEX "index_accounts_on_assigned_to" ON "accounts" ("assigned_to")
  [1m[36m (1.5ms)[0m  [1mCREATE UNIQUE INDEX "index_accounts_on_user_id_and_name_and_deleted_at" ON "accounts" ("user_id", "name", "deleted_at")[0m
  [1m[35m (3.6ms)[0m  CREATE TABLE "activities" ("id" serial primary key, "user_id" integer, "subject_id" integer, "subject_type" character varying(255), "action" character varying(32) DEFAULT 'created', "info" character varying(255) DEFAULT '', "private" boolean DEFAULT 'f', "created_at" timestamp NOT NULL, "updated_at" timestamp NOT NULL) 
  [1m[36m (0.8ms)[0m  [1mCREATE INDEX "index_activities_on_created_at" ON "activities" ("created_at")[0m
  [1m[35m (1.0ms)[0m  CREATE INDEX "index_activities_on_user_id" ON "activities" ("user_id")
  [1m[36m (3.3ms)[0m  [1mCREATE TABLE "addresses" ("id" serial primary key, "street1" character varying(255), "street2" character varying(255), "city" character varying(64), "state" character varying(64), "zipcode" character varying(16), "country" character varying(64), "full_address" character varying(255), "address_type" character varying(16), "addressable_id" integer, "addressable_type" character varying(255), "created_at" timestamp NOT NULL, "updated_at" timestamp NOT NULL, "deleted_at" timestamp) [0m
  [1m[35m (1.1ms)[0m  CREATE INDEX "index_addresses_on_addressable_id_and_addressable_type" ON "addresses" ("addressable_id", "addressable_type")
  [1m[36m (20.9ms)[0m  [1mCREATE TABLE "avatars" ("id" serial primary key, "user_id" integer, "entity_id" integer, "entity_type" character varying(255), "image_file_size" integer, "image_file_name" character varying(255), "image_content_type" character varying(255), "created_at" timestamp NOT NULL, "updated_at" timestamp NOT NULL) [0m
  [1m[35m (12.5ms)[0m  CREATE TABLE "campaigns" ("id" serial primary key, "user_id" integer, "assigned_to" integer, "name" character varying(64) DEFAULT '' NOT NULL, "access" character varying(8) DEFAULT 'Public', "status" character varying(64), "budget" decimal(12,2), "target_leads" integer, "target_conversion" float, "target_revenue" decimal(12,2), "leads_count" integer, "opportunities_count" integer, "revenue" decimal(12,2), "starts_on" date, "ends_on" date, "objectives" text, "deleted_at" timestamp, "created_at" timestamp NOT NULL, "updated_at" timestamp NOT NULL, "background_info" character varying(255), "subscribed_users" text) 
  [1m[36m (1.0ms)[0m  [1mCREATE INDEX "index_campaigns_on_assigned_to" ON "campaigns" ("assigned_to")[0m
  [1m[35m (1.0ms)[0m  CREATE UNIQUE INDEX "index_campaigns_on_user_id_and_name_and_deleted_at" ON "campaigns" ("user_id", "name", "deleted_at")
  [1m[36m (3.4ms)[0m  [1mCREATE TABLE "comments" ("id" serial primary key, "user_id" integer, "commentable_id" integer, "commentable_type" character varying(255), "private" boolean, "title" character varying(255) DEFAULT '', "comment" text, "created_at" timestamp NOT NULL, "updated_at" timestamp NOT NULL, "state" character varying(16) DEFAULT 'Expanded' NOT NULL) [0m
  [1m[35m (2.3ms)[0m  CREATE TABLE "contact_opportunities" ("id" serial primary key, "contact_id" integer, "opportunity_id" integer, "role" character varying(32), "deleted_at" timestamp, "created_at" timestamp NOT NULL, "updated_at" timestamp NOT NULL) 
  [1m[36m (4.0ms)[0m  [1mCREATE TABLE "contacts" ("id" serial primary key, "user_id" integer, "lead_id" integer, "assigned_to" integer, "reports_to" integer, "first_name" character varying(64) DEFAULT '' NOT NULL, "last_name" character varying(64) DEFAULT '' NOT NULL, "access" character varying(8) DEFAULT 'Public', "title" character varying(64), "department" character varying(64), "source" character varying(32), "email" character varying(64), "alt_email" character varying(64), "phone" character varying(32), "mobile" character varying(32), "fax" character varying(32), "blog" character varying(128), "linkedin" character varying(128), "facebook" character varying(128), "twitter" character varying(128), "born_on" date, "do_not_call" boolean DEFAULT 'f' NOT NULL, "deleted_at" timestamp, "created_at" timestamp NOT NULL, "updated_at" timestamp NOT NULL, "background_info" character varying(255), "skype" character varying(128), "subscribed_users" text) [0m
  [1m[35m (0.9ms)[0m  CREATE INDEX "index_contacts_on_assigned_to" ON "contacts" ("assigned_to")
  [1m[36m (1.1ms)[0m  [1mCREATE UNIQUE INDEX "id_last_name_deleted" ON "contacts" ("user_id", "last_name", "deleted_at")[0m
  [1m[35m (3.3ms)[0m  CREATE TABLE "emails" ("id" serial primary key, "imap_message_id" character varying(255) NOT NULL, "user_id" integer, "mediator_id" integer, "mediator_type" character varying(255), "sent_from" character varying(255) NOT NULL, "sent_to" character varying(255) NOT NULL, "cc" character varying(255), "bcc" character varying(255), "subject" character varying(255), "body" text, "header" text, "sent_at" timestamp, "received_at" timestamp, "deleted_at" timestamp, "created_at" timestamp NOT NULL, "updated_at" timestamp NOT NULL, "state" character varying(16) DEFAULT 'Expanded' NOT NULL) 
  [1m[36m (0.9ms)[0m  [1mCREATE INDEX "index_emails_on_mediator_id_and_mediator_type" ON "emails" ("mediator_id", "mediator_type")[0m
  [1m[35m (2.5ms)[0m  CREATE TABLE "field_groups" ("id" serial primary key, "name" character varying(64), "label" character varying(128), "position" integer, "hint" character varying(255), "created_at" timestamp NOT NULL, "updated_at" timestamp NOT NULL, "tag_id" integer, "klass_name" character varying(32)) 
  [1m[36m (3.3ms)[0m  [1mCREATE TABLE "fields" ("id" serial primary key, "type" character varying(255), "field_group_id" integer, "position" integer, "name" character varying(64), "label" character varying(128), "hint" character varying(255), "placeholder" character varying(255), "as" character varying(32), "collection" text, "disabled" boolean, "required" boolean, "maxlength" integer, "created_at" timestamp NOT NULL, "updated_at" timestamp NOT NULL) [0m
  [1m[35m (1.0ms)[0m  CREATE INDEX "index_fields_on_field_group_id" ON "fields" ("field_group_id")
  [1m[36m (1.0ms)[0m  [1mCREATE INDEX "index_fields_on_name" ON "fields" ("name")[0m
  [1m[35m (4.9ms)[0m  CREATE TABLE "leads" ("id" serial primary key, "user_id" integer, "campaign_id" integer, "assigned_to" integer, "first_name" character varying(64) DEFAULT '' NOT NULL, "last_name" character varying(64) DEFAULT '' NOT NULL, "access" character varying(8) DEFAULT 'Public', "title" character varying(64), "company" character varying(64), "source" character varying(32), "status" character varying(32), "referred_by" character varying(64), "email" character varying(64), "alt_email" character varying(64), "phone" character varying(32), "mobile" character varying(32), "blog" character varying(128), "linkedin" character varying(128), "facebook" character varying(128), "twitter" character varying(128), "rating" integer DEFAULT 0 NOT NULL, "do_not_call" boolean DEFAULT 'f' NOT NULL, "deleted_at" timestamp, "created_at" timestamp NOT NULL, "updated_at" timestamp NOT NULL, "background_info" character varying(255), "skype" character varying(128), "subscribed_users" text) 
  [1m[36m (1.0ms)[0m  [1mCREATE INDEX "index_leads_on_assigned_to" ON "leads" ("assigned_to")[0m
  [1m[35m (1.4ms)[0m  CREATE UNIQUE INDEX "index_leads_on_user_id_and_last_name_and_deleted_at" ON "leads" ("user_id", "last_name", "deleted_at")
  [1m[36m (3.0ms)[0m  [1mCREATE TABLE "lists" ("id" serial primary key, "name" character varying(255), "url" text, "created_at" timestamp NOT NULL, "updated_at" timestamp NOT NULL) [0m
  [1m[35m (3.5ms)[0m  CREATE TABLE "opportunities" ("id" serial primary key, "user_id" integer, "campaign_id" integer, "assigned_to" integer, "name" character varying(64) DEFAULT '' NOT NULL, "access" character varying(8) DEFAULT 'Public', "source" character varying(32), "stage" character varying(32), "probability" integer, "amount" decimal(12,2), "discount" decimal(12,2), "closes_on" date, "deleted_at" timestamp, "created_at" timestamp NOT NULL, "updated_at" timestamp NOT NULL, "background_info" character varying(255), "subscribed_users" text) 
  [1m[36m (1.0ms)[0m  [1mCREATE INDEX "index_opportunities_on_assigned_to" ON "opportunities" ("assigned_to")[0m
  [1m[35m (1.1ms)[0m  CREATE UNIQUE INDEX "id_name_deleted" ON "opportunities" ("user_id", "name", "deleted_at")
  [1m[36m (2.3ms)[0m  [1mCREATE TABLE "permissions" ("id" serial primary key, "user_id" integer, "asset_id" integer, "asset_type" character varying(255), "created_at" timestamp NOT NULL, "updated_at" timestamp NOT NULL) [0m
  [1m[35m (1.0ms)[0m  CREATE INDEX "index_permissions_on_asset_id_and_asset_type" ON "permissions" ("asset_id", "asset_type")
  [1m[36m (1.0ms)[0m  [1mCREATE INDEX "index_permissions_on_user_id" ON "permissions" ("user_id")[0m
  [1m[35m (3.7ms)[0m  CREATE TABLE "preferences" ("id" serial primary key, "user_id" integer, "name" character varying(32) DEFAULT '' NOT NULL, "value" text, "created_at" timestamp NOT NULL, "updated_at" timestamp NOT NULL) 
  [1m[36m (1.0ms)[0m  [1mCREATE INDEX "index_preferences_on_user_id_and_name" ON "preferences" ("user_id", "name")[0m
  [1m[35m (3.3ms)[0m  CREATE TABLE "sessions" ("id" serial primary key, "session_id" character varying(255) NOT NULL, "data" text, "created_at" timestamp NOT NULL, "updated_at" timestamp NOT NULL) 
  [1m[36m (0.9ms)[0m  [1mCREATE INDEX "index_sessions_on_session_id" ON "sessions" ("session_id")[0m
  [1m[35m (0.8ms)[0m  CREATE INDEX "index_sessions_on_updated_at" ON "sessions" ("updated_at")
  [1m[36m (3.2ms)[0m  [1mCREATE TABLE "settings" ("id" serial primary key, "name" character varying(32) DEFAULT '' NOT NULL, "value" text, "created_at" timestamp NOT NULL, "updated_at" timestamp NOT NULL) [0m
  [1m[35m (1.0ms)[0m  CREATE INDEX "index_settings_on_name" ON "settings" ("name")
  [1m[36m (3.4ms)[0m  [1mCREATE TABLE "taggings" ("id" serial primary key, "tag_id" integer, "taggable_id" integer, "tagger_id" integer, "tagger_type" character varying(255), "taggable_type" character varying(255), "context" character varying(255), "created_at" timestamp) [0m
  [1m[35m (0.9ms)[0m  CREATE INDEX "index_taggings_on_tag_id" ON "taggings" ("tag_id")
  [1m[36m (1.0ms)[0m  [1mCREATE INDEX "index_taggings_on_taggable_id_and_taggable_type_and_context" ON "taggings" ("taggable_id", "taggable_type", "context")[0m
  [1m[35m (2.1ms)[0m  CREATE TABLE "tags" ("id" serial primary key, "name" character varying(255)) 
  [1m[36m (3.5ms)[0m  [1mCREATE TABLE "tasks" ("id" serial primary key, "user_id" integer, "assigned_to" integer, "completed_by" integer, "name" character varying(255) DEFAULT '' NOT NULL, "asset_id" integer, "asset_type" character varying(255), "priority" character varying(32), "category" character varying(32), "bucket" character varying(32), "due_at" timestamp, "completed_at" timestamp, "deleted_at" timestamp, "created_at" timestamp NOT NULL, "updated_at" timestamp NOT NULL, "background_info" character varying(255), "subscribed_users" text) [0m
  [1m[35m (1.1ms)[0m  CREATE INDEX "index_tasks_on_assigned_to" ON "tasks" ("assigned_to")
  [1m[36m (1.1ms)[0m  [1mCREATE UNIQUE INDEX "index_tasks_on_user_id_and_name_and_deleted_at" ON "tasks" ("user_id", "name", "deleted_at")[0m
  [1m[35m (4.2ms)[0m  CREATE TABLE "users" ("id" serial primary key, "username" character varying(32) DEFAULT '' NOT NULL, "email" character varying(64) DEFAULT '' NOT NULL, "first_name" character varying(32), "last_name" character varying(32), "title" character varying(64), "company" character varying(64), "alt_email" character varying(64), "phone" character varying(32), "mobile" character varying(32), "aim" character varying(32), "yahoo" character varying(32), "google" character varying(32), "skype" character varying(32), "password_hash" character varying(255) DEFAULT '' NOT NULL, "password_salt" character varying(255) DEFAULT '' NOT NULL, "persistence_token" character varying(255) DEFAULT '' NOT NULL, "perishable_token" character varying(255) DEFAULT '' NOT NULL, "last_request_at" timestamp, "last_login_at" timestamp, "current_login_at" timestamp, "last_login_ip" character varying(255), "current_login_ip" character varying(255), "login_count" integer DEFAULT 0 NOT NULL, "deleted_at" timestamp, "created_at" timestamp NOT NULL, "updated_at" timestamp NOT NULL, "admin" boolean DEFAULT 'f' NOT NULL, "suspended_at" timestamp, "single_access_token" character varying(255)) 
  [1m[36m (1.1ms)[0m  [1mCREATE INDEX "index_users_on_email" ON "users" ("email")[0m
  [1m[35m (0.9ms)[0m  CREATE INDEX "index_users_on_last_request_at" ON "users" ("last_request_at")
  [1m[36m (0.9ms)[0m  [1mCREATE INDEX "index_users_on_perishable_token" ON "users" ("perishable_token")[0m
  [1m[35m (1.1ms)[0m  CREATE INDEX "index_users_on_remember_token" ON "users" ("persistence_token")
  [1m[36m (1.0ms)[0m  [1mCREATE UNIQUE INDEX "index_users_on_username_and_deleted_at" ON "users" ("username", "deleted_at")[0m
  [1m[35m (3.4ms)[0m  CREATE TABLE "versions" ("id" serial primary key, "item_type" character varying(255) NOT NULL, "item_id" integer NOT NULL, "event" character varying(512) NOT NULL, "whodunnit" character varying(255), "object" text, "created_at" timestamp, "object_changes" text, "related_id" integer, "related_type" character varying(255)) 
  [1m[36m (0.9ms)[0m  [1mCREATE INDEX "index_versions_on_item_type_and_item_id" ON "versions" ("item_type", "item_id")[0m
  [1m[35m (0.8ms)[0m  CREATE INDEX "index_versions_on_whodunnit" ON "versions" ("whodunnit")
  [1m[36m (0.8ms)[0m  [1mCREATE TABLE "schema_migrations" ("version" character varying(255) NOT NULL) [0m
  [1m[35m (1.0ms)[0m  CREATE UNIQUE INDEX "unique_schema_migrations" ON "schema_migrations" ("version")
  [1m[36m (0.2ms)[0m  [1mSELECT version FROM "schema_migrations"[0m
  [1m[35m (0.4ms)[0m  INSERT INTO "schema_migrations" (version) VALUES ('20120528102124')
  [1m[36m (0.3ms)[0m  [1mBEGIN[0m
Started POST "/vend/register_sale" for 127.0.0.1 at 2013-03-06 23:15:41 +1300
Processing by VendController#register_sale as JSON
  Parameters: {"\n    {\n      \"payload\": {\n        \"id\": \"5e8b5134-a002-dd6b-b7c7-26126887c4ee\",\n        \"sale_date\": \"2012-11-13 16:40:06\",\n        \"status\": \"CLOSED\",\n        \"user_id\": \"9b2a8d5f-2d20-11e2-8057-080027706aa2\",\n        \"customer_id\": \"9b17ac9d-2d20-11e2-8057-080027706aa2\",\n        \"register_id\": \"9af85e69-2d20-11e2-8057-080027706aa2\",\n        \"market_id\": \"1\",\n        \"invoice_number\": \"144\",\n        \"short_code\": \"ne2zq\",\n        \"totals\": {\n          \"total_price\": \"4.87\",\n          \"total_tax\": \"0.69\",\n          \"total_payment\": \"5.55\",\n          \"total_to_pay\": \"0\"\n        },\n        \"note\": null,\n        \"updated_at\": \"2012-11-13 16:40:09\",\n        \"created_at\": \"2012-11-13 16:40:09\",\n        \"customer\": {\n          \"id\": \"9b17ac9d-2d20-11e2-8057-080027706aa2\",\n          \"customer_code\": \"WALKIN\",\n          \"balance\": \"-6.250\",\n          \"points\": 0,\n          \"note\": null,\n          \"year_to_date\": \"79945.92188\",\n          \"sex\": \"M\",\n          \"date_of_birth\": \"1950-05-25\",\n          \"updated_at\": \"2012-11-13 16:43:15\",\n          \"created_at\": \"2012-11-13 12:28:03\"\n        },\n        \"user\": {\n          \"id\": \"9b2a8d5f-2d20-11e2-8057-080027706aa2\",\n          \"name\": \"admin\",\n          \"display_name\": \"A admin this time\",\n          \"outlet_id\": \"9ae97219-2d20-11e2-8057-080027706aa2\",\n          \"target_daily\": null,\n          \"target_weekly\": null,\n          \"target_monthly\": null,\n          \"created_at\": \"2011-09-08 05:18:38\",\n          \"updated_at\": \"2011-09-08 05:18:38\"\n        },\n        \"register_sale_products\": "=>{"\n        {\n          \"id\": \"148793f0-475a-7d49-442d-fd761ce76339\",\n          \"product_id\": \"9fe945bc-2d20-11e2-8057-080027706aa2\",\n          \"quantity\": 1,\n          \"price\": \"1.90\",\n          \"price_set\": true,\n          \"tax\": \"0.24\",\n          \"price_total\": \"1.9\",\n          \"tax_total\": \"0.24\",\n          \"tax_id\": \"9a025ff0-2d20-11e2-8057-080027706aa2\",\n          \"tax_name\": \"NZ GST\",\n          \"tax_rate\": \"0.150000\"\n        },\n        {\n          \"id\": \"7d37dc0f-9462-06fa-cae0-0b4988b36539\",\n          \"product_id\": \"a0c0df02-2d20-11e2-8057-080027706aa2\",\n          \"quantity\": 3,\n          \"price\": \"0.99\",\n          \"price_set\": true,\n          \"tax\": \"0.15\",\n          \"price_total\": \"2.97\",\n          \"tax_total\": \"0.45\",\n          \"tax_id\": \"9a025ff0-2d20-11e2-8057-080027706aa2\",\n          \"tax_name\": \"NZ GST\",\n          \"tax_rate\": \"0.150000\"\n        }"=>{",\n        \"register_sale_payments\": "=>{"\n        {\n          \"id\": \"39948e3e-bf93-1b60-ff44-f46a777ed1d4\",\n          \"payment_date\": \"2012-11-13 16:40:06\",\n          \"amount\": \"5.55\",\n          \"retailer_payment_type_id\": \"9e9ba1ba-2d20-11e2-8057-080027706aa2\",\n          \"payment_type_id\": \"1\"\n        }"=>{"\n      }\n    }\n  "=>nil}}}}}
Completed 500 Internal Server Error in 50481ms
  [1m[35m (0.3ms)[0m  ROLLBACK
Connecting to database specified by database.yml
  [1m[36mFieldGroup Load (0.9ms)[0m  [1mSELECT "field_groups".* FROM "field_groups" WHERE "field_groups"."klass_name" = 'Account' ORDER BY position[0m
  [1m[35mFieldGroup Load (0.3ms)[0m  SELECT "field_groups".* FROM "field_groups" WHERE "field_groups"."klass_name" = 'Campaign' ORDER BY position
  [1m[36mFieldGroup Load (0.4ms)[0m  [1mSELECT "field_groups".* FROM "field_groups" WHERE "field_groups"."klass_name" = 'Contact' ORDER BY position[0m
  [1m[35mFieldGroup Load (0.3ms)[0m  SELECT "field_groups".* FROM "field_groups" WHERE "field_groups"."klass_name" = 'Lead' ORDER BY position
  [1m[36mFieldGroup Load (0.3ms)[0m  [1mSELECT "field_groups".* FROM "field_groups" WHERE "field_groups"."klass_name" = 'Opportunity' ORDER BY position[0m
  [1m[35mFieldGroup Load (0.3ms)[0m  SELECT "field_groups".* FROM "field_groups" WHERE "field_groups"."klass_name" = 'Task' ORDER BY position
Creating scope :except. Overwriting existing method User.except.
  [1m[36m (121.1ms)[0m  [1mDROP DATABASE IF EXISTS "ffcrm_vend_test"[0m
  [1m[35m (243.4ms)[0m  CREATE DATABASE "ffcrm_vend_test" ENCODING = 'utf8'
  [1m[36m (5.5ms)[0m  [1mCREATE TABLE "account_contacts" ("id" serial primary key, "account_id" integer, "contact_id" integer, "deleted_at" timestamp, "created_at" timestamp NOT NULL, "updated_at" timestamp NOT NULL) [0m
  [1m[35m (2.3ms)[0m  CREATE TABLE "account_opportunities" ("id" serial primary key, "account_id" integer, "opportunity_id" integer, "deleted_at" timestamp, "created_at" timestamp NOT NULL, "updated_at" timestamp NOT NULL) 
  [1m[36m (3.8ms)[0m  [1mCREATE TABLE "accounts" ("id" serial primary key, "user_id" integer, "assigned_to" integer, "name" character varying(64) DEFAULT '' NOT NULL, "access" character varying(8) DEFAULT 'Public', "website" character varying(64), "toll_free_phone" character varying(32), "phone" character varying(32), "fax" character varying(32), "deleted_at" timestamp, "created_at" timestamp NOT NULL, "updated_at" timestamp NOT NULL, "email" character varying(64), "background_info" character varying(255), "rating" integer DEFAULT 0 NOT NULL, "category" character varying(32), "subscribed_users" text) [0m
  [1m[35m (0.9ms)[0m  CREATE INDEX "index_accounts_on_assigned_to" ON "accounts" ("assigned_to")
  [1m[36m (1.3ms)[0m  [1mCREATE UNIQUE INDEX "index_accounts_on_user_id_and_name_and_deleted_at" ON "accounts" ("user_id", "name", "deleted_at")[0m
  [1m[35m (3.4ms)[0m  CREATE TABLE "activities" ("id" serial primary key, "user_id" integer, "subject_id" integer, "subject_type" character varying(255), "action" character varying(32) DEFAULT 'created', "info" character varying(255) DEFAULT '', "private" boolean DEFAULT 'f', "created_at" timestamp NOT NULL, "updated_at" timestamp NOT NULL) 
  [1m[36m (1.2ms)[0m  [1mCREATE INDEX "index_activities_on_created_at" ON "activities" ("created_at")[0m
  [1m[35m (1.1ms)[0m  CREATE INDEX "index_activities_on_user_id" ON "activities" ("user_id")
  [1m[36m (3.1ms)[0m  [1mCREATE TABLE "addresses" ("id" serial primary key, "street1" character varying(255), "street2" character varying(255), "city" character varying(64), "state" character varying(64), "zipcode" character varying(16), "country" character varying(64), "full_address" character varying(255), "address_type" character varying(16), "addressable_id" integer, "addressable_type" character varying(255), "created_at" timestamp NOT NULL, "updated_at" timestamp NOT NULL, "deleted_at" timestamp) [0m
  [1m[35m (0.9ms)[0m  CREATE INDEX "index_addresses_on_addressable_id_and_addressable_type" ON "addresses" ("addressable_id", "addressable_type")
  [1m[36m (3.1ms)[0m  [1mCREATE TABLE "avatars" ("id" serial primary key, "user_id" integer, "entity_id" integer, "entity_type" character varying(255), "image_file_size" integer, "image_file_name" character varying(255), "image_content_type" character varying(255), "created_at" timestamp NOT NULL, "updated_at" timestamp NOT NULL) [0m
  [1m[35m (3.4ms)[0m  CREATE TABLE "campaigns" ("id" serial primary key, "user_id" integer, "assigned_to" integer, "name" character varying(64) DEFAULT '' NOT NULL, "access" character varying(8) DEFAULT 'Public', "status" character varying(64), "budget" decimal(12,2), "target_leads" integer, "target_conversion" float, "target_revenue" decimal(12,2), "leads_count" integer, "opportunities_count" integer, "revenue" decimal(12,2), "starts_on" date, "ends_on" date, "objectives" text, "deleted_at" timestamp, "created_at" timestamp NOT NULL, "updated_at" timestamp NOT NULL, "background_info" character varying(255), "subscribed_users" text) 
  [1m[36m (1.0ms)[0m  [1mCREATE INDEX "index_campaigns_on_assigned_to" ON "campaigns" ("assigned_to")[0m
  [1m[35m (1.0ms)[0m  CREATE UNIQUE INDEX "index_campaigns_on_user_id_and_name_and_deleted_at" ON "campaigns" ("user_id", "name", "deleted_at")
  [1m[36m (3.5ms)[0m  [1mCREATE TABLE "comments" ("id" serial primary key, "user_id" integer, "commentable_id" integer, "commentable_type" character varying(255), "private" boolean, "title" character varying(255) DEFAULT '', "comment" text, "created_at" timestamp NOT NULL, "updated_at" timestamp NOT NULL, "state" character varying(16) DEFAULT 'Expanded' NOT NULL) [0m
  [1m[35m (2.8ms)[0m  CREATE TABLE "contact_opportunities" ("id" serial primary key, "contact_id" integer, "opportunity_id" integer, "role" character varying(32), "deleted_at" timestamp, "created_at" timestamp NOT NULL, "updated_at" timestamp NOT NULL) 
  [1m[36m (4.1ms)[0m  [1mCREATE TABLE "contacts" ("id" serial primary key, "user_id" integer, "lead_id" integer, "assigned_to" integer, "reports_to" integer, "first_name" character varying(64) DEFAULT '' NOT NULL, "last_name" character varying(64) DEFAULT '' NOT NULL, "access" character varying(8) DEFAULT 'Public', "title" character varying(64), "department" character varying(64), "source" character varying(32), "email" character varying(64), "alt_email" character varying(64), "phone" character varying(32), "mobile" character varying(32), "fax" character varying(32), "blog" character varying(128), "linkedin" character varying(128), "facebook" character varying(128), "twitter" character varying(128), "born_on" date, "do_not_call" boolean DEFAULT 'f' NOT NULL, "deleted_at" timestamp, "created_at" timestamp NOT NULL, "updated_at" timestamp NOT NULL, "background_info" character varying(255), "skype" character varying(128), "subscribed_users" text) [0m
  [1m[35m (0.9ms)[0m  CREATE INDEX "index_contacts_on_assigned_to" ON "contacts" ("assigned_to")
  [1m[36m (1.2ms)[0m  [1mCREATE UNIQUE INDEX "id_last_name_deleted" ON "contacts" ("user_id", "last_name", "deleted_at")[0m
  [1m[35m (3.1ms)[0m  CREATE TABLE "emails" ("id" serial primary key, "imap_message_id" character varying(255) NOT NULL, "user_id" integer, "mediator_id" integer, "mediator_type" character varying(255), "sent_from" character varying(255) NOT NULL, "sent_to" character varying(255) NOT NULL, "cc" character varying(255), "bcc" character varying(255), "subject" character varying(255), "body" text, "header" text, "sent_at" timestamp, "received_at" timestamp, "deleted_at" timestamp, "created_at" timestamp NOT NULL, "updated_at" timestamp NOT NULL, "state" character varying(16) DEFAULT 'Expanded' NOT NULL) 
  [1m[36m (1.0ms)[0m  [1mCREATE INDEX "index_emails_on_mediator_id_and_mediator_type" ON "emails" ("mediator_id", "mediator_type")[0m
  [1m[35m (2.3ms)[0m  CREATE TABLE "field_groups" ("id" serial primary key, "name" character varying(64), "label" character varying(128), "position" integer, "hint" character varying(255), "created_at" timestamp NOT NULL, "updated_at" timestamp NOT NULL, "tag_id" integer, "klass_name" character varying(32)) 
  [1m[36m (3.1ms)[0m  [1mCREATE TABLE "fields" ("id" serial primary key, "type" character varying(255), "field_group_id" integer, "position" integer, "name" character varying(64), "label" character varying(128), "hint" character varying(255), "placeholder" character varying(255), "as" character varying(32), "collection" text, "disabled" boolean, "required" boolean, "maxlength" integer, "created_at" timestamp NOT NULL, "updated_at" timestamp NOT NULL) [0m
  [1m[35m (1.1ms)[0m  CREATE INDEX "index_fields_on_field_group_id" ON "fields" ("field_group_id")
  [1m[36m (0.8ms)[0m  [1mCREATE INDEX "index_fields_on_name" ON "fields" ("name")[0m
  [1m[35m (4.5ms)[0m  CREATE TABLE "leads" ("id" serial primary key, "user_id" integer, "campaign_id" integer, "assigned_to" integer, "first_name" character varying(64) DEFAULT '' NOT NULL, "last_name" character varying(64) DEFAULT '' NOT NULL, "access" character varying(8) DEFAULT 'Public', "title" character varying(64), "company" character varying(64), "source" character varying(32), "status" character varying(32), "referred_by" character varying(64), "email" character varying(64), "alt_email" character varying(64), "phone" character varying(32), "mobile" character varying(32), "blog" character varying(128), "linkedin" character varying(128), "facebook" character varying(128), "twitter" character varying(128), "rating" integer DEFAULT 0 NOT NULL, "do_not_call" boolean DEFAULT 'f' NOT NULL, "deleted_at" timestamp, "created_at" timestamp NOT NULL, "updated_at" timestamp NOT NULL, "background_info" character varying(255), "skype" character varying(128), "subscribed_users" text) 
  [1m[36m (0.9ms)[0m  [1mCREATE INDEX "index_leads_on_assigned_to" ON "leads" ("assigned_to")[0m
  [1m[35m (1.2ms)[0m  CREATE UNIQUE INDEX "index_leads_on_user_id_and_last_name_and_deleted_at" ON "leads" ("user_id", "last_name", "deleted_at")
  [1m[36m (3.5ms)[0m  [1mCREATE TABLE "lists" ("id" serial primary key, "name" character varying(255), "url" text, "created_at" timestamp NOT NULL, "updated_at" timestamp NOT NULL) [0m
  [1m[35m (3.5ms)[0m  CREATE TABLE "opportunities" ("id" serial primary key, "user_id" integer, "campaign_id" integer, "assigned_to" integer, "name" character varying(64) DEFAULT '' NOT NULL, "access" character varying(8) DEFAULT 'Public', "source" character varying(32), "stage" character varying(32), "probability" integer, "amount" decimal(12,2), "discount" decimal(12,2), "closes_on" date, "deleted_at" timestamp, "created_at" timestamp NOT NULL, "updated_at" timestamp NOT NULL, "background_info" character varying(255), "subscribed_users" text) 
  [1m[36m (1.0ms)[0m  [1mCREATE INDEX "index_opportunities_on_assigned_to" ON "opportunities" ("assigned_to")[0m
  [1m[35m (1.1ms)[0m  CREATE UNIQUE INDEX "id_name_deleted" ON "opportunities" ("user_id", "name", "deleted_at")
  [1m[36m (2.3ms)[0m  [1mCREATE TABLE "permissions" ("id" serial primary key, "user_id" integer, "asset_id" integer, "asset_type" character varying(255), "created_at" timestamp NOT NULL, "updated_at" timestamp NOT NULL) [0m
  [1m[35m (1.0ms)[0m  CREATE INDEX "index_permissions_on_asset_id_and_asset_type" ON "permissions" ("asset_id", "asset_type")
  [1m[36m (12.3ms)[0m  [1mCREATE INDEX "index_permissions_on_user_id" ON "permissions" ("user_id")[0m
  [1m[35m (4.7ms)[0m  CREATE TABLE "preferences" ("id" serial primary key, "user_id" integer, "name" character varying(32) DEFAULT '' NOT NULL, "value" text, "created_at" timestamp NOT NULL, "updated_at" timestamp NOT NULL) 
  [1m[36m (1.0ms)[0m  [1mCREATE INDEX "index_preferences_on_user_id_and_name" ON "preferences" ("user_id", "name")[0m
  [1m[35m (3.0ms)[0m  CREATE TABLE "sessions" ("id" serial primary key, "session_id" character varying(255) NOT NULL, "data" text, "created_at" timestamp NOT NULL, "updated_at" timestamp NOT NULL) 
  [1m[36m (1.0ms)[0m  [1mCREATE INDEX "index_sessions_on_session_id" ON "sessions" ("session_id")[0m
  [1m[35m (0.9ms)[0m  CREATE INDEX "index_sessions_on_updated_at" ON "sessions" ("updated_at")
  [1m[36m (3.3ms)[0m  [1mCREATE TABLE "settings" ("id" serial primary key, "name" character varying(32) DEFAULT '' NOT NULL, "value" text, "created_at" timestamp NOT NULL, "updated_at" timestamp NOT NULL) [0m
  [1m[35m (8.9ms)[0m  CREATE INDEX "index_settings_on_name" ON "settings" ("name")
  [1m[36m (3.6ms)[0m  [1mCREATE TABLE "taggings" ("id" serial primary key, "tag_id" integer, "taggable_id" integer, "tagger_id" integer, "tagger_type" character varying(255), "taggable_type" character varying(255), "context" character varying(255), "created_at" timestamp) [0m
  [1m[35m (1.0ms)[0m  CREATE INDEX "index_taggings_on_tag_id" ON "taggings" ("tag_id")
  [1m[36m (1.1ms)[0m  [1mCREATE INDEX "index_taggings_on_taggable_id_and_taggable_type_and_context" ON "taggings" ("taggable_id", "taggable_type", "context")[0m
  [1m[35m (2.0ms)[0m  CREATE TABLE "tags" ("id" serial primary key, "name" character varying(255)) 
  [1m[36m (3.6ms)[0m  [1mCREATE TABLE "tasks" ("id" serial primary key, "user_id" integer, "assigned_to" integer, "completed_by" integer, "name" character varying(255) DEFAULT '' NOT NULL, "asset_id" integer, "asset_type" character varying(255), "priority" character varying(32), "category" character varying(32), "bucket" character varying(32), "due_at" timestamp, "completed_at" timestamp, "deleted_at" timestamp, "created_at" timestamp NOT NULL, "updated_at" timestamp NOT NULL, "background_info" character varying(255), "subscribed_users" text) [0m
  [1m[35m (0.9ms)[0m  CREATE INDEX "index_tasks_on_assigned_to" ON "tasks" ("assigned_to")
  [1m[36m (1.1ms)[0m  [1mCREATE UNIQUE INDEX "index_tasks_on_user_id_and_name_and_deleted_at" ON "tasks" ("user_id", "name", "deleted_at")[0m
  [1m[35m (3.9ms)[0m  CREATE TABLE "users" ("id" serial primary key, "username" character varying(32) DEFAULT '' NOT NULL, "email" character varying(64) DEFAULT '' NOT NULL, "first_name" character varying(32), "last_name" character varying(32), "title" character varying(64), "company" character varying(64), "alt_email" character varying(64), "phone" character varying(32), "mobile" character varying(32), "aim" character varying(32), "yahoo" character varying(32), "google" character varying(32), "skype" character varying(32), "password_hash" character varying(255) DEFAULT '' NOT NULL, "password_salt" character varying(255) DEFAULT '' NOT NULL, "persistence_token" character varying(255) DEFAULT '' NOT NULL, "perishable_token" character varying(255) DEFAULT '' NOT NULL, "last_request_at" timestamp, "last_login_at" timestamp, "current_login_at" timestamp, "last_login_ip" character varying(255), "current_login_ip" character varying(255), "login_count" integer DEFAULT 0 NOT NULL, "deleted_at" timestamp, "created_at" timestamp NOT NULL, "updated_at" timestamp NOT NULL, "admin" boolean DEFAULT 'f' NOT NULL, "suspended_at" timestamp, "single_access_token" character varying(255)) 
  [1m[36m (1.2ms)[0m  [1mCREATE INDEX "index_users_on_email" ON "users" ("email")[0m
  [1m[35m (0.8ms)[0m  CREATE INDEX "index_users_on_last_request_at" ON "users" ("last_request_at")
  [1m[36m (1.1ms)[0m  [1mCREATE INDEX "index_users_on_perishable_token" ON "users" ("perishable_token")[0m
  [1m[35m (1.2ms)[0m  CREATE INDEX "index_users_on_remember_token" ON "users" ("persistence_token")
  [1m[36m (1.2ms)[0m  [1mCREATE UNIQUE INDEX "index_users_on_username_and_deleted_at" ON "users" ("username", "deleted_at")[0m
  [1m[35m (3.2ms)[0m  CREATE TABLE "versions" ("id" serial primary key, "item_type" character varying(255) NOT NULL, "item_id" integer NOT NULL, "event" character varying(512) NOT NULL, "whodunnit" character varying(255), "object" text, "created_at" timestamp, "object_changes" text, "related_id" integer, "related_type" character varying(255)) 
  [1m[36m (1.0ms)[0m  [1mCREATE INDEX "index_versions_on_item_type_and_item_id" ON "versions" ("item_type", "item_id")[0m
  [1m[35m (0.9ms)[0m  CREATE INDEX "index_versions_on_whodunnit" ON "versions" ("whodunnit")
  [1m[36m (0.7ms)[0m  [1mCREATE TABLE "schema_migrations" ("version" character varying(255) NOT NULL) [0m
  [1m[35m (0.8ms)[0m  CREATE UNIQUE INDEX "unique_schema_migrations" ON "schema_migrations" ("version")
  [1m[36m (0.2ms)[0m  [1mSELECT version FROM "schema_migrations"[0m
  [1m[35m (0.4ms)[0m  INSERT INTO "schema_migrations" (version) VALUES ('20120528102124')
  [1m[36m (0.2ms)[0m  [1mBEGIN[0m
Started POST "/vend/register_sale" for 127.0.0.1 at 2013-03-06 23:16:40 +1300
Processing by VendController#register_sale as JSON
  Parameters: {"\n    {\n      \"payload\": {\n        \"id\": \"5e8b5134-a002-dd6b-b7c7-26126887c4ee\",\n        \"sale_date\": \"2012-11-13 16:40:06\",\n        \"status\": \"CLOSED\",\n        \"user_id\": \"9b2a8d5f-2d20-11e2-8057-080027706aa2\",\n        \"customer_id\": \"9b17ac9d-2d20-11e2-8057-080027706aa2\",\n        \"register_id\": \"9af85e69-2d20-11e2-8057-080027706aa2\",\n        \"market_id\": \"1\",\n        \"invoice_number\": \"144\",\n        \"short_code\": \"ne2zq\",\n        \"totals\": {\n          \"total_price\": \"4.87\",\n          \"total_tax\": \"0.69\",\n          \"total_payment\": \"5.55\",\n          \"total_to_pay\": \"0\"\n        },\n        \"note\": null,\n        \"updated_at\": \"2012-11-13 16:40:09\",\n        \"created_at\": \"2012-11-13 16:40:09\",\n        \"customer\": {\n          \"id\": \"9b17ac9d-2d20-11e2-8057-080027706aa2\",\n          \"customer_code\": \"WALKIN\",\n          \"balance\": \"-6.250\",\n          \"points\": 0,\n          \"note\": null,\n          \"year_to_date\": \"79945.92188\",\n          \"sex\": \"M\",\n          \"date_of_birth\": \"1950-05-25\",\n          \"updated_at\": \"2012-11-13 16:43:15\",\n          \"created_at\": \"2012-11-13 12:28:03\"\n        },\n        \"user\": {\n          \"id\": \"9b2a8d5f-2d20-11e2-8057-080027706aa2\",\n          \"name\": \"admin\",\n          \"display_name\": \"A admin this time\",\n          \"outlet_id\": \"9ae97219-2d20-11e2-8057-080027706aa2\",\n          \"target_daily\": null,\n          \"target_weekly\": null,\n          \"target_monthly\": null,\n          \"created_at\": \"2011-09-08 05:18:38\",\n          \"updated_at\": \"2011-09-08 05:18:38\"\n        },\n        \"register_sale_products\": "=>{"\n        {\n          \"id\": \"148793f0-475a-7d49-442d-fd761ce76339\",\n          \"product_id\": \"9fe945bc-2d20-11e2-8057-080027706aa2\",\n          \"quantity\": 1,\n          \"price\": \"1.90\",\n          \"price_set\": true,\n          \"tax\": \"0.24\",\n          \"price_total\": \"1.9\",\n          \"tax_total\": \"0.24\",\n          \"tax_id\": \"9a025ff0-2d20-11e2-8057-080027706aa2\",\n          \"tax_name\": \"NZ GST\",\n          \"tax_rate\": \"0.150000\"\n        },\n        {\n          \"id\": \"7d37dc0f-9462-06fa-cae0-0b4988b36539\",\n          \"product_id\": \"a0c0df02-2d20-11e2-8057-080027706aa2\",\n          \"quantity\": 3,\n          \"price\": \"0.99\",\n          \"price_set\": true,\n          \"tax\": \"0.15\",\n          \"price_total\": \"2.97\",\n          \"tax_total\": \"0.45\",\n          \"tax_id\": \"9a025ff0-2d20-11e2-8057-080027706aa2\",\n          \"tax_name\": \"NZ GST\",\n          \"tax_rate\": \"0.150000\"\n        }"=>{",\n        \"register_sale_payments\": "=>{"\n        {\n          \"id\": \"39948e3e-bf93-1b60-ff44-f46a777ed1d4\",\n          \"payment_date\": \"2012-11-13 16:40:06\",\n          \"amount\": \"5.55\",\n          \"retailer_payment_type_id\": \"9e9ba1ba-2d20-11e2-8057-080027706aa2\",\n          \"payment_type_id\": \"1\"\n        }"=>{"\n      }\n    }\n  "=>nil}}}}}
Connecting to database specified by database.yml
  [1m[36mFieldGroup Load (0.8ms)[0m  [1mSELECT "field_groups".* FROM "field_groups" WHERE "field_groups"."klass_name" = 'Account' ORDER BY position[0m
  [1m[35mFieldGroup Load (0.3ms)[0m  SELECT "field_groups".* FROM "field_groups" WHERE "field_groups"."klass_name" = 'Campaign' ORDER BY position
  [1m[36mFieldGroup Load (0.4ms)[0m  [1mSELECT "field_groups".* FROM "field_groups" WHERE "field_groups"."klass_name" = 'Contact' ORDER BY position[0m
  [1m[35mFieldGroup Load (0.3ms)[0m  SELECT "field_groups".* FROM "field_groups" WHERE "field_groups"."klass_name" = 'Lead' ORDER BY position
  [1m[36mFieldGroup Load (0.3ms)[0m  [1mSELECT "field_groups".* FROM "field_groups" WHERE "field_groups"."klass_name" = 'Opportunity' ORDER BY position[0m
  [1m[35mFieldGroup Load (0.3ms)[0m  SELECT "field_groups".* FROM "field_groups" WHERE "field_groups"."klass_name" = 'Task' ORDER BY position
Creating scope :except. Overwriting existing method User.except.
  [1m[36m (124.6ms)[0m  [1mDROP DATABASE IF EXISTS "ffcrm_vend_test"[0m
  [1m[35m (246.0ms)[0m  CREATE DATABASE "ffcrm_vend_test" ENCODING = 'utf8'
  [1m[36m (5.8ms)[0m  [1mCREATE TABLE "account_contacts" ("id" serial primary key, "account_id" integer, "contact_id" integer, "deleted_at" timestamp, "created_at" timestamp NOT NULL, "updated_at" timestamp NOT NULL) [0m
  [1m[35m (2.2ms)[0m  CREATE TABLE "account_opportunities" ("id" serial primary key, "account_id" integer, "opportunity_id" integer, "deleted_at" timestamp, "created_at" timestamp NOT NULL, "updated_at" timestamp NOT NULL) 
  [1m[36m (4.3ms)[0m  [1mCREATE TABLE "accounts" ("id" serial primary key, "user_id" integer, "assigned_to" integer, "name" character varying(64) DEFAULT '' NOT NULL, "access" character varying(8) DEFAULT 'Public', "website" character varying(64), "toll_free_phone" character varying(32), "phone" character varying(32), "fax" character varying(32), "deleted_at" timestamp, "created_at" timestamp NOT NULL, "updated_at" timestamp NOT NULL, "email" character varying(64), "background_info" character varying(255), "rating" integer DEFAULT 0 NOT NULL, "category" character varying(32), "subscribed_users" text) [0m
  [1m[35m (1.2ms)[0m  CREATE INDEX "index_accounts_on_assigned_to" ON "accounts" ("assigned_to")
  [1m[36m (1.3ms)[0m  [1mCREATE UNIQUE INDEX "index_accounts_on_user_id_and_name_and_deleted_at" ON "accounts" ("user_id", "name", "deleted_at")[0m
  [1m[35m (3.8ms)[0m  CREATE TABLE "activities" ("id" serial primary key, "user_id" integer, "subject_id" integer, "subject_type" character varying(255), "action" character varying(32) DEFAULT 'created', "info" character varying(255) DEFAULT '', "private" boolean DEFAULT 'f', "created_at" timestamp NOT NULL, "updated_at" timestamp NOT NULL) 
  [1m[36m (0.9ms)[0m  [1mCREATE INDEX "index_activities_on_created_at" ON "activities" ("created_at")[0m
  [1m[35m (0.9ms)[0m  CREATE INDEX "index_activities_on_user_id" ON "activities" ("user_id")
  [1m[36m (3.5ms)[0m  [1mCREATE TABLE "addresses" ("id" serial primary key, "street1" character varying(255), "street2" character varying(255), "city" character varying(64), "state" character varying(64), "zipcode" character varying(16), "country" character varying(64), "full_address" character varying(255), "address_type" character varying(16), "addressable_id" integer, "addressable_type" character varying(255), "created_at" timestamp NOT NULL, "updated_at" timestamp NOT NULL, "deleted_at" timestamp) [0m
  [1m[35m (0.9ms)[0m  CREATE INDEX "index_addresses_on_addressable_id_and_addressable_type" ON "addresses" ("addressable_id", "addressable_type")
  [1m[36m (3.2ms)[0m  [1mCREATE TABLE "avatars" ("id" serial primary key, "user_id" integer, "entity_id" integer, "entity_type" character varying(255), "image_file_size" integer, "image_file_name" character varying(255), "image_content_type" character varying(255), "created_at" timestamp NOT NULL, "updated_at" timestamp NOT NULL) [0m
  [1m[35m (4.2ms)[0m  CREATE TABLE "campaigns" ("id" serial primary key, "user_id" integer, "assigned_to" integer, "name" character varying(64) DEFAULT '' NOT NULL, "access" character varying(8) DEFAULT 'Public', "status" character varying(64), "budget" decimal(12,2), "target_leads" integer, "target_conversion" float, "target_revenue" decimal(12,2), "leads_count" integer, "opportunities_count" integer, "revenue" decimal(12,2), "starts_on" date, "ends_on" date, "objectives" text, "deleted_at" timestamp, "created_at" timestamp NOT NULL, "updated_at" timestamp NOT NULL, "background_info" character varying(255), "subscribed_users" text) 
  [1m[36m (1.0ms)[0m  [1mCREATE INDEX "index_campaigns_on_assigned_to" ON "campaigns" ("assigned_to")[0m
  [1m[35m (1.1ms)[0m  CREATE UNIQUE INDEX "index_campaigns_on_user_id_and_name_and_deleted_at" ON "campaigns" ("user_id", "name", "deleted_at")
  [1m[36m (3.8ms)[0m  [1mCREATE TABLE "comments" ("id" serial primary key, "user_id" integer, "commentable_id" integer, "commentable_type" character varying(255), "private" boolean, "title" character varying(255) DEFAULT '', "comment" text, "created_at" timestamp NOT NULL, "updated_at" timestamp NOT NULL, "state" character varying(16) DEFAULT 'Expanded' NOT NULL) [0m
  [1m[35m (2.3ms)[0m  CREATE TABLE "contact_opportunities" ("id" serial primary key, "contact_id" integer, "opportunity_id" integer, "role" character varying(32), "deleted_at" timestamp, "created_at" timestamp NOT NULL, "updated_at" timestamp NOT NULL) 
  [1m[36m (4.0ms)[0m  [1mCREATE TABLE "contacts" ("id" serial primary key, "user_id" integer, "lead_id" integer, "assigned_to" integer, "reports_to" integer, "first_name" character varying(64) DEFAULT '' NOT NULL, "last_name" character varying(64) DEFAULT '' NOT NULL, "access" character varying(8) DEFAULT 'Public', "title" character varying(64), "department" character varying(64), "source" character varying(32), "email" character varying(64), "alt_email" character varying(64), "phone" character varying(32), "mobile" character varying(32), "fax" character varying(32), "blog" character varying(128), "linkedin" character varying(128), "facebook" character varying(128), "twitter" character varying(128), "born_on" date, "do_not_call" boolean DEFAULT 'f' NOT NULL, "deleted_at" timestamp, "created_at" timestamp NOT NULL, "updated_at" timestamp NOT NULL, "background_info" character varying(255), "skype" character varying(128), "subscribed_users" text) [0m
  [1m[35m (1.0ms)[0m  CREATE INDEX "index_contacts_on_assigned_to" ON "contacts" ("assigned_to")
  [1m[36m (1.2ms)[0m  [1mCREATE UNIQUE INDEX "id_last_name_deleted" ON "contacts" ("user_id", "last_name", "deleted_at")[0m
  [1m[35m (3.5ms)[0m  CREATE TABLE "emails" ("id" serial primary key, "imap_message_id" character varying(255) NOT NULL, "user_id" integer, "mediator_id" integer, "mediator_type" character varying(255), "sent_from" character varying(255) NOT NULL, "sent_to" character varying(255) NOT NULL, "cc" character varying(255), "bcc" character varying(255), "subject" character varying(255), "body" text, "header" text, "sent_at" timestamp, "received_at" timestamp, "deleted_at" timestamp, "created_at" timestamp NOT NULL, "updated_at" timestamp NOT NULL, "state" character varying(16) DEFAULT 'Expanded' NOT NULL) 
  [1m[36m (1.1ms)[0m  [1mCREATE INDEX "index_emails_on_mediator_id_and_mediator_type" ON "emails" ("mediator_id", "mediator_type")[0m
  [1m[35m (2.4ms)[0m  CREATE TABLE "field_groups" ("id" serial primary key, "name" character varying(64), "label" character varying(128), "position" integer, "hint" character varying(255), "created_at" timestamp NOT NULL, "updated_at" timestamp NOT NULL, "tag_id" integer, "klass_name" character varying(32)) 
  [1m[36m (2.9ms)[0m  [1mCREATE TABLE "fields" ("id" serial primary key, "type" character varying(255), "field_group_id" integer, "position" integer, "name" character varying(64), "label" character varying(128), "hint" character varying(255), "placeholder" character varying(255), "as" character varying(32), "collection" text, "disabled" boolean, "required" boolean, "maxlength" integer, "created_at" timestamp NOT NULL, "updated_at" timestamp NOT NULL) [0m
  [1m[35m (1.0ms)[0m  CREATE INDEX "index_fields_on_field_group_id" ON "fields" ("field_group_id")
  [1m[36m (0.9ms)[0m  [1mCREATE INDEX "index_fields_on_name" ON "fields" ("name")[0m
  [1m[35m (4.2ms)[0m  CREATE TABLE "leads" ("id" serial primary key, "user_id" integer, "campaign_id" integer, "assigned_to" integer, "first_name" character varying(64) DEFAULT '' NOT NULL, "last_name" character varying(64) DEFAULT '' NOT NULL, "access" character varying(8) DEFAULT 'Public', "title" character varying(64), "company" character varying(64), "source" character varying(32), "status" character varying(32), "referred_by" character varying(64), "email" character varying(64), "alt_email" character varying(64), "phone" character varying(32), "mobile" character varying(32), "blog" character varying(128), "linkedin" character varying(128), "facebook" character varying(128), "twitter" character varying(128), "rating" integer DEFAULT 0 NOT NULL, "do_not_call" boolean DEFAULT 'f' NOT NULL, "deleted_at" timestamp, "created_at" timestamp NOT NULL, "updated_at" timestamp NOT NULL, "background_info" character varying(255), "skype" character varying(128), "subscribed_users" text) 
  [1m[36m (0.9ms)[0m  [1mCREATE INDEX "index_leads_on_assigned_to" ON "leads" ("assigned_to")[0m
  [1m[35m (1.1ms)[0m  CREATE UNIQUE INDEX "index_leads_on_user_id_and_last_name_and_deleted_at" ON "leads" ("user_id", "last_name", "deleted_at")
  [1m[36m (3.0ms)[0m  [1mCREATE TABLE "lists" ("id" serial primary key, "name" character varying(255), "url" text, "created_at" timestamp NOT NULL, "updated_at" timestamp NOT NULL) [0m
  [1m[35m (3.5ms)[0m  CREATE TABLE "opportunities" ("id" serial primary key, "user_id" integer, "campaign_id" integer, "assigned_to" integer, "name" character varying(64) DEFAULT '' NOT NULL, "access" character varying(8) DEFAULT 'Public', "source" character varying(32), "stage" character varying(32), "probability" integer, "amount" decimal(12,2), "discount" decimal(12,2), "closes_on" date, "deleted_at" timestamp, "created_at" timestamp NOT NULL, "updated_at" timestamp NOT NULL, "background_info" character varying(255), "subscribed_users" text) 
  [1m[36m (1.0ms)[0m  [1mCREATE INDEX "index_opportunities_on_assigned_to" ON "opportunities" ("assigned_to")[0m
  [1m[35m (1.1ms)[0m  CREATE UNIQUE INDEX "id_name_deleted" ON "opportunities" ("user_id", "name", "deleted_at")
  [1m[36m (2.3ms)[0m  [1mCREATE TABLE "permissions" ("id" serial primary key, "user_id" integer, "asset_id" integer, "asset_type" character varying(255), "created_at" timestamp NOT NULL, "updated_at" timestamp NOT NULL) [0m
  [1m[35m (1.2ms)[0m  CREATE INDEX "index_permissions_on_asset_id_and_asset_type" ON "permissions" ("asset_id", "asset_type")
  [1m[36m (1.0ms)[0m  [1mCREATE INDEX "index_permissions_on_user_id" ON "permissions" ("user_id")[0m
  [1m[35m (3.2ms)[0m  CREATE TABLE "preferences" ("id" serial primary key, "user_id" integer, "name" character varying(32) DEFAULT '' NOT NULL, "value" text, "created_at" timestamp NOT NULL, "updated_at" timestamp NOT NULL) 
  [1m[36m (1.1ms)[0m  [1mCREATE INDEX "index_preferences_on_user_id_and_name" ON "preferences" ("user_id", "name")[0m
  [1m[35m (3.3ms)[0m  CREATE TABLE "sessions" ("id" serial primary key, "session_id" character varying(255) NOT NULL, "data" text, "created_at" timestamp NOT NULL, "updated_at" timestamp NOT NULL) 
  [1m[36m (16.5ms)[0m  [1mCREATE INDEX "index_sessions_on_session_id" ON "sessions" ("session_id")[0m
  [1m[35m (4.0ms)[0m  CREATE INDEX "index_sessions_on_updated_at" ON "sessions" ("updated_at")
  [1m[36m (3.9ms)[0m  [1mCREATE TABLE "settings" ("id" serial primary key, "name" character varying(32) DEFAULT '' NOT NULL, "value" text, "created_at" timestamp NOT NULL, "updated_at" timestamp NOT NULL) [0m
  [1m[35m (0.8ms)[0m  CREATE INDEX "index_settings_on_name" ON "settings" ("name")
  [1m[36m (3.6ms)[0m  [1mCREATE TABLE "taggings" ("id" serial primary key, "tag_id" integer, "taggable_id" integer, "tagger_id" integer, "tagger_type" character varying(255), "taggable_type" character varying(255), "context" character varying(255), "created_at" timestamp) [0m
  [1m[35m (1.4ms)[0m  CREATE INDEX "index_taggings_on_tag_id" ON "taggings" ("tag_id")
  [1m[36m (10.5ms)[0m  [1mCREATE INDEX "index_taggings_on_taggable_id_and_taggable_type_and_context" ON "taggings" ("taggable_id", "taggable_type", "context")[0m
  [1m[35m (8.7ms)[0m  CREATE TABLE "tags" ("id" serial primary key, "name" character varying(255)) 
  [1m[36m (3.4ms)[0m  [1mCREATE TABLE "tasks" ("id" serial primary key, "user_id" integer, "assigned_to" integer, "completed_by" integer, "name" character varying(255) DEFAULT '' NOT NULL, "asset_id" integer, "asset_type" character varying(255), "priority" character varying(32), "category" character varying(32), "bucket" character varying(32), "due_at" timestamp, "completed_at" timestamp, "deleted_at" timestamp, "created_at" timestamp NOT NULL, "updated_at" timestamp NOT NULL, "background_info" character varying(255), "subscribed_users" text) [0m
  [1m[35m (0.9ms)[0m  CREATE INDEX "index_tasks_on_assigned_to" ON "tasks" ("assigned_to")
  [1m[36m (1.0ms)[0m  [1mCREATE UNIQUE INDEX "index_tasks_on_user_id_and_name_and_deleted_at" ON "tasks" ("user_id", "name", "deleted_at")[0m
  [1m[35m (5.4ms)[0m  CREATE TABLE "users" ("id" serial primary key, "username" character varying(32) DEFAULT '' NOT NULL, "email" character varying(64) DEFAULT '' NOT NULL, "first_name" character varying(32), "last_name" character varying(32), "title" character varying(64), "company" character varying(64), "alt_email" character varying(64), "phone" character varying(32), "mobile" character varying(32), "aim" character varying(32), "yahoo" character varying(32), "google" character varying(32), "skype" character varying(32), "password_hash" character varying(255) DEFAULT '' NOT NULL, "password_salt" character varying(255) DEFAULT '' NOT NULL, "persistence_token" character varying(255) DEFAULT '' NOT NULL, "perishable_token" character varying(255) DEFAULT '' NOT NULL, "last_request_at" timestamp, "last_login_at" timestamp, "current_login_at" timestamp, "last_login_ip" character varying(255), "current_login_ip" character varying(255), "login_count" integer DEFAULT 0 NOT NULL, "deleted_at" timestamp, "created_at" timestamp NOT NULL, "updated_at" timestamp NOT NULL, "admin" boolean DEFAULT 'f' NOT NULL, "suspended_at" timestamp, "single_access_token" character varying(255)) 
  [1m[36m (1.1ms)[0m  [1mCREATE INDEX "index_users_on_email" ON "users" ("email")[0m
  [1m[35m (1.2ms)[0m  CREATE INDEX "index_users_on_last_request_at" ON "users" ("last_request_at")
  [1m[36m (1.0ms)[0m  [1mCREATE INDEX "index_users_on_perishable_token" ON "users" ("perishable_token")[0m
  [1m[35m (0.9ms)[0m  CREATE INDEX "index_users_on_remember_token" ON "users" ("persistence_token")
  [1m[36m (1.0ms)[0m  [1mCREATE UNIQUE INDEX "index_users_on_username_and_deleted_at" ON "users" ("username", "deleted_at")[0m
  [1m[35m (3.8ms)[0m  CREATE TABLE "versions" ("id" serial primary key, "item_type" character varying(255) NOT NULL, "item_id" integer NOT NULL, "event" character varying(512) NOT NULL, "whodunnit" character varying(255), "object" text, "created_at" timestamp, "object_changes" text, "related_id" integer, "related_type" character varying(255)) 
  [1m[36m (1.0ms)[0m  [1mCREATE INDEX "index_versions_on_item_type_and_item_id" ON "versions" ("item_type", "item_id")[0m
  [1m[35m (0.8ms)[0m  CREATE INDEX "index_versions_on_whodunnit" ON "versions" ("whodunnit")
  [1m[36m (11.3ms)[0m  [1mCREATE TABLE "schema_migrations" ("version" character varying(255) NOT NULL) [0m
  [1m[35m (2.3ms)[0m  CREATE UNIQUE INDEX "unique_schema_migrations" ON "schema_migrations" ("version")
  [1m[36m (0.2ms)[0m  [1mSELECT version FROM "schema_migrations"[0m
  [1m[35m (0.8ms)[0m  INSERT INTO "schema_migrations" (version) VALUES ('20120528102124')
  [1m[36m (0.2ms)[0m  [1mBEGIN[0m
Started POST "/vend/register_sale" for 127.0.0.1 at 2013-03-06 23:19:36 +1300
Processing by VendController#register_sale as JSON
  Parameters: {"payload"=>{"id"=>"5e8b5134-a002-dd6b-b7c7-26126887c4ee", "sale_date"=>"2012-11-13 16:40:06", "status"=>"CLOSED", "user_id"=>"9b2a8d5f-2d20-11e2-8057-080027706aa2", "customer_id"=>"9b17ac9d-2d20-11e2-8057-080027706aa2", "register_id"=>"9af85e69-2d20-11e2-8057-080027706aa2", "market_id"=>"1", "invoice_number"=>"144", "short_code"=>"ne2zq", "totals"=>{"total_price"=>"4.87", "total_tax"=>"0.69", "total_payment"=>"5.55", "total_to_pay"=>"0"}, "note"=>nil, "updated_at"=>"2012-11-13 16:40:09", "created_at"=>"2012-11-13 16:40:09", "customer"=>{"id"=>"9b17ac9d-2d20-11e2-8057-080027706aa2", "customer_code"=>"WALKIN", "balance"=>"-6.250", "points"=>"0", "note"=>nil, "year_to_date"=>"79945.92188", "sex"=>"M", "date_of_birth"=>"1950-05-25", "updated_at"=>"2012-11-13 16:43:15", "created_at"=>"2012-11-13 12:28:03"}, "user"=>{"id"=>"9b2a8d5f-2d20-11e2-8057-080027706aa2", "name"=>"admin", "display_name"=>"A admin this time", "outlet_id"=>"9ae97219-2d20-11e2-8057-080027706aa2", "target_daily"=>nil, "target_weekly"=>nil, "target_monthly"=>nil, "created_at"=>"2011-09-08 05:18:38", "updated_at"=>"2011-09-08 05:18:38"}, "register_sale_products"=>[{"id"=>"148793f0-475a-7d49-442d-fd761ce76339", "product_id"=>"9fe945bc-2d20-11e2-8057-080027706aa2", "quantity"=>"1", "price"=>"1.90", "price_set"=>"true", "tax"=>"0.24", "price_total"=>"1.9", "tax_total"=>"0.24", "tax_id"=>"9a025ff0-2d20-11e2-8057-080027706aa2", "tax_name"=>"NZ GST", "tax_rate"=>"0.150000"}, {"id"=>"7d37dc0f-9462-06fa-cae0-0b4988b36539", "product_id"=>"a0c0df02-2d20-11e2-8057-080027706aa2", "quantity"=>"3", "price"=>"0.99", "price_set"=>"true", "tax"=>"0.15", "price_total"=>"2.97", "tax_total"=>"0.45", "tax_id"=>"9a025ff0-2d20-11e2-8057-080027706aa2", "tax_name"=>"NZ GST", "tax_rate"=>"0.150000"}], "register_sale_payments"=>[{"id"=>"39948e3e-bf93-1b60-ff44-f46a777ed1d4", "payment_date"=>"2012-11-13 16:40:06", "amount"=>"5.55", "retailer_payment_type_id"=>"9e9ba1ba-2d20-11e2-8057-080027706aa2", "payment_type_id"=>"1"}]}}
Completed 500 Internal Server Error in 1ms
  [1m[35m (0.3ms)[0m  ROLLBACK
  [1m[36m (0.1ms)[0m  [1mBEGIN[0m
  [1m[35m (0.2ms)[0m  ROLLBACK
Connecting to database specified by database.yml
  [1m[36mFieldGroup Load (0.9ms)[0m  [1mSELECT "field_groups".* FROM "field_groups" WHERE "field_groups"."klass_name" = 'Account' ORDER BY position[0m
  [1m[35mFieldGroup Load (0.3ms)[0m  SELECT "field_groups".* FROM "field_groups" WHERE "field_groups"."klass_name" = 'Campaign' ORDER BY position
  [1m[36mFieldGroup Load (0.3ms)[0m  [1mSELECT "field_groups".* FROM "field_groups" WHERE "field_groups"."klass_name" = 'Contact' ORDER BY position[0m
  [1m[35mFieldGroup Load (0.5ms)[0m  SELECT "field_groups".* FROM "field_groups" WHERE "field_groups"."klass_name" = 'Lead' ORDER BY position
  [1m[36mFieldGroup Load (0.3ms)[0m  [1mSELECT "field_groups".* FROM "field_groups" WHERE "field_groups"."klass_name" = 'Opportunity' ORDER BY position[0m
  [1m[35mFieldGroup Load (0.3ms)[0m  SELECT "field_groups".* FROM "field_groups" WHERE "field_groups"."klass_name" = 'Task' ORDER BY position
Creating scope :except. Overwriting existing method User.except.
  [1m[36m (122.5ms)[0m  [1mDROP DATABASE IF EXISTS "ffcrm_vend_test"[0m
  [1m[35m (244.3ms)[0m  CREATE DATABASE "ffcrm_vend_test" ENCODING = 'utf8'
  [1m[36m (5.4ms)[0m  [1mCREATE TABLE "account_contacts" ("id" serial primary key, "account_id" integer, "contact_id" integer, "deleted_at" timestamp, "created_at" timestamp NOT NULL, "updated_at" timestamp NOT NULL) [0m
  [1m[35m (2.7ms)[0m  CREATE TABLE "account_opportunities" ("id" serial primary key, "account_id" integer, "opportunity_id" integer, "deleted_at" timestamp, "created_at" timestamp NOT NULL, "updated_at" timestamp NOT NULL) 
  [1m[36m (4.0ms)[0m  [1mCREATE TABLE "accounts" ("id" serial primary key, "user_id" integer, "assigned_to" integer, "name" character varying(64) DEFAULT '' NOT NULL, "access" character varying(8) DEFAULT 'Public', "website" character varying(64), "toll_free_phone" character varying(32), "phone" character varying(32), "fax" character varying(32), "deleted_at" timestamp, "created_at" timestamp NOT NULL, "updated_at" timestamp NOT NULL, "email" character varying(64), "background_info" character varying(255), "rating" integer DEFAULT 0 NOT NULL, "category" character varying(32), "subscribed_users" text) [0m
  [1m[35m (1.2ms)[0m  CREATE INDEX "index_accounts_on_assigned_to" ON "accounts" ("assigned_to")
  [1m[36m (1.3ms)[0m  [1mCREATE UNIQUE INDEX "index_accounts_on_user_id_and_name_and_deleted_at" ON "accounts" ("user_id", "name", "deleted_at")[0m
  [1m[35m (3.5ms)[0m  CREATE TABLE "activities" ("id" serial primary key, "user_id" integer, "subject_id" integer, "subject_type" character varying(255), "action" character varying(32) DEFAULT 'created', "info" character varying(255) DEFAULT '', "private" boolean DEFAULT 'f', "created_at" timestamp NOT NULL, "updated_at" timestamp NOT NULL) 
  [1m[36m (1.0ms)[0m  [1mCREATE INDEX "index_activities_on_created_at" ON "activities" ("created_at")[0m
  [1m[35m (0.9ms)[0m  CREATE INDEX "index_activities_on_user_id" ON "activities" ("user_id")
  [1m[36m (3.3ms)[0m  [1mCREATE TABLE "addresses" ("id" serial primary key, "street1" character varying(255), "street2" character varying(255), "city" character varying(64), "state" character varying(64), "zipcode" character varying(16), "country" character varying(64), "full_address" character varying(255), "address_type" character varying(16), "addressable_id" integer, "addressable_type" character varying(255), "created_at" timestamp NOT NULL, "updated_at" timestamp NOT NULL, "deleted_at" timestamp) [0m
  [1m[35m (1.0ms)[0m  CREATE INDEX "index_addresses_on_addressable_id_and_addressable_type" ON "addresses" ("addressable_id", "addressable_type")
  [1m[36m (3.1ms)[0m  [1mCREATE TABLE "avatars" ("id" serial primary key, "user_id" integer, "entity_id" integer, "entity_type" character varying(255), "image_file_size" integer, "image_file_name" character varying(255), "image_content_type" character varying(255), "created_at" timestamp NOT NULL, "updated_at" timestamp NOT NULL) [0m
  [1m[35m (3.7ms)[0m  CREATE TABLE "campaigns" ("id" serial primary key, "user_id" integer, "assigned_to" integer, "name" character varying(64) DEFAULT '' NOT NULL, "access" character varying(8) DEFAULT 'Public', "status" character varying(64), "budget" decimal(12,2), "target_leads" integer, "target_conversion" float, "target_revenue" decimal(12,2), "leads_count" integer, "opportunities_count" integer, "revenue" decimal(12,2), "starts_on" date, "ends_on" date, "objectives" text, "deleted_at" timestamp, "created_at" timestamp NOT NULL, "updated_at" timestamp NOT NULL, "background_info" character varying(255), "subscribed_users" text) 
  [1m[36m (1.1ms)[0m  [1mCREATE INDEX "index_campaigns_on_assigned_to" ON "campaigns" ("assigned_to")[0m
  [1m[35m (1.1ms)[0m  CREATE UNIQUE INDEX "index_campaigns_on_user_id_and_name_and_deleted_at" ON "campaigns" ("user_id", "name", "deleted_at")
  [1m[36m (3.3ms)[0m  [1mCREATE TABLE "comments" ("id" serial primary key, "user_id" integer, "commentable_id" integer, "commentable_type" character varying(255), "private" boolean, "title" character varying(255) DEFAULT '', "comment" text, "created_at" timestamp NOT NULL, "updated_at" timestamp NOT NULL, "state" character varying(16) DEFAULT 'Expanded' NOT NULL) [0m
  [1m[35m (2.5ms)[0m  CREATE TABLE "contact_opportunities" ("id" serial primary key, "contact_id" integer, "opportunity_id" integer, "role" character varying(32), "deleted_at" timestamp, "created_at" timestamp NOT NULL, "updated_at" timestamp NOT NULL) 
  [1m[36m (4.1ms)[0m  [1mCREATE TABLE "contacts" ("id" serial primary key, "user_id" integer, "lead_id" integer, "assigned_to" integer, "reports_to" integer, "first_name" character varying(64) DEFAULT '' NOT NULL, "last_name" character varying(64) DEFAULT '' NOT NULL, "access" character varying(8) DEFAULT 'Public', "title" character varying(64), "department" character varying(64), "source" character varying(32), "email" character varying(64), "alt_email" character varying(64), "phone" character varying(32), "mobile" character varying(32), "fax" character varying(32), "blog" character varying(128), "linkedin" character varying(128), "facebook" character varying(128), "twitter" character varying(128), "born_on" date, "do_not_call" boolean DEFAULT 'f' NOT NULL, "deleted_at" timestamp, "created_at" timestamp NOT NULL, "updated_at" timestamp NOT NULL, "background_info" character varying(255), "skype" character varying(128), "subscribed_users" text) [0m
  [1m[35m (1.1ms)[0m  CREATE INDEX "index_contacts_on_assigned_to" ON "contacts" ("assigned_to")
  [1m[36m (1.1ms)[0m  [1mCREATE UNIQUE INDEX "id_last_name_deleted" ON "contacts" ("user_id", "last_name", "deleted_at")[0m
  [1m[35m (3.7ms)[0m  CREATE TABLE "emails" ("id" serial primary key, "imap_message_id" character varying(255) NOT NULL, "user_id" integer, "mediator_id" integer, "mediator_type" character varying(255), "sent_from" character varying(255) NOT NULL, "sent_to" character varying(255) NOT NULL, "cc" character varying(255), "bcc" character varying(255), "subject" character varying(255), "body" text, "header" text, "sent_at" timestamp, "received_at" timestamp, "deleted_at" timestamp, "created_at" timestamp NOT NULL, "updated_at" timestamp NOT NULL, "state" character varying(16) DEFAULT 'Expanded' NOT NULL) 
  [1m[36m (1.1ms)[0m  [1mCREATE INDEX "index_emails_on_mediator_id_and_mediator_type" ON "emails" ("mediator_id", "mediator_type")[0m
  [1m[35m (3.2ms)[0m  CREATE TABLE "field_groups" ("id" serial primary key, "name" character varying(64), "label" character varying(128), "position" integer, "hint" character varying(255), "created_at" timestamp NOT NULL, "updated_at" timestamp NOT NULL, "tag_id" integer, "klass_name" character varying(32)) 
  [1m[36m (3.2ms)[0m  [1mCREATE TABLE "fields" ("id" serial primary key, "type" character varying(255), "field_group_id" integer, "position" integer, "name" character varying(64), "label" character varying(128), "hint" character varying(255), "placeholder" character varying(255), "as" character varying(32), "collection" text, "disabled" boolean, "required" boolean, "maxlength" integer, "created_at" timestamp NOT NULL, "updated_at" timestamp NOT NULL) [0m
  [1m[35m (1.0ms)[0m  CREATE INDEX "index_fields_on_field_group_id" ON "fields" ("field_group_id")
  [1m[36m (0.8ms)[0m  [1mCREATE INDEX "index_fields_on_name" ON "fields" ("name")[0m
  [1m[35m (4.0ms)[0m  CREATE TABLE "leads" ("id" serial primary key, "user_id" integer, "campaign_id" integer, "assigned_to" integer, "first_name" character varying(64) DEFAULT '' NOT NULL, "last_name" character varying(64) DEFAULT '' NOT NULL, "access" character varying(8) DEFAULT 'Public', "title" character varying(64), "company" character varying(64), "source" character varying(32), "status" character varying(32), "referred_by" character varying(64), "email" character varying(64), "alt_email" character varying(64), "phone" character varying(32), "mobile" character varying(32), "blog" character varying(128), "linkedin" character varying(128), "facebook" character varying(128), "twitter" character varying(128), "rating" integer DEFAULT 0 NOT NULL, "do_not_call" boolean DEFAULT 'f' NOT NULL, "deleted_at" timestamp, "created_at" timestamp NOT NULL, "updated_at" timestamp NOT NULL, "background_info" character varying(255), "skype" character varying(128), "subscribed_users" text) 
  [1m[36m (1.1ms)[0m  [1mCREATE INDEX "index_leads_on_assigned_to" ON "leads" ("assigned_to")[0m
  [1m[35m (1.2ms)[0m  CREATE UNIQUE INDEX "index_leads_on_user_id_and_last_name_and_deleted_at" ON "leads" ("user_id", "last_name", "deleted_at")
  [1m[36m (3.2ms)[0m  [1mCREATE TABLE "lists" ("id" serial primary key, "name" character varying(255), "url" text, "created_at" timestamp NOT NULL, "updated_at" timestamp NOT NULL) [0m
  [1m[35m (3.5ms)[0m  CREATE TABLE "opportunities" ("id" serial primary key, "user_id" integer, "campaign_id" integer, "assigned_to" integer, "name" character varying(64) DEFAULT '' NOT NULL, "access" character varying(8) DEFAULT 'Public', "source" character varying(32), "stage" character varying(32), "probability" integer, "amount" decimal(12,2), "discount" decimal(12,2), "closes_on" date, "deleted_at" timestamp, "created_at" timestamp NOT NULL, "updated_at" timestamp NOT NULL, "background_info" character varying(255), "subscribed_users" text) 
  [1m[36m (1.2ms)[0m  [1mCREATE INDEX "index_opportunities_on_assigned_to" ON "opportunities" ("assigned_to")[0m
  [1m[35m (1.1ms)[0m  CREATE UNIQUE INDEX "id_name_deleted" ON "opportunities" ("user_id", "name", "deleted_at")
  [1m[36m (2.3ms)[0m  [1mCREATE TABLE "permissions" ("id" serial primary key, "user_id" integer, "asset_id" integer, "asset_type" character varying(255), "created_at" timestamp NOT NULL, "updated_at" timestamp NOT NULL) [0m
  [1m[35m (1.0ms)[0m  CREATE INDEX "index_permissions_on_asset_id_and_asset_type" ON "permissions" ("asset_id", "asset_type")
  [1m[36m (0.8ms)[0m  [1mCREATE INDEX "index_permissions_on_user_id" ON "permissions" ("user_id")[0m
  [1m[35m (3.2ms)[0m  CREATE TABLE "preferences" ("id" serial primary key, "user_id" integer, "name" character varying(32) DEFAULT '' NOT NULL, "value" text, "created_at" timestamp NOT NULL, "updated_at" timestamp NOT NULL) 
  [1m[36m (1.2ms)[0m  [1mCREATE INDEX "index_preferences_on_user_id_and_name" ON "preferences" ("user_id", "name")[0m
  [1m[35m (3.3ms)[0m  CREATE TABLE "sessions" ("id" serial primary key, "session_id" character varying(255) NOT NULL, "data" text, "created_at" timestamp NOT NULL, "updated_at" timestamp NOT NULL) 
  [1m[36m (0.9ms)[0m  [1mCREATE INDEX "index_sessions_on_session_id" ON "sessions" ("session_id")[0m
  [1m[35m (1.1ms)[0m  CREATE INDEX "index_sessions_on_updated_at" ON "sessions" ("updated_at")
  [1m[36m (3.0ms)[0m  [1mCREATE TABLE "settings" ("id" serial primary key, "name" character varying(32) DEFAULT '' NOT NULL, "value" text, "created_at" timestamp NOT NULL, "updated_at" timestamp NOT NULL) [0m
  [1m[35m (1.0ms)[0m  CREATE INDEX "index_settings_on_name" ON "settings" ("name")
  [1m[36m (3.7ms)[0m  [1mCREATE TABLE "taggings" ("id" serial primary key, "tag_id" integer, "taggable_id" integer, "tagger_id" integer, "tagger_type" character varying(255), "taggable_type" character varying(255), "context" character varying(255), "created_at" timestamp) [0m
  [1m[35m (1.1ms)[0m  CREATE INDEX "index_taggings_on_tag_id" ON "taggings" ("tag_id")
  [1m[36m (1.0ms)[0m  [1mCREATE INDEX "index_taggings_on_taggable_id_and_taggable_type_and_context" ON "taggings" ("taggable_id", "taggable_type", "context")[0m
  [1m[35m (2.1ms)[0m  CREATE TABLE "tags" ("id" serial primary key, "name" character varying(255)) 
  [1m[36m (3.7ms)[0m  [1mCREATE TABLE "tasks" ("id" serial primary key, "user_id" integer, "assigned_to" integer, "completed_by" integer, "name" character varying(255) DEFAULT '' NOT NULL, "asset_id" integer, "asset_type" character varying(255), "priority" character varying(32), "category" character varying(32), "bucket" character varying(32), "due_at" timestamp, "completed_at" timestamp, "deleted_at" timestamp, "created_at" timestamp NOT NULL, "updated_at" timestamp NOT NULL, "background_info" character varying(255), "subscribed_users" text) [0m
  [1m[35m (1.0ms)[0m  CREATE INDEX "index_tasks_on_assigned_to" ON "tasks" ("assigned_to")
  [1m[36m (1.0ms)[0m  [1mCREATE UNIQUE INDEX "index_tasks_on_user_id_and_name_and_deleted_at" ON "tasks" ("user_id", "name", "deleted_at")[0m
  [1m[35m (5.5ms)[0m  CREATE TABLE "users" ("id" serial primary key, "username" character varying(32) DEFAULT '' NOT NULL, "email" character varying(64) DEFAULT '' NOT NULL, "first_name" character varying(32), "last_name" character varying(32), "title" character varying(64), "company" character varying(64), "alt_email" character varying(64), "phone" character varying(32), "mobile" character varying(32), "aim" character varying(32), "yahoo" character varying(32), "google" character varying(32), "skype" character varying(32), "password_hash" character varying(255) DEFAULT '' NOT NULL, "password_salt" character varying(255) DEFAULT '' NOT NULL, "persistence_token" character varying(255) DEFAULT '' NOT NULL, "perishable_token" character varying(255) DEFAULT '' NOT NULL, "last_request_at" timestamp, "last_login_at" timestamp, "current_login_at" timestamp, "last_login_ip" character varying(255), "current_login_ip" character varying(255), "login_count" integer DEFAULT 0 NOT NULL, "deleted_at" timestamp, "created_at" timestamp NOT NULL, "updated_at" timestamp NOT NULL, "admin" boolean DEFAULT 'f' NOT NULL, "suspended_at" timestamp, "single_access_token" character varying(255)) 
  [1m[36m (1.1ms)[0m  [1mCREATE INDEX "index_users_on_email" ON "users" ("email")[0m
  [1m[35m (0.9ms)[0m  CREATE INDEX "index_users_on_last_request_at" ON "users" ("last_request_at")
  [1m[36m (0.9ms)[0m  [1mCREATE INDEX "index_users_on_perishable_token" ON "users" ("perishable_token")[0m
  [1m[35m (1.3ms)[0m  CREATE INDEX "index_users_on_remember_token" ON "users" ("persistence_token")
  [1m[36m (1.2ms)[0m  [1mCREATE UNIQUE INDEX "index_users_on_username_and_deleted_at" ON "users" ("username", "deleted_at")[0m
  [1m[35m (3.9ms)[0m  CREATE TABLE "versions" ("id" serial primary key, "item_type" character varying(255) NOT NULL, "item_id" integer NOT NULL, "event" character varying(512) NOT NULL, "whodunnit" character varying(255), "object" text, "created_at" timestamp, "object_changes" text, "related_id" integer, "related_type" character varying(255)) 
  [1m[36m (0.9ms)[0m  [1mCREATE INDEX "index_versions_on_item_type_and_item_id" ON "versions" ("item_type", "item_id")[0m
  [1m[35m (1.0ms)[0m  CREATE INDEX "index_versions_on_whodunnit" ON "versions" ("whodunnit")
  [1m[36m (0.7ms)[0m  [1mCREATE TABLE "schema_migrations" ("version" character varying(255) NOT NULL) [0m
  [1m[35m (1.0ms)[0m  CREATE UNIQUE INDEX "unique_schema_migrations" ON "schema_migrations" ("version")
  [1m[36m (0.2ms)[0m  [1mSELECT version FROM "schema_migrations"[0m
  [1m[35m (0.4ms)[0m  INSERT INTO "schema_migrations" (version) VALUES ('20120528102124')
  [1m[36m (0.4ms)[0m  [1mBEGIN[0m
  [1m[35m (0.2ms)[0m  ROLLBACK
  [1m[36m (0.1ms)[0m  [1mBEGIN[0m
  [1m[35m (0.2ms)[0m  ROLLBACK
Connecting to database specified by database.yml
  [1m[36mFieldGroup Load (0.8ms)[0m  [1mSELECT "field_groups".* FROM "field_groups" WHERE "field_groups"."klass_name" = 'Account' ORDER BY position[0m
  [1m[35mFieldGroup Load (0.3ms)[0m  SELECT "field_groups".* FROM "field_groups" WHERE "field_groups"."klass_name" = 'Campaign' ORDER BY position
  [1m[36mFieldGroup Load (0.3ms)[0m  [1mSELECT "field_groups".* FROM "field_groups" WHERE "field_groups"."klass_name" = 'Contact' ORDER BY position[0m
  [1m[35mFieldGroup Load (0.5ms)[0m  SELECT "field_groups".* FROM "field_groups" WHERE "field_groups"."klass_name" = 'Lead' ORDER BY position
  [1m[36mFieldGroup Load (0.2ms)[0m  [1mSELECT "field_groups".* FROM "field_groups" WHERE "field_groups"."klass_name" = 'Opportunity' ORDER BY position[0m
  [1m[35mFieldGroup Load (0.3ms)[0m  SELECT "field_groups".* FROM "field_groups" WHERE "field_groups"."klass_name" = 'Task' ORDER BY position
Creating scope :except. Overwriting existing method User.except.
  [1m[36m (122.0ms)[0m  [1mDROP DATABASE IF EXISTS "ffcrm_vend_test"[0m
  [1m[35m (254.6ms)[0m  CREATE DATABASE "ffcrm_vend_test" ENCODING = 'utf8'
  [1m[36m (16.7ms)[0m  [1mCREATE TABLE "account_contacts" ("id" serial primary key, "account_id" integer, "contact_id" integer, "deleted_at" timestamp, "created_at" timestamp NOT NULL, "updated_at" timestamp NOT NULL) [0m
  [1m[35m (2.4ms)[0m  CREATE TABLE "account_opportunities" ("id" serial primary key, "account_id" integer, "opportunity_id" integer, "deleted_at" timestamp, "created_at" timestamp NOT NULL, "updated_at" timestamp NOT NULL) 
  [1m[36m (20.6ms)[0m  [1mCREATE TABLE "accounts" ("id" serial primary key, "user_id" integer, "assigned_to" integer, "name" character varying(64) DEFAULT '' NOT NULL, "access" character varying(8) DEFAULT 'Public', "website" character varying(64), "toll_free_phone" character varying(32), "phone" character varying(32), "fax" character varying(32), "deleted_at" timestamp, "created_at" timestamp NOT NULL, "updated_at" timestamp NOT NULL, "email" character varying(64), "background_info" character varying(255), "rating" integer DEFAULT 0 NOT NULL, "category" character varying(32), "subscribed_users" text) [0m
  [1m[35m (1.4ms)[0m  CREATE INDEX "index_accounts_on_assigned_to" ON "accounts" ("assigned_to")
  [1m[36m (1.4ms)[0m  [1mCREATE UNIQUE INDEX "index_accounts_on_user_id_and_name_and_deleted_at" ON "accounts" ("user_id", "name", "deleted_at")[0m
  [1m[35m (3.8ms)[0m  CREATE TABLE "activities" ("id" serial primary key, "user_id" integer, "subject_id" integer, "subject_type" character varying(255), "action" character varying(32) DEFAULT 'created', "info" character varying(255) DEFAULT '', "private" boolean DEFAULT 'f', "created_at" timestamp NOT NULL, "updated_at" timestamp NOT NULL) 
  [1m[36m (0.8ms)[0m  [1mCREATE INDEX "index_activities_on_created_at" ON "activities" ("created_at")[0m
  [1m[35m (0.8ms)[0m  CREATE INDEX "index_activities_on_user_id" ON "activities" ("user_id")
  [1m[36m (3.3ms)[0m  [1mCREATE TABLE "addresses" ("id" serial primary key, "street1" character varying(255), "street2" character varying(255), "city" character varying(64), "state" character varying(64), "zipcode" character varying(16), "country" character varying(64), "full_address" character varying(255), "address_type" character varying(16), "addressable_id" integer, "addressable_type" character varying(255), "created_at" timestamp NOT NULL, "updated_at" timestamp NOT NULL, "deleted_at" timestamp) [0m
  [1m[35m (1.0ms)[0m  CREATE INDEX "index_addresses_on_addressable_id_and_addressable_type" ON "addresses" ("addressable_id", "addressable_type")
  [1m[36m (3.4ms)[0m  [1mCREATE TABLE "avatars" ("id" serial primary key, "user_id" integer, "entity_id" integer, "entity_type" character varying(255), "image_file_size" integer, "image_file_name" character varying(255), "image_content_type" character varying(255), "created_at" timestamp NOT NULL, "updated_at" timestamp NOT NULL) [0m
  [1m[35m (3.9ms)[0m  CREATE TABLE "campaigns" ("id" serial primary key, "user_id" integer, "assigned_to" integer, "name" character varying(64) DEFAULT '' NOT NULL, "access" character varying(8) DEFAULT 'Public', "status" character varying(64), "budget" decimal(12,2), "target_leads" integer, "target_conversion" float, "target_revenue" decimal(12,2), "leads_count" integer, "opportunities_count" integer, "revenue" decimal(12,2), "starts_on" date, "ends_on" date, "objectives" text, "deleted_at" timestamp, "created_at" timestamp NOT NULL, "updated_at" timestamp NOT NULL, "background_info" character varying(255), "subscribed_users" text) 
  [1m[36m (1.0ms)[0m  [1mCREATE INDEX "index_campaigns_on_assigned_to" ON "campaigns" ("assigned_to")[0m
  [1m[35m (1.0ms)[0m  CREATE UNIQUE INDEX "index_campaigns_on_user_id_and_name_and_deleted_at" ON "campaigns" ("user_id", "name", "deleted_at")
  [1m[36m (3.6ms)[0m  [1mCREATE TABLE "comments" ("id" serial primary key, "user_id" integer, "commentable_id" integer, "commentable_type" character varying(255), "private" boolean, "title" character varying(255) DEFAULT '', "comment" text, "created_at" timestamp NOT NULL, "updated_at" timestamp NOT NULL, "state" character varying(16) DEFAULT 'Expanded' NOT NULL) [0m
  [1m[35m (2.3ms)[0m  CREATE TABLE "contact_opportunities" ("id" serial primary key, "contact_id" integer, "opportunity_id" integer, "role" character varying(32), "deleted_at" timestamp, "created_at" timestamp NOT NULL, "updated_at" timestamp NOT NULL) 
  [1m[36m (4.2ms)[0m  [1mCREATE TABLE "contacts" ("id" serial primary key, "user_id" integer, "lead_id" integer, "assigned_to" integer, "reports_to" integer, "first_name" character varying(64) DEFAULT '' NOT NULL, "last_name" character varying(64) DEFAULT '' NOT NULL, "access" character varying(8) DEFAULT 'Public', "title" character varying(64), "department" character varying(64), "source" character varying(32), "email" character varying(64), "alt_email" character varying(64), "phone" character varying(32), "mobile" character varying(32), "fax" character varying(32), "blog" character varying(128), "linkedin" character varying(128), "facebook" character varying(128), "twitter" character varying(128), "born_on" date, "do_not_call" boolean DEFAULT 'f' NOT NULL, "deleted_at" timestamp, "created_at" timestamp NOT NULL, "updated_at" timestamp NOT NULL, "background_info" character varying(255), "skype" character varying(128), "subscribed_users" text) [0m
  [1m[35m (0.9ms)[0m  CREATE INDEX "index_contacts_on_assigned_to" ON "contacts" ("assigned_to")
  [1m[36m (1.1ms)[0m  [1mCREATE UNIQUE INDEX "id_last_name_deleted" ON "contacts" ("user_id", "last_name", "deleted_at")[0m
  [1m[35m (3.2ms)[0m  CREATE TABLE "emails" ("id" serial primary key, "imap_message_id" character varying(255) NOT NULL, "user_id" integer, "mediator_id" integer, "mediator_type" character varying(255), "sent_from" character varying(255) NOT NULL, "sent_to" character varying(255) NOT NULL, "cc" character varying(255), "bcc" character varying(255), "subject" character varying(255), "body" text, "header" text, "sent_at" timestamp, "received_at" timestamp, "deleted_at" timestamp, "created_at" timestamp NOT NULL, "updated_at" timestamp NOT NULL, "state" character varying(16) DEFAULT 'Expanded' NOT NULL) 
  [1m[36m (0.9ms)[0m  [1mCREATE INDEX "index_emails_on_mediator_id_and_mediator_type" ON "emails" ("mediator_id", "mediator_type")[0m
  [1m[35m (2.4ms)[0m  CREATE TABLE "field_groups" ("id" serial primary key, "name" character varying(64), "label" character varying(128), "position" integer, "hint" character varying(255), "created_at" timestamp NOT NULL, "updated_at" timestamp NOT NULL, "tag_id" integer, "klass_name" character varying(32)) 
  [1m[36m (3.2ms)[0m  [1mCREATE TABLE "fields" ("id" serial primary key, "type" character varying(255), "field_group_id" integer, "position" integer, "name" character varying(64), "label" character varying(128), "hint" character varying(255), "placeholder" character varying(255), "as" character varying(32), "collection" text, "disabled" boolean, "required" boolean, "maxlength" integer, "created_at" timestamp NOT NULL, "updated_at" timestamp NOT NULL) [0m
  [1m[35m (1.1ms)[0m  CREATE INDEX "index_fields_on_field_group_id" ON "fields" ("field_group_id")
  [1m[36m (0.8ms)[0m  [1mCREATE INDEX "index_fields_on_name" ON "fields" ("name")[0m
  [1m[35m (4.0ms)[0m  CREATE TABLE "leads" ("id" serial primary key, "user_id" integer, "campaign_id" integer, "assigned_to" integer, "first_name" character varying(64) DEFAULT '' NOT NULL, "last_name" character varying(64) DEFAULT '' NOT NULL, "access" character varying(8) DEFAULT 'Public', "title" character varying(64), "company" character varying(64), "source" character varying(32), "status" character varying(32), "referred_by" character varying(64), "email" character varying(64), "alt_email" character varying(64), "phone" character varying(32), "mobile" character varying(32), "blog" character varying(128), "linkedin" character varying(128), "facebook" character varying(128), "twitter" character varying(128), "rating" integer DEFAULT 0 NOT NULL, "do_not_call" boolean DEFAULT 'f' NOT NULL, "deleted_at" timestamp, "created_at" timestamp NOT NULL, "updated_at" timestamp NOT NULL, "background_info" character varying(255), "skype" character varying(128), "subscribed_users" text) 
  [1m[36m (1.0ms)[0m  [1mCREATE INDEX "index_leads_on_assigned_to" ON "leads" ("assigned_to")[0m
  [1m[35m (1.1ms)[0m  CREATE UNIQUE INDEX "index_leads_on_user_id_and_last_name_and_deleted_at" ON "leads" ("user_id", "last_name", "deleted_at")
  [1m[36m (3.0ms)[0m  [1mCREATE TABLE "lists" ("id" serial primary key, "name" character varying(255), "url" text, "created_at" timestamp NOT NULL, "updated_at" timestamp NOT NULL) [0m
  [1m[35m (3.7ms)[0m  CREATE TABLE "opportunities" ("id" serial primary key, "user_id" integer, "campaign_id" integer, "assigned_to" integer, "name" character varying(64) DEFAULT '' NOT NULL, "access" character varying(8) DEFAULT 'Public', "source" character varying(32), "stage" character varying(32), "probability" integer, "amount" decimal(12,2), "discount" decimal(12,2), "closes_on" date, "deleted_at" timestamp, "created_at" timestamp NOT NULL, "updated_at" timestamp NOT NULL, "background_info" character varying(255), "subscribed_users" text) 
  [1m[36m (1.0ms)[0m  [1mCREATE INDEX "index_opportunities_on_assigned_to" ON "opportunities" ("assigned_to")[0m
  [1m[35m (1.0ms)[0m  CREATE UNIQUE INDEX "id_name_deleted" ON "opportunities" ("user_id", "name", "deleted_at")
  [1m[36m (2.3ms)[0m  [1mCREATE TABLE "permissions" ("id" serial primary key, "user_id" integer, "asset_id" integer, "asset_type" character varying(255), "created_at" timestamp NOT NULL, "updated_at" timestamp NOT NULL) [0m
  [1m[35m (1.3ms)[0m  CREATE INDEX "index_permissions_on_asset_id_and_asset_type" ON "permissions" ("asset_id", "asset_type")
  [1m[36m (1.1ms)[0m  [1mCREATE INDEX "index_permissions_on_user_id" ON "permissions" ("user_id")[0m
  [1m[35m (3.1ms)[0m  CREATE TABLE "preferences" ("id" serial primary key, "user_id" integer, "name" character varying(32) DEFAULT '' NOT NULL, "value" text, "created_at" timestamp NOT NULL, "updated_at" timestamp NOT NULL) 
  [1m[36m (1.2ms)[0m  [1mCREATE INDEX "index_preferences_on_user_id_and_name" ON "preferences" ("user_id", "name")[0m
  [1m[35m (3.1ms)[0m  CREATE TABLE "sessions" ("id" serial primary key, "session_id" character varying(255) NOT NULL, "data" text, "created_at" timestamp NOT NULL, "updated_at" timestamp NOT NULL) 
  [1m[36m (1.0ms)[0m  [1mCREATE INDEX "index_sessions_on_session_id" ON "sessions" ("session_id")[0m
  [1m[35m (0.8ms)[0m  CREATE INDEX "index_sessions_on_updated_at" ON "sessions" ("updated_at")
  [1m[36m (3.3ms)[0m  [1mCREATE TABLE "settings" ("id" serial primary key, "name" character varying(32) DEFAULT '' NOT NULL, "value" text, "created_at" timestamp NOT NULL, "updated_at" timestamp NOT NULL) [0m
  [1m[35m (1.1ms)[0m  CREATE INDEX "index_settings_on_name" ON "settings" ("name")
  [1m[36m (3.5ms)[0m  [1mCREATE TABLE "taggings" ("id" serial primary key, "tag_id" integer, "taggable_id" integer, "tagger_id" integer, "tagger_type" character varying(255), "taggable_type" character varying(255), "context" character varying(255), "created_at" timestamp) [0m
  [1m[35m (0.9ms)[0m  CREATE INDEX "index_taggings_on_tag_id" ON "taggings" ("tag_id")
  [1m[36m (1.0ms)[0m  [1mCREATE INDEX "index_taggings_on_taggable_id_and_taggable_type_and_context" ON "taggings" ("taggable_id", "taggable_type", "context")[0m
  [1m[35m (2.0ms)[0m  CREATE TABLE "tags" ("id" serial primary key, "name" character varying(255)) 
  [1m[36m (4.0ms)[0m  [1mCREATE TABLE "tasks" ("id" serial primary key, "user_id" integer, "assigned_to" integer, "completed_by" integer, "name" character varying(255) DEFAULT '' NOT NULL, "asset_id" integer, "asset_type" character varying(255), "priority" character varying(32), "category" character varying(32), "bucket" character varying(32), "due_at" timestamp, "completed_at" timestamp, "deleted_at" timestamp, "created_at" timestamp NOT NULL, "updated_at" timestamp NOT NULL, "background_info" character varying(255), "subscribed_users" text) [0m
  [1m[35m (1.0ms)[0m  CREATE INDEX "index_tasks_on_assigned_to" ON "tasks" ("assigned_to")
  [1m[36m (1.2ms)[0m  [1mCREATE UNIQUE INDEX "index_tasks_on_user_id_and_name_and_deleted_at" ON "tasks" ("user_id", "name", "deleted_at")[0m
  [1m[35m (4.2ms)[0m  CREATE TABLE "users" ("id" serial primary key, "username" character varying(32) DEFAULT '' NOT NULL, "email" character varying(64) DEFAULT '' NOT NULL, "first_name" character varying(32), "last_name" character varying(32), "title" character varying(64), "company" character varying(64), "alt_email" character varying(64), "phone" character varying(32), "mobile" character varying(32), "aim" character varying(32), "yahoo" character varying(32), "google" character varying(32), "skype" character varying(32), "password_hash" character varying(255) DEFAULT '' NOT NULL, "password_salt" character varying(255) DEFAULT '' NOT NULL, "persistence_token" character varying(255) DEFAULT '' NOT NULL, "perishable_token" character varying(255) DEFAULT '' NOT NULL, "last_request_at" timestamp, "last_login_at" timestamp, "current_login_at" timestamp, "last_login_ip" character varying(255), "current_login_ip" character varying(255), "login_count" integer DEFAULT 0 NOT NULL, "deleted_at" timestamp, "created_at" timestamp NOT NULL, "updated_at" timestamp NOT NULL, "admin" boolean DEFAULT 'f' NOT NULL, "suspended_at" timestamp, "single_access_token" character varying(255)) 
  [1m[36m (1.0ms)[0m  [1mCREATE INDEX "index_users_on_email" ON "users" ("email")[0m
  [1m[35m (0.9ms)[0m  CREATE INDEX "index_users_on_last_request_at" ON "users" ("last_request_at")
  [1m[36m (0.9ms)[0m  [1mCREATE INDEX "index_users_on_perishable_token" ON "users" ("perishable_token")[0m
  [1m[35m (9.4ms)[0m  CREATE INDEX "index_users_on_remember_token" ON "users" ("persistence_token")
  [1m[36m (5.6ms)[0m  [1mCREATE UNIQUE INDEX "index_users_on_username_and_deleted_at" ON "users" ("username", "deleted_at")[0m
  [1m[35m (10.0ms)[0m  CREATE TABLE "versions" ("id" serial primary key, "item_type" character varying(255) NOT NULL, "item_id" integer NOT NULL, "event" character varying(512) NOT NULL, "whodunnit" character varying(255), "object" text, "created_at" timestamp, "object_changes" text, "related_id" integer, "related_type" character varying(255)) 
  [1m[36m (1.1ms)[0m  [1mCREATE INDEX "index_versions_on_item_type_and_item_id" ON "versions" ("item_type", "item_id")[0m
  [1m[35m (0.9ms)[0m  CREATE INDEX "index_versions_on_whodunnit" ON "versions" ("whodunnit")
  [1m[36m (0.8ms)[0m  [1mCREATE TABLE "schema_migrations" ("version" character varying(255) NOT NULL) [0m
  [1m[35m (1.1ms)[0m  CREATE UNIQUE INDEX "unique_schema_migrations" ON "schema_migrations" ("version")
  [1m[36m (0.2ms)[0m  [1mSELECT version FROM "schema_migrations"[0m
  [1m[35m (0.4ms)[0m  INSERT INTO "schema_migrations" (version) VALUES ('20120528102124')
  [1m[36m (0.2ms)[0m  [1mBEGIN[0m
  [1m[35m (0.3ms)[0m  ROLLBACK
  [1m[36m (0.1ms)[0m  [1mBEGIN[0m
  [1m[35m (0.0ms)[0m  ROLLBACK
Connecting to database specified by database.yml
  [1m[36mFieldGroup Load (0.9ms)[0m  [1mSELECT "field_groups".* FROM "field_groups" WHERE "field_groups"."klass_name" = 'Account' ORDER BY position[0m
  [1m[35mFieldGroup Load (0.3ms)[0m  SELECT "field_groups".* FROM "field_groups" WHERE "field_groups"."klass_name" = 'Campaign' ORDER BY position
  [1m[36mFieldGroup Load (0.3ms)[0m  [1mSELECT "field_groups".* FROM "field_groups" WHERE "field_groups"."klass_name" = 'Contact' ORDER BY position[0m
  [1m[35mFieldGroup Load (0.3ms)[0m  SELECT "field_groups".* FROM "field_groups" WHERE "field_groups"."klass_name" = 'Lead' ORDER BY position
  [1m[36mFieldGroup Load (0.3ms)[0m  [1mSELECT "field_groups".* FROM "field_groups" WHERE "field_groups"."klass_name" = 'Opportunity' ORDER BY position[0m
  [1m[35mFieldGroup Load (0.4ms)[0m  SELECT "field_groups".* FROM "field_groups" WHERE "field_groups"."klass_name" = 'Task' ORDER BY position
Creating scope :except. Overwriting existing method User.except.
  [1m[36m (121.5ms)[0m  [1mDROP DATABASE IF EXISTS "ffcrm_vend_test"[0m
  [1m[35m (241.3ms)[0m  CREATE DATABASE "ffcrm_vend_test" ENCODING = 'utf8'
  [1m[36m (5.8ms)[0m  [1mCREATE TABLE "account_contacts" ("id" serial primary key, "account_id" integer, "contact_id" integer, "deleted_at" timestamp, "created_at" timestamp NOT NULL, "updated_at" timestamp NOT NULL) [0m
  [1m[35m (2.3ms)[0m  CREATE TABLE "account_opportunities" ("id" serial primary key, "account_id" integer, "opportunity_id" integer, "deleted_at" timestamp, "created_at" timestamp NOT NULL, "updated_at" timestamp NOT NULL) 
  [1m[36m (3.8ms)[0m  [1mCREATE TABLE "accounts" ("id" serial primary key, "user_id" integer, "assigned_to" integer, "name" character varying(64) DEFAULT '' NOT NULL, "access" character varying(8) DEFAULT 'Public', "website" character varying(64), "toll_free_phone" character varying(32), "phone" character varying(32), "fax" character varying(32), "deleted_at" timestamp, "created_at" timestamp NOT NULL, "updated_at" timestamp NOT NULL, "email" character varying(64), "background_info" character varying(255), "rating" integer DEFAULT 0 NOT NULL, "category" character varying(32), "subscribed_users" text) [0m
  [1m[35m (11.8ms)[0m  CREATE INDEX "index_accounts_on_assigned_to" ON "accounts" ("assigned_to")
  [1m[36m (2.3ms)[0m  [1mCREATE UNIQUE INDEX "index_accounts_on_user_id_and_name_and_deleted_at" ON "accounts" ("user_id", "name", "deleted_at")[0m
  [1m[35m (3.5ms)[0m  CREATE TABLE "activities" ("id" serial primary key, "user_id" integer, "subject_id" integer, "subject_type" character varying(255), "action" character varying(32) DEFAULT 'created', "info" character varying(255) DEFAULT '', "private" boolean DEFAULT 'f', "created_at" timestamp NOT NULL, "updated_at" timestamp NOT NULL) 
  [1m[36m (0.8ms)[0m  [1mCREATE INDEX "index_activities_on_created_at" ON "activities" ("created_at")[0m
  [1m[35m (0.9ms)[0m  CREATE INDEX "index_activities_on_user_id" ON "activities" ("user_id")
  [1m[36m (3.2ms)[0m  [1mCREATE TABLE "addresses" ("id" serial primary key, "street1" character varying(255), "street2" character varying(255), "city" character varying(64), "state" character varying(64), "zipcode" character varying(16), "country" character varying(64), "full_address" character varying(255), "address_type" character varying(16), "addressable_id" integer, "addressable_type" character varying(255), "created_at" timestamp NOT NULL, "updated_at" timestamp NOT NULL, "deleted_at" timestamp) [0m
  [1m[35m (1.1ms)[0m  CREATE INDEX "index_addresses_on_addressable_id_and_addressable_type" ON "addresses" ("addressable_id", "addressable_type")
  [1m[36m (3.1ms)[0m  [1mCREATE TABLE "avatars" ("id" serial primary key, "user_id" integer, "entity_id" integer, "entity_type" character varying(255), "image_file_size" integer, "image_file_name" character varying(255), "image_content_type" character varying(255), "created_at" timestamp NOT NULL, "updated_at" timestamp NOT NULL) [0m
  [1m[35m (3.7ms)[0m  CREATE TABLE "campaigns" ("id" serial primary key, "user_id" integer, "assigned_to" integer, "name" character varying(64) DEFAULT '' NOT NULL, "access" character varying(8) DEFAULT 'Public', "status" character varying(64), "budget" decimal(12,2), "target_leads" integer, "target_conversion" float, "target_revenue" decimal(12,2), "leads_count" integer, "opportunities_count" integer, "revenue" decimal(12,2), "starts_on" date, "ends_on" date, "objectives" text, "deleted_at" timestamp, "created_at" timestamp NOT NULL, "updated_at" timestamp NOT NULL, "background_info" character varying(255), "subscribed_users" text) 
  [1m[36m (1.1ms)[0m  [1mCREATE INDEX "index_campaigns_on_assigned_to" ON "campaigns" ("assigned_to")[0m
  [1m[35m (1.0ms)[0m  CREATE UNIQUE INDEX "index_campaigns_on_user_id_and_name_and_deleted_at" ON "campaigns" ("user_id", "name", "deleted_at")
  [1m[36m (4.0ms)[0m  [1mCREATE TABLE "comments" ("id" serial primary key, "user_id" integer, "commentable_id" integer, "commentable_type" character varying(255), "private" boolean, "title" character varying(255) DEFAULT '', "comment" text, "created_at" timestamp NOT NULL, "updated_at" timestamp NOT NULL, "state" character varying(16) DEFAULT 'Expanded' NOT NULL) [0m
  [1m[35m (2.4ms)[0m  CREATE TABLE "contact_opportunities" ("id" serial primary key, "contact_id" integer, "opportunity_id" integer, "role" character varying(32), "deleted_at" timestamp, "created_at" timestamp NOT NULL, "updated_at" timestamp NOT NULL) 
  [1m[36m (4.2ms)[0m  [1mCREATE TABLE "contacts" ("id" serial primary key, "user_id" integer, "lead_id" integer, "assigned_to" integer, "reports_to" integer, "first_name" character varying(64) DEFAULT '' NOT NULL, "last_name" character varying(64) DEFAULT '' NOT NULL, "access" character varying(8) DEFAULT 'Public', "title" character varying(64), "department" character varying(64), "source" character varying(32), "email" character varying(64), "alt_email" character varying(64), "phone" character varying(32), "mobile" character varying(32), "fax" character varying(32), "blog" character varying(128), "linkedin" character varying(128), "facebook" character varying(128), "twitter" character varying(128), "born_on" date, "do_not_call" boolean DEFAULT 'f' NOT NULL, "deleted_at" timestamp, "created_at" timestamp NOT NULL, "updated_at" timestamp NOT NULL, "background_info" character varying(255), "skype" character varying(128), "subscribed_users" text) [0m
  [1m[35m (0.9ms)[0m  CREATE INDEX "index_contacts_on_assigned_to" ON "contacts" ("assigned_to")
  [1m[36m (1.0ms)[0m  [1mCREATE UNIQUE INDEX "id_last_name_deleted" ON "contacts" ("user_id", "last_name", "deleted_at")[0m
  [1m[35m (3.2ms)[0m  CREATE TABLE "emails" ("id" serial primary key, "imap_message_id" character varying(255) NOT NULL, "user_id" integer, "mediator_id" integer, "mediator_type" character varying(255), "sent_from" character varying(255) NOT NULL, "sent_to" character varying(255) NOT NULL, "cc" character varying(255), "bcc" character varying(255), "subject" character varying(255), "body" text, "header" text, "sent_at" timestamp, "received_at" timestamp, "deleted_at" timestamp, "created_at" timestamp NOT NULL, "updated_at" timestamp NOT NULL, "state" character varying(16) DEFAULT 'Expanded' NOT NULL) 
  [1m[36m (1.1ms)[0m  [1mCREATE INDEX "index_emails_on_mediator_id_and_mediator_type" ON "emails" ("mediator_id", "mediator_type")[0m
  [1m[35m (2.6ms)[0m  CREATE TABLE "field_groups" ("id" serial primary key, "name" character varying(64), "label" character varying(128), "position" integer, "hint" character varying(255), "created_at" timestamp NOT NULL, "updated_at" timestamp NOT NULL, "tag_id" integer, "klass_name" character varying(32)) 
  [1m[36m (3.2ms)[0m  [1mCREATE TABLE "fields" ("id" serial primary key, "type" character varying(255), "field_group_id" integer, "position" integer, "name" character varying(64), "label" character varying(128), "hint" character varying(255), "placeholder" character varying(255), "as" character varying(32), "collection" text, "disabled" boolean, "required" boolean, "maxlength" integer, "created_at" timestamp NOT NULL, "updated_at" timestamp NOT NULL) [0m
  [1m[35m (1.0ms)[0m  CREATE INDEX "index_fields_on_field_group_id" ON "fields" ("field_group_id")
  [1m[36m (1.0ms)[0m  [1mCREATE INDEX "index_fields_on_name" ON "fields" ("name")[0m
  [1m[35m (4.0ms)[0m  CREATE TABLE "leads" ("id" serial primary key, "user_id" integer, "campaign_id" integer, "assigned_to" integer, "first_name" character varying(64) DEFAULT '' NOT NULL, "last_name" character varying(64) DEFAULT '' NOT NULL, "access" character varying(8) DEFAULT 'Public', "title" character varying(64), "company" character varying(64), "source" character varying(32), "status" character varying(32), "referred_by" character varying(64), "email" character varying(64), "alt_email" character varying(64), "phone" character varying(32), "mobile" character varying(32), "blog" character varying(128), "linkedin" character varying(128), "facebook" character varying(128), "twitter" character varying(128), "rating" integer DEFAULT 0 NOT NULL, "do_not_call" boolean DEFAULT 'f' NOT NULL, "deleted_at" timestamp, "created_at" timestamp NOT NULL, "updated_at" timestamp NOT NULL, "background_info" character varying(255), "skype" character varying(128), "subscribed_users" text) 
  [1m[36m (1.2ms)[0m  [1mCREATE INDEX "index_leads_on_assigned_to" ON "leads" ("assigned_to")[0m
  [1m[35m (1.1ms)[0m  CREATE UNIQUE INDEX "index_leads_on_user_id_and_last_name_and_deleted_at" ON "leads" ("user_id", "last_name", "deleted_at")
  [1m[36m (2.9ms)[0m  [1mCREATE TABLE "lists" ("id" serial primary key, "name" character varying(255), "url" text, "created_at" timestamp NOT NULL, "updated_at" timestamp NOT NULL) [0m
  [1m[35m (4.2ms)[0m  CREATE TABLE "opportunities" ("id" serial primary key, "user_id" integer, "campaign_id" integer, "assigned_to" integer, "name" character varying(64) DEFAULT '' NOT NULL, "access" character varying(8) DEFAULT 'Public', "source" character varying(32), "stage" character varying(32), "probability" integer, "amount" decimal(12,2), "discount" decimal(12,2), "closes_on" date, "deleted_at" timestamp, "created_at" timestamp NOT NULL, "updated_at" timestamp NOT NULL, "background_info" character varying(255), "subscribed_users" text) 
  [1m[36m (1.0ms)[0m  [1mCREATE INDEX "index_opportunities_on_assigned_to" ON "opportunities" ("assigned_to")[0m
  [1m[35m (1.0ms)[0m  CREATE UNIQUE INDEX "id_name_deleted" ON "opportunities" ("user_id", "name", "deleted_at")
  [1m[36m (2.2ms)[0m  [1mCREATE TABLE "permissions" ("id" serial primary key, "user_id" integer, "asset_id" integer, "asset_type" character varying(255), "created_at" timestamp NOT NULL, "updated_at" timestamp NOT NULL) [0m
  [1m[35m (1.1ms)[0m  CREATE INDEX "index_permissions_on_asset_id_and_asset_type" ON "permissions" ("asset_id", "asset_type")
  [1m[36m (0.8ms)[0m  [1mCREATE INDEX "index_permissions_on_user_id" ON "permissions" ("user_id")[0m
  [1m[35m (3.2ms)[0m  CREATE TABLE "preferences" ("id" serial primary key, "user_id" integer, "name" character varying(32) DEFAULT '' NOT NULL, "value" text, "created_at" timestamp NOT NULL, "updated_at" timestamp NOT NULL) 
  [1m[36m (1.0ms)[0m  [1mCREATE INDEX "index_preferences_on_user_id_and_name" ON "preferences" ("user_id", "name")[0m
  [1m[35m (2.9ms)[0m  CREATE TABLE "sessions" ("id" serial primary key, "session_id" character varying(255) NOT NULL, "data" text, "created_at" timestamp NOT NULL, "updated_at" timestamp NOT NULL) 
  [1m[36m (1.0ms)[0m  [1mCREATE INDEX "index_sessions_on_session_id" ON "sessions" ("session_id")[0m
  [1m[35m (0.9ms)[0m  CREATE INDEX "index_sessions_on_updated_at" ON "sessions" ("updated_at")
  [1m[36m (3.7ms)[0m  [1mCREATE TABLE "settings" ("id" serial primary key, "name" character varying(32) DEFAULT '' NOT NULL, "value" text, "created_at" timestamp NOT NULL, "updated_at" timestamp NOT NULL) [0m
  [1m[35m (1.3ms)[0m  CREATE INDEX "index_settings_on_name" ON "settings" ("name")
  [1m[36m (3.5ms)[0m  [1mCREATE TABLE "taggings" ("id" serial primary key, "tag_id" integer, "taggable_id" integer, "tagger_id" integer, "tagger_type" character varying(255), "taggable_type" character varying(255), "context" character varying(255), "created_at" timestamp) [0m
  [1m[35m (1.1ms)[0m  CREATE INDEX "index_taggings_on_tag_id" ON "taggings" ("tag_id")
  [1m[36m (1.1ms)[0m  [1mCREATE INDEX "index_taggings_on_taggable_id_and_taggable_type_and_context" ON "taggings" ("taggable_id", "taggable_type", "context")[0m
  [1m[35m (2.1ms)[0m  CREATE TABLE "tags" ("id" serial primary key, "name" character varying(255)) 
  [1m[36m (3.7ms)[0m  [1mCREATE TABLE "tasks" ("id" serial primary key, "user_id" integer, "assigned_to" integer, "completed_by" integer, "name" character varying(255) DEFAULT '' NOT NULL, "asset_id" integer, "asset_type" character varying(255), "priority" character varying(32), "category" character varying(32), "bucket" character varying(32), "due_at" timestamp, "completed_at" timestamp, "deleted_at" timestamp, "created_at" timestamp NOT NULL, "updated_at" timestamp NOT NULL, "background_info" character varying(255), "subscribed_users" text) [0m
  [1m[35m (0.9ms)[0m  CREATE INDEX "index_tasks_on_assigned_to" ON "tasks" ("assigned_to")
  [1m[36m (1.1ms)[0m  [1mCREATE UNIQUE INDEX "index_tasks_on_user_id_and_name_and_deleted_at" ON "tasks" ("user_id", "name", "deleted_at")[0m
  [1m[35m (5.6ms)[0m  CREATE TABLE "users" ("id" serial primary key, "username" character varying(32) DEFAULT '' NOT NULL, "email" character varying(64) DEFAULT '' NOT NULL, "first_name" character varying(32), "last_name" character varying(32), "title" character varying(64), "company" character varying(64), "alt_email" character varying(64), "phone" character varying(32), "mobile" character varying(32), "aim" character varying(32), "yahoo" character varying(32), "google" character varying(32), "skype" character varying(32), "password_hash" character varying(255) DEFAULT '' NOT NULL, "password_salt" character varying(255) DEFAULT '' NOT NULL, "persistence_token" character varying(255) DEFAULT '' NOT NULL, "perishable_token" character varying(255) DEFAULT '' NOT NULL, "last_request_at" timestamp, "last_login_at" timestamp, "current_login_at" timestamp, "last_login_ip" character varying(255), "current_login_ip" character varying(255), "login_count" integer DEFAULT 0 NOT NULL, "deleted_at" timestamp, "created_at" timestamp NOT NULL, "updated_at" timestamp NOT NULL, "admin" boolean DEFAULT 'f' NOT NULL, "suspended_at" timestamp, "single_access_token" character varying(255)) 
  [1m[36m (1.0ms)[0m  [1mCREATE INDEX "index_users_on_email" ON "users" ("email")[0m
  [1m[35m (1.0ms)[0m  CREATE INDEX "index_users_on_last_request_at" ON "users" ("last_request_at")
  [1m[36m (0.9ms)[0m  [1mCREATE INDEX "index_users_on_perishable_token" ON "users" ("perishable_token")[0m
  [1m[35m (0.9ms)[0m  CREATE INDEX "index_users_on_remember_token" ON "users" ("persistence_token")
  [1m[36m (1.3ms)[0m  [1mCREATE UNIQUE INDEX "index_users_on_username_and_deleted_at" ON "users" ("username", "deleted_at")[0m
  [1m[35m (22.7ms)[0m  CREATE TABLE "versions" ("id" serial primary key, "item_type" character varying(255) NOT NULL, "item_id" integer NOT NULL, "event" character varying(512) NOT NULL, "whodunnit" character varying(255), "object" text, "created_at" timestamp, "object_changes" text, "related_id" integer, "related_type" character varying(255)) 
  [1m[36m (1.2ms)[0m  [1mCREATE INDEX "index_versions_on_item_type_and_item_id" ON "versions" ("item_type", "item_id")[0m
  [1m[35m (1.0ms)[0m  CREATE INDEX "index_versions_on_whodunnit" ON "versions" ("whodunnit")
  [1m[36m (0.7ms)[0m  [1mCREATE TABLE "schema_migrations" ("version" character varying(255) NOT NULL) [0m
  [1m[35m (1.0ms)[0m  CREATE UNIQUE INDEX "unique_schema_migrations" ON "schema_migrations" ("version")
  [1m[36m (0.2ms)[0m  [1mSELECT version FROM "schema_migrations"[0m
  [1m[35m (0.4ms)[0m  INSERT INTO "schema_migrations" (version) VALUES ('20120528102124')
  [1m[36m (0.2ms)[0m  [1mBEGIN[0m
Started POST "/vend/register_sale" for 127.0.0.1 at 2013-03-06 23:35:01 +1300
Processing by VendController#register_sale as JSON
  Parameters: {"payload"=>{"id"=>"5e8b5134-a002-dd6b-b7c7-26126887c4ee", "sale_date"=>"2012-11-13 16:40:06", "status"=>"CLOSED", "user_id"=>"9b2a8d5f-2d20-11e2-8057-080027706aa2", "customer_id"=>"9b17ac9d-2d20-11e2-8057-080027706aa2", "register_id"=>"9af85e69-2d20-11e2-8057-080027706aa2", "market_id"=>"1", "invoice_number"=>"144", "short_code"=>"ne2zq", "totals"=>{"total_price"=>"4.87", "total_tax"=>"0.69", "total_payment"=>"5.55", "total_to_pay"=>"0"}, "note"=>nil, "updated_at"=>"2012-11-13 16:40:09", "created_at"=>"2012-11-13 16:40:09", "customer"=>{"id"=>"9b17ac9d-2d20-11e2-8057-080027706aa2", "customer_code"=>"WALKIN", "balance"=>"-6.250", "points"=>"0", "note"=>nil, "year_to_date"=>"79945.92188", "sex"=>"M", "date_of_birth"=>"1950-05-25", "updated_at"=>"2012-11-13 16:43:15", "created_at"=>"2012-11-13 12:28:03"}, "user"=>{"id"=>"9b2a8d5f-2d20-11e2-8057-080027706aa2", "name"=>"admin", "display_name"=>"A admin this time", "outlet_id"=>"9ae97219-2d20-11e2-8057-080027706aa2", "target_daily"=>nil, "target_weekly"=>nil, "target_monthly"=>nil, "created_at"=>"2011-09-08 05:18:38", "updated_at"=>"2011-09-08 05:18:38"}, "register_sale_products"=>[{"id"=>"148793f0-475a-7d49-442d-fd761ce76339", "product_id"=>"9fe945bc-2d20-11e2-8057-080027706aa2", "quantity"=>"1", "price"=>"1.90", "price_set"=>"true", "tax"=>"0.24", "price_total"=>"1.9", "tax_total"=>"0.24", "tax_id"=>"9a025ff0-2d20-11e2-8057-080027706aa2", "tax_name"=>"NZ GST", "tax_rate"=>"0.150000"}, {"id"=>"7d37dc0f-9462-06fa-cae0-0b4988b36539", "product_id"=>"a0c0df02-2d20-11e2-8057-080027706aa2", "quantity"=>"3", "price"=>"0.99", "price_set"=>"true", "tax"=>"0.15", "price_total"=>"2.97", "tax_total"=>"0.45", "tax_id"=>"9a025ff0-2d20-11e2-8057-080027706aa2", "tax_name"=>"NZ GST", "tax_rate"=>"0.150000"}], "register_sale_payments"=>[{"id"=>"39948e3e-bf93-1b60-ff44-f46a777ed1d4", "payment_date"=>"2012-11-13 16:40:06", "amount"=>"5.55", "retailer_payment_type_id"=>"9e9ba1ba-2d20-11e2-8057-080027706aa2", "payment_type_id"=>"1"}]}}
Completed 500 Internal Server Error in 1ms
  [1m[35m (0.3ms)[0m  ROLLBACK
  [1m[36m (0.1ms)[0m  [1mBEGIN[0m
  [1m[35m (0.1ms)[0m  ROLLBACK
Connecting to database specified by database.yml
  [1m[36mFieldGroup Load (0.9ms)[0m  [1mSELECT "field_groups".* FROM "field_groups" WHERE "field_groups"."klass_name" = 'Account' ORDER BY position[0m
  [1m[35mFieldGroup Load (0.3ms)[0m  SELECT "field_groups".* FROM "field_groups" WHERE "field_groups"."klass_name" = 'Campaign' ORDER BY position
  [1m[36mFieldGroup Load (0.3ms)[0m  [1mSELECT "field_groups".* FROM "field_groups" WHERE "field_groups"."klass_name" = 'Contact' ORDER BY position[0m
  [1m[35mFieldGroup Load (0.3ms)[0m  SELECT "field_groups".* FROM "field_groups" WHERE "field_groups"."klass_name" = 'Lead' ORDER BY position
  [1m[36mFieldGroup Load (0.3ms)[0m  [1mSELECT "field_groups".* FROM "field_groups" WHERE "field_groups"."klass_name" = 'Opportunity' ORDER BY position[0m
  [1m[35mFieldGroup Load (0.3ms)[0m  SELECT "field_groups".* FROM "field_groups" WHERE "field_groups"."klass_name" = 'Task' ORDER BY position
Creating scope :except. Overwriting existing method User.except.
  [1m[36m (124.7ms)[0m  [1mDROP DATABASE IF EXISTS "ffcrm_vend_test"[0m
  [1m[35m (244.5ms)[0m  CREATE DATABASE "ffcrm_vend_test" ENCODING = 'utf8'
  [1m[36m (12.6ms)[0m  [1mCREATE TABLE "account_contacts" ("id" serial primary key, "account_id" integer, "contact_id" integer, "deleted_at" timestamp, "created_at" timestamp NOT NULL, "updated_at" timestamp NOT NULL) [0m
  [1m[35m (2.3ms)[0m  CREATE TABLE "account_opportunities" ("id" serial primary key, "account_id" integer, "opportunity_id" integer, "deleted_at" timestamp, "created_at" timestamp NOT NULL, "updated_at" timestamp NOT NULL) 
  [1m[36m (4.2ms)[0m  [1mCREATE TABLE "accounts" ("id" serial primary key, "user_id" integer, "assigned_to" integer, "name" character varying(64) DEFAULT '' NOT NULL, "access" character varying(8) DEFAULT 'Public', "website" character varying(64), "toll_free_phone" character varying(32), "phone" character varying(32), "fax" character varying(32), "deleted_at" timestamp, "created_at" timestamp NOT NULL, "updated_at" timestamp NOT NULL, "email" character varying(64), "background_info" character varying(255), "rating" integer DEFAULT 0 NOT NULL, "category" character varying(32), "subscribed_users" text) [0m
  [1m[35m (1.2ms)[0m  CREATE INDEX "index_accounts_on_assigned_to" ON "accounts" ("assigned_to")
  [1m[36m (1.4ms)[0m  [1mCREATE UNIQUE INDEX "index_accounts_on_user_id_and_name_and_deleted_at" ON "accounts" ("user_id", "name", "deleted_at")[0m
  [1m[35m (3.7ms)[0m  CREATE TABLE "activities" ("id" serial primary key, "user_id" integer, "subject_id" integer, "subject_type" character varying(255), "action" character varying(32) DEFAULT 'created', "info" character varying(255) DEFAULT '', "private" boolean DEFAULT 'f', "created_at" timestamp NOT NULL, "updated_at" timestamp NOT NULL) 
  [1m[36m (1.0ms)[0m  [1mCREATE INDEX "index_activities_on_created_at" ON "activities" ("created_at")[0m
  [1m[35m (1.0ms)[0m  CREATE INDEX "index_activities_on_user_id" ON "activities" ("user_id")
  [1m[36m (3.9ms)[0m  [1mCREATE TABLE "addresses" ("id" serial primary key, "street1" character varying(255), "street2" character varying(255), "city" character varying(64), "state" character varying(64), "zipcode" character varying(16), "country" character varying(64), "full_address" character varying(255), "address_type" character varying(16), "addressable_id" integer, "addressable_type" character varying(255), "created_at" timestamp NOT NULL, "updated_at" timestamp NOT NULL, "deleted_at" timestamp) [0m
  [1m[35m (1.0ms)[0m  CREATE INDEX "index_addresses_on_addressable_id_and_addressable_type" ON "addresses" ("addressable_id", "addressable_type")
  [1m[36m (3.4ms)[0m  [1mCREATE TABLE "avatars" ("id" serial primary key, "user_id" integer, "entity_id" integer, "entity_type" character varying(255), "image_file_size" integer, "image_file_name" character varying(255), "image_content_type" character varying(255), "created_at" timestamp NOT NULL, "updated_at" timestamp NOT NULL) [0m
  [1m[35m (3.7ms)[0m  CREATE TABLE "campaigns" ("id" serial primary key, "user_id" integer, "assigned_to" integer, "name" character varying(64) DEFAULT '' NOT NULL, "access" character varying(8) DEFAULT 'Public', "status" character varying(64), "budget" decimal(12,2), "target_leads" integer, "target_conversion" float, "target_revenue" decimal(12,2), "leads_count" integer, "opportunities_count" integer, "revenue" decimal(12,2), "starts_on" date, "ends_on" date, "objectives" text, "deleted_at" timestamp, "created_at" timestamp NOT NULL, "updated_at" timestamp NOT NULL, "background_info" character varying(255), "subscribed_users" text) 
  [1m[36m (0.9ms)[0m  [1mCREATE INDEX "index_campaigns_on_assigned_to" ON "campaigns" ("assigned_to")[0m
  [1m[35m (1.0ms)[0m  CREATE UNIQUE INDEX "index_campaigns_on_user_id_and_name_and_deleted_at" ON "campaigns" ("user_id", "name", "deleted_at")
  [1m[36m (3.5ms)[0m  [1mCREATE TABLE "comments" ("id" serial primary key, "user_id" integer, "commentable_id" integer, "commentable_type" character varying(255), "private" boolean, "title" character varying(255) DEFAULT '', "comment" text, "created_at" timestamp NOT NULL, "updated_at" timestamp NOT NULL, "state" character varying(16) DEFAULT 'Expanded' NOT NULL) [0m
  [1m[35m (2.3ms)[0m  CREATE TABLE "contact_opportunities" ("id" serial primary key, "contact_id" integer, "opportunity_id" integer, "role" character varying(32), "deleted_at" timestamp, "created_at" timestamp NOT NULL, "updated_at" timestamp NOT NULL) 
  [1m[36m (4.6ms)[0m  [1mCREATE TABLE "contacts" ("id" serial primary key, "user_id" integer, "lead_id" integer, "assigned_to" integer, "reports_to" integer, "first_name" character varying(64) DEFAULT '' NOT NULL, "last_name" character varying(64) DEFAULT '' NOT NULL, "access" character varying(8) DEFAULT 'Public', "title" character varying(64), "department" character varying(64), "source" character varying(32), "email" character varying(64), "alt_email" character varying(64), "phone" character varying(32), "mobile" character varying(32), "fax" character varying(32), "blog" character varying(128), "linkedin" character varying(128), "facebook" character varying(128), "twitter" character varying(128), "born_on" date, "do_not_call" boolean DEFAULT 'f' NOT NULL, "deleted_at" timestamp, "created_at" timestamp NOT NULL, "updated_at" timestamp NOT NULL, "background_info" character varying(255), "skype" character varying(128), "subscribed_users" text) [0m
  [1m[35m (0.9ms)[0m  CREATE INDEX "index_contacts_on_assigned_to" ON "contacts" ("assigned_to")
  [1m[36m (1.1ms)[0m  [1mCREATE UNIQUE INDEX "id_last_name_deleted" ON "contacts" ("user_id", "last_name", "deleted_at")[0m
  [1m[35m (3.9ms)[0m  CREATE TABLE "emails" ("id" serial primary key, "imap_message_id" character varying(255) NOT NULL, "user_id" integer, "mediator_id" integer, "mediator_type" character varying(255), "sent_from" character varying(255) NOT NULL, "sent_to" character varying(255) NOT NULL, "cc" character varying(255), "bcc" character varying(255), "subject" character varying(255), "body" text, "header" text, "sent_at" timestamp, "received_at" timestamp, "deleted_at" timestamp, "created_at" timestamp NOT NULL, "updated_at" timestamp NOT NULL, "state" character varying(16) DEFAULT 'Expanded' NOT NULL) 
  [1m[36m (1.0ms)[0m  [1mCREATE INDEX "index_emails_on_mediator_id_and_mediator_type" ON "emails" ("mediator_id", "mediator_type")[0m
  [1m[35m (2.3ms)[0m  CREATE TABLE "field_groups" ("id" serial primary key, "name" character varying(64), "label" character varying(128), "position" integer, "hint" character varying(255), "created_at" timestamp NOT NULL, "updated_at" timestamp NOT NULL, "tag_id" integer, "klass_name" character varying(32)) 
  [1m[36m (3.3ms)[0m  [1mCREATE TABLE "fields" ("id" serial primary key, "type" character varying(255), "field_group_id" integer, "position" integer, "name" character varying(64), "label" character varying(128), "hint" character varying(255), "placeholder" character varying(255), "as" character varying(32), "collection" text, "disabled" boolean, "required" boolean, "maxlength" integer, "created_at" timestamp NOT NULL, "updated_at" timestamp NOT NULL) [0m
  [1m[35m (1.1ms)[0m  CREATE INDEX "index_fields_on_field_group_id" ON "fields" ("field_group_id")
  [1m[36m (0.9ms)[0m  [1mCREATE INDEX "index_fields_on_name" ON "fields" ("name")[0m
  [1m[35m (4.1ms)[0m  CREATE TABLE "leads" ("id" serial primary key, "user_id" integer, "campaign_id" integer, "assigned_to" integer, "first_name" character varying(64) DEFAULT '' NOT NULL, "last_name" character varying(64) DEFAULT '' NOT NULL, "access" character varying(8) DEFAULT 'Public', "title" character varying(64), "company" character varying(64), "source" character varying(32), "status" character varying(32), "referred_by" character varying(64), "email" character varying(64), "alt_email" character varying(64), "phone" character varying(32), "mobile" character varying(32), "blog" character varying(128), "linkedin" character varying(128), "facebook" character varying(128), "twitter" character varying(128), "rating" integer DEFAULT 0 NOT NULL, "do_not_call" boolean DEFAULT 'f' NOT NULL, "deleted_at" timestamp, "created_at" timestamp NOT NULL, "updated_at" timestamp NOT NULL, "background_info" character varying(255), "skype" character varying(128), "subscribed_users" text) 
  [1m[36m (1.0ms)[0m  [1mCREATE INDEX "index_leads_on_assigned_to" ON "leads" ("assigned_to")[0m
  [1m[35m (0.9ms)[0m  CREATE UNIQUE INDEX "index_leads_on_user_id_and_last_name_and_deleted_at" ON "leads" ("user_id", "last_name", "deleted_at")
  [1m[36m (3.0ms)[0m  [1mCREATE TABLE "lists" ("id" serial primary key, "name" character varying(255), "url" text, "created_at" timestamp NOT NULL, "updated_at" timestamp NOT NULL) [0m
  [1m[35m (3.4ms)[0m  CREATE TABLE "opportunities" ("id" serial primary key, "user_id" integer, "campaign_id" integer, "assigned_to" integer, "name" character varying(64) DEFAULT '' NOT NULL, "access" character varying(8) DEFAULT 'Public', "source" character varying(32), "stage" character varying(32), "probability" integer, "amount" decimal(12,2), "discount" decimal(12,2), "closes_on" date, "deleted_at" timestamp, "created_at" timestamp NOT NULL, "updated_at" timestamp NOT NULL, "background_info" character varying(255), "subscribed_users" text) 
  [1m[36m (1.0ms)[0m  [1mCREATE INDEX "index_opportunities_on_assigned_to" ON "opportunities" ("assigned_to")[0m
  [1m[35m (1.1ms)[0m  CREATE UNIQUE INDEX "id_name_deleted" ON "opportunities" ("user_id", "name", "deleted_at")
  [1m[36m (2.9ms)[0m  [1mCREATE TABLE "permissions" ("id" serial primary key, "user_id" integer, "asset_id" integer, "asset_type" character varying(255), "created_at" timestamp NOT NULL, "updated_at" timestamp NOT NULL) [0m
  [1m[35m (1.0ms)[0m  CREATE INDEX "index_permissions_on_asset_id_and_asset_type" ON "permissions" ("asset_id", "asset_type")
  [1m[36m (0.8ms)[0m  [1mCREATE INDEX "index_permissions_on_user_id" ON "permissions" ("user_id")[0m
  [1m[35m (3.1ms)[0m  CREATE TABLE "preferences" ("id" serial primary key, "user_id" integer, "name" character varying(32) DEFAULT '' NOT NULL, "value" text, "created_at" timestamp NOT NULL, "updated_at" timestamp NOT NULL) 
  [1m[36m (1.1ms)[0m  [1mCREATE INDEX "index_preferences_on_user_id_and_name" ON "preferences" ("user_id", "name")[0m
  [1m[35m (2.9ms)[0m  CREATE TABLE "sessions" ("id" serial primary key, "session_id" character varying(255) NOT NULL, "data" text, "created_at" timestamp NOT NULL, "updated_at" timestamp NOT NULL) 
  [1m[36m (1.1ms)[0m  [1mCREATE INDEX "index_sessions_on_session_id" ON "sessions" ("session_id")[0m
  [1m[35m (1.0ms)[0m  CREATE INDEX "index_sessions_on_updated_at" ON "sessions" ("updated_at")
  [1m[36m (3.0ms)[0m  [1mCREATE TABLE "settings" ("id" serial primary key, "name" character varying(32) DEFAULT '' NOT NULL, "value" text, "created_at" timestamp NOT NULL, "updated_at" timestamp NOT NULL) [0m
  [1m[35m (0.9ms)[0m  CREATE INDEX "index_settings_on_name" ON "settings" ("name")
  [1m[36m (3.3ms)[0m  [1mCREATE TABLE "taggings" ("id" serial primary key, "tag_id" integer, "taggable_id" integer, "tagger_id" integer, "tagger_type" character varying(255), "taggable_type" character varying(255), "context" character varying(255), "created_at" timestamp) [0m
  [1m[35m (1.0ms)[0m  CREATE INDEX "index_taggings_on_tag_id" ON "taggings" ("tag_id")
  [1m[36m (1.0ms)[0m  [1mCREATE INDEX "index_taggings_on_taggable_id_and_taggable_type_and_context" ON "taggings" ("taggable_id", "taggable_type", "context")[0m
  [1m[35m (3.0ms)[0m  CREATE TABLE "tags" ("id" serial primary key, "name" character varying(255)) 
  [1m[36m (3.4ms)[0m  [1mCREATE TABLE "tasks" ("id" serial primary key, "user_id" integer, "assigned_to" integer, "completed_by" integer, "name" character varying(255) DEFAULT '' NOT NULL, "asset_id" integer, "asset_type" character varying(255), "priority" character varying(32), "category" character varying(32), "bucket" character varying(32), "due_at" timestamp, "completed_at" timestamp, "deleted_at" timestamp, "created_at" timestamp NOT NULL, "updated_at" timestamp NOT NULL, "background_info" character varying(255), "subscribed_users" text) [0m
  [1m[35m (1.0ms)[0m  CREATE INDEX "index_tasks_on_assigned_to" ON "tasks" ("assigned_to")
  [1m[36m (1.1ms)[0m  [1mCREATE UNIQUE INDEX "index_tasks_on_user_id_and_name_and_deleted_at" ON "tasks" ("user_id", "name", "deleted_at")[0m
  [1m[35m (4.4ms)[0m  CREATE TABLE "users" ("id" serial primary key, "username" character varying(32) DEFAULT '' NOT NULL, "email" character varying(64) DEFAULT '' NOT NULL, "first_name" character varying(32), "last_name" character varying(32), "title" character varying(64), "company" character varying(64), "alt_email" character varying(64), "phone" character varying(32), "mobile" character varying(32), "aim" character varying(32), "yahoo" character varying(32), "google" character varying(32), "skype" character varying(32), "password_hash" character varying(255) DEFAULT '' NOT NULL, "password_salt" character varying(255) DEFAULT '' NOT NULL, "persistence_token" character varying(255) DEFAULT '' NOT NULL, "perishable_token" character varying(255) DEFAULT '' NOT NULL, "last_request_at" timestamp, "last_login_at" timestamp, "current_login_at" timestamp, "last_login_ip" character varying(255), "current_login_ip" character varying(255), "login_count" integer DEFAULT 0 NOT NULL, "deleted_at" timestamp, "created_at" timestamp NOT NULL, "updated_at" timestamp NOT NULL, "admin" boolean DEFAULT 'f' NOT NULL, "suspended_at" timestamp, "single_access_token" character varying(255)) 
  [1m[36m (1.0ms)[0m  [1mCREATE INDEX "index_users_on_email" ON "users" ("email")[0m
  [1m[35m (12.2ms)[0m  CREATE INDEX "index_users_on_last_request_at" ON "users" ("last_request_at")
  [1m[36m (8.1ms)[0m  [1mCREATE INDEX "index_users_on_perishable_token" ON "users" ("perishable_token")[0m
  [1m[35m (1.6ms)[0m  CREATE INDEX "index_users_on_remember_token" ON "users" ("persistence_token")
  [1m[36m (1.1ms)[0m  [1mCREATE UNIQUE INDEX "index_users_on_username_and_deleted_at" ON "users" ("username", "deleted_at")[0m
  [1m[35m (3.2ms)[0m  CREATE TABLE "versions" ("id" serial primary key, "item_type" character varying(255) NOT NULL, "item_id" integer NOT NULL, "event" character varying(512) NOT NULL, "whodunnit" character varying(255), "object" text, "created_at" timestamp, "object_changes" text, "related_id" integer, "related_type" character varying(255)) 
  [1m[36m (0.9ms)[0m  [1mCREATE INDEX "index_versions_on_item_type_and_item_id" ON "versions" ("item_type", "item_id")[0m
  [1m[35m (0.9ms)[0m  CREATE INDEX "index_versions_on_whodunnit" ON "versions" ("whodunnit")
  [1m[36m (0.9ms)[0m  [1mCREATE TABLE "schema_migrations" ("version" character varying(255) NOT NULL) [0m
  [1m[35m (1.0ms)[0m  CREATE UNIQUE INDEX "unique_schema_migrations" ON "schema_migrations" ("version")
  [1m[36m (0.2ms)[0m  [1mSELECT version FROM "schema_migrations"[0m
  [1m[35m (8.4ms)[0m  INSERT INTO "schema_migrations" (version) VALUES ('20120528102124')
  [1m[36m (0.2ms)[0m  [1mBEGIN[0m
Started POST "/vend/register_sale" for 127.0.0.1 at 2013-03-06 23:38:58 +1300
Processing by VendController#register_sale as JSON
  Parameters: {"payload"=>{"id"=>"5e8b5134-a002-dd6b-b7c7-26126887c4ee", "sale_date"=>"2012-11-13 16:40:06", "status"=>"CLOSED", "user_id"=>"9b2a8d5f-2d20-11e2-8057-080027706aa2", "customer_id"=>"9b17ac9d-2d20-11e2-8057-080027706aa2", "register_id"=>"9af85e69-2d20-11e2-8057-080027706aa2", "market_id"=>"1", "invoice_number"=>"144", "short_code"=>"ne2zq", "totals"=>{"total_price"=>"4.87", "total_tax"=>"0.69", "total_payment"=>"5.55", "total_to_pay"=>"0"}, "note"=>nil, "updated_at"=>"2012-11-13 16:40:09", "created_at"=>"2012-11-13 16:40:09", "customer"=>{"id"=>"9b17ac9d-2d20-11e2-8057-080027706aa2", "customer_code"=>"WALKIN", "balance"=>"-6.250", "points"=>"0", "note"=>nil, "year_to_date"=>"79945.92188", "sex"=>"M", "date_of_birth"=>"1950-05-25", "updated_at"=>"2012-11-13 16:43:15", "created_at"=>"2012-11-13 12:28:03"}, "user"=>{"id"=>"9b2a8d5f-2d20-11e2-8057-080027706aa2", "name"=>"admin", "display_name"=>"A admin this time", "outlet_id"=>"9ae97219-2d20-11e2-8057-080027706aa2", "target_daily"=>nil, "target_weekly"=>nil, "target_monthly"=>nil, "created_at"=>"2011-09-08 05:18:38", "updated_at"=>"2011-09-08 05:18:38"}, "register_sale_products"=>[{"id"=>"148793f0-475a-7d49-442d-fd761ce76339", "product_id"=>"9fe945bc-2d20-11e2-8057-080027706aa2", "quantity"=>"1", "price"=>"1.90", "price_set"=>"true", "tax"=>"0.24", "price_total"=>"1.9", "tax_total"=>"0.24", "tax_id"=>"9a025ff0-2d20-11e2-8057-080027706aa2", "tax_name"=>"NZ GST", "tax_rate"=>"0.150000"}, {"id"=>"7d37dc0f-9462-06fa-cae0-0b4988b36539", "product_id"=>"a0c0df02-2d20-11e2-8057-080027706aa2", "quantity"=>"3", "price"=>"0.99", "price_set"=>"true", "tax"=>"0.15", "price_total"=>"2.97", "tax_total"=>"0.45", "tax_id"=>"9a025ff0-2d20-11e2-8057-080027706aa2", "tax_name"=>"NZ GST", "tax_rate"=>"0.150000"}], "register_sale_payments"=>[{"id"=>"39948e3e-bf93-1b60-ff44-f46a777ed1d4", "payment_date"=>"2012-11-13 16:40:06", "amount"=>"5.55", "retailer_payment_type_id"=>"9e9ba1ba-2d20-11e2-8057-080027706aa2", "payment_type_id"=>"1"}]}}
Completed 500 Internal Server Error in 268753ms
  [1m[35m (0.4ms)[0m  ROLLBACK
Connecting to database specified by database.yml
  [1m[36mFieldGroup Load (0.9ms)[0m  [1mSELECT "field_groups".* FROM "field_groups" WHERE "field_groups"."klass_name" = 'Account' ORDER BY position[0m
  [1m[35mFieldGroup Load (0.3ms)[0m  SELECT "field_groups".* FROM "field_groups" WHERE "field_groups"."klass_name" = 'Campaign' ORDER BY position
  [1m[36mFieldGroup Load (0.3ms)[0m  [1mSELECT "field_groups".* FROM "field_groups" WHERE "field_groups"."klass_name" = 'Contact' ORDER BY position[0m
  [1m[35mFieldGroup Load (0.3ms)[0m  SELECT "field_groups".* FROM "field_groups" WHERE "field_groups"."klass_name" = 'Lead' ORDER BY position
  [1m[36mFieldGroup Load (0.3ms)[0m  [1mSELECT "field_groups".* FROM "field_groups" WHERE "field_groups"."klass_name" = 'Opportunity' ORDER BY position[0m
  [1m[35mFieldGroup Load (0.3ms)[0m  SELECT "field_groups".* FROM "field_groups" WHERE "field_groups"."klass_name" = 'Task' ORDER BY position
Creating scope :except. Overwriting existing method User.except.
  [1m[36m (120.7ms)[0m  [1mDROP DATABASE IF EXISTS "ffcrm_vend_test"[0m
  [1m[35m (242.3ms)[0m  CREATE DATABASE "ffcrm_vend_test" ENCODING = 'utf8'
  [1m[36m (13.7ms)[0m  [1mCREATE TABLE "account_contacts" ("id" serial primary key, "account_id" integer, "contact_id" integer, "deleted_at" timestamp, "created_at" timestamp NOT NULL, "updated_at" timestamp NOT NULL) [0m
  [1m[35m (2.5ms)[0m  CREATE TABLE "account_opportunities" ("id" serial primary key, "account_id" integer, "opportunity_id" integer, "deleted_at" timestamp, "created_at" timestamp NOT NULL, "updated_at" timestamp NOT NULL) 
  [1m[36m (4.0ms)[0m  [1mCREATE TABLE "accounts" ("id" serial primary key, "user_id" integer, "assigned_to" integer, "name" character varying(64) DEFAULT '' NOT NULL, "access" character varying(8) DEFAULT 'Public', "website" character varying(64), "toll_free_phone" character varying(32), "phone" character varying(32), "fax" character varying(32), "deleted_at" timestamp, "created_at" timestamp NOT NULL, "updated_at" timestamp NOT NULL, "email" character varying(64), "background_info" character varying(255), "rating" integer DEFAULT 0 NOT NULL, "category" character varying(32), "subscribed_users" text) [0m
  [1m[35m (1.1ms)[0m  CREATE INDEX "index_accounts_on_assigned_to" ON "accounts" ("assigned_to")
  [1m[36m (1.6ms)[0m  [1mCREATE UNIQUE INDEX "index_accounts_on_user_id_and_name_and_deleted_at" ON "accounts" ("user_id", "name", "deleted_at")[0m
  [1m[35m (3.5ms)[0m  CREATE TABLE "activities" ("id" serial primary key, "user_id" integer, "subject_id" integer, "subject_type" character varying(255), "action" character varying(32) DEFAULT 'created', "info" character varying(255) DEFAULT '', "private" boolean DEFAULT 'f', "created_at" timestamp NOT NULL, "updated_at" timestamp NOT NULL) 
  [1m[36m (0.9ms)[0m  [1mCREATE INDEX "index_activities_on_created_at" ON "activities" ("created_at")[0m
  [1m[35m (0.9ms)[0m  CREATE INDEX "index_activities_on_user_id" ON "activities" ("user_id")
  [1m[36m (3.8ms)[0m  [1mCREATE TABLE "addresses" ("id" serial primary key, "street1" character varying(255), "street2" character varying(255), "city" character varying(64), "state" character varying(64), "zipcode" character varying(16), "country" character varying(64), "full_address" character varying(255), "address_type" character varying(16), "addressable_id" integer, "addressable_type" character varying(255), "created_at" timestamp NOT NULL, "updated_at" timestamp NOT NULL, "deleted_at" timestamp) [0m
  [1m[35m (1.2ms)[0m  CREATE INDEX "index_addresses_on_addressable_id_and_addressable_type" ON "addresses" ("addressable_id", "addressable_type")
  [1m[36m (3.2ms)[0m  [1mCREATE TABLE "avatars" ("id" serial primary key, "user_id" integer, "entity_id" integer, "entity_type" character varying(255), "image_file_size" integer, "image_file_name" character varying(255), "image_content_type" character varying(255), "created_at" timestamp NOT NULL, "updated_at" timestamp NOT NULL) [0m
  [1m[35m (3.7ms)[0m  CREATE TABLE "campaigns" ("id" serial primary key, "user_id" integer, "assigned_to" integer, "name" character varying(64) DEFAULT '' NOT NULL, "access" character varying(8) DEFAULT 'Public', "status" character varying(64), "budget" decimal(12,2), "target_leads" integer, "target_conversion" float, "target_revenue" decimal(12,2), "leads_count" integer, "opportunities_count" integer, "revenue" decimal(12,2), "starts_on" date, "ends_on" date, "objectives" text, "deleted_at" timestamp, "created_at" timestamp NOT NULL, "updated_at" timestamp NOT NULL, "background_info" character varying(255), "subscribed_users" text) 
  [1m[36m (1.0ms)[0m  [1mCREATE INDEX "index_campaigns_on_assigned_to" ON "campaigns" ("assigned_to")[0m
  [1m[35m (1.1ms)[0m  CREATE UNIQUE INDEX "index_campaigns_on_user_id_and_name_and_deleted_at" ON "campaigns" ("user_id", "name", "deleted_at")
  [1m[36m (3.3ms)[0m  [1mCREATE TABLE "comments" ("id" serial primary key, "user_id" integer, "commentable_id" integer, "commentable_type" character varying(255), "private" boolean, "title" character varying(255) DEFAULT '', "comment" text, "created_at" timestamp NOT NULL, "updated_at" timestamp NOT NULL, "state" character varying(16) DEFAULT 'Expanded' NOT NULL) [0m
  [1m[35m (2.3ms)[0m  CREATE TABLE "contact_opportunities" ("id" serial primary key, "contact_id" integer, "opportunity_id" integer, "role" character varying(32), "deleted_at" timestamp, "created_at" timestamp NOT NULL, "updated_at" timestamp NOT NULL) 
  [1m[36m (3.9ms)[0m  [1mCREATE TABLE "contacts" ("id" serial primary key, "user_id" integer, "lead_id" integer, "assigned_to" integer, "reports_to" integer, "first_name" character varying(64) DEFAULT '' NOT NULL, "last_name" character varying(64) DEFAULT '' NOT NULL, "access" character varying(8) DEFAULT 'Public', "title" character varying(64), "department" character varying(64), "source" character varying(32), "email" character varying(64), "alt_email" character varying(64), "phone" character varying(32), "mobile" character varying(32), "fax" character varying(32), "blog" character varying(128), "linkedin" character varying(128), "facebook" character varying(128), "twitter" character varying(128), "born_on" date, "do_not_call" boolean DEFAULT 'f' NOT NULL, "deleted_at" timestamp, "created_at" timestamp NOT NULL, "updated_at" timestamp NOT NULL, "background_info" character varying(255), "skype" character varying(128), "subscribed_users" text) [0m
  [1m[35m (0.8ms)[0m  CREATE INDEX "index_contacts_on_assigned_to" ON "contacts" ("assigned_to")
  [1m[36m (1.1ms)[0m  [1mCREATE UNIQUE INDEX "id_last_name_deleted" ON "contacts" ("user_id", "last_name", "deleted_at")[0m
  [1m[35m (3.9ms)[0m  CREATE TABLE "emails" ("id" serial primary key, "imap_message_id" character varying(255) NOT NULL, "user_id" integer, "mediator_id" integer, "mediator_type" character varying(255), "sent_from" character varying(255) NOT NULL, "sent_to" character varying(255) NOT NULL, "cc" character varying(255), "bcc" character varying(255), "subject" character varying(255), "body" text, "header" text, "sent_at" timestamp, "received_at" timestamp, "deleted_at" timestamp, "created_at" timestamp NOT NULL, "updated_at" timestamp NOT NULL, "state" character varying(16) DEFAULT 'Expanded' NOT NULL) 
  [1m[36m (1.0ms)[0m  [1mCREATE INDEX "index_emails_on_mediator_id_and_mediator_type" ON "emails" ("mediator_id", "mediator_type")[0m
  [1m[35m (2.3ms)[0m  CREATE TABLE "field_groups" ("id" serial primary key, "name" character varying(64), "label" character varying(128), "position" integer, "hint" character varying(255), "created_at" timestamp NOT NULL, "updated_at" timestamp NOT NULL, "tag_id" integer, "klass_name" character varying(32)) 
  [1m[36m (3.4ms)[0m  [1mCREATE TABLE "fields" ("id" serial primary key, "type" character varying(255), "field_group_id" integer, "position" integer, "name" character varying(64), "label" character varying(128), "hint" character varying(255), "placeholder" character varying(255), "as" character varying(32), "collection" text, "disabled" boolean, "required" boolean, "maxlength" integer, "created_at" timestamp NOT NULL, "updated_at" timestamp NOT NULL) [0m
  [1m[35m (1.0ms)[0m  CREATE INDEX "index_fields_on_field_group_id" ON "fields" ("field_group_id")
  [1m[36m (0.8ms)[0m  [1mCREATE INDEX "index_fields_on_name" ON "fields" ("name")[0m
  [1m[35m (4.5ms)[0m  CREATE TABLE "leads" ("id" serial primary key, "user_id" integer, "campaign_id" integer, "assigned_to" integer, "first_name" character varying(64) DEFAULT '' NOT NULL, "last_name" character varying(64) DEFAULT '' NOT NULL, "access" character varying(8) DEFAULT 'Public', "title" character varying(64), "company" character varying(64), "source" character varying(32), "status" character varying(32), "referred_by" character varying(64), "email" character varying(64), "alt_email" character varying(64), "phone" character varying(32), "mobile" character varying(32), "blog" character varying(128), "linkedin" character varying(128), "facebook" character varying(128), "twitter" character varying(128), "rating" integer DEFAULT 0 NOT NULL, "do_not_call" boolean DEFAULT 'f' NOT NULL, "deleted_at" timestamp, "created_at" timestamp NOT NULL, "updated_at" timestamp NOT NULL, "background_info" character varying(255), "skype" character varying(128), "subscribed_users" text) 
  [1m[36m (1.0ms)[0m  [1mCREATE INDEX "index_leads_on_assigned_to" ON "leads" ("assigned_to")[0m
  [1m[35m (1.2ms)[0m  CREATE UNIQUE INDEX "index_leads_on_user_id_and_last_name_and_deleted_at" ON "leads" ("user_id", "last_name", "deleted_at")
  [1m[36m (3.4ms)[0m  [1mCREATE TABLE "lists" ("id" serial primary key, "name" character varying(255), "url" text, "created_at" timestamp NOT NULL, "updated_at" timestamp NOT NULL) [0m
  [1m[35m (3.6ms)[0m  CREATE TABLE "opportunities" ("id" serial primary key, "user_id" integer, "campaign_id" integer, "assigned_to" integer, "name" character varying(64) DEFAULT '' NOT NULL, "access" character varying(8) DEFAULT 'Public', "source" character varying(32), "stage" character varying(32), "probability" integer, "amount" decimal(12,2), "discount" decimal(12,2), "closes_on" date, "deleted_at" timestamp, "created_at" timestamp NOT NULL, "updated_at" timestamp NOT NULL, "background_info" character varying(255), "subscribed_users" text) 
  [1m[36m (1.0ms)[0m  [1mCREATE INDEX "index_opportunities_on_assigned_to" ON "opportunities" ("assigned_to")[0m
  [1m[35m (1.2ms)[0m  CREATE UNIQUE INDEX "id_name_deleted" ON "opportunities" ("user_id", "name", "deleted_at")
  [1m[36m (2.3ms)[0m  [1mCREATE TABLE "permissions" ("id" serial primary key, "user_id" integer, "asset_id" integer, "asset_type" character varying(255), "created_at" timestamp NOT NULL, "updated_at" timestamp NOT NULL) [0m
  [1m[35m (1.0ms)[0m  CREATE INDEX "index_permissions_on_asset_id_and_asset_type" ON "permissions" ("asset_id", "asset_type")
  [1m[36m (0.8ms)[0m  [1mCREATE INDEX "index_permissions_on_user_id" ON "permissions" ("user_id")[0m
  [1m[35m (3.6ms)[0m  CREATE TABLE "preferences" ("id" serial primary key, "user_id" integer, "name" character varying(32) DEFAULT '' NOT NULL, "value" text, "created_at" timestamp NOT NULL, "updated_at" timestamp NOT NULL) 
  [1m[36m (1.0ms)[0m  [1mCREATE INDEX "index_preferences_on_user_id_and_name" ON "preferences" ("user_id", "name")[0m
  [1m[35m (22.1ms)[0m  CREATE TABLE "sessions" ("id" serial primary key, "session_id" character varying(255) NOT NULL, "data" text, "created_at" timestamp NOT NULL, "updated_at" timestamp NOT NULL) 
  [1m[36m (1.7ms)[0m  [1mCREATE INDEX "index_sessions_on_session_id" ON "sessions" ("session_id")[0m
  [1m[35m (1.0ms)[0m  CREATE INDEX "index_sessions_on_updated_at" ON "sessions" ("updated_at")
  [1m[36m (3.2ms)[0m  [1mCREATE TABLE "settings" ("id" serial primary key, "name" character varying(32) DEFAULT '' NOT NULL, "value" text, "created_at" timestamp NOT NULL, "updated_at" timestamp NOT NULL) [0m
  [1m[35m (1.0ms)[0m  CREATE INDEX "index_settings_on_name" ON "settings" ("name")
  [1m[36m (3.5ms)[0m  [1mCREATE TABLE "taggings" ("id" serial primary key, "tag_id" integer, "taggable_id" integer, "tagger_id" integer, "tagger_type" character varying(255), "taggable_type" character varying(255), "context" character varying(255), "created_at" timestamp) [0m
  [1m[35m (0.9ms)[0m  CREATE INDEX "index_taggings_on_tag_id" ON "taggings" ("tag_id")
  [1m[36m (9.7ms)[0m  [1mCREATE INDEX "index_taggings_on_taggable_id_and_taggable_type_and_context" ON "taggings" ("taggable_id", "taggable_type", "context")[0m
  [1m[35m (7.5ms)[0m  CREATE TABLE "tags" ("id" serial primary key, "name" character varying(255)) 
  [1m[36m (3.9ms)[0m  [1mCREATE TABLE "tasks" ("id" serial primary key, "user_id" integer, "assigned_to" integer, "completed_by" integer, "name" character varying(255) DEFAULT '' NOT NULL, "asset_id" integer, "asset_type" character varying(255), "priority" character varying(32), "category" character varying(32), "bucket" character varying(32), "due_at" timestamp, "completed_at" timestamp, "deleted_at" timestamp, "created_at" timestamp NOT NULL, "updated_at" timestamp NOT NULL, "background_info" character varying(255), "subscribed_users" text) [0m
  [1m[35m (1.1ms)[0m  CREATE INDEX "index_tasks_on_assigned_to" ON "tasks" ("assigned_to")
  [1m[36m (1.1ms)[0m  [1mCREATE UNIQUE INDEX "index_tasks_on_user_id_and_name_and_deleted_at" ON "tasks" ("user_id", "name", "deleted_at")[0m
  [1m[35m (4.5ms)[0m  CREATE TABLE "users" ("id" serial primary key, "username" character varying(32) DEFAULT '' NOT NULL, "email" character varying(64) DEFAULT '' NOT NULL, "first_name" character varying(32), "last_name" character varying(32), "title" character varying(64), "company" character varying(64), "alt_email" character varying(64), "phone" character varying(32), "mobile" character varying(32), "aim" character varying(32), "yahoo" character varying(32), "google" character varying(32), "skype" character varying(32), "password_hash" character varying(255) DEFAULT '' NOT NULL, "password_salt" character varying(255) DEFAULT '' NOT NULL, "persistence_token" character varying(255) DEFAULT '' NOT NULL, "perishable_token" character varying(255) DEFAULT '' NOT NULL, "last_request_at" timestamp, "last_login_at" timestamp, "current_login_at" timestamp, "last_login_ip" character varying(255), "current_login_ip" character varying(255), "login_count" integer DEFAULT 0 NOT NULL, "deleted_at" timestamp, "created_at" timestamp NOT NULL, "updated_at" timestamp NOT NULL, "admin" boolean DEFAULT 'f' NOT NULL, "suspended_at" timestamp, "single_access_token" character varying(255)) 
  [1m[36m (1.2ms)[0m  [1mCREATE INDEX "index_users_on_email" ON "users" ("email")[0m
  [1m[35m (7.3ms)[0m  CREATE INDEX "index_users_on_last_request_at" ON "users" ("last_request_at")
  [1m[36m (5.2ms)[0m  [1mCREATE INDEX "index_users_on_perishable_token" ON "users" ("perishable_token")[0m
  [1m[35m (1.8ms)[0m  CREATE INDEX "index_users_on_remember_token" ON "users" ("persistence_token")
  [1m[36m (1.1ms)[0m  [1mCREATE UNIQUE INDEX "index_users_on_username_and_deleted_at" ON "users" ("username", "deleted_at")[0m
  [1m[35m (3.6ms)[0m  CREATE TABLE "versions" ("id" serial primary key, "item_type" character varying(255) NOT NULL, "item_id" integer NOT NULL, "event" character varying(512) NOT NULL, "whodunnit" character varying(255), "object" text, "created_at" timestamp, "object_changes" text, "related_id" integer, "related_type" character varying(255)) 
  [1m[36m (1.0ms)[0m  [1mCREATE INDEX "index_versions_on_item_type_and_item_id" ON "versions" ("item_type", "item_id")[0m
  [1m[35m (1.1ms)[0m  CREATE INDEX "index_versions_on_whodunnit" ON "versions" ("whodunnit")
  [1m[36m (0.8ms)[0m  [1mCREATE TABLE "schema_migrations" ("version" character varying(255) NOT NULL) [0m
  [1m[35m (0.9ms)[0m  CREATE UNIQUE INDEX "unique_schema_migrations" ON "schema_migrations" ("version")
  [1m[36m (0.2ms)[0m  [1mSELECT version FROM "schema_migrations"[0m
  [1m[35m (0.4ms)[0m  INSERT INTO "schema_migrations" (version) VALUES ('20120528102124')
  [1m[36m (0.2ms)[0m  [1mBEGIN[0m
Started POST "/vend/register_sale" for 127.0.0.1 at 2013-03-06 23:43:39 +1300
Processing by VendController#register_sale as JSON
  Parameters: {"payload"=>{"id"=>"5e8b5134-a002-dd6b-b7c7-26126887c4ee", "sale_date"=>"2012-11-13 16:40:06", "status"=>"CLOSED", "user_id"=>"9b2a8d5f-2d20-11e2-8057-080027706aa2", "customer_id"=>"9b17ac9d-2d20-11e2-8057-080027706aa2", "register_id"=>"9af85e69-2d20-11e2-8057-080027706aa2", "market_id"=>"1", "invoice_number"=>"144", "short_code"=>"ne2zq", "totals"=>{"total_price"=>"4.87", "total_tax"=>"0.69", "total_payment"=>"5.55", "total_to_pay"=>"0"}, "note"=>nil, "updated_at"=>"2012-11-13 16:40:09", "created_at"=>"2012-11-13 16:40:09", "customer"=>{"id"=>"9b17ac9d-2d20-11e2-8057-080027706aa2", "customer_code"=>"WALKIN", "balance"=>"-6.250", "points"=>"0", "note"=>nil, "year_to_date"=>"79945.92188", "sex"=>"M", "date_of_birth"=>"1950-05-25", "updated_at"=>"2012-11-13 16:43:15", "created_at"=>"2012-11-13 12:28:03"}, "user"=>{"id"=>"9b2a8d5f-2d20-11e2-8057-080027706aa2", "name"=>"admin", "display_name"=>"A admin this time", "outlet_id"=>"9ae97219-2d20-11e2-8057-080027706aa2", "target_daily"=>nil, "target_weekly"=>nil, "target_monthly"=>nil, "created_at"=>"2011-09-08 05:18:38", "updated_at"=>"2011-09-08 05:18:38"}, "register_sale_products"=>[{"id"=>"148793f0-475a-7d49-442d-fd761ce76339", "product_id"=>"9fe945bc-2d20-11e2-8057-080027706aa2", "quantity"=>"1", "price"=>"1.90", "price_set"=>"true", "tax"=>"0.24", "price_total"=>"1.9", "tax_total"=>"0.24", "tax_id"=>"9a025ff0-2d20-11e2-8057-080027706aa2", "tax_name"=>"NZ GST", "tax_rate"=>"0.150000"}, {"id"=>"7d37dc0f-9462-06fa-cae0-0b4988b36539", "product_id"=>"a0c0df02-2d20-11e2-8057-080027706aa2", "quantity"=>"3", "price"=>"0.99", "price_set"=>"true", "tax"=>"0.15", "price_total"=>"2.97", "tax_total"=>"0.45", "tax_id"=>"9a025ff0-2d20-11e2-8057-080027706aa2", "tax_name"=>"NZ GST", "tax_rate"=>"0.150000"}], "register_sale_payments"=>[{"id"=>"39948e3e-bf93-1b60-ff44-f46a777ed1d4", "payment_date"=>"2012-11-13 16:40:06", "amount"=>"5.55", "retailer_payment_type_id"=>"9e9ba1ba-2d20-11e2-8057-080027706aa2", "payment_type_id"=>"1"}]}}
  [1m[35m (0.2ms)[0m  SAVEPOINT active_record_1
  [1m[36m (1.7ms)[0m  [1mSELECT "tags".id FROM "tags" INNER JOIN "taggings" ON "tags"."id" = "taggings"."tag_id" WHERE "taggings"."taggable_id" IS NULL AND "taggings"."taggable_type" = 'Opportunity' AND (taggings.context = 'tags')[0m
  [1m[35mFieldGroup Load (0.5ms)[0m  SELECT "field_groups".* FROM "field_groups" WHERE "field_groups"."klass_name" = 'Opportunity' AND (tag_id IS NULL OR tag_id IN (NULL)) ORDER BY position
  [1m[36m (0.2ms)[0m  [1mROLLBACK TO SAVEPOINT active_record_1[0m
Completed 201 Created in 912407ms (Views: 0.2ms | ActiveRecord: 0.0ms)
  [1m[35m (0.3ms)[0m  ROLLBACK
  [1m[36m (0.1ms)[0m  [1mBEGIN[0m
  [1m[35m (0.2ms)[0m  ROLLBACK
Connecting to database specified by database.yml
  [1m[36mFieldGroup Load (1.1ms)[0m  [1mSELECT "field_groups".* FROM "field_groups" WHERE "field_groups"."klass_name" = 'Account' ORDER BY position[0m
  [1m[35mFieldGroup Load (0.4ms)[0m  SELECT "field_groups".* FROM "field_groups" WHERE "field_groups"."klass_name" = 'Campaign' ORDER BY position
  [1m[36mFieldGroup Load (0.3ms)[0m  [1mSELECT "field_groups".* FROM "field_groups" WHERE "field_groups"."klass_name" = 'Contact' ORDER BY position[0m
  [1m[35mFieldGroup Load (0.3ms)[0m  SELECT "field_groups".* FROM "field_groups" WHERE "field_groups"."klass_name" = 'Lead' ORDER BY position
  [1m[36mFieldGroup Load (0.2ms)[0m  [1mSELECT "field_groups".* FROM "field_groups" WHERE "field_groups"."klass_name" = 'Opportunity' ORDER BY position[0m
  [1m[35mFieldGroup Load (0.2ms)[0m  SELECT "field_groups".* FROM "field_groups" WHERE "field_groups"."klass_name" = 'Task' ORDER BY position
Creating scope :except. Overwriting existing method User.except.
  [1m[36m (121.1ms)[0m  [1mDROP DATABASE IF EXISTS "ffcrm_vend_test"[0m
  [1m[35m (244.2ms)[0m  CREATE DATABASE "ffcrm_vend_test" ENCODING = 'utf8'
  [1m[36m (5.7ms)[0m  [1mCREATE TABLE "account_contacts" ("id" serial primary key, "account_id" integer, "contact_id" integer, "deleted_at" timestamp, "created_at" timestamp NOT NULL, "updated_at" timestamp NOT NULL) [0m
  [1m[35m (2.3ms)[0m  CREATE TABLE "account_opportunities" ("id" serial primary key, "account_id" integer, "opportunity_id" integer, "deleted_at" timestamp, "created_at" timestamp NOT NULL, "updated_at" timestamp NOT NULL) 
  [1m[36m (3.9ms)[0m  [1mCREATE TABLE "accounts" ("id" serial primary key, "user_id" integer, "assigned_to" integer, "name" character varying(64) DEFAULT '' NOT NULL, "access" character varying(8) DEFAULT 'Public', "website" character varying(64), "toll_free_phone" character varying(32), "phone" character varying(32), "fax" character varying(32), "deleted_at" timestamp, "created_at" timestamp NOT NULL, "updated_at" timestamp NOT NULL, "email" character varying(64), "background_info" character varying(255), "rating" integer DEFAULT 0 NOT NULL, "category" character varying(32), "subscribed_users" text) [0m
  [1m[35m (1.3ms)[0m  CREATE INDEX "index_accounts_on_assigned_to" ON "accounts" ("assigned_to")
  [1m[36m (1.3ms)[0m  [1mCREATE UNIQUE INDEX "index_accounts_on_user_id_and_name_and_deleted_at" ON "accounts" ("user_id", "name", "deleted_at")[0m
  [1m[35m (3.5ms)[0m  CREATE TABLE "activities" ("id" serial primary key, "user_id" integer, "subject_id" integer, "subject_type" character varying(255), "action" character varying(32) DEFAULT 'created', "info" character varying(255) DEFAULT '', "private" boolean DEFAULT 'f', "created_at" timestamp NOT NULL, "updated_at" timestamp NOT NULL) 
  [1m[36m (1.1ms)[0m  [1mCREATE INDEX "index_activities_on_created_at" ON "activities" ("created_at")[0m
  [1m[35m (1.4ms)[0m  CREATE INDEX "index_activities_on_user_id" ON "activities" ("user_id")
  [1m[36m (3.2ms)[0m  [1mCREATE TABLE "addresses" ("id" serial primary key, "street1" character varying(255), "street2" character varying(255), "city" character varying(64), "state" character varying(64), "zipcode" character varying(16), "country" character varying(64), "full_address" character varying(255), "address_type" character varying(16), "addressable_id" integer, "addressable_type" character varying(255), "created_at" timestamp NOT NULL, "updated_at" timestamp NOT NULL, "deleted_at" timestamp) [0m
  [1m[35m (1.0ms)[0m  CREATE INDEX "index_addresses_on_addressable_id_and_addressable_type" ON "addresses" ("addressable_id", "addressable_type")
  [1m[36m (3.1ms)[0m  [1mCREATE TABLE "avatars" ("id" serial primary key, "user_id" integer, "entity_id" integer, "entity_type" character varying(255), "image_file_size" integer, "image_file_name" character varying(255), "image_content_type" character varying(255), "created_at" timestamp NOT NULL, "updated_at" timestamp NOT NULL) [0m
  [1m[35m (3.6ms)[0m  CREATE TABLE "campaigns" ("id" serial primary key, "user_id" integer, "assigned_to" integer, "name" character varying(64) DEFAULT '' NOT NULL, "access" character varying(8) DEFAULT 'Public', "status" character varying(64), "budget" decimal(12,2), "target_leads" integer, "target_conversion" float, "target_revenue" decimal(12,2), "leads_count" integer, "opportunities_count" integer, "revenue" decimal(12,2), "starts_on" date, "ends_on" date, "objectives" text, "deleted_at" timestamp, "created_at" timestamp NOT NULL, "updated_at" timestamp NOT NULL, "background_info" character varying(255), "subscribed_users" text) 
  [1m[36m (0.9ms)[0m  [1mCREATE INDEX "index_campaigns_on_assigned_to" ON "campaigns" ("assigned_to")[0m
  [1m[35m (1.0ms)[0m  CREATE UNIQUE INDEX "index_campaigns_on_user_id_and_name_and_deleted_at" ON "campaigns" ("user_id", "name", "deleted_at")
  [1m[36m (3.4ms)[0m  [1mCREATE TABLE "comments" ("id" serial primary key, "user_id" integer, "commentable_id" integer, "commentable_type" character varying(255), "private" boolean, "title" character varying(255) DEFAULT '', "comment" text, "created_at" timestamp NOT NULL, "updated_at" timestamp NOT NULL, "state" character varying(16) DEFAULT 'Expanded' NOT NULL) [0m
  [1m[35m (2.5ms)[0m  CREATE TABLE "contact_opportunities" ("id" serial primary key, "contact_id" integer, "opportunity_id" integer, "role" character varying(32), "deleted_at" timestamp, "created_at" timestamp NOT NULL, "updated_at" timestamp NOT NULL) 
  [1m[36m (3.9ms)[0m  [1mCREATE TABLE "contacts" ("id" serial primary key, "user_id" integer, "lead_id" integer, "assigned_to" integer, "reports_to" integer, "first_name" character varying(64) DEFAULT '' NOT NULL, "last_name" character varying(64) DEFAULT '' NOT NULL, "access" character varying(8) DEFAULT 'Public', "title" character varying(64), "department" character varying(64), "source" character varying(32), "email" character varying(64), "alt_email" character varying(64), "phone" character varying(32), "mobile" character varying(32), "fax" character varying(32), "blog" character varying(128), "linkedin" character varying(128), "facebook" character varying(128), "twitter" character varying(128), "born_on" date, "do_not_call" boolean DEFAULT 'f' NOT NULL, "deleted_at" timestamp, "created_at" timestamp NOT NULL, "updated_at" timestamp NOT NULL, "background_info" character varying(255), "skype" character varying(128), "subscribed_users" text) [0m
  [1m[35m (0.9ms)[0m  CREATE INDEX "index_contacts_on_assigned_to" ON "contacts" ("assigned_to")
  [1m[36m (1.0ms)[0m  [1mCREATE UNIQUE INDEX "id_last_name_deleted" ON "contacts" ("user_id", "last_name", "deleted_at")[0m
  [1m[35m (3.2ms)[0m  CREATE TABLE "emails" ("id" serial primary key, "imap_message_id" character varying(255) NOT NULL, "user_id" integer, "mediator_id" integer, "mediator_type" character varying(255), "sent_from" character varying(255) NOT NULL, "sent_to" character varying(255) NOT NULL, "cc" character varying(255), "bcc" character varying(255), "subject" character varying(255), "body" text, "header" text, "sent_at" timestamp, "received_at" timestamp, "deleted_at" timestamp, "created_at" timestamp NOT NULL, "updated_at" timestamp NOT NULL, "state" character varying(16) DEFAULT 'Expanded' NOT NULL) 
  [1m[36m (0.9ms)[0m  [1mCREATE INDEX "index_emails_on_mediator_id_and_mediator_type" ON "emails" ("mediator_id", "mediator_type")[0m
  [1m[35m (2.2ms)[0m  CREATE TABLE "field_groups" ("id" serial primary key, "name" character varying(64), "label" character varying(128), "position" integer, "hint" character varying(255), "created_at" timestamp NOT NULL, "updated_at" timestamp NOT NULL, "tag_id" integer, "klass_name" character varying(32)) 
  [1m[36m (3.3ms)[0m  [1mCREATE TABLE "fields" ("id" serial primary key, "type" character varying(255), "field_group_id" integer, "position" integer, "name" character varying(64), "label" character varying(128), "hint" character varying(255), "placeholder" character varying(255), "as" character varying(32), "collection" text, "disabled" boolean, "required" boolean, "maxlength" integer, "created_at" timestamp NOT NULL, "updated_at" timestamp NOT NULL) [0m
  [1m[35m (1.0ms)[0m  CREATE INDEX "index_fields_on_field_group_id" ON "fields" ("field_group_id")
  [1m[36m (0.8ms)[0m  [1mCREATE INDEX "index_fields_on_name" ON "fields" ("name")[0m
  [1m[35m (4.2ms)[0m  CREATE TABLE "leads" ("id" serial primary key, "user_id" integer, "campaign_id" integer, "assigned_to" integer, "first_name" character varying(64) DEFAULT '' NOT NULL, "last_name" character varying(64) DEFAULT '' NOT NULL, "access" character varying(8) DEFAULT 'Public', "title" character varying(64), "company" character varying(64), "source" character varying(32), "status" character varying(32), "referred_by" character varying(64), "email" character varying(64), "alt_email" character varying(64), "phone" character varying(32), "mobile" character varying(32), "blog" character varying(128), "linkedin" character varying(128), "facebook" character varying(128), "twitter" character varying(128), "rating" integer DEFAULT 0 NOT NULL, "do_not_call" boolean DEFAULT 'f' NOT NULL, "deleted_at" timestamp, "created_at" timestamp NOT NULL, "updated_at" timestamp NOT NULL, "background_info" character varying(255), "skype" character varying(128), "subscribed_users" text) 
  [1m[36m (1.0ms)[0m  [1mCREATE INDEX "index_leads_on_assigned_to" ON "leads" ("assigned_to")[0m
  [1m[35m (0.9ms)[0m  CREATE UNIQUE INDEX "index_leads_on_user_id_and_last_name_and_deleted_at" ON "leads" ("user_id", "last_name", "deleted_at")
  [1m[36m (3.6ms)[0m  [1mCREATE TABLE "lists" ("id" serial primary key, "name" character varying(255), "url" text, "created_at" timestamp NOT NULL, "updated_at" timestamp NOT NULL) [0m
  [1m[35m (3.4ms)[0m  CREATE TABLE "opportunities" ("id" serial primary key, "user_id" integer, "campaign_id" integer, "assigned_to" integer, "name" character varying(64) DEFAULT '' NOT NULL, "access" character varying(8) DEFAULT 'Public', "source" character varying(32), "stage" character varying(32), "probability" integer, "amount" decimal(12,2), "discount" decimal(12,2), "closes_on" date, "deleted_at" timestamp, "created_at" timestamp NOT NULL, "updated_at" timestamp NOT NULL, "background_info" character varying(255), "subscribed_users" text) 
  [1m[36m (0.9ms)[0m  [1mCREATE INDEX "index_opportunities_on_assigned_to" ON "opportunities" ("assigned_to")[0m
  [1m[35m (1.0ms)[0m  CREATE UNIQUE INDEX "id_name_deleted" ON "opportunities" ("user_id", "name", "deleted_at")
  [1m[36m (2.4ms)[0m  [1mCREATE TABLE "permissions" ("id" serial primary key, "user_id" integer, "asset_id" integer, "asset_type" character varying(255), "created_at" timestamp NOT NULL, "updated_at" timestamp NOT NULL) [0m
  [1m[35m (1.0ms)[0m  CREATE INDEX "index_permissions_on_asset_id_and_asset_type" ON "permissions" ("asset_id", "asset_type")
  [1m[36m (1.0ms)[0m  [1mCREATE INDEX "index_permissions_on_user_id" ON "permissions" ("user_id")[0m
  [1m[35m (3.3ms)[0m  CREATE TABLE "preferences" ("id" serial primary key, "user_id" integer, "name" character varying(32) DEFAULT '' NOT NULL, "value" text, "created_at" timestamp NOT NULL, "updated_at" timestamp NOT NULL) 
  [1m[36m (1.0ms)[0m  [1mCREATE INDEX "index_preferences_on_user_id_and_name" ON "preferences" ("user_id", "name")[0m
  [1m[35m (3.1ms)[0m  CREATE TABLE "sessions" ("id" serial primary key, "session_id" character varying(255) NOT NULL, "data" text, "created_at" timestamp NOT NULL, "updated_at" timestamp NOT NULL) 
  [1m[36m (1.0ms)[0m  [1mCREATE INDEX "index_sessions_on_session_id" ON "sessions" ("session_id")[0m
  [1m[35m (0.8ms)[0m  CREATE INDEX "index_sessions_on_updated_at" ON "sessions" ("updated_at")
  [1m[36m (17.4ms)[0m  [1mCREATE TABLE "settings" ("id" serial primary key, "name" character varying(32) DEFAULT '' NOT NULL, "value" text, "created_at" timestamp NOT NULL, "updated_at" timestamp NOT NULL) [0m
  [1m[35m (6.6ms)[0m  CREATE INDEX "index_settings_on_name" ON "settings" ("name")
  [1m[36m (5.7ms)[0m  [1mCREATE TABLE "taggings" ("id" serial primary key, "tag_id" integer, "taggable_id" integer, "tagger_id" integer, "tagger_type" character varying(255), "taggable_type" character varying(255), "context" character varying(255), "created_at" timestamp) [0m
  [1m[35m (1.1ms)[0m  CREATE INDEX "index_taggings_on_tag_id" ON "taggings" ("tag_id")
  [1m[36m (1.1ms)[0m  [1mCREATE INDEX "index_taggings_on_taggable_id_and_taggable_type_and_context" ON "taggings" ("taggable_id", "taggable_type", "context")[0m
  [1m[35m (2.5ms)[0m  CREATE TABLE "tags" ("id" serial primary key, "name" character varying(255)) 
  [1m[36m (17.9ms)[0m  [1mCREATE TABLE "tasks" ("id" serial primary key, "user_id" integer, "assigned_to" integer, "completed_by" integer, "name" character varying(255) DEFAULT '' NOT NULL, "asset_id" integer, "asset_type" character varying(255), "priority" character varying(32), "category" character varying(32), "bucket" character varying(32), "due_at" timestamp, "completed_at" timestamp, "deleted_at" timestamp, "created_at" timestamp NOT NULL, "updated_at" timestamp NOT NULL, "background_info" character varying(255), "subscribed_users" text) [0m
  [1m[35m (1.1ms)[0m  CREATE INDEX "index_tasks_on_assigned_to" ON "tasks" ("assigned_to")
  [1m[36m (1.4ms)[0m  [1mCREATE UNIQUE INDEX "index_tasks_on_user_id_and_name_and_deleted_at" ON "tasks" ("user_id", "name", "deleted_at")[0m
  [1m[35m (4.0ms)[0m  CREATE TABLE "users" ("id" serial primary key, "username" character varying(32) DEFAULT '' NOT NULL, "email" character varying(64) DEFAULT '' NOT NULL, "first_name" character varying(32), "last_name" character varying(32), "title" character varying(64), "company" character varying(64), "alt_email" character varying(64), "phone" character varying(32), "mobile" character varying(32), "aim" character varying(32), "yahoo" character varying(32), "google" character varying(32), "skype" character varying(32), "password_hash" character varying(255) DEFAULT '' NOT NULL, "password_salt" character varying(255) DEFAULT '' NOT NULL, "persistence_token" character varying(255) DEFAULT '' NOT NULL, "perishable_token" character varying(255) DEFAULT '' NOT NULL, "last_request_at" timestamp, "last_login_at" timestamp, "current_login_at" timestamp, "last_login_ip" character varying(255), "current_login_ip" character varying(255), "login_count" integer DEFAULT 0 NOT NULL, "deleted_at" timestamp, "created_at" timestamp NOT NULL, "updated_at" timestamp NOT NULL, "admin" boolean DEFAULT 'f' NOT NULL, "suspended_at" timestamp, "single_access_token" character varying(255)) 
  [1m[36m (1.3ms)[0m  [1mCREATE INDEX "index_users_on_email" ON "users" ("email")[0m
  [1m[35m (0.9ms)[0m  CREATE INDEX "index_users_on_last_request_at" ON "users" ("last_request_at")
  [1m[36m (1.0ms)[0m  [1mCREATE INDEX "index_users_on_perishable_token" ON "users" ("perishable_token")[0m
  [1m[35m (1.0ms)[0m  CREATE INDEX "index_users_on_remember_token" ON "users" ("persistence_token")
  [1m[36m (6.8ms)[0m  [1mCREATE UNIQUE INDEX "index_users_on_username_and_deleted_at" ON "users" ("username", "deleted_at")[0m
  [1m[35m (8.9ms)[0m  CREATE TABLE "versions" ("id" serial primary key, "item_type" character varying(255) NOT NULL, "item_id" integer NOT NULL, "event" character varying(512) NOT NULL, "whodunnit" character varying(255), "object" text, "created_at" timestamp, "object_changes" text, "related_id" integer, "related_type" character varying(255)) 
  [1m[36m (1.0ms)[0m  [1mCREATE INDEX "index_versions_on_item_type_and_item_id" ON "versions" ("item_type", "item_id")[0m
  [1m[35m (1.1ms)[0m  CREATE INDEX "index_versions_on_whodunnit" ON "versions" ("whodunnit")
  [1m[36m (0.8ms)[0m  [1mCREATE TABLE "schema_migrations" ("version" character varying(255) NOT NULL) [0m
  [1m[35m (1.1ms)[0m  CREATE UNIQUE INDEX "unique_schema_migrations" ON "schema_migrations" ("version")
  [1m[36m (0.2ms)[0m  [1mSELECT version FROM "schema_migrations"[0m
  [1m[35m (0.4ms)[0m  INSERT INTO "schema_migrations" (version) VALUES ('20120528102124')
  [1m[36m (0.2ms)[0m  [1mBEGIN[0m
Started POST "/vend/register_sale" for 127.0.0.1 at 2013-03-06 23:59:00 +1300
Processing by VendController#register_sale as JSON
  Parameters: {"payload"=>{"id"=>"5e8b5134-a002-dd6b-b7c7-26126887c4ee", "sale_date"=>"2012-11-13 16:40:06", "status"=>"CLOSED", "user_id"=>"9b2a8d5f-2d20-11e2-8057-080027706aa2", "customer_id"=>"9b17ac9d-2d20-11e2-8057-080027706aa2", "register_id"=>"9af85e69-2d20-11e2-8057-080027706aa2", "market_id"=>"1", "invoice_number"=>"144", "short_code"=>"ne2zq", "totals"=>{"total_price"=>"4.87", "total_tax"=>"0.69", "total_payment"=>"5.55", "total_to_pay"=>"0"}, "note"=>nil, "updated_at"=>"2012-11-13 16:40:09", "created_at"=>"2012-11-13 16:40:09", "customer"=>{"id"=>"9b17ac9d-2d20-11e2-8057-080027706aa2", "customer_code"=>"WALKIN", "balance"=>"-6.250", "points"=>"0", "note"=>nil, "year_to_date"=>"79945.92188", "sex"=>"M", "date_of_birth"=>"1950-05-25", "updated_at"=>"2012-11-13 16:43:15", "created_at"=>"2012-11-13 12:28:03"}, "user"=>{"id"=>"9b2a8d5f-2d20-11e2-8057-080027706aa2", "name"=>"admin", "display_name"=>"A admin this time", "outlet_id"=>"9ae97219-2d20-11e2-8057-080027706aa2", "target_daily"=>nil, "target_weekly"=>nil, "target_monthly"=>nil, "created_at"=>"2011-09-08 05:18:38", "updated_at"=>"2011-09-08 05:18:38"}, "register_sale_products"=>[{"id"=>"148793f0-475a-7d49-442d-fd761ce76339", "product_id"=>"9fe945bc-2d20-11e2-8057-080027706aa2", "quantity"=>"1", "price"=>"1.90", "price_set"=>"true", "tax"=>"0.24", "price_total"=>"1.9", "tax_total"=>"0.24", "tax_id"=>"9a025ff0-2d20-11e2-8057-080027706aa2", "tax_name"=>"NZ GST", "tax_rate"=>"0.150000"}, {"id"=>"7d37dc0f-9462-06fa-cae0-0b4988b36539", "product_id"=>"a0c0df02-2d20-11e2-8057-080027706aa2", "quantity"=>"3", "price"=>"0.99", "price_set"=>"true", "tax"=>"0.15", "price_total"=>"2.97", "tax_total"=>"0.45", "tax_id"=>"9a025ff0-2d20-11e2-8057-080027706aa2", "tax_name"=>"NZ GST", "tax_rate"=>"0.150000"}], "register_sale_payments"=>[{"id"=>"39948e3e-bf93-1b60-ff44-f46a777ed1d4", "payment_date"=>"2012-11-13 16:40:06", "amount"=>"5.55", "retailer_payment_type_id"=>"9e9ba1ba-2d20-11e2-8057-080027706aa2", "payment_type_id"=>"1"}]}}
Completed 500 Internal Server Error in 2ms
  [1m[35m (0.3ms)[0m  ROLLBACK
  [1m[36m (0.1ms)[0m  [1mBEGIN[0m
  [1m[35m (0.1ms)[0m  ROLLBACK
Connecting to database specified by database.yml
  [1m[36mFieldGroup Load (0.9ms)[0m  [1mSELECT "field_groups".* FROM "field_groups" WHERE "field_groups"."klass_name" = 'Account' ORDER BY position[0m
  [1m[35mFieldGroup Load (0.5ms)[0m  SELECT "field_groups".* FROM "field_groups" WHERE "field_groups"."klass_name" = 'Campaign' ORDER BY position
  [1m[36mFieldGroup Load (0.3ms)[0m  [1mSELECT "field_groups".* FROM "field_groups" WHERE "field_groups"."klass_name" = 'Contact' ORDER BY position[0m
  [1m[35mFieldGroup Load (0.3ms)[0m  SELECT "field_groups".* FROM "field_groups" WHERE "field_groups"."klass_name" = 'Lead' ORDER BY position
  [1m[36mFieldGroup Load (0.3ms)[0m  [1mSELECT "field_groups".* FROM "field_groups" WHERE "field_groups"."klass_name" = 'Opportunity' ORDER BY position[0m
  [1m[35mFieldGroup Load (0.3ms)[0m  SELECT "field_groups".* FROM "field_groups" WHERE "field_groups"."klass_name" = 'Task' ORDER BY position
Creating scope :except. Overwriting existing method User.except.
  [1m[36m (120.3ms)[0m  [1mDROP DATABASE IF EXISTS "ffcrm_vend_test"[0m
  [1m[35m (242.6ms)[0m  CREATE DATABASE "ffcrm_vend_test" ENCODING = 'utf8'
  [1m[36m (6.1ms)[0m  [1mCREATE TABLE "account_contacts" ("id" serial primary key, "account_id" integer, "contact_id" integer, "deleted_at" timestamp, "created_at" timestamp NOT NULL, "updated_at" timestamp NOT NULL) [0m
  [1m[35m (2.3ms)[0m  CREATE TABLE "account_opportunities" ("id" serial primary key, "account_id" integer, "opportunity_id" integer, "deleted_at" timestamp, "created_at" timestamp NOT NULL, "updated_at" timestamp NOT NULL) 
  [1m[36m (3.7ms)[0m  [1mCREATE TABLE "accounts" ("id" serial primary key, "user_id" integer, "assigned_to" integer, "name" character varying(64) DEFAULT '' NOT NULL, "access" character varying(8) DEFAULT 'Public', "website" character varying(64), "toll_free_phone" character varying(32), "phone" character varying(32), "fax" character varying(32), "deleted_at" timestamp, "created_at" timestamp NOT NULL, "updated_at" timestamp NOT NULL, "email" character varying(64), "background_info" character varying(255), "rating" integer DEFAULT 0 NOT NULL, "category" character varying(32), "subscribed_users" text, "cf_vend_customer_id" character varying(255)) [0m
  [1m[35m (1.1ms)[0m  CREATE INDEX "index_accounts_on_assigned_to" ON "accounts" ("assigned_to")
  [1m[36m (1.4ms)[0m  [1mCREATE UNIQUE INDEX "index_accounts_on_user_id_and_name_and_deleted_at" ON "accounts" ("user_id", "name", "deleted_at")[0m
  [1m[35m (3.5ms)[0m  CREATE TABLE "activities" ("id" serial primary key, "user_id" integer, "subject_id" integer, "subject_type" character varying(255), "action" character varying(32) DEFAULT 'created', "info" character varying(255) DEFAULT '', "private" boolean DEFAULT 'f', "created_at" timestamp NOT NULL, "updated_at" timestamp NOT NULL) 
  [1m[36m (0.9ms)[0m  [1mCREATE INDEX "index_activities_on_created_at" ON "activities" ("created_at")[0m
  [1m[35m (0.9ms)[0m  CREATE INDEX "index_activities_on_user_id" ON "activities" ("user_id")
  [1m[36m (3.2ms)[0m  [1mCREATE TABLE "addresses" ("id" serial primary key, "street1" character varying(255), "street2" character varying(255), "city" character varying(64), "state" character varying(64), "zipcode" character varying(16), "country" character varying(64), "full_address" character varying(255), "address_type" character varying(16), "addressable_id" integer, "addressable_type" character varying(255), "created_at" timestamp NOT NULL, "updated_at" timestamp NOT NULL, "deleted_at" timestamp) [0m
  [1m[35m (0.9ms)[0m  CREATE INDEX "index_addresses_on_addressable_id_and_addressable_type" ON "addresses" ("addressable_id", "addressable_type")
  [1m[36m (3.4ms)[0m  [1mCREATE TABLE "avatars" ("id" serial primary key, "user_id" integer, "entity_id" integer, "entity_type" character varying(255), "image_file_size" integer, "image_file_name" character varying(255), "image_content_type" character varying(255), "created_at" timestamp NOT NULL, "updated_at" timestamp NOT NULL) [0m
  [1m[35m (3.6ms)[0m  CREATE TABLE "campaigns" ("id" serial primary key, "user_id" integer, "assigned_to" integer, "name" character varying(64) DEFAULT '' NOT NULL, "access" character varying(8) DEFAULT 'Public', "status" character varying(64), "budget" decimal(12,2), "target_leads" integer, "target_conversion" float, "target_revenue" decimal(12,2), "leads_count" integer, "opportunities_count" integer, "revenue" decimal(12,2), "starts_on" date, "ends_on" date, "objectives" text, "deleted_at" timestamp, "created_at" timestamp NOT NULL, "updated_at" timestamp NOT NULL, "background_info" character varying(255), "subscribed_users" text) 
  [1m[36m (1.0ms)[0m  [1mCREATE INDEX "index_campaigns_on_assigned_to" ON "campaigns" ("assigned_to")[0m
  [1m[35m (1.0ms)[0m  CREATE UNIQUE INDEX "index_campaigns_on_user_id_and_name_and_deleted_at" ON "campaigns" ("user_id", "name", "deleted_at")
  [1m[36m (3.5ms)[0m  [1mCREATE TABLE "comments" ("id" serial primary key, "user_id" integer, "commentable_id" integer, "commentable_type" character varying(255), "private" boolean, "title" character varying(255) DEFAULT '', "comment" text, "created_at" timestamp NOT NULL, "updated_at" timestamp NOT NULL, "state" character varying(16) DEFAULT 'Expanded' NOT NULL) [0m
  [1m[35m (2.4ms)[0m  CREATE TABLE "contact_opportunities" ("id" serial primary key, "contact_id" integer, "opportunity_id" integer, "role" character varying(32), "deleted_at" timestamp, "created_at" timestamp NOT NULL, "updated_at" timestamp NOT NULL) 
  [1m[36m (4.5ms)[0m  [1mCREATE TABLE "contacts" ("id" serial primary key, "user_id" integer, "lead_id" integer, "assigned_to" integer, "reports_to" integer, "first_name" character varying(64) DEFAULT '' NOT NULL, "last_name" character varying(64) DEFAULT '' NOT NULL, "access" character varying(8) DEFAULT 'Public', "title" character varying(64), "department" character varying(64), "source" character varying(32), "email" character varying(64), "alt_email" character varying(64), "phone" character varying(32), "mobile" character varying(32), "fax" character varying(32), "blog" character varying(128), "linkedin" character varying(128), "facebook" character varying(128), "twitter" character varying(128), "born_on" date, "do_not_call" boolean DEFAULT 'f' NOT NULL, "deleted_at" timestamp, "created_at" timestamp NOT NULL, "updated_at" timestamp NOT NULL, "background_info" character varying(255), "skype" character varying(128), "subscribed_users" text) [0m
  [1m[35m (0.9ms)[0m  CREATE INDEX "index_contacts_on_assigned_to" ON "contacts" ("assigned_to")
  [1m[36m (1.2ms)[0m  [1mCREATE UNIQUE INDEX "id_last_name_deleted" ON "contacts" ("user_id", "last_name", "deleted_at")[0m
  [1m[35m (3.2ms)[0m  CREATE TABLE "emails" ("id" serial primary key, "imap_message_id" character varying(255) NOT NULL, "user_id" integer, "mediator_id" integer, "mediator_type" character varying(255), "sent_from" character varying(255) NOT NULL, "sent_to" character varying(255) NOT NULL, "cc" character varying(255), "bcc" character varying(255), "subject" character varying(255), "body" text, "header" text, "sent_at" timestamp, "received_at" timestamp, "deleted_at" timestamp, "created_at" timestamp NOT NULL, "updated_at" timestamp NOT NULL, "state" character varying(16) DEFAULT 'Expanded' NOT NULL) 
  [1m[36m (1.2ms)[0m  [1mCREATE INDEX "index_emails_on_mediator_id_and_mediator_type" ON "emails" ("mediator_id", "mediator_type")[0m
  [1m[35m (2.7ms)[0m  CREATE TABLE "field_groups" ("id" serial primary key, "name" character varying(64), "label" character varying(128), "position" integer, "hint" character varying(255), "created_at" timestamp NOT NULL, "updated_at" timestamp NOT NULL, "tag_id" integer, "klass_name" character varying(32)) 
  [1m[36m (3.1ms)[0m  [1mCREATE TABLE "fields" ("id" serial primary key, "type" character varying(255), "field_group_id" integer, "position" integer, "name" character varying(64), "label" character varying(128), "hint" character varying(255), "placeholder" character varying(255), "as" character varying(32), "collection" text, "disabled" boolean, "required" boolean, "maxlength" integer, "created_at" timestamp NOT NULL, "updated_at" timestamp NOT NULL) [0m
  [1m[35m (1.0ms)[0m  CREATE INDEX "index_fields_on_field_group_id" ON "fields" ("field_group_id")
  [1m[36m (0.9ms)[0m  [1mCREATE INDEX "index_fields_on_name" ON "fields" ("name")[0m
  [1m[35m (4.1ms)[0m  CREATE TABLE "leads" ("id" serial primary key, "user_id" integer, "campaign_id" integer, "assigned_to" integer, "first_name" character varying(64) DEFAULT '' NOT NULL, "last_name" character varying(64) DEFAULT '' NOT NULL, "access" character varying(8) DEFAULT 'Public', "title" character varying(64), "company" character varying(64), "source" character varying(32), "status" character varying(32), "referred_by" character varying(64), "email" character varying(64), "alt_email" character varying(64), "phone" character varying(32), "mobile" character varying(32), "blog" character varying(128), "linkedin" character varying(128), "facebook" character varying(128), "twitter" character varying(128), "rating" integer DEFAULT 0 NOT NULL, "do_not_call" boolean DEFAULT 'f' NOT NULL, "deleted_at" timestamp, "created_at" timestamp NOT NULL, "updated_at" timestamp NOT NULL, "background_info" character varying(255), "skype" character varying(128), "subscribed_users" text) 
  [1m[36m (1.0ms)[0m  [1mCREATE INDEX "index_leads_on_assigned_to" ON "leads" ("assigned_to")[0m
  [1m[35m (1.2ms)[0m  CREATE UNIQUE INDEX "index_leads_on_user_id_and_last_name_and_deleted_at" ON "leads" ("user_id", "last_name", "deleted_at")
  [1m[36m (3.4ms)[0m  [1mCREATE TABLE "lists" ("id" serial primary key, "name" character varying(255), "url" text, "created_at" timestamp NOT NULL, "updated_at" timestamp NOT NULL) [0m
  [1m[35m (3.6ms)[0m  CREATE TABLE "opportunities" ("id" serial primary key, "user_id" integer, "campaign_id" integer, "assigned_to" integer, "name" character varying(64) DEFAULT '' NOT NULL, "access" character varying(8) DEFAULT 'Public', "source" character varying(32), "stage" character varying(32), "probability" integer, "amount" decimal(12,2), "discount" decimal(12,2), "closes_on" date, "deleted_at" timestamp, "created_at" timestamp NOT NULL, "updated_at" timestamp NOT NULL, "background_info" character varying(255), "subscribed_users" text) 
  [1m[36m (1.0ms)[0m  [1mCREATE INDEX "index_opportunities_on_assigned_to" ON "opportunities" ("assigned_to")[0m
  [1m[35m (1.2ms)[0m  CREATE UNIQUE INDEX "id_name_deleted" ON "opportunities" ("user_id", "name", "deleted_at")
  [1m[36m (2.3ms)[0m  [1mCREATE TABLE "permissions" ("id" serial primary key, "user_id" integer, "asset_id" integer, "asset_type" character varying(255), "created_at" timestamp NOT NULL, "updated_at" timestamp NOT NULL) [0m
  [1m[35m (0.9ms)[0m  CREATE INDEX "index_permissions_on_asset_id_and_asset_type" ON "permissions" ("asset_id", "asset_type")
  [1m[36m (1.2ms)[0m  [1mCREATE INDEX "index_permissions_on_user_id" ON "permissions" ("user_id")[0m
  [1m[35m (3.6ms)[0m  CREATE TABLE "preferences" ("id" serial primary key, "user_id" integer, "name" character varying(32) DEFAULT '' NOT NULL, "value" text, "created_at" timestamp NOT NULL, "updated_at" timestamp NOT NULL) 
  [1m[36m (1.0ms)[0m  [1mCREATE INDEX "index_preferences_on_user_id_and_name" ON "preferences" ("user_id", "name")[0m
  [1m[35m (3.0ms)[0m  CREATE TABLE "sessions" ("id" serial primary key, "session_id" character varying(255) NOT NULL, "data" text, "created_at" timestamp NOT NULL, "updated_at" timestamp NOT NULL) 
  [1m[36m (1.0ms)[0m  [1mCREATE INDEX "index_sessions_on_session_id" ON "sessions" ("session_id")[0m
  [1m[35m (0.9ms)[0m  CREATE INDEX "index_sessions_on_updated_at" ON "sessions" ("updated_at")
  [1m[36m (22.6ms)[0m  [1mCREATE TABLE "settings" ("id" serial primary key, "name" character varying(32) DEFAULT '' NOT NULL, "value" text, "created_at" timestamp NOT NULL, "updated_at" timestamp NOT NULL) [0m
  [1m[35m (1.5ms)[0m  CREATE INDEX "index_settings_on_name" ON "settings" ("name")
  [1m[36m (3.5ms)[0m  [1mCREATE TABLE "taggings" ("id" serial primary key, "tag_id" integer, "taggable_id" integer, "tagger_id" integer, "tagger_type" character varying(255), "taggable_type" character varying(255), "context" character varying(255), "created_at" timestamp) [0m
  [1m[35m (0.9ms)[0m  CREATE INDEX "index_taggings_on_tag_id" ON "taggings" ("tag_id")
  [1m[36m (1.0ms)[0m  [1mCREATE INDEX "index_taggings_on_taggable_id_and_taggable_type_and_context" ON "taggings" ("taggable_id", "taggable_type", "context")[0m
  [1m[35m (2.2ms)[0m  CREATE TABLE "tags" ("id" serial primary key, "name" character varying(255)) 
  [1m[36m (16.1ms)[0m  [1mCREATE TABLE "tasks" ("id" serial primary key, "user_id" integer, "assigned_to" integer, "completed_by" integer, "name" character varying(255) DEFAULT '' NOT NULL, "asset_id" integer, "asset_type" character varying(255), "priority" character varying(32), "category" character varying(32), "bucket" character varying(32), "due_at" timestamp, "completed_at" timestamp, "deleted_at" timestamp, "created_at" timestamp NOT NULL, "updated_at" timestamp NOT NULL, "background_info" character varying(255), "subscribed_users" text) [0m
  [1m[35m (1.0ms)[0m  CREATE INDEX "index_tasks_on_assigned_to" ON "tasks" ("assigned_to")
  [1m[36m (1.2ms)[0m  [1mCREATE UNIQUE INDEX "index_tasks_on_user_id_and_name_and_deleted_at" ON "tasks" ("user_id", "name", "deleted_at")[0m
  [1m[35m (5.1ms)[0m  CREATE TABLE "users" ("id" serial primary key, "username" character varying(32) DEFAULT '' NOT NULL, "email" character varying(64) DEFAULT '' NOT NULL, "first_name" character varying(32), "last_name" character varying(32), "title" character varying(64), "company" character varying(64), "alt_email" character varying(64), "phone" character varying(32), "mobile" character varying(32), "aim" character varying(32), "yahoo" character varying(32), "google" character varying(32), "skype" character varying(32), "password_hash" character varying(255) DEFAULT '' NOT NULL, "password_salt" character varying(255) DEFAULT '' NOT NULL, "persistence_token" character varying(255) DEFAULT '' NOT NULL, "perishable_token" character varying(255) DEFAULT '' NOT NULL, "last_request_at" timestamp, "last_login_at" timestamp, "current_login_at" timestamp, "last_login_ip" character varying(255), "current_login_ip" character varying(255), "login_count" integer DEFAULT 0 NOT NULL, "deleted_at" timestamp, "created_at" timestamp NOT NULL, "updated_at" timestamp NOT NULL, "admin" boolean DEFAULT 'f' NOT NULL, "suspended_at" timestamp, "single_access_token" character varying(255)) 
  [1m[36m (1.1ms)[0m  [1mCREATE INDEX "index_users_on_email" ON "users" ("email")[0m
  [1m[35m (0.9ms)[0m  CREATE INDEX "index_users_on_last_request_at" ON "users" ("last_request_at")
  [1m[36m (0.9ms)[0m  [1mCREATE INDEX "index_users_on_perishable_token" ON "users" ("perishable_token")[0m
  [1m[35m (0.9ms)[0m  CREATE INDEX "index_users_on_remember_token" ON "users" ("persistence_token")
  [1m[36m (1.2ms)[0m  [1mCREATE UNIQUE INDEX "index_users_on_username_and_deleted_at" ON "users" ("username", "deleted_at")[0m
  [1m[35m (10.3ms)[0m  CREATE TABLE "versions" ("id" serial primary key, "item_type" character varying(255) NOT NULL, "item_id" integer NOT NULL, "event" character varying(512) NOT NULL, "whodunnit" character varying(255), "object" text, "created_at" timestamp, "object_changes" text, "related_id" integer, "related_type" character varying(255)) 
  [1m[36m (1.2ms)[0m  [1mCREATE INDEX "index_versions_on_item_type_and_item_id" ON "versions" ("item_type", "item_id")[0m
  [1m[35m (0.9ms)[0m  CREATE INDEX "index_versions_on_whodunnit" ON "versions" ("whodunnit")
  [1m[36m (0.7ms)[0m  [1mCREATE TABLE "schema_migrations" ("version" character varying(255) NOT NULL) [0m
  [1m[35m (0.8ms)[0m  CREATE UNIQUE INDEX "unique_schema_migrations" ON "schema_migrations" ("version")
  [1m[36m (0.2ms)[0m  [1mSELECT version FROM "schema_migrations"[0m
  [1m[35m (0.4ms)[0m  INSERT INTO "schema_migrations" (version) VALUES ('20120528102124')
  [1m[36m (0.2ms)[0m  [1mBEGIN[0m
Started POST "/vend/register_sale" for 127.0.0.1 at 2013-03-07 00:04:04 +1300
Processing by VendController#register_sale as JSON
  Parameters: {"payload"=>{"id"=>"5e8b5134-a002-dd6b-b7c7-26126887c4ee", "sale_date"=>"2012-11-13 16:40:06", "status"=>"CLOSED", "user_id"=>"9b2a8d5f-2d20-11e2-8057-080027706aa2", "customer_id"=>"9b17ac9d-2d20-11e2-8057-080027706aa2", "register_id"=>"9af85e69-2d20-11e2-8057-080027706aa2", "market_id"=>"1", "invoice_number"=>"144", "short_code"=>"ne2zq", "totals"=>{"total_price"=>"4.87", "total_tax"=>"0.69", "total_payment"=>"5.55", "total_to_pay"=>"0"}, "note"=>nil, "updated_at"=>"2012-11-13 16:40:09", "created_at"=>"2012-11-13 16:40:09", "customer"=>{"id"=>"9b17ac9d-2d20-11e2-8057-080027706aa2", "customer_code"=>"WALKIN", "balance"=>"-6.250", "points"=>"0", "note"=>nil, "year_to_date"=>"79945.92188", "sex"=>"M", "date_of_birth"=>"1950-05-25", "updated_at"=>"2012-11-13 16:43:15", "created_at"=>"2012-11-13 12:28:03"}, "user"=>{"id"=>"9b2a8d5f-2d20-11e2-8057-080027706aa2", "name"=>"admin", "display_name"=>"A admin this time", "outlet_id"=>"9ae97219-2d20-11e2-8057-080027706aa2", "target_daily"=>nil, "target_weekly"=>nil, "target_monthly"=>nil, "created_at"=>"2011-09-08 05:18:38", "updated_at"=>"2011-09-08 05:18:38"}, "register_sale_products"=>[{"id"=>"148793f0-475a-7d49-442d-fd761ce76339", "product_id"=>"9fe945bc-2d20-11e2-8057-080027706aa2", "quantity"=>"1", "price"=>"1.90", "price_set"=>"true", "tax"=>"0.24", "price_total"=>"1.9", "tax_total"=>"0.24", "tax_id"=>"9a025ff0-2d20-11e2-8057-080027706aa2", "tax_name"=>"NZ GST", "tax_rate"=>"0.150000"}, {"id"=>"7d37dc0f-9462-06fa-cae0-0b4988b36539", "product_id"=>"a0c0df02-2d20-11e2-8057-080027706aa2", "quantity"=>"3", "price"=>"0.99", "price_set"=>"true", "tax"=>"0.15", "price_total"=>"2.97", "tax_total"=>"0.45", "tax_id"=>"9a025ff0-2d20-11e2-8057-080027706aa2", "tax_name"=>"NZ GST", "tax_rate"=>"0.150000"}], "register_sale_payments"=>[{"id"=>"39948e3e-bf93-1b60-ff44-f46a777ed1d4", "payment_date"=>"2012-11-13 16:40:06", "amount"=>"5.55", "retailer_payment_type_id"=>"9e9ba1ba-2d20-11e2-8057-080027706aa2", "payment_type_id"=>"1"}]}}
Completed 500 Internal Server Error in 2ms
  [1m[35m (0.2ms)[0m  ROLLBACK
  [1m[36m (0.1ms)[0m  [1mBEGIN[0m
  [1m[35m (0.1ms)[0m  ROLLBACK
Connecting to database specified by database.yml
  [1m[36mFieldGroup Load (0.8ms)[0m  [1mSELECT "field_groups".* FROM "field_groups" WHERE "field_groups"."klass_name" = 'Account' ORDER BY position[0m
  [1m[35mFieldGroup Load (0.3ms)[0m  SELECT "field_groups".* FROM "field_groups" WHERE "field_groups"."klass_name" = 'Campaign' ORDER BY position
  [1m[36mFieldGroup Load (0.3ms)[0m  [1mSELECT "field_groups".* FROM "field_groups" WHERE "field_groups"."klass_name" = 'Contact' ORDER BY position[0m
  [1m[35mFieldGroup Load (0.3ms)[0m  SELECT "field_groups".* FROM "field_groups" WHERE "field_groups"."klass_name" = 'Lead' ORDER BY position
  [1m[36mFieldGroup Load (0.3ms)[0m  [1mSELECT "field_groups".* FROM "field_groups" WHERE "field_groups"."klass_name" = 'Opportunity' ORDER BY position[0m
  [1m[35mFieldGroup Load (0.3ms)[0m  SELECT "field_groups".* FROM "field_groups" WHERE "field_groups"."klass_name" = 'Task' ORDER BY position
Creating scope :except. Overwriting existing method User.except.
  [1m[36m (119.8ms)[0m  [1mDROP DATABASE IF EXISTS "ffcrm_vend_test"[0m
  [1m[35m (248.7ms)[0m  CREATE DATABASE "ffcrm_vend_test" ENCODING = 'utf8'
  [1m[36m (5.3ms)[0m  [1mCREATE TABLE "account_contacts" ("id" serial primary key, "account_id" integer, "contact_id" integer, "deleted_at" timestamp, "created_at" timestamp NOT NULL, "updated_at" timestamp NOT NULL) [0m
  [1m[35m (2.5ms)[0m  CREATE TABLE "account_opportunities" ("id" serial primary key, "account_id" integer, "opportunity_id" integer, "deleted_at" timestamp, "created_at" timestamp NOT NULL, "updated_at" timestamp NOT NULL) 
  [1m[36m (3.6ms)[0m  [1mCREATE TABLE "accounts" ("id" serial primary key, "user_id" integer, "assigned_to" integer, "name" character varying(64) DEFAULT '' NOT NULL, "access" character varying(8) DEFAULT 'Public', "website" character varying(64), "toll_free_phone" character varying(32), "phone" character varying(32), "fax" character varying(32), "deleted_at" timestamp, "created_at" timestamp NOT NULL, "updated_at" timestamp NOT NULL, "email" character varying(64), "background_info" character varying(255), "rating" integer DEFAULT 0 NOT NULL, "category" character varying(32), "subscribed_users" text, "cf_vend_customer_id" character varying(255)) [0m
  [1m[35m (1.4ms)[0m  CREATE INDEX "index_accounts_on_assigned_to" ON "accounts" ("assigned_to")
  [1m[36m (1.3ms)[0m  [1mCREATE UNIQUE INDEX "index_accounts_on_user_id_and_name_and_deleted_at" ON "accounts" ("user_id", "name", "deleted_at")[0m
  [1m[35m (3.5ms)[0m  CREATE TABLE "activities" ("id" serial primary key, "user_id" integer, "subject_id" integer, "subject_type" character varying(255), "action" character varying(32) DEFAULT 'created', "info" character varying(255) DEFAULT '', "private" boolean DEFAULT 'f', "created_at" timestamp NOT NULL, "updated_at" timestamp NOT NULL) 
  [1m[36m (1.1ms)[0m  [1mCREATE INDEX "index_activities_on_created_at" ON "activities" ("created_at")[0m
  [1m[35m (0.8ms)[0m  CREATE INDEX "index_activities_on_user_id" ON "activities" ("user_id")
  [1m[36m (3.4ms)[0m  [1mCREATE TABLE "addresses" ("id" serial primary key, "street1" character varying(255), "street2" character varying(255), "city" character varying(64), "state" character varying(64), "zipcode" character varying(16), "country" character varying(64), "full_address" character varying(255), "address_type" character varying(16), "addressable_id" integer, "addressable_type" character varying(255), "created_at" timestamp NOT NULL, "updated_at" timestamp NOT NULL, "deleted_at" timestamp) [0m
  [1m[35m (1.0ms)[0m  CREATE INDEX "index_addresses_on_addressable_id_and_addressable_type" ON "addresses" ("addressable_id", "addressable_type")
  [1m[36m (3.1ms)[0m  [1mCREATE TABLE "avatars" ("id" serial primary key, "user_id" integer, "entity_id" integer, "entity_type" character varying(255), "image_file_size" integer, "image_file_name" character varying(255), "image_content_type" character varying(255), "created_at" timestamp NOT NULL, "updated_at" timestamp NOT NULL) [0m
  [1m[35m (3.6ms)[0m  CREATE TABLE "campaigns" ("id" serial primary key, "user_id" integer, "assigned_to" integer, "name" character varying(64) DEFAULT '' NOT NULL, "access" character varying(8) DEFAULT 'Public', "status" character varying(64), "budget" decimal(12,2), "target_leads" integer, "target_conversion" float, "target_revenue" decimal(12,2), "leads_count" integer, "opportunities_count" integer, "revenue" decimal(12,2), "starts_on" date, "ends_on" date, "objectives" text, "deleted_at" timestamp, "created_at" timestamp NOT NULL, "updated_at" timestamp NOT NULL, "background_info" character varying(255), "subscribed_users" text) 
  [1m[36m (1.0ms)[0m  [1mCREATE INDEX "index_campaigns_on_assigned_to" ON "campaigns" ("assigned_to")[0m
  [1m[35m (1.1ms)[0m  CREATE UNIQUE INDEX "index_campaigns_on_user_id_and_name_and_deleted_at" ON "campaigns" ("user_id", "name", "deleted_at")
  [1m[36m (3.4ms)[0m  [1mCREATE TABLE "comments" ("id" serial primary key, "user_id" integer, "commentable_id" integer, "commentable_type" character varying(255), "private" boolean, "title" character varying(255) DEFAULT '', "comment" text, "created_at" timestamp NOT NULL, "updated_at" timestamp NOT NULL, "state" character varying(16) DEFAULT 'Expanded' NOT NULL) [0m
  [1m[35m (2.5ms)[0m  CREATE TABLE "contact_opportunities" ("id" serial primary key, "contact_id" integer, "opportunity_id" integer, "role" character varying(32), "deleted_at" timestamp, "created_at" timestamp NOT NULL, "updated_at" timestamp NOT NULL) 
  [1m[36m (4.1ms)[0m  [1mCREATE TABLE "contacts" ("id" serial primary key, "user_id" integer, "lead_id" integer, "assigned_to" integer, "reports_to" integer, "first_name" character varying(64) DEFAULT '' NOT NULL, "last_name" character varying(64) DEFAULT '' NOT NULL, "access" character varying(8) DEFAULT 'Public', "title" character varying(64), "department" character varying(64), "source" character varying(32), "email" character varying(64), "alt_email" character varying(64), "phone" character varying(32), "mobile" character varying(32), "fax" character varying(32), "blog" character varying(128), "linkedin" character varying(128), "facebook" character varying(128), "twitter" character varying(128), "born_on" date, "do_not_call" boolean DEFAULT 'f' NOT NULL, "deleted_at" timestamp, "created_at" timestamp NOT NULL, "updated_at" timestamp NOT NULL, "background_info" character varying(255), "skype" character varying(128), "subscribed_users" text) [0m
  [1m[35m (0.9ms)[0m  CREATE INDEX "index_contacts_on_assigned_to" ON "contacts" ("assigned_to")
  [1m[36m (1.2ms)[0m  [1mCREATE UNIQUE INDEX "id_last_name_deleted" ON "contacts" ("user_id", "last_name", "deleted_at")[0m
  [1m[35m (3.9ms)[0m  CREATE TABLE "emails" ("id" serial primary key, "imap_message_id" character varying(255) NOT NULL, "user_id" integer, "mediator_id" integer, "mediator_type" character varying(255), "sent_from" character varying(255) NOT NULL, "sent_to" character varying(255) NOT NULL, "cc" character varying(255), "bcc" character varying(255), "subject" character varying(255), "body" text, "header" text, "sent_at" timestamp, "received_at" timestamp, "deleted_at" timestamp, "created_at" timestamp NOT NULL, "updated_at" timestamp NOT NULL, "state" character varying(16) DEFAULT 'Expanded' NOT NULL) 
  [1m[36m (1.1ms)[0m  [1mCREATE INDEX "index_emails_on_mediator_id_and_mediator_type" ON "emails" ("mediator_id", "mediator_type")[0m
  [1m[35m (2.3ms)[0m  CREATE TABLE "field_groups" ("id" serial primary key, "name" character varying(64), "label" character varying(128), "position" integer, "hint" character varying(255), "created_at" timestamp NOT NULL, "updated_at" timestamp NOT NULL, "tag_id" integer, "klass_name" character varying(32)) 
  [1m[36m (3.6ms)[0m  [1mCREATE TABLE "fields" ("id" serial primary key, "type" character varying(255), "field_group_id" integer, "position" integer, "name" character varying(64), "label" character varying(128), "hint" character varying(255), "placeholder" character varying(255), "as" character varying(32), "collection" text, "disabled" boolean, "required" boolean, "maxlength" integer, "created_at" timestamp NOT NULL, "updated_at" timestamp NOT NULL) [0m
  [1m[35m (0.9ms)[0m  CREATE INDEX "index_fields_on_field_group_id" ON "fields" ("field_group_id")
  [1m[36m (0.8ms)[0m  [1mCREATE INDEX "index_fields_on_name" ON "fields" ("name")[0m
  [1m[35m (4.1ms)[0m  CREATE TABLE "leads" ("id" serial primary key, "user_id" integer, "campaign_id" integer, "assigned_to" integer, "first_name" character varying(64) DEFAULT '' NOT NULL, "last_name" character varying(64) DEFAULT '' NOT NULL, "access" character varying(8) DEFAULT 'Public', "title" character varying(64), "company" character varying(64), "source" character varying(32), "status" character varying(32), "referred_by" character varying(64), "email" character varying(64), "alt_email" character varying(64), "phone" character varying(32), "mobile" character varying(32), "blog" character varying(128), "linkedin" character varying(128), "facebook" character varying(128), "twitter" character varying(128), "rating" integer DEFAULT 0 NOT NULL, "do_not_call" boolean DEFAULT 'f' NOT NULL, "deleted_at" timestamp, "created_at" timestamp NOT NULL, "updated_at" timestamp NOT NULL, "background_info" character varying(255), "skype" character varying(128), "subscribed_users" text) 
  [1m[36m (1.0ms)[0m  [1mCREATE INDEX "index_leads_on_assigned_to" ON "leads" ("assigned_to")[0m
  [1m[35m (1.0ms)[0m  CREATE UNIQUE INDEX "index_leads_on_user_id_and_last_name_and_deleted_at" ON "leads" ("user_id", "last_name", "deleted_at")
  [1m[36m (3.1ms)[0m  [1mCREATE TABLE "lists" ("id" serial primary key, "name" character varying(255), "url" text, "created_at" timestamp NOT NULL, "updated_at" timestamp NOT NULL) [0m
  [1m[35m (3.7ms)[0m  CREATE TABLE "opportunities" ("id" serial primary key, "user_id" integer, "campaign_id" integer, "assigned_to" integer, "name" character varying(64) DEFAULT '' NOT NULL, "access" character varying(8) DEFAULT 'Public', "source" character varying(32), "stage" character varying(32), "probability" integer, "amount" decimal(12,2), "discount" decimal(12,2), "closes_on" date, "deleted_at" timestamp, "created_at" timestamp NOT NULL, "updated_at" timestamp NOT NULL, "background_info" character varying(255), "subscribed_users" text) 
  [1m[36m (0.9ms)[0m  [1mCREATE INDEX "index_opportunities_on_assigned_to" ON "opportunities" ("assigned_to")[0m
  [1m[35m (1.0ms)[0m  CREATE UNIQUE INDEX "id_name_deleted" ON "opportunities" ("user_id", "name", "deleted_at")
  [1m[36m (3.2ms)[0m  [1mCREATE TABLE "permissions" ("id" serial primary key, "user_id" integer, "asset_id" integer, "asset_type" character varying(255), "created_at" timestamp NOT NULL, "updated_at" timestamp NOT NULL) [0m
  [1m[35m (1.0ms)[0m  CREATE INDEX "index_permissions_on_asset_id_and_asset_type" ON "permissions" ("asset_id", "asset_type")
  [1m[36m (1.0ms)[0m  [1mCREATE INDEX "index_permissions_on_user_id" ON "permissions" ("user_id")[0m
  [1m[35m (20.0ms)[0m  CREATE TABLE "preferences" ("id" serial primary key, "user_id" integer, "name" character varying(32) DEFAULT '' NOT NULL, "value" text, "created_at" timestamp NOT NULL, "updated_at" timestamp NOT NULL) 
  [1m[36m (1.4ms)[0m  [1mCREATE INDEX "index_preferences_on_user_id_and_name" ON "preferences" ("user_id", "name")[0m
  [1m[35m (20.0ms)[0m  CREATE TABLE "sessions" ("id" serial primary key, "session_id" character varying(255) NOT NULL, "data" text, "created_at" timestamp NOT NULL, "updated_at" timestamp NOT NULL) 
  [1m[36m (1.7ms)[0m  [1mCREATE INDEX "index_sessions_on_session_id" ON "sessions" ("session_id")[0m
  [1m[35m (1.3ms)[0m  CREATE INDEX "index_sessions_on_updated_at" ON "sessions" ("updated_at")
  [1m[36m (3.2ms)[0m  [1mCREATE TABLE "settings" ("id" serial primary key, "name" character varying(32) DEFAULT '' NOT NULL, "value" text, "created_at" timestamp NOT NULL, "updated_at" timestamp NOT NULL) [0m
  [1m[35m (1.0ms)[0m  CREATE INDEX "index_settings_on_name" ON "settings" ("name")
  [1m[36m (3.4ms)[0m  [1mCREATE TABLE "taggings" ("id" serial primary key, "tag_id" integer, "taggable_id" integer, "tagger_id" integer, "tagger_type" character varying(255), "taggable_type" character varying(255), "context" character varying(255), "created_at" timestamp) [0m
  [1m[35m (6.6ms)[0m  CREATE INDEX "index_taggings_on_tag_id" ON "taggings" ("tag_id")
  [1m[36m (5.3ms)[0m  [1mCREATE INDEX "index_taggings_on_taggable_id_and_taggable_type_and_context" ON "taggings" ("taggable_id", "taggable_type", "context")[0m
  [1m[35m (2.7ms)[0m  CREATE TABLE "tags" ("id" serial primary key, "name" character varying(255)) 
  [1m[36m (3.4ms)[0m  [1mCREATE TABLE "tasks" ("id" serial primary key, "user_id" integer, "assigned_to" integer, "completed_by" integer, "name" character varying(255) DEFAULT '' NOT NULL, "asset_id" integer, "asset_type" character varying(255), "priority" character varying(32), "category" character varying(32), "bucket" character varying(32), "due_at" timestamp, "completed_at" timestamp, "deleted_at" timestamp, "created_at" timestamp NOT NULL, "updated_at" timestamp NOT NULL, "background_info" character varying(255), "subscribed_users" text) [0m
  [1m[35m (1.2ms)[0m  CREATE INDEX "index_tasks_on_assigned_to" ON "tasks" ("assigned_to")
  [1m[36m (1.1ms)[0m  [1mCREATE UNIQUE INDEX "index_tasks_on_user_id_and_name_and_deleted_at" ON "tasks" ("user_id", "name", "deleted_at")[0m
  [1m[35m (4.0ms)[0m  CREATE TABLE "users" ("id" serial primary key, "username" character varying(32) DEFAULT '' NOT NULL, "email" character varying(64) DEFAULT '' NOT NULL, "first_name" character varying(32), "last_name" character varying(32), "title" character varying(64), "company" character varying(64), "alt_email" character varying(64), "phone" character varying(32), "mobile" character varying(32), "aim" character varying(32), "yahoo" character varying(32), "google" character varying(32), "skype" character varying(32), "password_hash" character varying(255) DEFAULT '' NOT NULL, "password_salt" character varying(255) DEFAULT '' NOT NULL, "persistence_token" character varying(255) DEFAULT '' NOT NULL, "perishable_token" character varying(255) DEFAULT '' NOT NULL, "last_request_at" timestamp, "last_login_at" timestamp, "current_login_at" timestamp, "last_login_ip" character varying(255), "current_login_ip" character varying(255), "login_count" integer DEFAULT 0 NOT NULL, "deleted_at" timestamp, "created_at" timestamp NOT NULL, "updated_at" timestamp NOT NULL, "admin" boolean DEFAULT 'f' NOT NULL, "suspended_at" timestamp, "single_access_token" character varying(255)) 
  [1m[36m (1.0ms)[0m  [1mCREATE INDEX "index_users_on_email" ON "users" ("email")[0m
  [1m[35m (0.9ms)[0m  CREATE INDEX "index_users_on_last_request_at" ON "users" ("last_request_at")
  [1m[36m (0.9ms)[0m  [1mCREATE INDEX "index_users_on_perishable_token" ON "users" ("perishable_token")[0m
  [1m[35m (1.2ms)[0m  CREATE INDEX "index_users_on_remember_token" ON "users" ("persistence_token")
  [1m[36m (1.2ms)[0m  [1mCREATE UNIQUE INDEX "index_users_on_username_and_deleted_at" ON "users" ("username", "deleted_at")[0m
  [1m[35m (3.6ms)[0m  CREATE TABLE "versions" ("id" serial primary key, "item_type" character varying(255) NOT NULL, "item_id" integer NOT NULL, "event" character varying(512) NOT NULL, "whodunnit" character varying(255), "object" text, "created_at" timestamp, "object_changes" text, "related_id" integer, "related_type" character varying(255)) 
  [1m[36m (1.0ms)[0m  [1mCREATE INDEX "index_versions_on_item_type_and_item_id" ON "versions" ("item_type", "item_id")[0m
  [1m[35m (0.9ms)[0m  CREATE INDEX "index_versions_on_whodunnit" ON "versions" ("whodunnit")
  [1m[36m (1.0ms)[0m  [1mCREATE TABLE "schema_migrations" ("version" character varying(255) NOT NULL) [0m
  [1m[35m (0.9ms)[0m  CREATE UNIQUE INDEX "unique_schema_migrations" ON "schema_migrations" ("version")
  [1m[36m (0.2ms)[0m  [1mSELECT version FROM "schema_migrations"[0m
  [1m[35m (0.4ms)[0m  INSERT INTO "schema_migrations" (version) VALUES ('20120528102124')
  [1m[36m (0.3ms)[0m  [1mBEGIN[0m
Started POST "/vend/register_sale" for 127.0.0.1 at 2013-03-07 00:07:17 +1300
Processing by VendController#register_sale as JSON
  Parameters: {"payload"=>{"id"=>"5e8b5134-a002-dd6b-b7c7-26126887c4ee", "sale_date"=>"2012-11-13 16:40:06", "status"=>"CLOSED", "user_id"=>"9b2a8d5f-2d20-11e2-8057-080027706aa2", "customer_id"=>"9b17ac9d-2d20-11e2-8057-080027706aa2", "register_id"=>"9af85e69-2d20-11e2-8057-080027706aa2", "market_id"=>"1", "invoice_number"=>"144", "short_code"=>"ne2zq", "totals"=>{"total_price"=>"4.87", "total_tax"=>"0.69", "total_payment"=>"5.55", "total_to_pay"=>"0"}, "note"=>nil, "updated_at"=>"2012-11-13 16:40:09", "created_at"=>"2012-11-13 16:40:09", "customer"=>{"id"=>"9b17ac9d-2d20-11e2-8057-080027706aa2", "customer_code"=>"WALKIN", "balance"=>"-6.250", "points"=>"0", "note"=>nil, "year_to_date"=>"79945.92188", "sex"=>"M", "date_of_birth"=>"1950-05-25", "updated_at"=>"2012-11-13 16:43:15", "created_at"=>"2012-11-13 12:28:03"}, "user"=>{"id"=>"9b2a8d5f-2d20-11e2-8057-080027706aa2", "name"=>"admin", "display_name"=>"A admin this time", "outlet_id"=>"9ae97219-2d20-11e2-8057-080027706aa2", "target_daily"=>nil, "target_weekly"=>nil, "target_monthly"=>nil, "created_at"=>"2011-09-08 05:18:38", "updated_at"=>"2011-09-08 05:18:38"}, "register_sale_products"=>[{"id"=>"148793f0-475a-7d49-442d-fd761ce76339", "product_id"=>"9fe945bc-2d20-11e2-8057-080027706aa2", "quantity"=>"1", "price"=>"1.90", "price_set"=>"true", "tax"=>"0.24", "price_total"=>"1.9", "tax_total"=>"0.24", "tax_id"=>"9a025ff0-2d20-11e2-8057-080027706aa2", "tax_name"=>"NZ GST", "tax_rate"=>"0.150000"}, {"id"=>"7d37dc0f-9462-06fa-cae0-0b4988b36539", "product_id"=>"a0c0df02-2d20-11e2-8057-080027706aa2", "quantity"=>"3", "price"=>"0.99", "price_set"=>"true", "tax"=>"0.15", "price_total"=>"2.97", "tax_total"=>"0.45", "tax_id"=>"9a025ff0-2d20-11e2-8057-080027706aa2", "tax_name"=>"NZ GST", "tax_rate"=>"0.150000"}], "register_sale_payments"=>[{"id"=>"39948e3e-bf93-1b60-ff44-f46a777ed1d4", "payment_date"=>"2012-11-13 16:40:06", "amount"=>"5.55", "retailer_payment_type_id"=>"9e9ba1ba-2d20-11e2-8057-080027706aa2", "payment_type_id"=>"1"}]}}
  [1m[35mAccount Load (0.7ms)[0m  SELECT "accounts".* FROM "accounts" WHERE "accounts"."cf_vend_customer_id" = '1212' LIMIT 1
  [1m[36mAccount Load (0.5ms)[0m  [1mSELECT "accounts".* FROM "accounts" WHERE "accounts"."cf_vend_customer_id" = '9b17ac9d-2d20-11e2-8057-080027706aa2' LIMIT 1[0m
  [1m[35m (0.2ms)[0m  SAVEPOINT active_record_1
  [1m[36m (0.8ms)[0m  [1mSELECT "tags".id FROM "tags" INNER JOIN "taggings" ON "tags"."id" = "taggings"."tag_id" WHERE "taggings"."taggable_id" IS NULL AND "taggings"."taggable_type" = 'Account' AND (taggings.context = 'tags')[0m
  [1m[35mFieldGroup Load (0.5ms)[0m  SELECT "field_groups".* FROM "field_groups" WHERE "field_groups"."klass_name" = 'Account' AND (tag_id IS NULL OR tag_id IN (NULL)) ORDER BY position
  [1m[36mAccount Exists (0.4ms)[0m  [1mSELECT 1 AS one FROM "accounts" WHERE ("accounts"."name" = 'Account for Register Sale 144' AND "accounts"."deleted_at" IS NULL) LIMIT 1[0m
  [1m[35mSQL (1.2ms)[0m  INSERT INTO "accounts" ("access", "assigned_to", "background_info", "category", "cf_vend_customer_id", "created_at", "deleted_at", "email", "fax", "name", "phone", "rating", "subscribed_users", "toll_free_phone", "updated_at", "user_id", "website") VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9, $10, $11, $12, $13, $14, $15, $16, $17) RETURNING "id"  [["access", "Public"], ["assigned_to", nil], ["background_info", nil], ["category", nil], ["cf_vend_customer_id", "9b17ac9d-2d20-11e2-8057-080027706aa2"], ["created_at", Wed, 06 Mar 2013 11:08:30 UTC +00:00], ["deleted_at", nil], ["email", nil], ["fax", nil], ["name", "Account for Register Sale 144"], ["phone", nil], ["rating", 0], ["subscribed_users", nil], ["toll_free_phone", nil], ["updated_at", Wed, 06 Mar 2013 11:08:30 UTC +00:00], ["user_id", nil], ["website", nil]]
  [1m[36mSQL (1.2ms)[0m  [1mINSERT INTO "versions" ("created_at", "event", "item_id", "item_type", "object", "object_changes", "related_id", "related_type", "whodunnit") VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9) RETURNING "id"[0m  [["created_at", Wed, 06 Mar 2013 11:08:30 UTC +00:00], ["event", "create"], ["item_id", 1], ["item_type", "Account"], ["object", nil], ["object_changes", "--- !map:ActiveSupport::HashWithIndifferentAccess \nname: \n- \"\"\n- Account for Register Sale 144\ncf_vend_customer_id: \n- \n- 9b17ac9d-2d20-11e2-8057-080027706aa2\ncreated_at: \n- \n- &id001 2013-03-06 11:08:30.617591 Z\nupdated_at: \n- \n- *id001\nid: \n- \n- 1\n"], ["related_id", nil], ["related_type", nil], ["whodunnit", nil]]
  [1m[35m (0.2ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36m (0.2ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35m (0.4ms)[0m  SELECT "tags".id FROM "tags" INNER JOIN "taggings" ON "tags"."id" = "taggings"."tag_id" WHERE "taggings"."taggable_id" IS NULL AND "taggings"."taggable_type" = 'Opportunity' AND (taggings.context = 'tags')
  [1m[36mFieldGroup Load (0.3ms)[0m  [1mSELECT "field_groups".* FROM "field_groups" WHERE "field_groups"."klass_name" = 'Opportunity' AND (tag_id IS NULL OR tag_id IN (NULL)) ORDER BY position[0m
  [1m[35mSQL (1.3ms)[0m  INSERT INTO "opportunities" ("access", "amount", "assigned_to", "background_info", "campaign_id", "closes_on", "created_at", "deleted_at", "discount", "name", "probability", "source", "stage", "subscribed_users", "updated_at", "user_id") VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9, $10, $11, $12, $13, $14, $15, $16) RETURNING "id"  [["access", "Public"], ["amount", #<BigDecimal:7f85ff607e30,'0.555E1',18(18)>], ["assigned_to", nil], ["background_info", nil], ["campaign_id", nil], ["closes_on", nil], ["created_at", Wed, 06 Mar 2013 11:08:30 UTC +00:00], ["deleted_at", nil], ["discount", nil], ["name", "Register Sale 144"], ["probability", nil], ["source", nil], ["stage", "won"], ["subscribed_users", nil], ["updated_at", Wed, 06 Mar 2013 11:08:30 UTC +00:00], ["user_id", nil]]
  [1m[36mSQL (0.5ms)[0m  [1mINSERT INTO "versions" ("created_at", "event", "item_id", "item_type", "object", "object_changes", "related_id", "related_type", "whodunnit") VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9) RETURNING "id"[0m  [["created_at", Wed, 06 Mar 2013 11:08:30 UTC +00:00], ["event", "create"], ["item_id", 1], ["item_type", "Opportunity"], ["object", nil], ["object_changes", "--- !map:ActiveSupport::HashWithIndifferentAccess \nname: \n- \"\"\n- Register Sale 144\namount: \n- \n- 5.55\nstage: \n- \n- won\ncreated_at: \n- \n- &id001 2013-03-06 11:08:30.668171 Z\nupdated_at: \n- \n- *id001\nid: \n- \n- 1\n"], ["related_id", nil], ["related_type", nil], ["whodunnit", nil]]
  [1m[35m (0.2ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36m (0.2ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.9ms)[0m  INSERT INTO "account_opportunities" ("account_id", "created_at", "deleted_at", "opportunity_id", "updated_at") VALUES ($1, $2, $3, $4, $5) RETURNING "id"  [["account_id", 1], ["created_at", Wed, 06 Mar 2013 11:08:34 UTC +00:00], ["deleted_at", nil], ["opportunity_id", 1], ["updated_at", Wed, 06 Mar 2013 11:08:34 UTC +00:00]]
  [1m[36mSQL (0.4ms)[0m  [1mINSERT INTO "versions" ("created_at", "event", "item_id", "item_type", "object", "object_changes", "related_id", "related_type", "whodunnit") VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9) RETURNING "id"[0m  [["created_at", Wed, 06 Mar 2013 11:08:34 UTC +00:00], ["event", "create"], ["item_id", 1], ["item_type", "AccountOpportunity"], ["object", nil], ["object_changes", "--- !map:ActiveSupport::HashWithIndifferentAccess \naccount_id: \n- \n- 1\nopportunity_id: \n- \n- 1\ncreated_at: \n- \n- &id001 2013-03-06 11:08:34.539031 Z\nupdated_at: \n- \n- *id001\nid: \n- \n- 1\n"], ["related_id", nil], ["related_type", nil], ["whodunnit", nil]]
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
Completed 500 Internal Server Error in 76869ms
  [1m[36m (0.3ms)[0m  [1mROLLBACK[0m
Connecting to database specified by database.yml
  [1m[36mFieldGroup Load (0.8ms)[0m  [1mSELECT "field_groups".* FROM "field_groups" WHERE "field_groups"."klass_name" = 'Account' ORDER BY position[0m
  [1m[35mFieldGroup Load (0.3ms)[0m  SELECT "field_groups".* FROM "field_groups" WHERE "field_groups"."klass_name" = 'Campaign' ORDER BY position
  [1m[36mFieldGroup Load (0.3ms)[0m  [1mSELECT "field_groups".* FROM "field_groups" WHERE "field_groups"."klass_name" = 'Contact' ORDER BY position[0m
  [1m[35mFieldGroup Load (0.3ms)[0m  SELECT "field_groups".* FROM "field_groups" WHERE "field_groups"."klass_name" = 'Lead' ORDER BY position
  [1m[36mFieldGroup Load (0.3ms)[0m  [1mSELECT "field_groups".* FROM "field_groups" WHERE "field_groups"."klass_name" = 'Opportunity' ORDER BY position[0m
  [1m[35mFieldGroup Load (0.3ms)[0m  SELECT "field_groups".* FROM "field_groups" WHERE "field_groups"."klass_name" = 'Task' ORDER BY position
Creating scope :except. Overwriting existing method User.except.
  [1m[36m (124.8ms)[0m  [1mDROP DATABASE IF EXISTS "ffcrm_vend_test"[0m
  [1m[35m (253.2ms)[0m  CREATE DATABASE "ffcrm_vend_test" ENCODING = 'utf8'
  [1m[36m (5.6ms)[0m  [1mCREATE TABLE "account_contacts" ("id" serial primary key, "account_id" integer, "contact_id" integer, "deleted_at" timestamp, "created_at" timestamp NOT NULL, "updated_at" timestamp NOT NULL) [0m
  [1m[35m (2.5ms)[0m  CREATE TABLE "account_opportunities" ("id" serial primary key, "account_id" integer, "opportunity_id" integer, "deleted_at" timestamp, "created_at" timestamp NOT NULL, "updated_at" timestamp NOT NULL) 
  [1m[36m (4.2ms)[0m  [1mCREATE TABLE "accounts" ("id" serial primary key, "user_id" integer, "assigned_to" integer, "name" character varying(64) DEFAULT '' NOT NULL, "access" character varying(8) DEFAULT 'Public', "website" character varying(64), "toll_free_phone" character varying(32), "phone" character varying(32), "fax" character varying(32), "deleted_at" timestamp, "created_at" timestamp NOT NULL, "updated_at" timestamp NOT NULL, "email" character varying(64), "background_info" character varying(255), "rating" integer DEFAULT 0 NOT NULL, "category" character varying(32), "subscribed_users" text, "cf_vend_customer_id" character varying(255)) [0m
  [1m[35m (1.1ms)[0m  CREATE INDEX "index_accounts_on_assigned_to" ON "accounts" ("assigned_to")
  [1m[36m (1.2ms)[0m  [1mCREATE UNIQUE INDEX "index_accounts_on_user_id_and_name_and_deleted_at" ON "accounts" ("user_id", "name", "deleted_at")[0m
  [1m[35m (3.4ms)[0m  CREATE TABLE "activities" ("id" serial primary key, "user_id" integer, "subject_id" integer, "subject_type" character varying(255), "action" character varying(32) DEFAULT 'created', "info" character varying(255) DEFAULT '', "private" boolean DEFAULT 'f', "created_at" timestamp NOT NULL, "updated_at" timestamp NOT NULL) 
  [1m[36m (0.9ms)[0m  [1mCREATE INDEX "index_activities_on_created_at" ON "activities" ("created_at")[0m
  [1m[35m (0.9ms)[0m  CREATE INDEX "index_activities_on_user_id" ON "activities" ("user_id")
  [1m[36m (3.4ms)[0m  [1mCREATE TABLE "addresses" ("id" serial primary key, "street1" character varying(255), "street2" character varying(255), "city" character varying(64), "state" character varying(64), "zipcode" character varying(16), "country" character varying(64), "full_address" character varying(255), "address_type" character varying(16), "addressable_id" integer, "addressable_type" character varying(255), "created_at" timestamp NOT NULL, "updated_at" timestamp NOT NULL, "deleted_at" timestamp) [0m
  [1m[35m (1.0ms)[0m  CREATE INDEX "index_addresses_on_addressable_id_and_addressable_type" ON "addresses" ("addressable_id", "addressable_type")
  [1m[36m (3.1ms)[0m  [1mCREATE TABLE "avatars" ("id" serial primary key, "user_id" integer, "entity_id" integer, "entity_type" character varying(255), "image_file_size" integer, "image_file_name" character varying(255), "image_content_type" character varying(255), "created_at" timestamp NOT NULL, "updated_at" timestamp NOT NULL) [0m
  [1m[35m (3.7ms)[0m  CREATE TABLE "campaigns" ("id" serial primary key, "user_id" integer, "assigned_to" integer, "name" character varying(64) DEFAULT '' NOT NULL, "access" character varying(8) DEFAULT 'Public', "status" character varying(64), "budget" decimal(12,2), "target_leads" integer, "target_conversion" float, "target_revenue" decimal(12,2), "leads_count" integer, "opportunities_count" integer, "revenue" decimal(12,2), "starts_on" date, "ends_on" date, "objectives" text, "deleted_at" timestamp, "created_at" timestamp NOT NULL, "updated_at" timestamp NOT NULL, "background_info" character varying(255), "subscribed_users" text) 
  [1m[36m (0.8ms)[0m  [1mCREATE INDEX "index_campaigns_on_assigned_to" ON "campaigns" ("assigned_to")[0m
  [1m[35m (1.0ms)[0m  CREATE UNIQUE INDEX "index_campaigns_on_user_id_and_name_and_deleted_at" ON "campaigns" ("user_id", "name", "deleted_at")
  [1m[36m (4.3ms)[0m  [1mCREATE TABLE "comments" ("id" serial primary key, "user_id" integer, "commentable_id" integer, "commentable_type" character varying(255), "private" boolean, "title" character varying(255) DEFAULT '', "comment" text, "created_at" timestamp NOT NULL, "updated_at" timestamp NOT NULL, "state" character varying(16) DEFAULT 'Expanded' NOT NULL) [0m
  [1m[35m (2.5ms)[0m  CREATE TABLE "contact_opportunities" ("id" serial primary key, "contact_id" integer, "opportunity_id" integer, "role" character varying(32), "deleted_at" timestamp, "created_at" timestamp NOT NULL, "updated_at" timestamp NOT NULL) 
  [1m[36m (4.3ms)[0m  [1mCREATE TABLE "contacts" ("id" serial primary key, "user_id" integer, "lead_id" integer, "assigned_to" integer, "reports_to" integer, "first_name" character varying(64) DEFAULT '' NOT NULL, "last_name" character varying(64) DEFAULT '' NOT NULL, "access" character varying(8) DEFAULT 'Public', "title" character varying(64), "department" character varying(64), "source" character varying(32), "email" character varying(64), "alt_email" character varying(64), "phone" character varying(32), "mobile" character varying(32), "fax" character varying(32), "blog" character varying(128), "linkedin" character varying(128), "facebook" character varying(128), "twitter" character varying(128), "born_on" date, "do_not_call" boolean DEFAULT 'f' NOT NULL, "deleted_at" timestamp, "created_at" timestamp NOT NULL, "updated_at" timestamp NOT NULL, "background_info" character varying(255), "skype" character varying(128), "subscribed_users" text) [0m
  [1m[35m (0.9ms)[0m  CREATE INDEX "index_contacts_on_assigned_to" ON "contacts" ("assigned_to")
  [1m[36m (1.1ms)[0m  [1mCREATE UNIQUE INDEX "id_last_name_deleted" ON "contacts" ("user_id", "last_name", "deleted_at")[0m
  [1m[35m (3.6ms)[0m  CREATE TABLE "emails" ("id" serial primary key, "imap_message_id" character varying(255) NOT NULL, "user_id" integer, "mediator_id" integer, "mediator_type" character varying(255), "sent_from" character varying(255) NOT NULL, "sent_to" character varying(255) NOT NULL, "cc" character varying(255), "bcc" character varying(255), "subject" character varying(255), "body" text, "header" text, "sent_at" timestamp, "received_at" timestamp, "deleted_at" timestamp, "created_at" timestamp NOT NULL, "updated_at" timestamp NOT NULL, "state" character varying(16) DEFAULT 'Expanded' NOT NULL) 
  [1m[36m (0.9ms)[0m  [1mCREATE INDEX "index_emails_on_mediator_id_and_mediator_type" ON "emails" ("mediator_id", "mediator_type")[0m
  [1m[35m (3.0ms)[0m  CREATE TABLE "field_groups" ("id" serial primary key, "name" character varying(64), "label" character varying(128), "position" integer, "hint" character varying(255), "created_at" timestamp NOT NULL, "updated_at" timestamp NOT NULL, "tag_id" integer, "klass_name" character varying(32)) 
  [1m[36m (3.6ms)[0m  [1mCREATE TABLE "fields" ("id" serial primary key, "type" character varying(255), "field_group_id" integer, "position" integer, "name" character varying(64), "label" character varying(128), "hint" character varying(255), "placeholder" character varying(255), "as" character varying(32), "collection" text, "disabled" boolean, "required" boolean, "maxlength" integer, "created_at" timestamp NOT NULL, "updated_at" timestamp NOT NULL) [0m
  [1m[35m (0.8ms)[0m  CREATE INDEX "index_fields_on_field_group_id" ON "fields" ("field_group_id")
  [1m[36m (0.9ms)[0m  [1mCREATE INDEX "index_fields_on_name" ON "fields" ("name")[0m
  [1m[35m (4.0ms)[0m  CREATE TABLE "leads" ("id" serial primary key, "user_id" integer, "campaign_id" integer, "assigned_to" integer, "first_name" character varying(64) DEFAULT '' NOT NULL, "last_name" character varying(64) DEFAULT '' NOT NULL, "access" character varying(8) DEFAULT 'Public', "title" character varying(64), "company" character varying(64), "source" character varying(32), "status" character varying(32), "referred_by" character varying(64), "email" character varying(64), "alt_email" character varying(64), "phone" character varying(32), "mobile" character varying(32), "blog" character varying(128), "linkedin" character varying(128), "facebook" character varying(128), "twitter" character varying(128), "rating" integer DEFAULT 0 NOT NULL, "do_not_call" boolean DEFAULT 'f' NOT NULL, "deleted_at" timestamp, "created_at" timestamp NOT NULL, "updated_at" timestamp NOT NULL, "background_info" character varying(255), "skype" character varying(128), "subscribed_users" text) 
  [1m[36m (0.9ms)[0m  [1mCREATE INDEX "index_leads_on_assigned_to" ON "leads" ("assigned_to")[0m
  [1m[35m (1.2ms)[0m  CREATE UNIQUE INDEX "index_leads_on_user_id_and_last_name_and_deleted_at" ON "leads" ("user_id", "last_name", "deleted_at")
  [1m[36m (3.4ms)[0m  [1mCREATE TABLE "lists" ("id" serial primary key, "name" character varying(255), "url" text, "created_at" timestamp NOT NULL, "updated_at" timestamp NOT NULL) [0m
  [1m[35m (3.8ms)[0m  CREATE TABLE "opportunities" ("id" serial primary key, "user_id" integer, "campaign_id" integer, "assigned_to" integer, "name" character varying(64) DEFAULT '' NOT NULL, "access" character varying(8) DEFAULT 'Public', "source" character varying(32), "stage" character varying(32), "probability" integer, "amount" decimal(12,2), "discount" decimal(12,2), "closes_on" date, "deleted_at" timestamp, "created_at" timestamp NOT NULL, "updated_at" timestamp NOT NULL, "background_info" character varying(255), "subscribed_users" text) 
  [1m[36m (1.1ms)[0m  [1mCREATE INDEX "index_opportunities_on_assigned_to" ON "opportunities" ("assigned_to")[0m
  [1m[35m (1.0ms)[0m  CREATE UNIQUE INDEX "id_name_deleted" ON "opportunities" ("user_id", "name", "deleted_at")
  [1m[36m (2.9ms)[0m  [1mCREATE TABLE "permissions" ("id" serial primary key, "user_id" integer, "asset_id" integer, "asset_type" character varying(255), "created_at" timestamp NOT NULL, "updated_at" timestamp NOT NULL) [0m
  [1m[35m (1.2ms)[0m  CREATE INDEX "index_permissions_on_asset_id_and_asset_type" ON "permissions" ("asset_id", "asset_type")
  [1m[36m (1.0ms)[0m  [1mCREATE INDEX "index_permissions_on_user_id" ON "permissions" ("user_id")[0m
  [1m[35m (4.3ms)[0m  CREATE TABLE "preferences" ("id" serial primary key, "user_id" integer, "name" character varying(32) DEFAULT '' NOT NULL, "value" text, "created_at" timestamp NOT NULL, "updated_at" timestamp NOT NULL) 
  [1m[36m (1.1ms)[0m  [1mCREATE INDEX "index_preferences_on_user_id_and_name" ON "preferences" ("user_id", "name")[0m
  [1m[35m (3.1ms)[0m  CREATE TABLE "sessions" ("id" serial primary key, "session_id" character varying(255) NOT NULL, "data" text, "created_at" timestamp NOT NULL, "updated_at" timestamp NOT NULL) 
  [1m[36m (1.1ms)[0m  [1mCREATE INDEX "index_sessions_on_session_id" ON "sessions" ("session_id")[0m
  [1m[35m (0.9ms)[0m  CREATE INDEX "index_sessions_on_updated_at" ON "sessions" ("updated_at")
  [1m[36m (2.9ms)[0m  [1mCREATE TABLE "settings" ("id" serial primary key, "name" character varying(32) DEFAULT '' NOT NULL, "value" text, "created_at" timestamp NOT NULL, "updated_at" timestamp NOT NULL) [0m
  [1m[35m (1.1ms)[0m  CREATE INDEX "index_settings_on_name" ON "settings" ("name")
  [1m[36m (28.9ms)[0m  [1mCREATE TABLE "taggings" ("id" serial primary key, "tag_id" integer, "taggable_id" integer, "tagger_id" integer, "tagger_type" character varying(255), "taggable_type" character varying(255), "context" character varying(255), "created_at" timestamp) [0m
  [1m[35m (2.6ms)[0m  CREATE INDEX "index_taggings_on_tag_id" ON "taggings" ("tag_id")
  [1m[36m (1.0ms)[0m  [1mCREATE INDEX "index_taggings_on_taggable_id_and_taggable_type_and_context" ON "taggings" ("taggable_id", "taggable_type", "context")[0m
  [1m[35m (2.1ms)[0m  CREATE TABLE "tags" ("id" serial primary key, "name" character varying(255)) 
  [1m[36m (14.0ms)[0m  [1mCREATE TABLE "tasks" ("id" serial primary key, "user_id" integer, "assigned_to" integer, "completed_by" integer, "name" character varying(255) DEFAULT '' NOT NULL, "asset_id" integer, "asset_type" character varying(255), "priority" character varying(32), "category" character varying(32), "bucket" character varying(32), "due_at" timestamp, "completed_at" timestamp, "deleted_at" timestamp, "created_at" timestamp NOT NULL, "updated_at" timestamp NOT NULL, "background_info" character varying(255), "subscribed_users" text) [0m
  [1m[35m (1.1ms)[0m  CREATE INDEX "index_tasks_on_assigned_to" ON "tasks" ("assigned_to")
  [1m[36m (1.1ms)[0m  [1mCREATE UNIQUE INDEX "index_tasks_on_user_id_and_name_and_deleted_at" ON "tasks" ("user_id", "name", "deleted_at")[0m
  [1m[35m (4.8ms)[0m  CREATE TABLE "users" ("id" serial primary key, "username" character varying(32) DEFAULT '' NOT NULL, "email" character varying(64) DEFAULT '' NOT NULL, "first_name" character varying(32), "last_name" character varying(32), "title" character varying(64), "company" character varying(64), "alt_email" character varying(64), "phone" character varying(32), "mobile" character varying(32), "aim" character varying(32), "yahoo" character varying(32), "google" character varying(32), "skype" character varying(32), "password_hash" character varying(255) DEFAULT '' NOT NULL, "password_salt" character varying(255) DEFAULT '' NOT NULL, "persistence_token" character varying(255) DEFAULT '' NOT NULL, "perishable_token" character varying(255) DEFAULT '' NOT NULL, "last_request_at" timestamp, "last_login_at" timestamp, "current_login_at" timestamp, "last_login_ip" character varying(255), "current_login_ip" character varying(255), "login_count" integer DEFAULT 0 NOT NULL, "deleted_at" timestamp, "created_at" timestamp NOT NULL, "updated_at" timestamp NOT NULL, "admin" boolean DEFAULT 'f' NOT NULL, "suspended_at" timestamp, "single_access_token" character varying(255)) 
  [1m[36m (1.1ms)[0m  [1mCREATE INDEX "index_users_on_email" ON "users" ("email")[0m
  [1m[35m (0.9ms)[0m  CREATE INDEX "index_users_on_last_request_at" ON "users" ("last_request_at")
  [1m[36m (0.9ms)[0m  [1mCREATE INDEX "index_users_on_perishable_token" ON "users" ("perishable_token")[0m
  [1m[35m (1.1ms)[0m  CREATE INDEX "index_users_on_remember_token" ON "users" ("persistence_token")
  [1m[36m (1.2ms)[0m  [1mCREATE UNIQUE INDEX "index_users_on_username_and_deleted_at" ON "users" ("username", "deleted_at")[0m
  [1m[35m (16.5ms)[0m  CREATE TABLE "versions" ("id" serial primary key, "item_type" character varying(255) NOT NULL, "item_id" integer NOT NULL, "event" character varying(512) NOT NULL, "whodunnit" character varying(255), "object" text, "created_at" timestamp, "object_changes" text, "related_id" integer, "related_type" character varying(255)) 
  [1m[36m (1.1ms)[0m  [1mCREATE INDEX "index_versions_on_item_type_and_item_id" ON "versions" ("item_type", "item_id")[0m
  [1m[35m (1.0ms)[0m  CREATE INDEX "index_versions_on_whodunnit" ON "versions" ("whodunnit")
  [1m[36m (0.8ms)[0m  [1mCREATE TABLE "schema_migrations" ("version" character varying(255) NOT NULL) [0m
  [1m[35m (1.0ms)[0m  CREATE UNIQUE INDEX "unique_schema_migrations" ON "schema_migrations" ("version")
  [1m[36m (0.3ms)[0m  [1mSELECT version FROM "schema_migrations"[0m
  [1m[35m (0.5ms)[0m  INSERT INTO "schema_migrations" (version) VALUES ('20120528102124')
  [1m[36m (0.2ms)[0m  [1mBEGIN[0m
  [1m[35m (0.4ms)[0m  ROLLBACK
  [1m[36m (0.1ms)[0m  [1mBEGIN[0m
Started POST "/vend/register_sale" for 127.0.0.1 at 2013-03-07 00:09:32 +1300
Processing by VendController#register_sale as JSON
  Parameters: {"payload"=>{"id"=>"5e8b5134-a002-dd6b-b7c7-26126887c4ee", "sale_date"=>"2012-11-13 16:40:06", "status"=>"CLOSED", "user_id"=>"9b2a8d5f-2d20-11e2-8057-080027706aa2", "customer_id"=>"9b17ac9d-2d20-11e2-8057-080027706aa2", "register_id"=>"9af85e69-2d20-11e2-8057-080027706aa2", "market_id"=>"1", "invoice_number"=>"144", "short_code"=>"ne2zq", "totals"=>{"total_price"=>"4.87", "total_tax"=>"0.69", "total_payment"=>"5.55", "total_to_pay"=>"0"}, "note"=>nil, "updated_at"=>"2012-11-13 16:40:09", "created_at"=>"2012-11-13 16:40:09", "customer"=>{"id"=>"9b17ac9d-2d20-11e2-8057-080027706aa2", "customer_code"=>"WALKIN", "balance"=>"-6.250", "points"=>"0", "note"=>nil, "year_to_date"=>"79945.92188", "sex"=>"M", "date_of_birth"=>"1950-05-25", "updated_at"=>"2012-11-13 16:43:15", "created_at"=>"2012-11-13 12:28:03"}, "user"=>{"id"=>"9b2a8d5f-2d20-11e2-8057-080027706aa2", "name"=>"admin", "display_name"=>"A admin this time", "outlet_id"=>"9ae97219-2d20-11e2-8057-080027706aa2", "target_daily"=>nil, "target_weekly"=>nil, "target_monthly"=>nil, "created_at"=>"2011-09-08 05:18:38", "updated_at"=>"2011-09-08 05:18:38"}, "register_sale_products"=>[{"id"=>"148793f0-475a-7d49-442d-fd761ce76339", "product_id"=>"9fe945bc-2d20-11e2-8057-080027706aa2", "quantity"=>"1", "price"=>"1.90", "price_set"=>"true", "tax"=>"0.24", "price_total"=>"1.9", "tax_total"=>"0.24", "tax_id"=>"9a025ff0-2d20-11e2-8057-080027706aa2", "tax_name"=>"NZ GST", "tax_rate"=>"0.150000"}, {"id"=>"7d37dc0f-9462-06fa-cae0-0b4988b36539", "product_id"=>"a0c0df02-2d20-11e2-8057-080027706aa2", "quantity"=>"3", "price"=>"0.99", "price_set"=>"true", "tax"=>"0.15", "price_total"=>"2.97", "tax_total"=>"0.45", "tax_id"=>"9a025ff0-2d20-11e2-8057-080027706aa2", "tax_name"=>"NZ GST", "tax_rate"=>"0.150000"}], "register_sale_payments"=>[{"id"=>"39948e3e-bf93-1b60-ff44-f46a777ed1d4", "payment_date"=>"2012-11-13 16:40:06", "amount"=>"5.55", "retailer_payment_type_id"=>"9e9ba1ba-2d20-11e2-8057-080027706aa2", "payment_type_id"=>"1"}]}}
  [1m[35mAccount Load (0.8ms)[0m  SELECT "accounts".* FROM "accounts" WHERE "accounts"."cf_vend_customer_id" = '9b17ac9d-2d20-11e2-8057-080027706aa2' LIMIT 1
  [1m[36m (0.2ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35m (1.0ms)[0m  SELECT "tags".id FROM "tags" INNER JOIN "taggings" ON "tags"."id" = "taggings"."tag_id" WHERE "taggings"."taggable_id" IS NULL AND "taggings"."taggable_type" = 'Account' AND (taggings.context = 'tags')
  [1m[36mFieldGroup Load (0.5ms)[0m  [1mSELECT "field_groups".* FROM "field_groups" WHERE "field_groups"."klass_name" = 'Account' AND (tag_id IS NULL OR tag_id IN (NULL)) ORDER BY position[0m
  [1m[35mAccount Exists (0.4ms)[0m  SELECT 1 AS one FROM "accounts" WHERE ("accounts"."name" = 'Account for Register Sale 144' AND "accounts"."deleted_at" IS NULL) LIMIT 1
  [1m[36mSQL (1.3ms)[0m  [1mINSERT INTO "accounts" ("access", "assigned_to", "background_info", "category", "cf_vend_customer_id", "created_at", "deleted_at", "email", "fax", "name", "phone", "rating", "subscribed_users", "toll_free_phone", "updated_at", "user_id", "website") VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9, $10, $11, $12, $13, $14, $15, $16, $17) RETURNING "id"[0m  [["access", "Public"], ["assigned_to", nil], ["background_info", nil], ["category", nil], ["cf_vend_customer_id", "9b17ac9d-2d20-11e2-8057-080027706aa2"], ["created_at", Wed, 06 Mar 2013 11:09:33 UTC +00:00], ["deleted_at", nil], ["email", nil], ["fax", nil], ["name", "Account for Register Sale 144"], ["phone", nil], ["rating", 0], ["subscribed_users", nil], ["toll_free_phone", nil], ["updated_at", Wed, 06 Mar 2013 11:09:33 UTC +00:00], ["user_id", nil], ["website", nil]]
  [1m[35mSQL (1.3ms)[0m  INSERT INTO "versions" ("created_at", "event", "item_id", "item_type", "object", "object_changes", "related_id", "related_type", "whodunnit") VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9) RETURNING "id"  [["created_at", Wed, 06 Mar 2013 11:09:33 UTC +00:00], ["event", "create"], ["item_id", 1], ["item_type", "Account"], ["object", nil], ["object_changes", "--- !map:ActiveSupport::HashWithIndifferentAccess \nname: \n- \"\"\n- Account for Register Sale 144\ncf_vend_customer_id: \n- \n- 9b17ac9d-2d20-11e2-8057-080027706aa2\ncreated_at: \n- \n- &id001 2013-03-06 11:09:33.144944 Z\nupdated_at: \n- \n- *id001\nid: \n- \n- 1\n"], ["related_id", nil], ["related_type", nil], ["whodunnit", nil]]
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.2ms)[0m  SAVEPOINT active_record_1
  [1m[36m (0.4ms)[0m  [1mSELECT "tags".id FROM "tags" INNER JOIN "taggings" ON "tags"."id" = "taggings"."tag_id" WHERE "taggings"."taggable_id" IS NULL AND "taggings"."taggable_type" = 'Opportunity' AND (taggings.context = 'tags')[0m
  [1m[35mFieldGroup Load (0.3ms)[0m  SELECT "field_groups".* FROM "field_groups" WHERE "field_groups"."klass_name" = 'Opportunity' AND (tag_id IS NULL OR tag_id IN (NULL)) ORDER BY position
  [1m[36mSQL (1.8ms)[0m  [1mINSERT INTO "opportunities" ("access", "amount", "assigned_to", "background_info", "campaign_id", "closes_on", "created_at", "deleted_at", "discount", "name", "probability", "source", "stage", "subscribed_users", "updated_at", "user_id") VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9, $10, $11, $12, $13, $14, $15, $16) RETURNING "id"[0m  [["access", "Public"], ["amount", #<BigDecimal:7feb671e7eb8,'0.555E1',18(18)>], ["assigned_to", nil], ["background_info", nil], ["campaign_id", nil], ["closes_on", nil], ["created_at", Wed, 06 Mar 2013 11:09:33 UTC +00:00], ["deleted_at", nil], ["discount", nil], ["name", "Register Sale 144"], ["probability", nil], ["source", nil], ["stage", "won"], ["subscribed_users", nil], ["updated_at", Wed, 06 Mar 2013 11:09:33 UTC +00:00], ["user_id", nil]]
  [1m[35mSQL (0.4ms)[0m  INSERT INTO "versions" ("created_at", "event", "item_id", "item_type", "object", "object_changes", "related_id", "related_type", "whodunnit") VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9) RETURNING "id"  [["created_at", Wed, 06 Mar 2013 11:09:33 UTC +00:00], ["event", "create"], ["item_id", 1], ["item_type", "Opportunity"], ["object", nil], ["object_changes", "--- !map:ActiveSupport::HashWithIndifferentAccess \nname: \n- \"\"\n- Register Sale 144\namount: \n- \n- 5.55\nstage: \n- \n- won\ncreated_at: \n- \n- &id001 2013-03-06 11:09:33.199309 Z\nupdated_at: \n- \n- *id001\nid: \n- \n- 1\n"], ["related_id", nil], ["related_type", nil], ["whodunnit", nil]]
  [1m[36m (0.2ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.2ms)[0m  SAVEPOINT active_record_1
  [1m[36mSQL (0.9ms)[0m  [1mINSERT INTO "account_opportunities" ("account_id", "created_at", "deleted_at", "opportunity_id", "updated_at") VALUES ($1, $2, $3, $4, $5) RETURNING "id"[0m  [["account_id", 1], ["created_at", Wed, 06 Mar 2013 11:09:33 UTC +00:00], ["deleted_at", nil], ["opportunity_id", 1], ["updated_at", Wed, 06 Mar 2013 11:09:33 UTC +00:00]]
  [1m[35mSQL (0.4ms)[0m  INSERT INTO "versions" ("created_at", "event", "item_id", "item_type", "object", "object_changes", "related_id", "related_type", "whodunnit") VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9) RETURNING "id"  [["created_at", Wed, 06 Mar 2013 11:09:33 UTC +00:00], ["event", "create"], ["item_id", 1], ["item_type", "AccountOpportunity"], ["object", nil], ["object_changes", "--- !map:ActiveSupport::HashWithIndifferentAccess \naccount_id: \n- \n- 1\nopportunity_id: \n- \n- 1\ncreated_at: \n- \n- &id001 2013-03-06 11:09:33.267823 Z\nupdated_at: \n- \n- *id001\nid: \n- \n- 1\n"], ["related_id", nil], ["related_type", nil], ["whodunnit", nil]]
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mOpportunity Load (0.5ms)[0m  [1mSELECT "opportunities".* FROM "opportunities" WHERE "opportunities"."id" = 1 LIMIT 1[0m
  [1m[35m (0.2ms)[0m  RELEASE SAVEPOINT active_record_1
Completed 201 Created in 285ms (Views: 0.2ms | ActiveRecord: 0.0ms)
  [1m[36m (0.6ms)[0m  [1mROLLBACK[0m
Connecting to database specified by database.yml
  [1m[36mFieldGroup Load (4.6ms)[0m  [1mSELECT "field_groups".* FROM "field_groups" WHERE "field_groups"."klass_name" = 'Account' ORDER BY position[0m
  [1m[35mFieldGroup Load (0.2ms)[0m  SELECT "field_groups".* FROM "field_groups" WHERE "field_groups"."klass_name" = 'Campaign' ORDER BY position
  [1m[36mFieldGroup Load (0.3ms)[0m  [1mSELECT "field_groups".* FROM "field_groups" WHERE "field_groups"."klass_name" = 'Contact' ORDER BY position[0m
  [1m[35mFieldGroup Load (0.3ms)[0m  SELECT "field_groups".* FROM "field_groups" WHERE "field_groups"."klass_name" = 'Lead' ORDER BY position
  [1m[36mFieldGroup Load (0.2ms)[0m  [1mSELECT "field_groups".* FROM "field_groups" WHERE "field_groups"."klass_name" = 'Opportunity' ORDER BY position[0m
  [1m[35mFieldGroup Load (0.3ms)[0m  SELECT "field_groups".* FROM "field_groups" WHERE "field_groups"."klass_name" = 'Task' ORDER BY position
Creating scope :except. Overwriting existing method User.except.
  [1m[36m (141.9ms)[0m  [1mDROP DATABASE IF EXISTS "ffcrm_vend_test"[0m
  [1m[35m (424.7ms)[0m  CREATE DATABASE "ffcrm_vend_test" ENCODING = 'utf8'
  [1m[36m (6.4ms)[0m  [1mCREATE TABLE "account_contacts" ("id" serial primary key, "account_id" integer, "contact_id" integer, "deleted_at" timestamp, "created_at" timestamp NOT NULL, "updated_at" timestamp NOT NULL) [0m
  [1m[35m (2.3ms)[0m  CREATE TABLE "account_opportunities" ("id" serial primary key, "account_id" integer, "opportunity_id" integer, "deleted_at" timestamp, "created_at" timestamp NOT NULL, "updated_at" timestamp NOT NULL) 
  [1m[36m (4.4ms)[0m  [1mCREATE TABLE "accounts" ("id" serial primary key, "user_id" integer, "assigned_to" integer, "name" character varying(64) DEFAULT '' NOT NULL, "access" character varying(8) DEFAULT 'Public', "website" character varying(64), "toll_free_phone" character varying(32), "phone" character varying(32), "fax" character varying(32), "deleted_at" timestamp, "created_at" timestamp NOT NULL, "updated_at" timestamp NOT NULL, "email" character varying(64), "background_info" character varying(255), "rating" integer DEFAULT 0 NOT NULL, "category" character varying(32), "subscribed_users" text, "cf_vend_customer_id" character varying(255)) [0m
  [1m[35m (1.1ms)[0m  CREATE INDEX "index_accounts_on_assigned_to" ON "accounts" ("assigned_to")
  [1m[36m (1.3ms)[0m  [1mCREATE UNIQUE INDEX "index_accounts_on_user_id_and_name_and_deleted_at" ON "accounts" ("user_id", "name", "deleted_at")[0m
  [1m[35m (3.8ms)[0m  CREATE TABLE "activities" ("id" serial primary key, "user_id" integer, "subject_id" integer, "subject_type" character varying(255), "action" character varying(32) DEFAULT 'created', "info" character varying(255) DEFAULT '', "private" boolean DEFAULT 'f', "created_at" timestamp NOT NULL, "updated_at" timestamp NOT NULL) 
  [1m[36m (1.0ms)[0m  [1mCREATE INDEX "index_activities_on_created_at" ON "activities" ("created_at")[0m
  [1m[35m (1.0ms)[0m  CREATE INDEX "index_activities_on_user_id" ON "activities" ("user_id")
  [1m[36m (3.8ms)[0m  [1mCREATE TABLE "addresses" ("id" serial primary key, "street1" character varying(255), "street2" character varying(255), "city" character varying(64), "state" character varying(64), "zipcode" character varying(16), "country" character varying(64), "full_address" character varying(255), "address_type" character varying(16), "addressable_id" integer, "addressable_type" character varying(255), "created_at" timestamp NOT NULL, "updated_at" timestamp NOT NULL, "deleted_at" timestamp) [0m
  [1m[35m (1.0ms)[0m  CREATE INDEX "index_addresses_on_addressable_id_and_addressable_type" ON "addresses" ("addressable_id", "addressable_type")
  [1m[36m (3.9ms)[0m  [1mCREATE TABLE "avatars" ("id" serial primary key, "user_id" integer, "entity_id" integer, "entity_type" character varying(255), "image_file_size" integer, "image_file_name" character varying(255), "image_content_type" character varying(255), "created_at" timestamp NOT NULL, "updated_at" timestamp NOT NULL) [0m
  [1m[35m (3.8ms)[0m  CREATE TABLE "campaigns" ("id" serial primary key, "user_id" integer, "assigned_to" integer, "name" character varying(64) DEFAULT '' NOT NULL, "access" character varying(8) DEFAULT 'Public', "status" character varying(64), "budget" decimal(12,2), "target_leads" integer, "target_conversion" float, "target_revenue" decimal(12,2), "leads_count" integer, "opportunities_count" integer, "revenue" decimal(12,2), "starts_on" date, "ends_on" date, "objectives" text, "deleted_at" timestamp, "created_at" timestamp NOT NULL, "updated_at" timestamp NOT NULL, "background_info" character varying(255), "subscribed_users" text) 
  [1m[36m (1.0ms)[0m  [1mCREATE INDEX "index_campaigns_on_assigned_to" ON "campaigns" ("assigned_to")[0m
  [1m[35m (1.2ms)[0m  CREATE UNIQUE INDEX "index_campaigns_on_user_id_and_name_and_deleted_at" ON "campaigns" ("user_id", "name", "deleted_at")
  [1m[36m (3.8ms)[0m  [1mCREATE TABLE "comments" ("id" serial primary key, "user_id" integer, "commentable_id" integer, "commentable_type" character varying(255), "private" boolean, "title" character varying(255) DEFAULT '', "comment" text, "created_at" timestamp NOT NULL, "updated_at" timestamp NOT NULL, "state" character varying(16) DEFAULT 'Expanded' NOT NULL) [0m
  [1m[35m (2.6ms)[0m  CREATE TABLE "contact_opportunities" ("id" serial primary key, "contact_id" integer, "opportunity_id" integer, "role" character varying(32), "deleted_at" timestamp, "created_at" timestamp NOT NULL, "updated_at" timestamp NOT NULL) 
  [1m[36m (4.8ms)[0m  [1mCREATE TABLE "contacts" ("id" serial primary key, "user_id" integer, "lead_id" integer, "assigned_to" integer, "reports_to" integer, "first_name" character varying(64) DEFAULT '' NOT NULL, "last_name" character varying(64) DEFAULT '' NOT NULL, "access" character varying(8) DEFAULT 'Public', "title" character varying(64), "department" character varying(64), "source" character varying(32), "email" character varying(64), "alt_email" character varying(64), "phone" character varying(32), "mobile" character varying(32), "fax" character varying(32), "blog" character varying(128), "linkedin" character varying(128), "facebook" character varying(128), "twitter" character varying(128), "born_on" date, "do_not_call" boolean DEFAULT 'f' NOT NULL, "deleted_at" timestamp, "created_at" timestamp NOT NULL, "updated_at" timestamp NOT NULL, "background_info" character varying(255), "skype" character varying(128), "subscribed_users" text) [0m
  [1m[35m (1.3ms)[0m  CREATE INDEX "index_contacts_on_assigned_to" ON "contacts" ("assigned_to")
  [1m[36m (1.4ms)[0m  [1mCREATE UNIQUE INDEX "id_last_name_deleted" ON "contacts" ("user_id", "last_name", "deleted_at")[0m
  [1m[35m (4.4ms)[0m  CREATE TABLE "emails" ("id" serial primary key, "imap_message_id" character varying(255) NOT NULL, "user_id" integer, "mediator_id" integer, "mediator_type" character varying(255), "sent_from" character varying(255) NOT NULL, "sent_to" character varying(255) NOT NULL, "cc" character varying(255), "bcc" character varying(255), "subject" character varying(255), "body" text, "header" text, "sent_at" timestamp, "received_at" timestamp, "deleted_at" timestamp, "created_at" timestamp NOT NULL, "updated_at" timestamp NOT NULL, "state" character varying(16) DEFAULT 'Expanded' NOT NULL) 
  [1m[36m (1.3ms)[0m  [1mCREATE INDEX "index_emails_on_mediator_id_and_mediator_type" ON "emails" ("mediator_id", "mediator_type")[0m
  [1m[35m (2.7ms)[0m  CREATE TABLE "field_groups" ("id" serial primary key, "name" character varying(64), "label" character varying(128), "position" integer, "hint" character varying(255), "created_at" timestamp NOT NULL, "updated_at" timestamp NOT NULL, "tag_id" integer, "klass_name" character varying(32)) 
  [1m[36m (3.4ms)[0m  [1mCREATE TABLE "fields" ("id" serial primary key, "type" character varying(255), "field_group_id" integer, "position" integer, "name" character varying(64), "label" character varying(128), "hint" character varying(255), "placeholder" character varying(255), "as" character varying(32), "collection" text, "disabled" boolean, "required" boolean, "maxlength" integer, "created_at" timestamp NOT NULL, "updated_at" timestamp NOT NULL) [0m
  [1m[35m (0.9ms)[0m  CREATE INDEX "index_fields_on_field_group_id" ON "fields" ("field_group_id")
  [1m[36m (1.0ms)[0m  [1mCREATE INDEX "index_fields_on_name" ON "fields" ("name")[0m
  [1m[35m (4.8ms)[0m  CREATE TABLE "leads" ("id" serial primary key, "user_id" integer, "campaign_id" integer, "assigned_to" integer, "first_name" character varying(64) DEFAULT '' NOT NULL, "last_name" character varying(64) DEFAULT '' NOT NULL, "access" character varying(8) DEFAULT 'Public', "title" character varying(64), "company" character varying(64), "source" character varying(32), "status" character varying(32), "referred_by" character varying(64), "email" character varying(64), "alt_email" character varying(64), "phone" character varying(32), "mobile" character varying(32), "blog" character varying(128), "linkedin" character varying(128), "facebook" character varying(128), "twitter" character varying(128), "rating" integer DEFAULT 0 NOT NULL, "do_not_call" boolean DEFAULT 'f' NOT NULL, "deleted_at" timestamp, "created_at" timestamp NOT NULL, "updated_at" timestamp NOT NULL, "background_info" character varying(255), "skype" character varying(128), "subscribed_users" text) 
  [1m[36m (1.0ms)[0m  [1mCREATE INDEX "index_leads_on_assigned_to" ON "leads" ("assigned_to")[0m
  [1m[35m (1.0ms)[0m  CREATE UNIQUE INDEX "index_leads_on_user_id_and_last_name_and_deleted_at" ON "leads" ("user_id", "last_name", "deleted_at")
  [1m[36m (4.1ms)[0m  [1mCREATE TABLE "lists" ("id" serial primary key, "name" character varying(255), "url" text, "created_at" timestamp NOT NULL, "updated_at" timestamp NOT NULL) [0m
  [1m[35m (4.9ms)[0m  CREATE TABLE "opportunities" ("id" serial primary key, "user_id" integer, "campaign_id" integer, "assigned_to" integer, "name" character varying(64) DEFAULT '' NOT NULL, "access" character varying(8) DEFAULT 'Public', "source" character varying(32), "stage" character varying(32), "probability" integer, "amount" decimal(12,2), "discount" decimal(12,2), "closes_on" date, "deleted_at" timestamp, "created_at" timestamp NOT NULL, "updated_at" timestamp NOT NULL, "background_info" character varying(255), "subscribed_users" text) 
  [1m[36m (1.1ms)[0m  [1mCREATE INDEX "index_opportunities_on_assigned_to" ON "opportunities" ("assigned_to")[0m
  [1m[35m (1.1ms)[0m  CREATE UNIQUE INDEX "id_name_deleted" ON "opportunities" ("user_id", "name", "deleted_at")
  [1m[36m (3.2ms)[0m  [1mCREATE TABLE "permissions" ("id" serial primary key, "user_id" integer, "asset_id" integer, "asset_type" character varying(255), "created_at" timestamp NOT NULL, "updated_at" timestamp NOT NULL) [0m
  [1m[35m (1.1ms)[0m  CREATE INDEX "index_permissions_on_asset_id_and_asset_type" ON "permissions" ("asset_id", "asset_type")
  [1m[36m (0.9ms)[0m  [1mCREATE INDEX "index_permissions_on_user_id" ON "permissions" ("user_id")[0m
  [1m[35m (3.8ms)[0m  CREATE TABLE "preferences" ("id" serial primary key, "user_id" integer, "name" character varying(32) DEFAULT '' NOT NULL, "value" text, "created_at" timestamp NOT NULL, "updated_at" timestamp NOT NULL) 
  [1m[36m (1.2ms)[0m  [1mCREATE INDEX "index_preferences_on_user_id_and_name" ON "preferences" ("user_id", "name")[0m
  [1m[35m (3.7ms)[0m  CREATE TABLE "sessions" ("id" serial primary key, "session_id" character varying(255) NOT NULL, "data" text, "created_at" timestamp NOT NULL, "updated_at" timestamp NOT NULL) 
  [1m[36m (1.2ms)[0m  [1mCREATE INDEX "index_sessions_on_session_id" ON "sessions" ("session_id")[0m
  [1m[35m (1.0ms)[0m  CREATE INDEX "index_sessions_on_updated_at" ON "sessions" ("updated_at")
  [1m[36m (3.2ms)[0m  [1mCREATE TABLE "settings" ("id" serial primary key, "name" character varying(32) DEFAULT '' NOT NULL, "value" text, "created_at" timestamp NOT NULL, "updated_at" timestamp NOT NULL) [0m
  [1m[35m (1.2ms)[0m  CREATE INDEX "index_settings_on_name" ON "settings" ("name")
  [1m[36m (3.7ms)[0m  [1mCREATE TABLE "taggings" ("id" serial primary key, "tag_id" integer, "taggable_id" integer, "tagger_id" integer, "tagger_type" character varying(255), "taggable_type" character varying(255), "context" character varying(255), "created_at" timestamp) [0m
  [1m[35m (1.2ms)[0m  CREATE INDEX "index_taggings_on_tag_id" ON "taggings" ("tag_id")
  [1m[36m (1.0ms)[0m  [1mCREATE INDEX "index_taggings_on_taggable_id_and_taggable_type_and_context" ON "taggings" ("taggable_id", "taggable_type", "context")[0m
  [1m[35m (2.6ms)[0m  CREATE TABLE "tags" ("id" serial primary key, "name" character varying(255)) 
  [1m[36m (4.3ms)[0m  [1mCREATE TABLE "tasks" ("id" serial primary key, "user_id" integer, "assigned_to" integer, "completed_by" integer, "name" character varying(255) DEFAULT '' NOT NULL, "asset_id" integer, "asset_type" character varying(255), "priority" character varying(32), "category" character varying(32), "bucket" character varying(32), "due_at" timestamp, "completed_at" timestamp, "deleted_at" timestamp, "created_at" timestamp NOT NULL, "updated_at" timestamp NOT NULL, "background_info" character varying(255), "subscribed_users" text) [0m
  [1m[35m (0.9ms)[0m  CREATE INDEX "index_tasks_on_assigned_to" ON "tasks" ("assigned_to")
  [1m[36m (1.3ms)[0m  [1mCREATE UNIQUE INDEX "index_tasks_on_user_id_and_name_and_deleted_at" ON "tasks" ("user_id", "name", "deleted_at")[0m
  [1m[35m (5.2ms)[0m  CREATE TABLE "users" ("id" serial primary key, "username" character varying(32) DEFAULT '' NOT NULL, "email" character varying(64) DEFAULT '' NOT NULL, "first_name" character varying(32), "last_name" character varying(32), "title" character varying(64), "company" character varying(64), "alt_email" character varying(64), "phone" character varying(32), "mobile" character varying(32), "aim" character varying(32), "yahoo" character varying(32), "google" character varying(32), "skype" character varying(32), "password_hash" character varying(255) DEFAULT '' NOT NULL, "password_salt" character varying(255) DEFAULT '' NOT NULL, "persistence_token" character varying(255) DEFAULT '' NOT NULL, "perishable_token" character varying(255) DEFAULT '' NOT NULL, "last_request_at" timestamp, "last_login_at" timestamp, "current_login_at" timestamp, "last_login_ip" character varying(255), "current_login_ip" character varying(255), "login_count" integer DEFAULT 0 NOT NULL, "deleted_at" timestamp, "created_at" timestamp NOT NULL, "updated_at" timestamp NOT NULL, "admin" boolean DEFAULT 'f' NOT NULL, "suspended_at" timestamp, "single_access_token" character varying(255)) 
  [1m[36m (1.0ms)[0m  [1mCREATE INDEX "index_users_on_email" ON "users" ("email")[0m
  [1m[35m (0.9ms)[0m  CREATE INDEX "index_users_on_last_request_at" ON "users" ("last_request_at")
  [1m[36m (1.0ms)[0m  [1mCREATE INDEX "index_users_on_perishable_token" ON "users" ("perishable_token")[0m
  [1m[35m (1.1ms)[0m  CREATE INDEX "index_users_on_remember_token" ON "users" ("persistence_token")
  [1m[36m (1.2ms)[0m  [1mCREATE UNIQUE INDEX "index_users_on_username_and_deleted_at" ON "users" ("username", "deleted_at")[0m
  [1m[35m (4.3ms)[0m  CREATE TABLE "versions" ("id" serial primary key, "item_type" character varying(255) NOT NULL, "item_id" integer NOT NULL, "event" character varying(512) NOT NULL, "whodunnit" character varying(255), "object" text, "created_at" timestamp, "object_changes" text, "related_id" integer, "related_type" character varying(255)) 
  [1m[36m (1.0ms)[0m  [1mCREATE INDEX "index_versions_on_item_type_and_item_id" ON "versions" ("item_type", "item_id")[0m
  [1m[35m (1.0ms)[0m  CREATE INDEX "index_versions_on_whodunnit" ON "versions" ("whodunnit")
  [1m[36m (1.0ms)[0m  [1mCREATE TABLE "schema_migrations" ("version" character varying(255) NOT NULL) [0m
  [1m[35m (1.0ms)[0m  CREATE UNIQUE INDEX "unique_schema_migrations" ON "schema_migrations" ("version")
  [1m[36m (0.2ms)[0m  [1mSELECT version FROM "schema_migrations"[0m
  [1m[35m (0.5ms)[0m  INSERT INTO "schema_migrations" (version) VALUES ('20120528102124')
  [1m[36m (0.1ms)[0m  [1mBEGIN[0m
  [1m[35m (0.7ms)[0m  SELECT COUNT(*) FROM "opportunities" 
  [1m[36m (1.3ms)[0m  [1mSELECT COUNT(*) FROM "accounts" [0m
Started POST "/vend/register_sale" for 127.0.0.1 at 2013-03-07 23:38:27 +1300
Processing by VendController#register_sale as JSON
  Parameters: {"payload"=>{"id"=>"5e8b5134-a002-dd6b-b7c7-26126887c4ee", "sale_date"=>"2012-11-13 16:40:06", "status"=>"CLOSED", "user_id"=>"9b2a8d5f-2d20-11e2-8057-080027706aa2", "customer_id"=>"9b17ac9d-2d20-11e2-8057-080027706aa2", "register_id"=>"9af85e69-2d20-11e2-8057-080027706aa2", "market_id"=>"1", "invoice_number"=>"144", "short_code"=>"ne2zq", "totals"=>{"total_price"=>"4.87", "total_tax"=>"0.69", "total_payment"=>"5.55", "total_to_pay"=>"0"}, "note"=>nil, "updated_at"=>"2012-11-13 16:40:09", "created_at"=>"2012-11-13 16:40:09", "customer"=>{"id"=>"9b17ac9d-2d20-11e2-8057-080027706aa2", "customer_code"=>"WALKIN", "balance"=>"-6.250", "points"=>"0", "note"=>nil, "year_to_date"=>"79945.92188", "sex"=>"M", "date_of_birth"=>"1950-05-25", "updated_at"=>"2012-11-13 16:43:15", "created_at"=>"2012-11-13 12:28:03"}, "user"=>{"id"=>"9b2a8d5f-2d20-11e2-8057-080027706aa2", "name"=>"admin", "display_name"=>"A admin this time", "outlet_id"=>"9ae97219-2d20-11e2-8057-080027706aa2", "target_daily"=>nil, "target_weekly"=>nil, "target_monthly"=>nil, "created_at"=>"2011-09-08 05:18:38", "updated_at"=>"2011-09-08 05:18:38"}, "register_sale_products"=>[{"id"=>"148793f0-475a-7d49-442d-fd761ce76339", "product_id"=>"9fe945bc-2d20-11e2-8057-080027706aa2", "quantity"=>"1", "price"=>"1.90", "price_set"=>"true", "tax"=>"0.24", "price_total"=>"1.9", "tax_total"=>"0.24", "tax_id"=>"9a025ff0-2d20-11e2-8057-080027706aa2", "tax_name"=>"NZ GST", "tax_rate"=>"0.150000"}, {"id"=>"7d37dc0f-9462-06fa-cae0-0b4988b36539", "product_id"=>"a0c0df02-2d20-11e2-8057-080027706aa2", "quantity"=>"3", "price"=>"0.99", "price_set"=>"true", "tax"=>"0.15", "price_total"=>"2.97", "tax_total"=>"0.45", "tax_id"=>"9a025ff0-2d20-11e2-8057-080027706aa2", "tax_name"=>"NZ GST", "tax_rate"=>"0.150000"}], "register_sale_payments"=>[{"id"=>"39948e3e-bf93-1b60-ff44-f46a777ed1d4", "payment_date"=>"2012-11-13 16:40:06", "amount"=>"5.55", "retailer_payment_type_id"=>"9e9ba1ba-2d20-11e2-8057-080027706aa2", "payment_type_id"=>"1"}]}}
  [1m[35mAccount Load (0.5ms)[0m  SELECT "accounts".* FROM "accounts" WHERE "accounts"."cf_vend_customer_id" = '9b17ac9d-2d20-11e2-8057-080027706aa2' LIMIT 1
  [1m[36m (0.2ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35m (0.7ms)[0m  SELECT "tags".id FROM "tags" INNER JOIN "taggings" ON "tags"."id" = "taggings"."tag_id" WHERE "taggings"."taggable_id" IS NULL AND "taggings"."taggable_type" = 'Account' AND (taggings.context = 'tags')
  [1m[36mFieldGroup Load (0.5ms)[0m  [1mSELECT "field_groups".* FROM "field_groups" WHERE "field_groups"."klass_name" = 'Account' AND (tag_id IS NULL OR tag_id IN (NULL)) ORDER BY position[0m
  [1m[35mAccount Exists (0.5ms)[0m  SELECT 1 AS one FROM "accounts" WHERE ("accounts"."name" = 'Account for Register Sale 144' AND "accounts"."deleted_at" IS NULL) LIMIT 1
  [1m[36mSQL (1.7ms)[0m  [1mINSERT INTO "accounts" ("access", "assigned_to", "background_info", "category", "cf_vend_customer_id", "created_at", "deleted_at", "email", "fax", "name", "phone", "rating", "subscribed_users", "toll_free_phone", "updated_at", "user_id", "website") VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9, $10, $11, $12, $13, $14, $15, $16, $17) RETURNING "id"[0m  [["access", "Public"], ["assigned_to", nil], ["background_info", nil], ["category", nil], ["cf_vend_customer_id", "9b17ac9d-2d20-11e2-8057-080027706aa2"], ["created_at", Thu, 07 Mar 2013 10:38:27 UTC +00:00], ["deleted_at", nil], ["email", nil], ["fax", nil], ["name", "Account for Register Sale 144"], ["phone", nil], ["rating", 0], ["subscribed_users", nil], ["toll_free_phone", nil], ["updated_at", Thu, 07 Mar 2013 10:38:27 UTC +00:00], ["user_id", nil], ["website", nil]]
  [1m[35mSQL (1.2ms)[0m  INSERT INTO "versions" ("created_at", "event", "item_id", "item_type", "object", "object_changes", "related_id", "related_type", "whodunnit") VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9) RETURNING "id"  [["created_at", Thu, 07 Mar 2013 10:38:27 UTC +00:00], ["event", "create"], ["item_id", 1], ["item_type", "Account"], ["object", nil], ["object_changes", "--- !map:ActiveSupport::HashWithIndifferentAccess \nname: \n- \"\"\n- Account for Register Sale 144\ncf_vend_customer_id: \n- \n- 9b17ac9d-2d20-11e2-8057-080027706aa2\ncreated_at: \n- \n- &id001 2013-03-07 10:38:27.610176 Z\nupdated_at: \n- \n- *id001\nid: \n- \n- 1\n"], ["related_id", nil], ["related_type", nil], ["whodunnit", nil]]
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.2ms)[0m  SAVEPOINT active_record_1
  [1m[36m (0.5ms)[0m  [1mSELECT "tags".id FROM "tags" INNER JOIN "taggings" ON "tags"."id" = "taggings"."tag_id" WHERE "taggings"."taggable_id" IS NULL AND "taggings"."taggable_type" = 'Opportunity' AND (taggings.context = 'tags')[0m
  [1m[35mFieldGroup Load (0.3ms)[0m  SELECT "field_groups".* FROM "field_groups" WHERE "field_groups"."klass_name" = 'Opportunity' AND (tag_id IS NULL OR tag_id IN (NULL)) ORDER BY position
  [1m[36mSQL (1.2ms)[0m  [1mINSERT INTO "opportunities" ("access", "amount", "assigned_to", "background_info", "campaign_id", "closes_on", "created_at", "deleted_at", "discount", "name", "probability", "source", "stage", "subscribed_users", "updated_at", "user_id") VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9, $10, $11, $12, $13, $14, $15, $16) RETURNING "id"[0m  [["access", "Public"], ["amount", #<BigDecimal:7faa6d9c8438,'0.555E1',18(18)>], ["assigned_to", nil], ["background_info", nil], ["campaign_id", nil], ["closes_on", nil], ["created_at", Thu, 07 Mar 2013 10:38:27 UTC +00:00], ["deleted_at", nil], ["discount", nil], ["name", "Register Sale 144"], ["probability", nil], ["source", nil], ["stage", "won"], ["subscribed_users", nil], ["updated_at", Thu, 07 Mar 2013 10:38:27 UTC +00:00], ["user_id", nil]]
  [1m[35mSQL (0.4ms)[0m  INSERT INTO "versions" ("created_at", "event", "item_id", "item_type", "object", "object_changes", "related_id", "related_type", "whodunnit") VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9) RETURNING "id"  [["created_at", Thu, 07 Mar 2013 10:38:27 UTC +00:00], ["event", "create"], ["item_id", 1], ["item_type", "Opportunity"], ["object", nil], ["object_changes", "--- !map:ActiveSupport::HashWithIndifferentAccess \nname: \n- \"\"\n- Register Sale 144\namount: \n- \n- 5.55\nstage: \n- \n- won\ncreated_at: \n- \n- &id001 2013-03-07 10:38:27.670593 Z\nupdated_at: \n- \n- *id001\nid: \n- \n- 1\n"], ["related_id", nil], ["related_type", nil], ["whodunnit", nil]]
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.2ms)[0m  SAVEPOINT active_record_1
  [1m[36mSQL (1.0ms)[0m  [1mINSERT INTO "account_opportunities" ("account_id", "created_at", "deleted_at", "opportunity_id", "updated_at") VALUES ($1, $2, $3, $4, $5) RETURNING "id"[0m  [["account_id", 1], ["created_at", Thu, 07 Mar 2013 10:38:27 UTC +00:00], ["deleted_at", nil], ["opportunity_id", 1], ["updated_at", Thu, 07 Mar 2013 10:38:27 UTC +00:00]]
  [1m[35mSQL (0.5ms)[0m  INSERT INTO "versions" ("created_at", "event", "item_id", "item_type", "object", "object_changes", "related_id", "related_type", "whodunnit") VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9) RETURNING "id"  [["created_at", Thu, 07 Mar 2013 10:38:27 UTC +00:00], ["event", "create"], ["item_id", 1], ["item_type", "AccountOpportunity"], ["object", nil], ["object_changes", "--- !map:ActiveSupport::HashWithIndifferentAccess \naccount_id: \n- \n- 1\nopportunity_id: \n- \n- 1\ncreated_at: \n- \n- &id001 2013-03-07 10:38:27.742255 Z\nupdated_at: \n- \n- *id001\nid: \n- \n- 1\n"], ["related_id", nil], ["related_type", nil], ["whodunnit", nil]]
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.2ms)[0m  SAVEPOINT active_record_1
  [1m[36mOpportunity Load (0.3ms)[0m  [1mSELECT "opportunities".* FROM "opportunities" WHERE "opportunities"."id" = 1 LIMIT 1[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
Completed 201 Created in 308ms (Views: 0.2ms | ActiveRecord: 0.0ms)
  [1m[36m (0.4ms)[0m  [1mSELECT COUNT(*) FROM "accounts" [0m
  [1m[35m (0.2ms)[0m  SELECT COUNT(*) FROM "opportunities" 
  [1m[36m (0.9ms)[0m  [1mROLLBACK[0m
  [1m[35m (0.1ms)[0m  BEGIN
  [1m[36m (0.1ms)[0m  [1mROLLBACK[0m
Connecting to database specified by database.yml
  [1m[36mFieldGroup Load (0.9ms)[0m  [1mSELECT "field_groups".* FROM "field_groups" WHERE "field_groups"."klass_name" = 'Account' ORDER BY position[0m
  [1m[35mFieldGroup Load (0.3ms)[0m  SELECT "field_groups".* FROM "field_groups" WHERE "field_groups"."klass_name" = 'Campaign' ORDER BY position
  [1m[36mFieldGroup Load (0.4ms)[0m  [1mSELECT "field_groups".* FROM "field_groups" WHERE "field_groups"."klass_name" = 'Contact' ORDER BY position[0m
  [1m[35mFieldGroup Load (0.3ms)[0m  SELECT "field_groups".* FROM "field_groups" WHERE "field_groups"."klass_name" = 'Lead' ORDER BY position
  [1m[36mFieldGroup Load (0.2ms)[0m  [1mSELECT "field_groups".* FROM "field_groups" WHERE "field_groups"."klass_name" = 'Opportunity' ORDER BY position[0m
  [1m[35mFieldGroup Load (0.4ms)[0m  SELECT "field_groups".* FROM "field_groups" WHERE "field_groups"."klass_name" = 'Task' ORDER BY position
Creating scope :except. Overwriting existing method User.except.
  [1m[36m (122.7ms)[0m  [1mDROP DATABASE IF EXISTS "ffcrm_vend_test"[0m
  [1m[35m (245.5ms)[0m  CREATE DATABASE "ffcrm_vend_test" ENCODING = 'utf8'
  [1m[36m (5.2ms)[0m  [1mCREATE TABLE "account_contacts" ("id" serial primary key, "account_id" integer, "contact_id" integer, "deleted_at" timestamp, "created_at" timestamp NOT NULL, "updated_at" timestamp NOT NULL) [0m
  [1m[35m (2.4ms)[0m  CREATE TABLE "account_opportunities" ("id" serial primary key, "account_id" integer, "opportunity_id" integer, "deleted_at" timestamp, "created_at" timestamp NOT NULL, "updated_at" timestamp NOT NULL) 
  [1m[36m (4.0ms)[0m  [1mCREATE TABLE "accounts" ("id" serial primary key, "user_id" integer, "assigned_to" integer, "name" character varying(64) DEFAULT '' NOT NULL, "access" character varying(8) DEFAULT 'Public', "website" character varying(64), "toll_free_phone" character varying(32), "phone" character varying(32), "fax" character varying(32), "deleted_at" timestamp, "created_at" timestamp NOT NULL, "updated_at" timestamp NOT NULL, "email" character varying(64), "background_info" character varying(255), "rating" integer DEFAULT 0 NOT NULL, "category" character varying(32), "subscribed_users" text, "cf_vend_customer_id" character varying(255)) [0m
  [1m[35m (1.0ms)[0m  CREATE INDEX "index_accounts_on_assigned_to" ON "accounts" ("assigned_to")
  [1m[36m (1.3ms)[0m  [1mCREATE UNIQUE INDEX "index_accounts_on_user_id_and_name_and_deleted_at" ON "accounts" ("user_id", "name", "deleted_at")[0m
  [1m[35m (3.8ms)[0m  CREATE TABLE "activities" ("id" serial primary key, "user_id" integer, "subject_id" integer, "subject_type" character varying(255), "action" character varying(32) DEFAULT 'created', "info" character varying(255) DEFAULT '', "private" boolean DEFAULT 'f', "created_at" timestamp NOT NULL, "updated_at" timestamp NOT NULL) 
  [1m[36m (0.9ms)[0m  [1mCREATE INDEX "index_activities_on_created_at" ON "activities" ("created_at")[0m
  [1m[35m (1.0ms)[0m  CREATE INDEX "index_activities_on_user_id" ON "activities" ("user_id")
  [1m[36m (3.6ms)[0m  [1mCREATE TABLE "addresses" ("id" serial primary key, "street1" character varying(255), "street2" character varying(255), "city" character varying(64), "state" character varying(64), "zipcode" character varying(16), "country" character varying(64), "full_address" character varying(255), "address_type" character varying(16), "addressable_id" integer, "addressable_type" character varying(255), "created_at" timestamp NOT NULL, "updated_at" timestamp NOT NULL, "deleted_at" timestamp) [0m
  [1m[35m (1.1ms)[0m  CREATE INDEX "index_addresses_on_addressable_id_and_addressable_type" ON "addresses" ("addressable_id", "addressable_type")
  [1m[36m (3.2ms)[0m  [1mCREATE TABLE "avatars" ("id" serial primary key, "user_id" integer, "entity_id" integer, "entity_type" character varying(255), "image_file_size" integer, "image_file_name" character varying(255), "image_content_type" character varying(255), "created_at" timestamp NOT NULL, "updated_at" timestamp NOT NULL) [0m
  [1m[35m (3.9ms)[0m  CREATE TABLE "campaigns" ("id" serial primary key, "user_id" integer, "assigned_to" integer, "name" character varying(64) DEFAULT '' NOT NULL, "access" character varying(8) DEFAULT 'Public', "status" character varying(64), "budget" decimal(12,2), "target_leads" integer, "target_conversion" float, "target_revenue" decimal(12,2), "leads_count" integer, "opportunities_count" integer, "revenue" decimal(12,2), "starts_on" date, "ends_on" date, "objectives" text, "deleted_at" timestamp, "created_at" timestamp NOT NULL, "updated_at" timestamp NOT NULL, "background_info" character varying(255), "subscribed_users" text) 
  [1m[36m (0.9ms)[0m  [1mCREATE INDEX "index_campaigns_on_assigned_to" ON "campaigns" ("assigned_to")[0m
  [1m[35m (1.2ms)[0m  CREATE UNIQUE INDEX "index_campaigns_on_user_id_and_name_and_deleted_at" ON "campaigns" ("user_id", "name", "deleted_at")
  [1m[36m (3.6ms)[0m  [1mCREATE TABLE "comments" ("id" serial primary key, "user_id" integer, "commentable_id" integer, "commentable_type" character varying(255), "private" boolean, "title" character varying(255) DEFAULT '', "comment" text, "created_at" timestamp NOT NULL, "updated_at" timestamp NOT NULL, "state" character varying(16) DEFAULT 'Expanded' NOT NULL) [0m
  [1m[35m (2.2ms)[0m  CREATE TABLE "contact_opportunities" ("id" serial primary key, "contact_id" integer, "opportunity_id" integer, "role" character varying(32), "deleted_at" timestamp, "created_at" timestamp NOT NULL, "updated_at" timestamp NOT NULL) 
  [1m[36m (4.5ms)[0m  [1mCREATE TABLE "contacts" ("id" serial primary key, "user_id" integer, "lead_id" integer, "assigned_to" integer, "reports_to" integer, "first_name" character varying(64) DEFAULT '' NOT NULL, "last_name" character varying(64) DEFAULT '' NOT NULL, "access" character varying(8) DEFAULT 'Public', "title" character varying(64), "department" character varying(64), "source" character varying(32), "email" character varying(64), "alt_email" character varying(64), "phone" character varying(32), "mobile" character varying(32), "fax" character varying(32), "blog" character varying(128), "linkedin" character varying(128), "facebook" character varying(128), "twitter" character varying(128), "born_on" date, "do_not_call" boolean DEFAULT 'f' NOT NULL, "deleted_at" timestamp, "created_at" timestamp NOT NULL, "updated_at" timestamp NOT NULL, "background_info" character varying(255), "skype" character varying(128), "subscribed_users" text) [0m
  [1m[35m (0.9ms)[0m  CREATE INDEX "index_contacts_on_assigned_to" ON "contacts" ("assigned_to")
  [1m[36m (1.1ms)[0m  [1mCREATE UNIQUE INDEX "id_last_name_deleted" ON "contacts" ("user_id", "last_name", "deleted_at")[0m
  [1m[35m (4.2ms)[0m  CREATE TABLE "emails" ("id" serial primary key, "imap_message_id" character varying(255) NOT NULL, "user_id" integer, "mediator_id" integer, "mediator_type" character varying(255), "sent_from" character varying(255) NOT NULL, "sent_to" character varying(255) NOT NULL, "cc" character varying(255), "bcc" character varying(255), "subject" character varying(255), "body" text, "header" text, "sent_at" timestamp, "received_at" timestamp, "deleted_at" timestamp, "created_at" timestamp NOT NULL, "updated_at" timestamp NOT NULL, "state" character varying(16) DEFAULT 'Expanded' NOT NULL) 
  [1m[36m (0.9ms)[0m  [1mCREATE INDEX "index_emails_on_mediator_id_and_mediator_type" ON "emails" ("mediator_id", "mediator_type")[0m
  [1m[35m (2.4ms)[0m  CREATE TABLE "field_groups" ("id" serial primary key, "name" character varying(64), "label" character varying(128), "position" integer, "hint" character varying(255), "created_at" timestamp NOT NULL, "updated_at" timestamp NOT NULL, "tag_id" integer, "klass_name" character varying(32)) 
  [1m[36m (3.7ms)[0m  [1mCREATE TABLE "fields" ("id" serial primary key, "type" character varying(255), "field_group_id" integer, "position" integer, "name" character varying(64), "label" character varying(128), "hint" character varying(255), "placeholder" character varying(255), "as" character varying(32), "collection" text, "disabled" boolean, "required" boolean, "maxlength" integer, "created_at" timestamp NOT NULL, "updated_at" timestamp NOT NULL) [0m
  [1m[35m (0.9ms)[0m  CREATE INDEX "index_fields_on_field_group_id" ON "fields" ("field_group_id")
  [1m[36m (0.9ms)[0m  [1mCREATE INDEX "index_fields_on_name" ON "fields" ("name")[0m
  [1m[35m (4.6ms)[0m  CREATE TABLE "leads" ("id" serial primary key, "user_id" integer, "campaign_id" integer, "assigned_to" integer, "first_name" character varying(64) DEFAULT '' NOT NULL, "last_name" character varying(64) DEFAULT '' NOT NULL, "access" character varying(8) DEFAULT 'Public', "title" character varying(64), "company" character varying(64), "source" character varying(32), "status" character varying(32), "referred_by" character varying(64), "email" character varying(64), "alt_email" character varying(64), "phone" character varying(32), "mobile" character varying(32), "blog" character varying(128), "linkedin" character varying(128), "facebook" character varying(128), "twitter" character varying(128), "rating" integer DEFAULT 0 NOT NULL, "do_not_call" boolean DEFAULT 'f' NOT NULL, "deleted_at" timestamp, "created_at" timestamp NOT NULL, "updated_at" timestamp NOT NULL, "background_info" character varying(255), "skype" character varying(128), "subscribed_users" text) 
  [1m[36m (0.9ms)[0m  [1mCREATE INDEX "index_leads_on_assigned_to" ON "leads" ("assigned_to")[0m
  [1m[35m (1.1ms)[0m  CREATE UNIQUE INDEX "index_leads_on_user_id_and_last_name_and_deleted_at" ON "leads" ("user_id", "last_name", "deleted_at")
  [1m[36m (3.7ms)[0m  [1mCREATE TABLE "lists" ("id" serial primary key, "name" character varying(255), "url" text, "created_at" timestamp NOT NULL, "updated_at" timestamp NOT NULL) [0m
  [1m[35m (3.7ms)[0m  CREATE TABLE "opportunities" ("id" serial primary key, "user_id" integer, "campaign_id" integer, "assigned_to" integer, "name" character varying(64) DEFAULT '' NOT NULL, "access" character varying(8) DEFAULT 'Public', "source" character varying(32), "stage" character varying(32), "probability" integer, "amount" decimal(12,2), "discount" decimal(12,2), "closes_on" date, "deleted_at" timestamp, "created_at" timestamp NOT NULL, "updated_at" timestamp NOT NULL, "background_info" character varying(255), "subscribed_users" text) 
  [1m[36m (0.9ms)[0m  [1mCREATE INDEX "index_opportunities_on_assigned_to" ON "opportunities" ("assigned_to")[0m
  [1m[35m (1.1ms)[0m  CREATE UNIQUE INDEX "id_name_deleted" ON "opportunities" ("user_id", "name", "deleted_at")
  [1m[36m (2.3ms)[0m  [1mCREATE TABLE "permissions" ("id" serial primary key, "user_id" integer, "asset_id" integer, "asset_type" character varying(255), "created_at" timestamp NOT NULL, "updated_at" timestamp NOT NULL) [0m
  [1m[35m (0.9ms)[0m  CREATE INDEX "index_permissions_on_asset_id_and_asset_type" ON "permissions" ("asset_id", "asset_type")
  [1m[36m (1.1ms)[0m  [1mCREATE INDEX "index_permissions_on_user_id" ON "permissions" ("user_id")[0m
  [1m[35m (4.2ms)[0m  CREATE TABLE "preferences" ("id" serial primary key, "user_id" integer, "name" character varying(32) DEFAULT '' NOT NULL, "value" text, "created_at" timestamp NOT NULL, "updated_at" timestamp NOT NULL) 
  [1m[36m (1.1ms)[0m  [1mCREATE INDEX "index_preferences_on_user_id_and_name" ON "preferences" ("user_id", "name")[0m
  [1m[35m (4.3ms)[0m  CREATE TABLE "sessions" ("id" serial primary key, "session_id" character varying(255) NOT NULL, "data" text, "created_at" timestamp NOT NULL, "updated_at" timestamp NOT NULL) 
  [1m[36m (1.0ms)[0m  [1mCREATE INDEX "index_sessions_on_session_id" ON "sessions" ("session_id")[0m
  [1m[35m (1.0ms)[0m  CREATE INDEX "index_sessions_on_updated_at" ON "sessions" ("updated_at")
  [1m[36m (22.3ms)[0m  [1mCREATE TABLE "settings" ("id" serial primary key, "name" character varying(32) DEFAULT '' NOT NULL, "value" text, "created_at" timestamp NOT NULL, "updated_at" timestamp NOT NULL) [0m
  [1m[35m (1.1ms)[0m  CREATE INDEX "index_settings_on_name" ON "settings" ("name")
  [1m[36m (3.6ms)[0m  [1mCREATE TABLE "taggings" ("id" serial primary key, "tag_id" integer, "taggable_id" integer, "tagger_id" integer, "tagger_type" character varying(255), "taggable_type" character varying(255), "context" character varying(255), "created_at" timestamp) [0m
  [1m[35m (1.0ms)[0m  CREATE INDEX "index_taggings_on_tag_id" ON "taggings" ("tag_id")
  [1m[36m (1.2ms)[0m  [1mCREATE INDEX "index_taggings_on_taggable_id_and_taggable_type_and_context" ON "taggings" ("taggable_id", "taggable_type", "context")[0m
  [1m[35m (2.1ms)[0m  CREATE TABLE "tags" ("id" serial primary key, "name" character varying(255)) 
  [1m[36m (18.9ms)[0m  [1mCREATE TABLE "tasks" ("id" serial primary key, "user_id" integer, "assigned_to" integer, "completed_by" integer, "name" character varying(255) DEFAULT '' NOT NULL, "asset_id" integer, "asset_type" character varying(255), "priority" character varying(32), "category" character varying(32), "bucket" character varying(32), "due_at" timestamp, "completed_at" timestamp, "deleted_at" timestamp, "created_at" timestamp NOT NULL, "updated_at" timestamp NOT NULL, "background_info" character varying(255), "subscribed_users" text) [0m
  [1m[35m (1.3ms)[0m  CREATE INDEX "index_tasks_on_assigned_to" ON "tasks" ("assigned_to")
  [1m[36m (1.1ms)[0m  [1mCREATE UNIQUE INDEX "index_tasks_on_user_id_and_name_and_deleted_at" ON "tasks" ("user_id", "name", "deleted_at")[0m
  [1m[35m (4.1ms)[0m  CREATE TABLE "users" ("id" serial primary key, "username" character varying(32) DEFAULT '' NOT NULL, "email" character varying(64) DEFAULT '' NOT NULL, "first_name" character varying(32), "last_name" character varying(32), "title" character varying(64), "company" character varying(64), "alt_email" character varying(64), "phone" character varying(32), "mobile" character varying(32), "aim" character varying(32), "yahoo" character varying(32), "google" character varying(32), "skype" character varying(32), "password_hash" character varying(255) DEFAULT '' NOT NULL, "password_salt" character varying(255) DEFAULT '' NOT NULL, "persistence_token" character varying(255) DEFAULT '' NOT NULL, "perishable_token" character varying(255) DEFAULT '' NOT NULL, "last_request_at" timestamp, "last_login_at" timestamp, "current_login_at" timestamp, "last_login_ip" character varying(255), "current_login_ip" character varying(255), "login_count" integer DEFAULT 0 NOT NULL, "deleted_at" timestamp, "created_at" timestamp NOT NULL, "updated_at" timestamp NOT NULL, "admin" boolean DEFAULT 'f' NOT NULL, "suspended_at" timestamp, "single_access_token" character varying(255)) 
  [1m[36m (1.0ms)[0m  [1mCREATE INDEX "index_users_on_email" ON "users" ("email")[0m
  [1m[35m (1.4ms)[0m  CREATE INDEX "index_users_on_last_request_at" ON "users" ("last_request_at")
  [1m[36m (1.2ms)[0m  [1mCREATE INDEX "index_users_on_perishable_token" ON "users" ("perishable_token")[0m
  [1m[35m (4.2ms)[0m  CREATE INDEX "index_users_on_remember_token" ON "users" ("persistence_token")
  [1m[36m (2.4ms)[0m  [1mCREATE UNIQUE INDEX "index_users_on_username_and_deleted_at" ON "users" ("username", "deleted_at")[0m
  [1m[35m (6.4ms)[0m  CREATE TABLE "versions" ("id" serial primary key, "item_type" character varying(255) NOT NULL, "item_id" integer NOT NULL, "event" character varying(512) NOT NULL, "whodunnit" character varying(255), "object" text, "created_at" timestamp, "object_changes" text, "related_id" integer, "related_type" character varying(255)) 
  [1m[36m (2.9ms)[0m  [1mCREATE INDEX "index_versions_on_item_type_and_item_id" ON "versions" ("item_type", "item_id")[0m
  [1m[35m (1.3ms)[0m  CREATE INDEX "index_versions_on_whodunnit" ON "versions" ("whodunnit")
  [1m[36m (1.1ms)[0m  [1mCREATE TABLE "schema_migrations" ("version" character varying(255) NOT NULL) [0m
  [1m[35m (1.2ms)[0m  CREATE UNIQUE INDEX "unique_schema_migrations" ON "schema_migrations" ("version")
  [1m[36m (0.4ms)[0m  [1mSELECT version FROM "schema_migrations"[0m
  [1m[35m (0.6ms)[0m  INSERT INTO "schema_migrations" (version) VALUES ('20120528102124')
  [1m[36m (0.2ms)[0m  [1mBEGIN[0m
  [1m[35m (0.4ms)[0m  SELECT COUNT(*) FROM "comments" 
  [1m[36m (0.4ms)[0m  [1mSELECT COUNT(*) FROM "opportunities" [0m
  [1m[35m (0.4ms)[0m  SELECT COUNT(*) FROM "accounts" 
Started POST "/vend/register_sale" for 127.0.0.1 at 2013-03-07 23:41:03 +1300
Processing by VendController#register_sale as JSON
  Parameters: {"payload"=>{"id"=>"5e8b5134-a002-dd6b-b7c7-26126887c4ee", "sale_date"=>"2012-11-13 16:40:06", "status"=>"CLOSED", "user_id"=>"9b2a8d5f-2d20-11e2-8057-080027706aa2", "customer_id"=>"9b17ac9d-2d20-11e2-8057-080027706aa2", "register_id"=>"9af85e69-2d20-11e2-8057-080027706aa2", "market_id"=>"1", "invoice_number"=>"144", "short_code"=>"ne2zq", "totals"=>{"total_price"=>"4.87", "total_tax"=>"0.69", "total_payment"=>"5.55", "total_to_pay"=>"0"}, "note"=>nil, "updated_at"=>"2012-11-13 16:40:09", "created_at"=>"2012-11-13 16:40:09", "customer"=>{"id"=>"9b17ac9d-2d20-11e2-8057-080027706aa2", "customer_code"=>"WALKIN", "balance"=>"-6.250", "points"=>"0", "note"=>nil, "year_to_date"=>"79945.92188", "sex"=>"M", "date_of_birth"=>"1950-05-25", "updated_at"=>"2012-11-13 16:43:15", "created_at"=>"2012-11-13 12:28:03"}, "user"=>{"id"=>"9b2a8d5f-2d20-11e2-8057-080027706aa2", "name"=>"admin", "display_name"=>"A admin this time", "outlet_id"=>"9ae97219-2d20-11e2-8057-080027706aa2", "target_daily"=>nil, "target_weekly"=>nil, "target_monthly"=>nil, "created_at"=>"2011-09-08 05:18:38", "updated_at"=>"2011-09-08 05:18:38"}, "register_sale_products"=>[{"id"=>"148793f0-475a-7d49-442d-fd761ce76339", "product_id"=>"9fe945bc-2d20-11e2-8057-080027706aa2", "quantity"=>"1", "price"=>"1.90", "price_set"=>"true", "tax"=>"0.24", "price_total"=>"1.9", "tax_total"=>"0.24", "tax_id"=>"9a025ff0-2d20-11e2-8057-080027706aa2", "tax_name"=>"NZ GST", "tax_rate"=>"0.150000"}, {"id"=>"7d37dc0f-9462-06fa-cae0-0b4988b36539", "product_id"=>"a0c0df02-2d20-11e2-8057-080027706aa2", "quantity"=>"3", "price"=>"0.99", "price_set"=>"true", "tax"=>"0.15", "price_total"=>"2.97", "tax_total"=>"0.45", "tax_id"=>"9a025ff0-2d20-11e2-8057-080027706aa2", "tax_name"=>"NZ GST", "tax_rate"=>"0.150000"}], "register_sale_payments"=>[{"id"=>"39948e3e-bf93-1b60-ff44-f46a777ed1d4", "payment_date"=>"2012-11-13 16:40:06", "amount"=>"5.55", "retailer_payment_type_id"=>"9e9ba1ba-2d20-11e2-8057-080027706aa2", "payment_type_id"=>"1"}]}}
  [1m[36mAccount Load (0.8ms)[0m  [1mSELECT "accounts".* FROM "accounts" WHERE "accounts"."cf_vend_customer_id" = '9b17ac9d-2d20-11e2-8057-080027706aa2' LIMIT 1[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36m (0.7ms)[0m  [1mSELECT "tags".id FROM "tags" INNER JOIN "taggings" ON "tags"."id" = "taggings"."tag_id" WHERE "taggings"."taggable_id" IS NULL AND "taggings"."taggable_type" = 'Account' AND (taggings.context = 'tags')[0m
  [1m[35mFieldGroup Load (0.4ms)[0m  SELECT "field_groups".* FROM "field_groups" WHERE "field_groups"."klass_name" = 'Account' AND (tag_id IS NULL OR tag_id IN (NULL)) ORDER BY position
  [1m[36mAccount Exists (0.4ms)[0m  [1mSELECT 1 AS one FROM "accounts" WHERE ("accounts"."name" = 'Account for Register Sale 144' AND "accounts"."deleted_at" IS NULL) LIMIT 1[0m
  [1m[35mSQL (1.9ms)[0m  INSERT INTO "accounts" ("access", "assigned_to", "background_info", "category", "cf_vend_customer_id", "created_at", "deleted_at", "email", "fax", "name", "phone", "rating", "subscribed_users", "toll_free_phone", "updated_at", "user_id", "website") VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9, $10, $11, $12, $13, $14, $15, $16, $17) RETURNING "id"  [["access", "Public"], ["assigned_to", nil], ["background_info", nil], ["category", nil], ["cf_vend_customer_id", "9b17ac9d-2d20-11e2-8057-080027706aa2"], ["created_at", Thu, 07 Mar 2013 10:41:03 UTC +00:00], ["deleted_at", nil], ["email", nil], ["fax", nil], ["name", "Account for Register Sale 144"], ["phone", nil], ["rating", 0], ["subscribed_users", nil], ["toll_free_phone", nil], ["updated_at", Thu, 07 Mar 2013 10:41:03 UTC +00:00], ["user_id", nil], ["website", nil]]
  [1m[36mSQL (1.1ms)[0m  [1mINSERT INTO "versions" ("created_at", "event", "item_id", "item_type", "object", "object_changes", "related_id", "related_type", "whodunnit") VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9) RETURNING "id"[0m  [["created_at", Thu, 07 Mar 2013 10:41:03 UTC +00:00], ["event", "create"], ["item_id", 1], ["item_type", "Account"], ["object", nil], ["object_changes", "--- !map:ActiveSupport::HashWithIndifferentAccess \nname: \n- \"\"\n- Account for Register Sale 144\ncf_vend_customer_id: \n- \n- 9b17ac9d-2d20-11e2-8057-080027706aa2\ncreated_at: \n- \n- &id001 2013-03-07 10:41:03.587358 Z\nupdated_at: \n- \n- *id001\nid: \n- \n- 1\n"], ["related_id", nil], ["related_type", nil], ["whodunnit", nil]]
  [1m[35m (0.2ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36m (0.2ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35m (0.5ms)[0m  SELECT "tags".id FROM "tags" INNER JOIN "taggings" ON "tags"."id" = "taggings"."tag_id" WHERE "taggings"."taggable_id" IS NULL AND "taggings"."taggable_type" = 'Opportunity' AND (taggings.context = 'tags')
  [1m[36mFieldGroup Load (0.3ms)[0m  [1mSELECT "field_groups".* FROM "field_groups" WHERE "field_groups"."klass_name" = 'Opportunity' AND (tag_id IS NULL OR tag_id IN (NULL)) ORDER BY position[0m
  [1m[35mSQL (1.3ms)[0m  INSERT INTO "opportunities" ("access", "amount", "assigned_to", "background_info", "campaign_id", "closes_on", "created_at", "deleted_at", "discount", "name", "probability", "source", "stage", "subscribed_users", "updated_at", "user_id") VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9, $10, $11, $12, $13, $14, $15, $16) RETURNING "id"  [["access", "Public"], ["amount", #<BigDecimal:7fb08de39c30,'0.555E1',18(18)>], ["assigned_to", nil], ["background_info", nil], ["campaign_id", nil], ["closes_on", nil], ["created_at", Thu, 07 Mar 2013 10:41:03 UTC +00:00], ["deleted_at", nil], ["discount", nil], ["name", "Register Sale 144"], ["probability", nil], ["source", nil], ["stage", "won"], ["subscribed_users", nil], ["updated_at", Thu, 07 Mar 2013 10:41:03 UTC +00:00], ["user_id", nil]]
  [1m[36mSQL (0.5ms)[0m  [1mINSERT INTO "versions" ("created_at", "event", "item_id", "item_type", "object", "object_changes", "related_id", "related_type", "whodunnit") VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9) RETURNING "id"[0m  [["created_at", Thu, 07 Mar 2013 10:41:03 UTC +00:00], ["event", "create"], ["item_id", 1], ["item_type", "Opportunity"], ["object", nil], ["object_changes", "--- !map:ActiveSupport::HashWithIndifferentAccess \nname: \n- \"\"\n- Register Sale 144\namount: \n- \n- 5.55\nstage: \n- \n- won\ncreated_at: \n- \n- &id001 2013-03-07 10:41:03.647238 Z\nupdated_at: \n- \n- *id001\nid: \n- \n- 1\n"], ["related_id", nil], ["related_type", nil], ["whodunnit", nil]]
  [1m[35m (0.2ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mSQL (1.0ms)[0m  INSERT INTO "account_opportunities" ("account_id", "created_at", "deleted_at", "opportunity_id", "updated_at") VALUES ($1, $2, $3, $4, $5) RETURNING "id"  [["account_id", 1], ["created_at", Thu, 07 Mar 2013 10:41:03 UTC +00:00], ["deleted_at", nil], ["opportunity_id", 1], ["updated_at", Thu, 07 Mar 2013 10:41:03 UTC +00:00]]
  [1m[36mSQL (0.4ms)[0m  [1mINSERT INTO "versions" ("created_at", "event", "item_id", "item_type", "object", "object_changes", "related_id", "related_type", "whodunnit") VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9) RETURNING "id"[0m  [["created_at", Thu, 07 Mar 2013 10:41:03 UTC +00:00], ["event", "create"], ["item_id", 1], ["item_type", "AccountOpportunity"], ["object", nil], ["object_changes", "--- !map:ActiveSupport::HashWithIndifferentAccess \naccount_id: \n- \n- 1\nopportunity_id: \n- \n- 1\ncreated_at: \n- \n- &id001 2013-03-07 10:41:03.720281 Z\nupdated_at: \n- \n- *id001\nid: \n- \n- 1\n"], ["related_id", nil], ["related_type", nil], ["whodunnit", nil]]
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mOpportunity Load (0.4ms)[0m  SELECT "opportunities".* FROM "opportunities" WHERE "opportunities"."id" = 1 LIMIT 1
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
Completed 201 Created in 307ms (Views: 0.2ms | ActiveRecord: 0.0ms)
  [1m[35m (0.5ms)[0m  SELECT COUNT(*) FROM "accounts" 
  [1m[36m (0.2ms)[0m  [1mSELECT COUNT(*) FROM "opportunities" [0m
  [1m[35m (0.2ms)[0m  SELECT COUNT(*) FROM "comments" 
  [1m[36m (0.5ms)[0m  [1mROLLBACK[0m
  [1m[35m (0.1ms)[0m  BEGIN
  [1m[36m (0.1ms)[0m  [1mROLLBACK[0m
Connecting to database specified by database.yml
  [1m[36mFieldGroup Load (0.9ms)[0m  [1mSELECT "field_groups".* FROM "field_groups" WHERE "field_groups"."klass_name" = 'Account' ORDER BY position[0m
  [1m[35mFieldGroup Load (0.4ms)[0m  SELECT "field_groups".* FROM "field_groups" WHERE "field_groups"."klass_name" = 'Campaign' ORDER BY position
  [1m[36mFieldGroup Load (0.2ms)[0m  [1mSELECT "field_groups".* FROM "field_groups" WHERE "field_groups"."klass_name" = 'Contact' ORDER BY position[0m
  [1m[35mFieldGroup Load (0.3ms)[0m  SELECT "field_groups".* FROM "field_groups" WHERE "field_groups"."klass_name" = 'Lead' ORDER BY position
  [1m[36mFieldGroup Load (0.2ms)[0m  [1mSELECT "field_groups".* FROM "field_groups" WHERE "field_groups"."klass_name" = 'Opportunity' ORDER BY position[0m
  [1m[35mFieldGroup Load (0.3ms)[0m  SELECT "field_groups".* FROM "field_groups" WHERE "field_groups"."klass_name" = 'Task' ORDER BY position
Creating scope :except. Overwriting existing method User.except.
  [1m[36m (122.7ms)[0m  [1mDROP DATABASE IF EXISTS "ffcrm_vend_test"[0m
  [1m[35m (263.3ms)[0m  CREATE DATABASE "ffcrm_vend_test" ENCODING = 'utf8'
  [1m[36m (5.3ms)[0m  [1mCREATE TABLE "account_contacts" ("id" serial primary key, "account_id" integer, "contact_id" integer, "deleted_at" timestamp, "created_at" timestamp NOT NULL, "updated_at" timestamp NOT NULL) [0m
  [1m[35m (2.4ms)[0m  CREATE TABLE "account_opportunities" ("id" serial primary key, "account_id" integer, "opportunity_id" integer, "deleted_at" timestamp, "created_at" timestamp NOT NULL, "updated_at" timestamp NOT NULL) 
  [1m[36m (3.7ms)[0m  [1mCREATE TABLE "accounts" ("id" serial primary key, "user_id" integer, "assigned_to" integer, "name" character varying(64) DEFAULT '' NOT NULL, "access" character varying(8) DEFAULT 'Public', "website" character varying(64), "toll_free_phone" character varying(32), "phone" character varying(32), "fax" character varying(32), "deleted_at" timestamp, "created_at" timestamp NOT NULL, "updated_at" timestamp NOT NULL, "email" character varying(64), "background_info" character varying(255), "rating" integer DEFAULT 0 NOT NULL, "category" character varying(32), "subscribed_users" text, "cf_vend_customer_id" character varying(255)) [0m
  [1m[35m (1.1ms)[0m  CREATE INDEX "index_accounts_on_assigned_to" ON "accounts" ("assigned_to")
  [1m[36m (1.5ms)[0m  [1mCREATE UNIQUE INDEX "index_accounts_on_user_id_and_name_and_deleted_at" ON "accounts" ("user_id", "name", "deleted_at")[0m
  [1m[35m (3.5ms)[0m  CREATE TABLE "activities" ("id" serial primary key, "user_id" integer, "subject_id" integer, "subject_type" character varying(255), "action" character varying(32) DEFAULT 'created', "info" character varying(255) DEFAULT '', "private" boolean DEFAULT 'f', "created_at" timestamp NOT NULL, "updated_at" timestamp NOT NULL) 
  [1m[36m (1.1ms)[0m  [1mCREATE INDEX "index_activities_on_created_at" ON "activities" ("created_at")[0m
  [1m[35m (1.0ms)[0m  CREATE INDEX "index_activities_on_user_id" ON "activities" ("user_id")
  [1m[36m (3.6ms)[0m  [1mCREATE TABLE "addresses" ("id" serial primary key, "street1" character varying(255), "street2" character varying(255), "city" character varying(64), "state" character varying(64), "zipcode" character varying(16), "country" character varying(64), "full_address" character varying(255), "address_type" character varying(16), "addressable_id" integer, "addressable_type" character varying(255), "created_at" timestamp NOT NULL, "updated_at" timestamp NOT NULL, "deleted_at" timestamp) [0m
  [1m[35m (1.0ms)[0m  CREATE INDEX "index_addresses_on_addressable_id_and_addressable_type" ON "addresses" ("addressable_id", "addressable_type")
  [1m[36m (3.3ms)[0m  [1mCREATE TABLE "avatars" ("id" serial primary key, "user_id" integer, "entity_id" integer, "entity_type" character varying(255), "image_file_size" integer, "image_file_name" character varying(255), "image_content_type" character varying(255), "created_at" timestamp NOT NULL, "updated_at" timestamp NOT NULL) [0m
  [1m[35m (3.9ms)[0m  CREATE TABLE "campaigns" ("id" serial primary key, "user_id" integer, "assigned_to" integer, "name" character varying(64) DEFAULT '' NOT NULL, "access" character varying(8) DEFAULT 'Public', "status" character varying(64), "budget" decimal(12,2), "target_leads" integer, "target_conversion" float, "target_revenue" decimal(12,2), "leads_count" integer, "opportunities_count" integer, "revenue" decimal(12,2), "starts_on" date, "ends_on" date, "objectives" text, "deleted_at" timestamp, "created_at" timestamp NOT NULL, "updated_at" timestamp NOT NULL, "background_info" character varying(255), "subscribed_users" text) 
  [1m[36m (1.1ms)[0m  [1mCREATE INDEX "index_campaigns_on_assigned_to" ON "campaigns" ("assigned_to")[0m
  [1m[35m (1.1ms)[0m  CREATE UNIQUE INDEX "index_campaigns_on_user_id_and_name_and_deleted_at" ON "campaigns" ("user_id", "name", "deleted_at")
  [1m[36m (3.5ms)[0m  [1mCREATE TABLE "comments" ("id" serial primary key, "user_id" integer, "commentable_id" integer, "commentable_type" character varying(255), "private" boolean, "title" character varying(255) DEFAULT '', "comment" text, "created_at" timestamp NOT NULL, "updated_at" timestamp NOT NULL, "state" character varying(16) DEFAULT 'Expanded' NOT NULL) [0m
  [1m[35m (2.7ms)[0m  CREATE TABLE "contact_opportunities" ("id" serial primary key, "contact_id" integer, "opportunity_id" integer, "role" character varying(32), "deleted_at" timestamp, "created_at" timestamp NOT NULL, "updated_at" timestamp NOT NULL) 
  [1m[36m (4.3ms)[0m  [1mCREATE TABLE "contacts" ("id" serial primary key, "user_id" integer, "lead_id" integer, "assigned_to" integer, "reports_to" integer, "first_name" character varying(64) DEFAULT '' NOT NULL, "last_name" character varying(64) DEFAULT '' NOT NULL, "access" character varying(8) DEFAULT 'Public', "title" character varying(64), "department" character varying(64), "source" character varying(32), "email" character varying(64), "alt_email" character varying(64), "phone" character varying(32), "mobile" character varying(32), "fax" character varying(32), "blog" character varying(128), "linkedin" character varying(128), "facebook" character varying(128), "twitter" character varying(128), "born_on" date, "do_not_call" boolean DEFAULT 'f' NOT NULL, "deleted_at" timestamp, "created_at" timestamp NOT NULL, "updated_at" timestamp NOT NULL, "background_info" character varying(255), "skype" character varying(128), "subscribed_users" text) [0m
  [1m[35m (1.0ms)[0m  CREATE INDEX "index_contacts_on_assigned_to" ON "contacts" ("assigned_to")
  [1m[36m (1.2ms)[0m  [1mCREATE UNIQUE INDEX "id_last_name_deleted" ON "contacts" ("user_id", "last_name", "deleted_at")[0m
  [1m[35m (3.6ms)[0m  CREATE TABLE "emails" ("id" serial primary key, "imap_message_id" character varying(255) NOT NULL, "user_id" integer, "mediator_id" integer, "mediator_type" character varying(255), "sent_from" character varying(255) NOT NULL, "sent_to" character varying(255) NOT NULL, "cc" character varying(255), "bcc" character varying(255), "subject" character varying(255), "body" text, "header" text, "sent_at" timestamp, "received_at" timestamp, "deleted_at" timestamp, "created_at" timestamp NOT NULL, "updated_at" timestamp NOT NULL, "state" character varying(16) DEFAULT 'Expanded' NOT NULL) 
  [1m[36m (0.9ms)[0m  [1mCREATE INDEX "index_emails_on_mediator_id_and_mediator_type" ON "emails" ("mediator_id", "mediator_type")[0m
  [1m[35m (2.7ms)[0m  CREATE TABLE "field_groups" ("id" serial primary key, "name" character varying(64), "label" character varying(128), "position" integer, "hint" character varying(255), "created_at" timestamp NOT NULL, "updated_at" timestamp NOT NULL, "tag_id" integer, "klass_name" character varying(32)) 
  [1m[36m (3.4ms)[0m  [1mCREATE TABLE "fields" ("id" serial primary key, "type" character varying(255), "field_group_id" integer, "position" integer, "name" character varying(64), "label" character varying(128), "hint" character varying(255), "placeholder" character varying(255), "as" character varying(32), "collection" text, "disabled" boolean, "required" boolean, "maxlength" integer, "created_at" timestamp NOT NULL, "updated_at" timestamp NOT NULL) [0m
  [1m[35m (1.2ms)[0m  CREATE INDEX "index_fields_on_field_group_id" ON "fields" ("field_group_id")
  [1m[36m (1.0ms)[0m  [1mCREATE INDEX "index_fields_on_name" ON "fields" ("name")[0m
  [1m[35m (4.1ms)[0m  CREATE TABLE "leads" ("id" serial primary key, "user_id" integer, "campaign_id" integer, "assigned_to" integer, "first_name" character varying(64) DEFAULT '' NOT NULL, "last_name" character varying(64) DEFAULT '' NOT NULL, "access" character varying(8) DEFAULT 'Public', "title" character varying(64), "company" character varying(64), "source" character varying(32), "status" character varying(32), "referred_by" character varying(64), "email" character varying(64), "alt_email" character varying(64), "phone" character varying(32), "mobile" character varying(32), "blog" character varying(128), "linkedin" character varying(128), "facebook" character varying(128), "twitter" character varying(128), "rating" integer DEFAULT 0 NOT NULL, "do_not_call" boolean DEFAULT 'f' NOT NULL, "deleted_at" timestamp, "created_at" timestamp NOT NULL, "updated_at" timestamp NOT NULL, "background_info" character varying(255), "skype" character varying(128), "subscribed_users" text) 
  [1m[36m (1.2ms)[0m  [1mCREATE INDEX "index_leads_on_assigned_to" ON "leads" ("assigned_to")[0m
  [1m[35m (1.1ms)[0m  CREATE UNIQUE INDEX "index_leads_on_user_id_and_last_name_and_deleted_at" ON "leads" ("user_id", "last_name", "deleted_at")
  [1m[36m (3.2ms)[0m  [1mCREATE TABLE "lists" ("id" serial primary key, "name" character varying(255), "url" text, "created_at" timestamp NOT NULL, "updated_at" timestamp NOT NULL) [0m
  [1m[35m (3.7ms)[0m  CREATE TABLE "opportunities" ("id" serial primary key, "user_id" integer, "campaign_id" integer, "assigned_to" integer, "name" character varying(64) DEFAULT '' NOT NULL, "access" character varying(8) DEFAULT 'Public', "source" character varying(32), "stage" character varying(32), "probability" integer, "amount" decimal(12,2), "discount" decimal(12,2), "closes_on" date, "deleted_at" timestamp, "created_at" timestamp NOT NULL, "updated_at" timestamp NOT NULL, "background_info" character varying(255), "subscribed_users" text) 
  [1m[36m (1.0ms)[0m  [1mCREATE INDEX "index_opportunities_on_assigned_to" ON "opportunities" ("assigned_to")[0m
  [1m[35m (0.9ms)[0m  CREATE UNIQUE INDEX "id_name_deleted" ON "opportunities" ("user_id", "name", "deleted_at")
  [1m[36m (23.6ms)[0m  [1mCREATE TABLE "permissions" ("id" serial primary key, "user_id" integer, "asset_id" integer, "asset_type" character varying(255), "created_at" timestamp NOT NULL, "updated_at" timestamp NOT NULL) [0m
  [1m[35m (1.5ms)[0m  CREATE INDEX "index_permissions_on_asset_id_and_asset_type" ON "permissions" ("asset_id", "asset_type")
  [1m[36m (0.9ms)[0m  [1mCREATE INDEX "index_permissions_on_user_id" ON "permissions" ("user_id")[0m
  [1m[35m (3.1ms)[0m  CREATE TABLE "preferences" ("id" serial primary key, "user_id" integer, "name" character varying(32) DEFAULT '' NOT NULL, "value" text, "created_at" timestamp NOT NULL, "updated_at" timestamp NOT NULL) 
  [1m[36m (1.1ms)[0m  [1mCREATE INDEX "index_preferences_on_user_id_and_name" ON "preferences" ("user_id", "name")[0m
  [1m[35m (3.2ms)[0m  CREATE TABLE "sessions" ("id" serial primary key, "session_id" character varying(255) NOT NULL, "data" text, "created_at" timestamp NOT NULL, "updated_at" timestamp NOT NULL) 
  [1m[36m (15.3ms)[0m  [1mCREATE INDEX "index_sessions_on_session_id" ON "sessions" ("session_id")[0m
  [1m[35m (1.4ms)[0m  CREATE INDEX "index_sessions_on_updated_at" ON "sessions" ("updated_at")
  [1m[36m (3.4ms)[0m  [1mCREATE TABLE "settings" ("id" serial primary key, "name" character varying(32) DEFAULT '' NOT NULL, "value" text, "created_at" timestamp NOT NULL, "updated_at" timestamp NOT NULL) [0m
  [1m[35m (0.9ms)[0m  CREATE INDEX "index_settings_on_name" ON "settings" ("name")
  [1m[36m (3.7ms)[0m  [1mCREATE TABLE "taggings" ("id" serial primary key, "tag_id" integer, "taggable_id" integer, "tagger_id" integer, "tagger_type" character varying(255), "taggable_type" character varying(255), "context" character varying(255), "created_at" timestamp) [0m
  [1m[35m (0.9ms)[0m  CREATE INDEX "index_taggings_on_tag_id" ON "taggings" ("tag_id")
  [1m[36m (1.0ms)[0m  [1mCREATE INDEX "index_taggings_on_taggable_id_and_taggable_type_and_context" ON "taggings" ("taggable_id", "taggable_type", "context")[0m
  [1m[35m (2.1ms)[0m  CREATE TABLE "tags" ("id" serial primary key, "name" character varying(255)) 
  [1m[36m (14.4ms)[0m  [1mCREATE TABLE "tasks" ("id" serial primary key, "user_id" integer, "assigned_to" integer, "completed_by" integer, "name" character varying(255) DEFAULT '' NOT NULL, "asset_id" integer, "asset_type" character varying(255), "priority" character varying(32), "category" character varying(32), "bucket" character varying(32), "due_at" timestamp, "completed_at" timestamp, "deleted_at" timestamp, "created_at" timestamp NOT NULL, "updated_at" timestamp NOT NULL, "background_info" character varying(255), "subscribed_users" text) [0m
  [1m[35m (0.9ms)[0m  CREATE INDEX "index_tasks_on_assigned_to" ON "tasks" ("assigned_to")
  [1m[36m (1.4ms)[0m  [1mCREATE UNIQUE INDEX "index_tasks_on_user_id_and_name_and_deleted_at" ON "tasks" ("user_id", "name", "deleted_at")[0m
  [1m[35m (5.4ms)[0m  CREATE TABLE "users" ("id" serial primary key, "username" character varying(32) DEFAULT '' NOT NULL, "email" character varying(64) DEFAULT '' NOT NULL, "first_name" character varying(32), "last_name" character varying(32), "title" character varying(64), "company" character varying(64), "alt_email" character varying(64), "phone" character varying(32), "mobile" character varying(32), "aim" character varying(32), "yahoo" character varying(32), "google" character varying(32), "skype" character varying(32), "password_hash" character varying(255) DEFAULT '' NOT NULL, "password_salt" character varying(255) DEFAULT '' NOT NULL, "persistence_token" character varying(255) DEFAULT '' NOT NULL, "perishable_token" character varying(255) DEFAULT '' NOT NULL, "last_request_at" timestamp, "last_login_at" timestamp, "current_login_at" timestamp, "last_login_ip" character varying(255), "current_login_ip" character varying(255), "login_count" integer DEFAULT 0 NOT NULL, "deleted_at" timestamp, "created_at" timestamp NOT NULL, "updated_at" timestamp NOT NULL, "admin" boolean DEFAULT 'f' NOT NULL, "suspended_at" timestamp, "single_access_token" character varying(255)) 
  [1m[36m (1.0ms)[0m  [1mCREATE INDEX "index_users_on_email" ON "users" ("email")[0m
  [1m[35m (0.9ms)[0m  CREATE INDEX "index_users_on_last_request_at" ON "users" ("last_request_at")
  [1m[36m (0.9ms)[0m  [1mCREATE INDEX "index_users_on_perishable_token" ON "users" ("perishable_token")[0m
  [1m[35m (1.0ms)[0m  CREATE INDEX "index_users_on_remember_token" ON "users" ("persistence_token")
  [1m[36m (1.1ms)[0m  [1mCREATE UNIQUE INDEX "index_users_on_username_and_deleted_at" ON "users" ("username", "deleted_at")[0m
  [1m[35m (3.6ms)[0m  CREATE TABLE "versions" ("id" serial primary key, "item_type" character varying(255) NOT NULL, "item_id" integer NOT NULL, "event" character varying(512) NOT NULL, "whodunnit" character varying(255), "object" text, "created_at" timestamp, "object_changes" text, "related_id" integer, "related_type" character varying(255)) 
  [1m[36m (1.1ms)[0m  [1mCREATE INDEX "index_versions_on_item_type_and_item_id" ON "versions" ("item_type", "item_id")[0m
  [1m[35m (0.9ms)[0m  CREATE INDEX "index_versions_on_whodunnit" ON "versions" ("whodunnit")
  [1m[36m (0.9ms)[0m  [1mCREATE TABLE "schema_migrations" ("version" character varying(255) NOT NULL) [0m
  [1m[35m (1.1ms)[0m  CREATE UNIQUE INDEX "unique_schema_migrations" ON "schema_migrations" ("version")
  [1m[36m (0.2ms)[0m  [1mSELECT version FROM "schema_migrations"[0m
  [1m[35m (0.4ms)[0m  INSERT INTO "schema_migrations" (version) VALUES ('20120528102124')
  [1m[36m (0.1ms)[0m  [1mBEGIN[0m
  [1m[35m (0.4ms)[0m  SELECT COUNT(*) FROM "comments" 
  [1m[36m (0.4ms)[0m  [1mSELECT COUNT(*) FROM "opportunities" [0m
  [1m[35m (0.5ms)[0m  SELECT COUNT(*) FROM "accounts" 
Started POST "/vend/register_sale" for 127.0.0.1 at 2013-03-07 23:42:14 +1300
Processing by VendController#register_sale as JSON
  Parameters: {"payload"=>{"id"=>"5e8b5134-a002-dd6b-b7c7-26126887c4ee", "sale_date"=>"2012-11-13 16:40:06", "status"=>"CLOSED", "user_id"=>"9b2a8d5f-2d20-11e2-8057-080027706aa2", "customer_id"=>"9b17ac9d-2d20-11e2-8057-080027706aa2", "register_id"=>"9af85e69-2d20-11e2-8057-080027706aa2", "market_id"=>"1", "invoice_number"=>"144", "short_code"=>"ne2zq", "totals"=>{"total_price"=>"4.87", "total_tax"=>"0.69", "total_payment"=>"5.55", "total_to_pay"=>"0"}, "note"=>nil, "updated_at"=>"2012-11-13 16:40:09", "created_at"=>"2012-11-13 16:40:09", "customer"=>{"id"=>"9b17ac9d-2d20-11e2-8057-080027706aa2", "customer_code"=>"WALKIN", "balance"=>"-6.250", "points"=>"0", "note"=>nil, "year_to_date"=>"79945.92188", "sex"=>"M", "date_of_birth"=>"1950-05-25", "updated_at"=>"2012-11-13 16:43:15", "created_at"=>"2012-11-13 12:28:03"}, "user"=>{"id"=>"9b2a8d5f-2d20-11e2-8057-080027706aa2", "name"=>"admin", "display_name"=>"A admin this time", "outlet_id"=>"9ae97219-2d20-11e2-8057-080027706aa2", "target_daily"=>nil, "target_weekly"=>nil, "target_monthly"=>nil, "created_at"=>"2011-09-08 05:18:38", "updated_at"=>"2011-09-08 05:18:38"}, "register_sale_products"=>[{"id"=>"148793f0-475a-7d49-442d-fd761ce76339", "product_id"=>"9fe945bc-2d20-11e2-8057-080027706aa2", "quantity"=>"1", "price"=>"1.90", "price_set"=>"true", "tax"=>"0.24", "price_total"=>"1.9", "tax_total"=>"0.24", "tax_id"=>"9a025ff0-2d20-11e2-8057-080027706aa2", "tax_name"=>"NZ GST", "tax_rate"=>"0.150000"}, {"id"=>"7d37dc0f-9462-06fa-cae0-0b4988b36539", "product_id"=>"a0c0df02-2d20-11e2-8057-080027706aa2", "quantity"=>"3", "price"=>"0.99", "price_set"=>"true", "tax"=>"0.15", "price_total"=>"2.97", "tax_total"=>"0.45", "tax_id"=>"9a025ff0-2d20-11e2-8057-080027706aa2", "tax_name"=>"NZ GST", "tax_rate"=>"0.150000"}], "register_sale_payments"=>[{"id"=>"39948e3e-bf93-1b60-ff44-f46a777ed1d4", "payment_date"=>"2012-11-13 16:40:06", "amount"=>"5.55", "retailer_payment_type_id"=>"9e9ba1ba-2d20-11e2-8057-080027706aa2", "payment_type_id"=>"1"}]}}
  [1m[36mAccount Load (1.0ms)[0m  [1mSELECT "accounts".* FROM "accounts" WHERE "accounts"."cf_vend_customer_id" = '9b17ac9d-2d20-11e2-8057-080027706aa2' LIMIT 1[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36m (0.7ms)[0m  [1mSELECT "tags".id FROM "tags" INNER JOIN "taggings" ON "tags"."id" = "taggings"."tag_id" WHERE "taggings"."taggable_id" IS NULL AND "taggings"."taggable_type" = 'Account' AND (taggings.context = 'tags')[0m
  [1m[35mFieldGroup Load (0.4ms)[0m  SELECT "field_groups".* FROM "field_groups" WHERE "field_groups"."klass_name" = 'Account' AND (tag_id IS NULL OR tag_id IN (NULL)) ORDER BY position
  [1m[36mAccount Exists (0.4ms)[0m  [1mSELECT 1 AS one FROM "accounts" WHERE ("accounts"."name" = 'Account for Register Sale 144' AND "accounts"."deleted_at" IS NULL) LIMIT 1[0m
  [1m[35mSQL (1.2ms)[0m  INSERT INTO "accounts" ("access", "assigned_to", "background_info", "category", "cf_vend_customer_id", "created_at", "deleted_at", "email", "fax", "name", "phone", "rating", "subscribed_users", "toll_free_phone", "updated_at", "user_id", "website") VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9, $10, $11, $12, $13, $14, $15, $16, $17) RETURNING "id"  [["access", "Public"], ["assigned_to", nil], ["background_info", nil], ["category", nil], ["cf_vend_customer_id", "9b17ac9d-2d20-11e2-8057-080027706aa2"], ["created_at", Thu, 07 Mar 2013 10:42:15 UTC +00:00], ["deleted_at", nil], ["email", nil], ["fax", nil], ["name", "Account for Register Sale 144"], ["phone", nil], ["rating", 0], ["subscribed_users", nil], ["toll_free_phone", nil], ["updated_at", Thu, 07 Mar 2013 10:42:15 UTC +00:00], ["user_id", nil], ["website", nil]]
  [1m[36mSQL (1.3ms)[0m  [1mINSERT INTO "versions" ("created_at", "event", "item_id", "item_type", "object", "object_changes", "related_id", "related_type", "whodunnit") VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9) RETURNING "id"[0m  [["created_at", Thu, 07 Mar 2013 10:42:15 UTC +00:00], ["event", "create"], ["item_id", 1], ["item_type", "Account"], ["object", nil], ["object_changes", "--- !map:ActiveSupport::HashWithIndifferentAccess \nname: \n- \"\"\n- Account for Register Sale 144\ncf_vend_customer_id: \n- \n- 9b17ac9d-2d20-11e2-8057-080027706aa2\ncreated_at: \n- \n- &id001 2013-03-07 10:42:15.046349 Z\nupdated_at: \n- \n- *id001\nid: \n- \n- 1\n"], ["related_id", nil], ["related_type", nil], ["whodunnit", nil]]
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36m (0.2ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35m (0.4ms)[0m  SELECT "tags".id FROM "tags" INNER JOIN "taggings" ON "tags"."id" = "taggings"."tag_id" WHERE "taggings"."taggable_id" IS NULL AND "taggings"."taggable_type" = 'Opportunity' AND (taggings.context = 'tags')
  [1m[36mFieldGroup Load (0.2ms)[0m  [1mSELECT "field_groups".* FROM "field_groups" WHERE "field_groups"."klass_name" = 'Opportunity' AND (tag_id IS NULL OR tag_id IN (NULL)) ORDER BY position[0m
  [1m[35mSQL (1.3ms)[0m  INSERT INTO "opportunities" ("access", "amount", "assigned_to", "background_info", "campaign_id", "closes_on", "created_at", "deleted_at", "discount", "name", "probability", "source", "stage", "subscribed_users", "updated_at", "user_id") VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9, $10, $11, $12, $13, $14, $15, $16) RETURNING "id"  [["access", "Public"], ["amount", #<BigDecimal:7ff7eedc02d8,'0.555E1',18(18)>], ["assigned_to", nil], ["background_info", nil], ["campaign_id", nil], ["closes_on", nil], ["created_at", Thu, 07 Mar 2013 10:42:15 UTC +00:00], ["deleted_at", nil], ["discount", nil], ["name", "Register Sale 144"], ["probability", nil], ["source", nil], ["stage", "won"], ["subscribed_users", nil], ["updated_at", Thu, 07 Mar 2013 10:42:15 UTC +00:00], ["user_id", nil]]
  [1m[36mSQL (0.4ms)[0m  [1mINSERT INTO "versions" ("created_at", "event", "item_id", "item_type", "object", "object_changes", "related_id", "related_type", "whodunnit") VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9) RETURNING "id"[0m  [["created_at", Thu, 07 Mar 2013 10:42:15 UTC +00:00], ["event", "create"], ["item_id", 1], ["item_type", "Opportunity"], ["object", nil], ["object_changes", "--- !map:ActiveSupport::HashWithIndifferentAccess \nname: \n- \"\"\n- Register Sale 144\namount: \n- \n- 5.55\nstage: \n- \n- won\ncreated_at: \n- \n- &id001 2013-03-07 10:42:15.105216 Z\nupdated_at: \n- \n- *id001\nid: \n- \n- 1\n"], ["related_id", nil], ["related_type", nil], ["whodunnit", nil]]
  [1m[35m (0.2ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36m (0.2ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mSQL (1.1ms)[0m  INSERT INTO "account_opportunities" ("account_id", "created_at", "deleted_at", "opportunity_id", "updated_at") VALUES ($1, $2, $3, $4, $5) RETURNING "id"  [["account_id", 1], ["created_at", Thu, 07 Mar 2013 10:42:15 UTC +00:00], ["deleted_at", nil], ["opportunity_id", 1], ["updated_at", Thu, 07 Mar 2013 10:42:15 UTC +00:00]]
  [1m[36mSQL (0.4ms)[0m  [1mINSERT INTO "versions" ("created_at", "event", "item_id", "item_type", "object", "object_changes", "related_id", "related_type", "whodunnit") VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9) RETURNING "id"[0m  [["created_at", Thu, 07 Mar 2013 10:42:15 UTC +00:00], ["event", "create"], ["item_id", 1], ["item_type", "AccountOpportunity"], ["object", nil], ["object_changes", "--- !map:ActiveSupport::HashWithIndifferentAccess \naccount_id: \n- \n- 1\nopportunity_id: \n- \n- 1\ncreated_at: \n- \n- &id001 2013-03-07 10:42:15.134308 Z\nupdated_at: \n- \n- *id001\nid: \n- \n- 1\n"], ["related_id", nil], ["related_type", nil], ["whodunnit", nil]]
  [1m[35m (0.2ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36m (0.2ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mOpportunity Load (0.4ms)[0m  SELECT "opportunities".* FROM "opportunities" WHERE "opportunities"."id" = 1 LIMIT 1
  [1m[36m (0.1ms)[0m  [1mROLLBACK TO SAVEPOINT active_record_1[0m
Completed 422 Unprocessable Entity in 324ms
  [1m[35m (0.6ms)[0m  ROLLBACK
  [1m[36m (0.0ms)[0m  [1mBEGIN[0m
  [1m[35m (0.2ms)[0m  ROLLBACK
Connecting to database specified by database.yml
  [1m[36mFieldGroup Load (1.3ms)[0m  [1mSELECT "field_groups".* FROM "field_groups" WHERE "field_groups"."klass_name" = 'Account' ORDER BY position[0m
  [1m[35mFieldGroup Load (0.2ms)[0m  SELECT "field_groups".* FROM "field_groups" WHERE "field_groups"."klass_name" = 'Campaign' ORDER BY position
  [1m[36mFieldGroup Load (0.3ms)[0m  [1mSELECT "field_groups".* FROM "field_groups" WHERE "field_groups"."klass_name" = 'Contact' ORDER BY position[0m
  [1m[35mFieldGroup Load (0.2ms)[0m  SELECT "field_groups".* FROM "field_groups" WHERE "field_groups"."klass_name" = 'Lead' ORDER BY position
  [1m[36mFieldGroup Load (0.3ms)[0m  [1mSELECT "field_groups".* FROM "field_groups" WHERE "field_groups"."klass_name" = 'Opportunity' ORDER BY position[0m
  [1m[35mFieldGroup Load (0.4ms)[0m  SELECT "field_groups".* FROM "field_groups" WHERE "field_groups"."klass_name" = 'Task' ORDER BY position
Creating scope :except. Overwriting existing method User.except.
  [1m[36m (121.5ms)[0m  [1mDROP DATABASE IF EXISTS "ffcrm_vend_test"[0m
  [1m[35m (242.3ms)[0m  CREATE DATABASE "ffcrm_vend_test" ENCODING = 'utf8'
  [1m[36m (11.5ms)[0m  [1mCREATE TABLE "account_contacts" ("id" serial primary key, "account_id" integer, "contact_id" integer, "deleted_at" timestamp, "created_at" timestamp NOT NULL, "updated_at" timestamp NOT NULL) [0m
  [1m[35m (2.6ms)[0m  CREATE TABLE "account_opportunities" ("id" serial primary key, "account_id" integer, "opportunity_id" integer, "deleted_at" timestamp, "created_at" timestamp NOT NULL, "updated_at" timestamp NOT NULL) 
  [1m[36m (4.1ms)[0m  [1mCREATE TABLE "accounts" ("id" serial primary key, "user_id" integer, "assigned_to" integer, "name" character varying(64) DEFAULT '' NOT NULL, "access" character varying(8) DEFAULT 'Public', "website" character varying(64), "toll_free_phone" character varying(32), "phone" character varying(32), "fax" character varying(32), "deleted_at" timestamp, "created_at" timestamp NOT NULL, "updated_at" timestamp NOT NULL, "email" character varying(64), "background_info" character varying(255), "rating" integer DEFAULT 0 NOT NULL, "category" character varying(32), "subscribed_users" text, "cf_vend_customer_id" character varying(255)) [0m
  [1m[35m (1.1ms)[0m  CREATE INDEX "index_accounts_on_assigned_to" ON "accounts" ("assigned_to")
  [1m[36m (1.3ms)[0m  [1mCREATE UNIQUE INDEX "index_accounts_on_user_id_and_name_and_deleted_at" ON "accounts" ("user_id", "name", "deleted_at")[0m
  [1m[35m (3.6ms)[0m  CREATE TABLE "activities" ("id" serial primary key, "user_id" integer, "subject_id" integer, "subject_type" character varying(255), "action" character varying(32) DEFAULT 'created', "info" character varying(255) DEFAULT '', "private" boolean DEFAULT 'f', "created_at" timestamp NOT NULL, "updated_at" timestamp NOT NULL) 
  [1m[36m (0.9ms)[0m  [1mCREATE INDEX "index_activities_on_created_at" ON "activities" ("created_at")[0m
  [1m[35m (1.1ms)[0m  CREATE INDEX "index_activities_on_user_id" ON "activities" ("user_id")
  [1m[36m (3.7ms)[0m  [1mCREATE TABLE "addresses" ("id" serial primary key, "street1" character varying(255), "street2" character varying(255), "city" character varying(64), "state" character varying(64), "zipcode" character varying(16), "country" character varying(64), "full_address" character varying(255), "address_type" character varying(16), "addressable_id" integer, "addressable_type" character varying(255), "created_at" timestamp NOT NULL, "updated_at" timestamp NOT NULL, "deleted_at" timestamp) [0m
  [1m[35m (0.9ms)[0m  CREATE INDEX "index_addresses_on_addressable_id_and_addressable_type" ON "addresses" ("addressable_id", "addressable_type")
  [1m[36m (3.3ms)[0m  [1mCREATE TABLE "avatars" ("id" serial primary key, "user_id" integer, "entity_id" integer, "entity_type" character varying(255), "image_file_size" integer, "image_file_name" character varying(255), "image_content_type" character varying(255), "created_at" timestamp NOT NULL, "updated_at" timestamp NOT NULL) [0m
  [1m[35m (3.9ms)[0m  CREATE TABLE "campaigns" ("id" serial primary key, "user_id" integer, "assigned_to" integer, "name" character varying(64) DEFAULT '' NOT NULL, "access" character varying(8) DEFAULT 'Public', "status" character varying(64), "budget" decimal(12,2), "target_leads" integer, "target_conversion" float, "target_revenue" decimal(12,2), "leads_count" integer, "opportunities_count" integer, "revenue" decimal(12,2), "starts_on" date, "ends_on" date, "objectives" text, "deleted_at" timestamp, "created_at" timestamp NOT NULL, "updated_at" timestamp NOT NULL, "background_info" character varying(255), "subscribed_users" text) 
  [1m[36m (0.9ms)[0m  [1mCREATE INDEX "index_campaigns_on_assigned_to" ON "campaigns" ("assigned_to")[0m
  [1m[35m (1.0ms)[0m  CREATE UNIQUE INDEX "index_campaigns_on_user_id_and_name_and_deleted_at" ON "campaigns" ("user_id", "name", "deleted_at")
  [1m[36m (4.2ms)[0m  [1mCREATE TABLE "comments" ("id" serial primary key, "user_id" integer, "commentable_id" integer, "commentable_type" character varying(255), "private" boolean, "title" character varying(255) DEFAULT '', "comment" text, "created_at" timestamp NOT NULL, "updated_at" timestamp NOT NULL, "state" character varying(16) DEFAULT 'Expanded' NOT NULL) [0m
  [1m[35m (2.6ms)[0m  CREATE TABLE "contact_opportunities" ("id" serial primary key, "contact_id" integer, "opportunity_id" integer, "role" character varying(32), "deleted_at" timestamp, "created_at" timestamp NOT NULL, "updated_at" timestamp NOT NULL) 
  [1m[36m (4.7ms)[0m  [1mCREATE TABLE "contacts" ("id" serial primary key, "user_id" integer, "lead_id" integer, "assigned_to" integer, "reports_to" integer, "first_name" character varying(64) DEFAULT '' NOT NULL, "last_name" character varying(64) DEFAULT '' NOT NULL, "access" character varying(8) DEFAULT 'Public', "title" character varying(64), "department" character varying(64), "source" character varying(32), "email" character varying(64), "alt_email" character varying(64), "phone" character varying(32), "mobile" character varying(32), "fax" character varying(32), "blog" character varying(128), "linkedin" character varying(128), "facebook" character varying(128), "twitter" character varying(128), "born_on" date, "do_not_call" boolean DEFAULT 'f' NOT NULL, "deleted_at" timestamp, "created_at" timestamp NOT NULL, "updated_at" timestamp NOT NULL, "background_info" character varying(255), "skype" character varying(128), "subscribed_users" text) [0m
  [1m[35m (1.0ms)[0m  CREATE INDEX "index_contacts_on_assigned_to" ON "contacts" ("assigned_to")
  [1m[36m (1.4ms)[0m  [1mCREATE UNIQUE INDEX "id_last_name_deleted" ON "contacts" ("user_id", "last_name", "deleted_at")[0m
  [1m[35m (3.9ms)[0m  CREATE TABLE "emails" ("id" serial primary key, "imap_message_id" character varying(255) NOT NULL, "user_id" integer, "mediator_id" integer, "mediator_type" character varying(255), "sent_from" character varying(255) NOT NULL, "sent_to" character varying(255) NOT NULL, "cc" character varying(255), "bcc" character varying(255), "subject" character varying(255), "body" text, "header" text, "sent_at" timestamp, "received_at" timestamp, "deleted_at" timestamp, "created_at" timestamp NOT NULL, "updated_at" timestamp NOT NULL, "state" character varying(16) DEFAULT 'Expanded' NOT NULL) 
  [1m[36m (1.0ms)[0m  [1mCREATE INDEX "index_emails_on_mediator_id_and_mediator_type" ON "emails" ("mediator_id", "mediator_type")[0m
  [1m[35m (2.4ms)[0m  CREATE TABLE "field_groups" ("id" serial primary key, "name" character varying(64), "label" character varying(128), "position" integer, "hint" character varying(255), "created_at" timestamp NOT NULL, "updated_at" timestamp NOT NULL, "tag_id" integer, "klass_name" character varying(32)) 
  [1m[36m (4.1ms)[0m  [1mCREATE TABLE "fields" ("id" serial primary key, "type" character varying(255), "field_group_id" integer, "position" integer, "name" character varying(64), "label" character varying(128), "hint" character varying(255), "placeholder" character varying(255), "as" character varying(32), "collection" text, "disabled" boolean, "required" boolean, "maxlength" integer, "created_at" timestamp NOT NULL, "updated_at" timestamp NOT NULL) [0m
  [1m[35m (0.8ms)[0m  CREATE INDEX "index_fields_on_field_group_id" ON "fields" ("field_group_id")
  [1m[36m (1.0ms)[0m  [1mCREATE INDEX "index_fields_on_name" ON "fields" ("name")[0m
  [1m[35m (4.9ms)[0m  CREATE TABLE "leads" ("id" serial primary key, "user_id" integer, "campaign_id" integer, "assigned_to" integer, "first_name" character varying(64) DEFAULT '' NOT NULL, "last_name" character varying(64) DEFAULT '' NOT NULL, "access" character varying(8) DEFAULT 'Public', "title" character varying(64), "company" character varying(64), "source" character varying(32), "status" character varying(32), "referred_by" character varying(64), "email" character varying(64), "alt_email" character varying(64), "phone" character varying(32), "mobile" character varying(32), "blog" character varying(128), "linkedin" character varying(128), "facebook" character varying(128), "twitter" character varying(128), "rating" integer DEFAULT 0 NOT NULL, "do_not_call" boolean DEFAULT 'f' NOT NULL, "deleted_at" timestamp, "created_at" timestamp NOT NULL, "updated_at" timestamp NOT NULL, "background_info" character varying(255), "skype" character varying(128), "subscribed_users" text) 
  [1m[36m (1.0ms)[0m  [1mCREATE INDEX "index_leads_on_assigned_to" ON "leads" ("assigned_to")[0m
  [1m[35m (1.0ms)[0m  CREATE UNIQUE INDEX "index_leads_on_user_id_and_last_name_and_deleted_at" ON "leads" ("user_id", "last_name", "deleted_at")
  [1m[36m (4.0ms)[0m  [1mCREATE TABLE "lists" ("id" serial primary key, "name" character varying(255), "url" text, "created_at" timestamp NOT NULL, "updated_at" timestamp NOT NULL) [0m
  [1m[35m (4.0ms)[0m  CREATE TABLE "opportunities" ("id" serial primary key, "user_id" integer, "campaign_id" integer, "assigned_to" integer, "name" character varying(64) DEFAULT '' NOT NULL, "access" character varying(8) DEFAULT 'Public', "source" character varying(32), "stage" character varying(32), "probability" integer, "amount" decimal(12,2), "discount" decimal(12,2), "closes_on" date, "deleted_at" timestamp, "created_at" timestamp NOT NULL, "updated_at" timestamp NOT NULL, "background_info" character varying(255), "subscribed_users" text) 
  [1m[36m (1.7ms)[0m  [1mCREATE INDEX "index_opportunities_on_assigned_to" ON "opportunities" ("assigned_to")[0m
  [1m[35m (1.3ms)[0m  CREATE UNIQUE INDEX "id_name_deleted" ON "opportunities" ("user_id", "name", "deleted_at")
  [1m[36m (3.2ms)[0m  [1mCREATE TABLE "permissions" ("id" serial primary key, "user_id" integer, "asset_id" integer, "asset_type" character varying(255), "created_at" timestamp NOT NULL, "updated_at" timestamp NOT NULL) [0m
  [1m[35m (1.1ms)[0m  CREATE INDEX "index_permissions_on_asset_id_and_asset_type" ON "permissions" ("asset_id", "asset_type")
  [1m[36m (0.9ms)[0m  [1mCREATE INDEX "index_permissions_on_user_id" ON "permissions" ("user_id")[0m
  [1m[35m (3.8ms)[0m  CREATE TABLE "preferences" ("id" serial primary key, "user_id" integer, "name" character varying(32) DEFAULT '' NOT NULL, "value" text, "created_at" timestamp NOT NULL, "updated_at" timestamp NOT NULL) 
  [1m[36m (1.1ms)[0m  [1mCREATE INDEX "index_preferences_on_user_id_and_name" ON "preferences" ("user_id", "name")[0m
  [1m[35m (3.4ms)[0m  CREATE TABLE "sessions" ("id" serial primary key, "session_id" character varying(255) NOT NULL, "data" text, "created_at" timestamp NOT NULL, "updated_at" timestamp NOT NULL) 
  [1m[36m (1.4ms)[0m  [1mCREATE INDEX "index_sessions_on_session_id" ON "sessions" ("session_id")[0m
  [1m[35m (1.0ms)[0m  CREATE INDEX "index_sessions_on_updated_at" ON "sessions" ("updated_at")
  [1m[36m (3.8ms)[0m  [1mCREATE TABLE "settings" ("id" serial primary key, "name" character varying(32) DEFAULT '' NOT NULL, "value" text, "created_at" timestamp NOT NULL, "updated_at" timestamp NOT NULL) [0m
  [1m[35m (1.5ms)[0m  CREATE INDEX "index_settings_on_name" ON "settings" ("name")
  [1m[36m (21.4ms)[0m  [1mCREATE TABLE "taggings" ("id" serial primary key, "tag_id" integer, "taggable_id" integer, "tagger_id" integer, "tagger_type" character varying(255), "taggable_type" character varying(255), "context" character varying(255), "created_at" timestamp) [0m
  [1m[35m (1.2ms)[0m  CREATE INDEX "index_taggings_on_tag_id" ON "taggings" ("tag_id")
  [1m[36m (1.0ms)[0m  [1mCREATE INDEX "index_taggings_on_taggable_id_and_taggable_type_and_context" ON "taggings" ("taggable_id", "taggable_type", "context")[0m
  [1m[35m (2.0ms)[0m  CREATE TABLE "tags" ("id" serial primary key, "name" character varying(255)) 
  [1m[36m (3.4ms)[0m  [1mCREATE TABLE "tasks" ("id" serial primary key, "user_id" integer, "assigned_to" integer, "completed_by" integer, "name" character varying(255) DEFAULT '' NOT NULL, "asset_id" integer, "asset_type" character varying(255), "priority" character varying(32), "category" character varying(32), "bucket" character varying(32), "due_at" timestamp, "completed_at" timestamp, "deleted_at" timestamp, "created_at" timestamp NOT NULL, "updated_at" timestamp NOT NULL, "background_info" character varying(255), "subscribed_users" text) [0m
  [1m[35m (0.9ms)[0m  CREATE INDEX "index_tasks_on_assigned_to" ON "tasks" ("assigned_to")
  [1m[36m (1.4ms)[0m  [1mCREATE UNIQUE INDEX "index_tasks_on_user_id_and_name_and_deleted_at" ON "tasks" ("user_id", "name", "deleted_at")[0m
  [1m[35m (16.4ms)[0m  CREATE TABLE "users" ("id" serial primary key, "username" character varying(32) DEFAULT '' NOT NULL, "email" character varying(64) DEFAULT '' NOT NULL, "first_name" character varying(32), "last_name" character varying(32), "title" character varying(64), "company" character varying(64), "alt_email" character varying(64), "phone" character varying(32), "mobile" character varying(32), "aim" character varying(32), "yahoo" character varying(32), "google" character varying(32), "skype" character varying(32), "password_hash" character varying(255) DEFAULT '' NOT NULL, "password_salt" character varying(255) DEFAULT '' NOT NULL, "persistence_token" character varying(255) DEFAULT '' NOT NULL, "perishable_token" character varying(255) DEFAULT '' NOT NULL, "last_request_at" timestamp, "last_login_at" timestamp, "current_login_at" timestamp, "last_login_ip" character varying(255), "current_login_ip" character varying(255), "login_count" integer DEFAULT 0 NOT NULL, "deleted_at" timestamp, "created_at" timestamp NOT NULL, "updated_at" timestamp NOT NULL, "admin" boolean DEFAULT 'f' NOT NULL, "suspended_at" timestamp, "single_access_token" character varying(255)) 
  [1m[36m (1.2ms)[0m  [1mCREATE INDEX "index_users_on_email" ON "users" ("email")[0m
  [1m[35m (1.0ms)[0m  CREATE INDEX "index_users_on_last_request_at" ON "users" ("last_request_at")
  [1m[36m (1.0ms)[0m  [1mCREATE INDEX "index_users_on_perishable_token" ON "users" ("perishable_token")[0m
  [1m[35m (1.2ms)[0m  CREATE INDEX "index_users_on_remember_token" ON "users" ("persistence_token")
  [1m[36m (1.2ms)[0m  [1mCREATE UNIQUE INDEX "index_users_on_username_and_deleted_at" ON "users" ("username", "deleted_at")[0m
  [1m[35m (3.9ms)[0m  CREATE TABLE "versions" ("id" serial primary key, "item_type" character varying(255) NOT NULL, "item_id" integer NOT NULL, "event" character varying(512) NOT NULL, "whodunnit" character varying(255), "object" text, "created_at" timestamp, "object_changes" text, "related_id" integer, "related_type" character varying(255)) 
  [1m[36m (7.7ms)[0m  [1mCREATE INDEX "index_versions_on_item_type_and_item_id" ON "versions" ("item_type", "item_id")[0m
  [1m[35m (1.3ms)[0m  CREATE INDEX "index_versions_on_whodunnit" ON "versions" ("whodunnit")
  [1m[36m (0.8ms)[0m  [1mCREATE TABLE "schema_migrations" ("version" character varying(255) NOT NULL) [0m
  [1m[35m (0.9ms)[0m  CREATE UNIQUE INDEX "unique_schema_migrations" ON "schema_migrations" ("version")
  [1m[36m (0.2ms)[0m  [1mSELECT version FROM "schema_migrations"[0m
  [1m[35m (0.4ms)[0m  INSERT INTO "schema_migrations" (version) VALUES ('20120528102124')
  [1m[36m (0.1ms)[0m  [1mBEGIN[0m
  [1m[35m (0.6ms)[0m  SELECT COUNT(*) FROM "comments" 
  [1m[36m (0.5ms)[0m  [1mSELECT COUNT(*) FROM "opportunities" [0m
  [1m[35m (0.5ms)[0m  SELECT COUNT(*) FROM "accounts" 
Started POST "/vend/register_sale" for 127.0.0.1 at 2013-03-07 23:43:18 +1300
Processing by VendController#register_sale as JSON
  Parameters: {"payload"=>{"id"=>"5e8b5134-a002-dd6b-b7c7-26126887c4ee", "sale_date"=>"2012-11-13 16:40:06", "status"=>"CLOSED", "user_id"=>"9b2a8d5f-2d20-11e2-8057-080027706aa2", "customer_id"=>"9b17ac9d-2d20-11e2-8057-080027706aa2", "register_id"=>"9af85e69-2d20-11e2-8057-080027706aa2", "market_id"=>"1", "invoice_number"=>"144", "short_code"=>"ne2zq", "totals"=>{"total_price"=>"4.87", "total_tax"=>"0.69", "total_payment"=>"5.55", "total_to_pay"=>"0"}, "note"=>nil, "updated_at"=>"2012-11-13 16:40:09", "created_at"=>"2012-11-13 16:40:09", "customer"=>{"id"=>"9b17ac9d-2d20-11e2-8057-080027706aa2", "customer_code"=>"WALKIN", "balance"=>"-6.250", "points"=>"0", "note"=>nil, "year_to_date"=>"79945.92188", "sex"=>"M", "date_of_birth"=>"1950-05-25", "updated_at"=>"2012-11-13 16:43:15", "created_at"=>"2012-11-13 12:28:03"}, "user"=>{"id"=>"9b2a8d5f-2d20-11e2-8057-080027706aa2", "name"=>"admin", "display_name"=>"A admin this time", "outlet_id"=>"9ae97219-2d20-11e2-8057-080027706aa2", "target_daily"=>nil, "target_weekly"=>nil, "target_monthly"=>nil, "created_at"=>"2011-09-08 05:18:38", "updated_at"=>"2011-09-08 05:18:38"}, "register_sale_products"=>[{"id"=>"148793f0-475a-7d49-442d-fd761ce76339", "product_id"=>"9fe945bc-2d20-11e2-8057-080027706aa2", "quantity"=>"1", "price"=>"1.90", "price_set"=>"true", "tax"=>"0.24", "price_total"=>"1.9", "tax_total"=>"0.24", "tax_id"=>"9a025ff0-2d20-11e2-8057-080027706aa2", "tax_name"=>"NZ GST", "tax_rate"=>"0.150000"}, {"id"=>"7d37dc0f-9462-06fa-cae0-0b4988b36539", "product_id"=>"a0c0df02-2d20-11e2-8057-080027706aa2", "quantity"=>"3", "price"=>"0.99", "price_set"=>"true", "tax"=>"0.15", "price_total"=>"2.97", "tax_total"=>"0.45", "tax_id"=>"9a025ff0-2d20-11e2-8057-080027706aa2", "tax_name"=>"NZ GST", "tax_rate"=>"0.150000"}], "register_sale_payments"=>[{"id"=>"39948e3e-bf93-1b60-ff44-f46a777ed1d4", "payment_date"=>"2012-11-13 16:40:06", "amount"=>"5.55", "retailer_payment_type_id"=>"9e9ba1ba-2d20-11e2-8057-080027706aa2", "payment_type_id"=>"1"}]}}
  [1m[36mAccount Load (0.6ms)[0m  [1mSELECT "accounts".* FROM "accounts" WHERE "accounts"."cf_vend_customer_id" = '9b17ac9d-2d20-11e2-8057-080027706aa2' LIMIT 1[0m
  [1m[35m (0.2ms)[0m  SAVEPOINT active_record_1
  [1m[36m (0.6ms)[0m  [1mSELECT "tags".id FROM "tags" INNER JOIN "taggings" ON "tags"."id" = "taggings"."tag_id" WHERE "taggings"."taggable_id" IS NULL AND "taggings"."taggable_type" = 'Account' AND (taggings.context = 'tags')[0m
  [1m[35mFieldGroup Load (0.5ms)[0m  SELECT "field_groups".* FROM "field_groups" WHERE "field_groups"."klass_name" = 'Account' AND (tag_id IS NULL OR tag_id IN (NULL)) ORDER BY position
  [1m[36mAccount Exists (0.4ms)[0m  [1mSELECT 1 AS one FROM "accounts" WHERE ("accounts"."name" = 'Account for Register Sale 144' AND "accounts"."deleted_at" IS NULL) LIMIT 1[0m
  [1m[35mSQL (1.9ms)[0m  INSERT INTO "accounts" ("access", "assigned_to", "background_info", "category", "cf_vend_customer_id", "created_at", "deleted_at", "email", "fax", "name", "phone", "rating", "subscribed_users", "toll_free_phone", "updated_at", "user_id", "website") VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9, $10, $11, $12, $13, $14, $15, $16, $17) RETURNING "id"  [["access", "Public"], ["assigned_to", nil], ["background_info", nil], ["category", nil], ["cf_vend_customer_id", "9b17ac9d-2d20-11e2-8057-080027706aa2"], ["created_at", Thu, 07 Mar 2013 10:43:18 UTC +00:00], ["deleted_at", nil], ["email", nil], ["fax", nil], ["name", "Account for Register Sale 144"], ["phone", nil], ["rating", 0], ["subscribed_users", nil], ["toll_free_phone", nil], ["updated_at", Thu, 07 Mar 2013 10:43:18 UTC +00:00], ["user_id", nil], ["website", nil]]
  [1m[36mSQL (1.3ms)[0m  [1mINSERT INTO "versions" ("created_at", "event", "item_id", "item_type", "object", "object_changes", "related_id", "related_type", "whodunnit") VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9) RETURNING "id"[0m  [["created_at", Thu, 07 Mar 2013 10:43:18 UTC +00:00], ["event", "create"], ["item_id", 1], ["item_type", "Account"], ["object", nil], ["object_changes", "--- !map:ActiveSupport::HashWithIndifferentAccess \nname: \n- \"\"\n- Account for Register Sale 144\ncf_vend_customer_id: \n- \n- 9b17ac9d-2d20-11e2-8057-080027706aa2\ncreated_at: \n- \n- &id001 2013-03-07 10:43:18.501919 Z\nupdated_at: \n- \n- *id001\nid: \n- \n- 1\n"], ["related_id", nil], ["related_type", nil], ["whodunnit", nil]]
  [1m[35m (0.2ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36m (0.2ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35m (0.5ms)[0m  SELECT "tags".id FROM "tags" INNER JOIN "taggings" ON "tags"."id" = "taggings"."tag_id" WHERE "taggings"."taggable_id" IS NULL AND "taggings"."taggable_type" = 'Opportunity' AND (taggings.context = 'tags')
  [1m[36mFieldGroup Load (0.3ms)[0m  [1mSELECT "field_groups".* FROM "field_groups" WHERE "field_groups"."klass_name" = 'Opportunity' AND (tag_id IS NULL OR tag_id IN (NULL)) ORDER BY position[0m
  [1m[35mSQL (1.1ms)[0m  INSERT INTO "opportunities" ("access", "amount", "assigned_to", "background_info", "campaign_id", "closes_on", "created_at", "deleted_at", "discount", "name", "probability", "source", "stage", "subscribed_users", "updated_at", "user_id") VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9, $10, $11, $12, $13, $14, $15, $16) RETURNING "id"  [["access", "Public"], ["amount", #<BigDecimal:7ffaadd40b20,'0.555E1',18(18)>], ["assigned_to", nil], ["background_info", nil], ["campaign_id", nil], ["closes_on", nil], ["created_at", Thu, 07 Mar 2013 10:43:18 UTC +00:00], ["deleted_at", nil], ["discount", nil], ["name", "Register Sale 144"], ["probability", nil], ["source", nil], ["stage", "won"], ["subscribed_users", nil], ["updated_at", Thu, 07 Mar 2013 10:43:18 UTC +00:00], ["user_id", nil]]
  [1m[36mSQL (0.5ms)[0m  [1mINSERT INTO "versions" ("created_at", "event", "item_id", "item_type", "object", "object_changes", "related_id", "related_type", "whodunnit") VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9) RETURNING "id"[0m  [["created_at", Thu, 07 Mar 2013 10:43:18 UTC +00:00], ["event", "create"], ["item_id", 1], ["item_type", "Opportunity"], ["object", nil], ["object_changes", "--- !map:ActiveSupport::HashWithIndifferentAccess \nname: \n- \"\"\n- Register Sale 144\namount: \n- \n- 5.55\nstage: \n- \n- won\ncreated_at: \n- \n- &id001 2013-03-07 10:43:18.559986 Z\nupdated_at: \n- \n- *id001\nid: \n- \n- 1\n"], ["related_id", nil], ["related_type", nil], ["whodunnit", nil]]
  [1m[35m (0.2ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36m (0.2ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mSQL (1.0ms)[0m  INSERT INTO "account_opportunities" ("account_id", "created_at", "deleted_at", "opportunity_id", "updated_at") VALUES ($1, $2, $3, $4, $5) RETURNING "id"  [["account_id", 1], ["created_at", Thu, 07 Mar 2013 10:43:18 UTC +00:00], ["deleted_at", nil], ["opportunity_id", 1], ["updated_at", Thu, 07 Mar 2013 10:43:18 UTC +00:00]]
  [1m[36mSQL (0.4ms)[0m  [1mINSERT INTO "versions" ("created_at", "event", "item_id", "item_type", "object", "object_changes", "related_id", "related_type", "whodunnit") VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9) RETURNING "id"[0m  [["created_at", Thu, 07 Mar 2013 10:43:18 UTC +00:00], ["event", "create"], ["item_id", 1], ["item_type", "AccountOpportunity"], ["object", nil], ["object_changes", "--- !map:ActiveSupport::HashWithIndifferentAccess \naccount_id: \n- \n- 1\nopportunity_id: \n- \n- 1\ncreated_at: \n- \n- &id001 2013-03-07 10:43:18.633088 Z\nupdated_at: \n- \n- *id001\nid: \n- \n- 1\n"], ["related_id", nil], ["related_type", nil], ["whodunnit", nil]]
  [1m[35m (0.2ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36mUser Load (0.6ms)[0m  [1mSELECT "users".* FROM "users" LIMIT 1[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mOpportunity Load (0.4ms)[0m  [1mSELECT "opportunities".* FROM "opportunities" WHERE "opportunities"."id" = 1 LIMIT 1[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
Completed 201 Created in 303ms (Views: 0.2ms | ActiveRecord: 0.0ms)
  [1m[36m (0.4ms)[0m  [1mSELECT COUNT(*) FROM "accounts" [0m
  [1m[35m (0.2ms)[0m  SELECT COUNT(*) FROM "opportunities" 
  [1m[36m (0.2ms)[0m  [1mSELECT COUNT(*) FROM "comments" [0m
  [1m[35m (0.8ms)[0m  ROLLBACK
  [1m[36m (0.1ms)[0m  [1mBEGIN[0m
  [1m[35m (0.1ms)[0m  ROLLBACK
Connecting to database specified by database.yml
  [1m[36mFieldGroup Load (0.9ms)[0m  [1mSELECT "field_groups".* FROM "field_groups" WHERE "field_groups"."klass_name" = 'Account' ORDER BY position[0m
  [1m[35mFieldGroup Load (0.3ms)[0m  SELECT "field_groups".* FROM "field_groups" WHERE "field_groups"."klass_name" = 'Campaign' ORDER BY position
  [1m[36mFieldGroup Load (0.3ms)[0m  [1mSELECT "field_groups".* FROM "field_groups" WHERE "field_groups"."klass_name" = 'Contact' ORDER BY position[0m
  [1m[35mFieldGroup Load (0.2ms)[0m  SELECT "field_groups".* FROM "field_groups" WHERE "field_groups"."klass_name" = 'Lead' ORDER BY position
  [1m[36mFieldGroup Load (0.3ms)[0m  [1mSELECT "field_groups".* FROM "field_groups" WHERE "field_groups"."klass_name" = 'Opportunity' ORDER BY position[0m
  [1m[35mFieldGroup Load (0.3ms)[0m  SELECT "field_groups".* FROM "field_groups" WHERE "field_groups"."klass_name" = 'Task' ORDER BY position
Creating scope :except. Overwriting existing method User.except.
  [1m[36m (122.4ms)[0m  [1mDROP DATABASE IF EXISTS "ffcrm_vend_test"[0m
  [1m[35m (249.3ms)[0m  CREATE DATABASE "ffcrm_vend_test" ENCODING = 'utf8'
  [1m[36m (5.9ms)[0m  [1mCREATE TABLE "account_contacts" ("id" serial primary key, "account_id" integer, "contact_id" integer, "deleted_at" timestamp, "created_at" timestamp NOT NULL, "updated_at" timestamp NOT NULL) [0m
  [1m[35m (15.4ms)[0m  CREATE TABLE "account_opportunities" ("id" serial primary key, "account_id" integer, "opportunity_id" integer, "deleted_at" timestamp, "created_at" timestamp NOT NULL, "updated_at" timestamp NOT NULL) 
  [1m[36m (4.0ms)[0m  [1mCREATE TABLE "accounts" ("id" serial primary key, "user_id" integer, "assigned_to" integer, "name" character varying(64) DEFAULT '' NOT NULL, "access" character varying(8) DEFAULT 'Public', "website" character varying(64), "toll_free_phone" character varying(32), "phone" character varying(32), "fax" character varying(32), "deleted_at" timestamp, "created_at" timestamp NOT NULL, "updated_at" timestamp NOT NULL, "email" character varying(64), "background_info" character varying(255), "rating" integer DEFAULT 0 NOT NULL, "category" character varying(32), "subscribed_users" text, "cf_vend_customer_id" character varying(255)) [0m
  [1m[35m (1.2ms)[0m  CREATE INDEX "index_accounts_on_assigned_to" ON "accounts" ("assigned_to")
  [1m[36m (1.5ms)[0m  [1mCREATE UNIQUE INDEX "index_accounts_on_user_id_and_name_and_deleted_at" ON "accounts" ("user_id", "name", "deleted_at")[0m
  [1m[35m (3.7ms)[0m  CREATE TABLE "activities" ("id" serial primary key, "user_id" integer, "subject_id" integer, "subject_type" character varying(255), "action" character varying(32) DEFAULT 'created', "info" character varying(255) DEFAULT '', "private" boolean DEFAULT 'f', "created_at" timestamp NOT NULL, "updated_at" timestamp NOT NULL) 
  [1m[36m (0.9ms)[0m  [1mCREATE INDEX "index_activities_on_created_at" ON "activities" ("created_at")[0m
  [1m[35m (0.9ms)[0m  CREATE INDEX "index_activities_on_user_id" ON "activities" ("user_id")
  [1m[36m (3.3ms)[0m  [1mCREATE TABLE "addresses" ("id" serial primary key, "street1" character varying(255), "street2" character varying(255), "city" character varying(64), "state" character varying(64), "zipcode" character varying(16), "country" character varying(64), "full_address" character varying(255), "address_type" character varying(16), "addressable_id" integer, "addressable_type" character varying(255), "created_at" timestamp NOT NULL, "updated_at" timestamp NOT NULL, "deleted_at" timestamp) [0m
  [1m[35m (1.0ms)[0m  CREATE INDEX "index_addresses_on_addressable_id_and_addressable_type" ON "addresses" ("addressable_id", "addressable_type")
  [1m[36m (3.8ms)[0m  [1mCREATE TABLE "avatars" ("id" serial primary key, "user_id" integer, "entity_id" integer, "entity_type" character varying(255), "image_file_size" integer, "image_file_name" character varying(255), "image_content_type" character varying(255), "created_at" timestamp NOT NULL, "updated_at" timestamp NOT NULL) [0m
  [1m[35m (3.7ms)[0m  CREATE TABLE "campaigns" ("id" serial primary key, "user_id" integer, "assigned_to" integer, "name" character varying(64) DEFAULT '' NOT NULL, "access" character varying(8) DEFAULT 'Public', "status" character varying(64), "budget" decimal(12,2), "target_leads" integer, "target_conversion" float, "target_revenue" decimal(12,2), "leads_count" integer, "opportunities_count" integer, "revenue" decimal(12,2), "starts_on" date, "ends_on" date, "objectives" text, "deleted_at" timestamp, "created_at" timestamp NOT NULL, "updated_at" timestamp NOT NULL, "background_info" character varying(255), "subscribed_users" text) 
  [1m[36m (1.0ms)[0m  [1mCREATE INDEX "index_campaigns_on_assigned_to" ON "campaigns" ("assigned_to")[0m
  [1m[35m (1.1ms)[0m  CREATE UNIQUE INDEX "index_campaigns_on_user_id_and_name_and_deleted_at" ON "campaigns" ("user_id", "name", "deleted_at")
  [1m[36m (3.7ms)[0m  [1mCREATE TABLE "comments" ("id" serial primary key, "user_id" integer, "commentable_id" integer, "commentable_type" character varying(255), "private" boolean, "title" character varying(255) DEFAULT '', "comment" text, "created_at" timestamp NOT NULL, "updated_at" timestamp NOT NULL, "state" character varying(16) DEFAULT 'Expanded' NOT NULL) [0m
  [1m[35m (2.4ms)[0m  CREATE TABLE "contact_opportunities" ("id" serial primary key, "contact_id" integer, "opportunity_id" integer, "role" character varying(32), "deleted_at" timestamp, "created_at" timestamp NOT NULL, "updated_at" timestamp NOT NULL) 
  [1m[36m (4.4ms)[0m  [1mCREATE TABLE "contacts" ("id" serial primary key, "user_id" integer, "lead_id" integer, "assigned_to" integer, "reports_to" integer, "first_name" character varying(64) DEFAULT '' NOT NULL, "last_name" character varying(64) DEFAULT '' NOT NULL, "access" character varying(8) DEFAULT 'Public', "title" character varying(64), "department" character varying(64), "source" character varying(32), "email" character varying(64), "alt_email" character varying(64), "phone" character varying(32), "mobile" character varying(32), "fax" character varying(32), "blog" character varying(128), "linkedin" character varying(128), "facebook" character varying(128), "twitter" character varying(128), "born_on" date, "do_not_call" boolean DEFAULT 'f' NOT NULL, "deleted_at" timestamp, "created_at" timestamp NOT NULL, "updated_at" timestamp NOT NULL, "background_info" character varying(255), "skype" character varying(128), "subscribed_users" text) [0m
  [1m[35m (1.1ms)[0m  CREATE INDEX "index_contacts_on_assigned_to" ON "contacts" ("assigned_to")
  [1m[36m (1.1ms)[0m  [1mCREATE UNIQUE INDEX "id_last_name_deleted" ON "contacts" ("user_id", "last_name", "deleted_at")[0m
  [1m[35m (3.4ms)[0m  CREATE TABLE "emails" ("id" serial primary key, "imap_message_id" character varying(255) NOT NULL, "user_id" integer, "mediator_id" integer, "mediator_type" character varying(255), "sent_from" character varying(255) NOT NULL, "sent_to" character varying(255) NOT NULL, "cc" character varying(255), "bcc" character varying(255), "subject" character varying(255), "body" text, "header" text, "sent_at" timestamp, "received_at" timestamp, "deleted_at" timestamp, "created_at" timestamp NOT NULL, "updated_at" timestamp NOT NULL, "state" character varying(16) DEFAULT 'Expanded' NOT NULL) 
  [1m[36m (1.0ms)[0m  [1mCREATE INDEX "index_emails_on_mediator_id_and_mediator_type" ON "emails" ("mediator_id", "mediator_type")[0m
  [1m[35m (3.2ms)[0m  CREATE TABLE "field_groups" ("id" serial primary key, "name" character varying(64), "label" character varying(128), "position" integer, "hint" character varying(255), "created_at" timestamp NOT NULL, "updated_at" timestamp NOT NULL, "tag_id" integer, "klass_name" character varying(32)) 
  [1m[36m (3.3ms)[0m  [1mCREATE TABLE "fields" ("id" serial primary key, "type" character varying(255), "field_group_id" integer, "position" integer, "name" character varying(64), "label" character varying(128), "hint" character varying(255), "placeholder" character varying(255), "as" character varying(32), "collection" text, "disabled" boolean, "required" boolean, "maxlength" integer, "created_at" timestamp NOT NULL, "updated_at" timestamp NOT NULL) [0m
  [1m[35m (1.1ms)[0m  CREATE INDEX "index_fields_on_field_group_id" ON "fields" ("field_group_id")
  [1m[36m (1.0ms)[0m  [1mCREATE INDEX "index_fields_on_name" ON "fields" ("name")[0m
  [1m[35m (4.0ms)[0m  CREATE TABLE "leads" ("id" serial primary key, "user_id" integer, "campaign_id" integer, "assigned_to" integer, "first_name" character varying(64) DEFAULT '' NOT NULL, "last_name" character varying(64) DEFAULT '' NOT NULL, "access" character varying(8) DEFAULT 'Public', "title" character varying(64), "company" character varying(64), "source" character varying(32), "status" character varying(32), "referred_by" character varying(64), "email" character varying(64), "alt_email" character varying(64), "phone" character varying(32), "mobile" character varying(32), "blog" character varying(128), "linkedin" character varying(128), "facebook" character varying(128), "twitter" character varying(128), "rating" integer DEFAULT 0 NOT NULL, "do_not_call" boolean DEFAULT 'f' NOT NULL, "deleted_at" timestamp, "created_at" timestamp NOT NULL, "updated_at" timestamp NOT NULL, "background_info" character varying(255), "skype" character varying(128), "subscribed_users" text) 
  [1m[36m (1.1ms)[0m  [1mCREATE INDEX "index_leads_on_assigned_to" ON "leads" ("assigned_to")[0m
  [1m[35m (1.2ms)[0m  CREATE UNIQUE INDEX "index_leads_on_user_id_and_last_name_and_deleted_at" ON "leads" ("user_id", "last_name", "deleted_at")
  [1m[36m (3.2ms)[0m  [1mCREATE TABLE "lists" ("id" serial primary key, "name" character varying(255), "url" text, "created_at" timestamp NOT NULL, "updated_at" timestamp NOT NULL) [0m
  [1m[35m (3.9ms)[0m  CREATE TABLE "opportunities" ("id" serial primary key, "user_id" integer, "campaign_id" integer, "assigned_to" integer, "name" character varying(64) DEFAULT '' NOT NULL, "access" character varying(8) DEFAULT 'Public', "source" character varying(32), "stage" character varying(32), "probability" integer, "amount" decimal(12,2), "discount" decimal(12,2), "closes_on" date, "deleted_at" timestamp, "created_at" timestamp NOT NULL, "updated_at" timestamp NOT NULL, "background_info" character varying(255), "subscribed_users" text) 
  [1m[36m (0.9ms)[0m  [1mCREATE INDEX "index_opportunities_on_assigned_to" ON "opportunities" ("assigned_to")[0m
  [1m[35m (1.1ms)[0m  CREATE UNIQUE INDEX "id_name_deleted" ON "opportunities" ("user_id", "name", "deleted_at")
  [1m[36m (2.6ms)[0m  [1mCREATE TABLE "permissions" ("id" serial primary key, "user_id" integer, "asset_id" integer, "asset_type" character varying(255), "created_at" timestamp NOT NULL, "updated_at" timestamp NOT NULL) [0m
  [1m[35m (1.3ms)[0m  CREATE INDEX "index_permissions_on_asset_id_and_asset_type" ON "permissions" ("asset_id", "asset_type")
  [1m[36m (0.9ms)[0m  [1mCREATE INDEX "index_permissions_on_user_id" ON "permissions" ("user_id")[0m
  [1m[35m (3.5ms)[0m  CREATE TABLE "preferences" ("id" serial primary key, "user_id" integer, "name" character varying(32) DEFAULT '' NOT NULL, "value" text, "created_at" timestamp NOT NULL, "updated_at" timestamp NOT NULL) 
  [1m[36m (1.1ms)[0m  [1mCREATE INDEX "index_preferences_on_user_id_and_name" ON "preferences" ("user_id", "name")[0m
  [1m[35m (3.3ms)[0m  CREATE TABLE "sessions" ("id" serial primary key, "session_id" character varying(255) NOT NULL, "data" text, "created_at" timestamp NOT NULL, "updated_at" timestamp NOT NULL) 
  [1m[36m (0.9ms)[0m  [1mCREATE INDEX "index_sessions_on_session_id" ON "sessions" ("session_id")[0m
  [1m[35m (0.8ms)[0m  CREATE INDEX "index_sessions_on_updated_at" ON "sessions" ("updated_at")
  [1m[36m (3.3ms)[0m  [1mCREATE TABLE "settings" ("id" serial primary key, "name" character varying(32) DEFAULT '' NOT NULL, "value" text, "created_at" timestamp NOT NULL, "updated_at" timestamp NOT NULL) [0m
  [1m[35m (1.1ms)[0m  CREATE INDEX "index_settings_on_name" ON "settings" ("name")
  [1m[36m (4.0ms)[0m  [1mCREATE TABLE "taggings" ("id" serial primary key, "tag_id" integer, "taggable_id" integer, "tagger_id" integer, "tagger_type" character varying(255), "taggable_type" character varying(255), "context" character varying(255), "created_at" timestamp) [0m
  [1m[35m (1.1ms)[0m  CREATE INDEX "index_taggings_on_tag_id" ON "taggings" ("tag_id")
  [1m[36m (1.2ms)[0m  [1mCREATE INDEX "index_taggings_on_taggable_id_and_taggable_type_and_context" ON "taggings" ("taggable_id", "taggable_type", "context")[0m
  [1m[35m (2.5ms)[0m  CREATE TABLE "tags" ("id" serial primary key, "name" character varying(255)) 
  [1m[36m (22.2ms)[0m  [1mCREATE TABLE "tasks" ("id" serial primary key, "user_id" integer, "assigned_to" integer, "completed_by" integer, "name" character varying(255) DEFAULT '' NOT NULL, "asset_id" integer, "asset_type" character varying(255), "priority" character varying(32), "category" character varying(32), "bucket" character varying(32), "due_at" timestamp, "completed_at" timestamp, "deleted_at" timestamp, "created_at" timestamp NOT NULL, "updated_at" timestamp NOT NULL, "background_info" character varying(255), "subscribed_users" text) [0m
  [1m[35m (11.2ms)[0m  CREATE INDEX "index_tasks_on_assigned_to" ON "tasks" ("assigned_to")
  [1m[36m (1.7ms)[0m  [1mCREATE UNIQUE INDEX "index_tasks_on_user_id_and_name_and_deleted_at" ON "tasks" ("user_id", "name", "deleted_at")[0m
  [1m[35m (4.3ms)[0m  CREATE TABLE "users" ("id" serial primary key, "username" character varying(32) DEFAULT '' NOT NULL, "email" character varying(64) DEFAULT '' NOT NULL, "first_name" character varying(32), "last_name" character varying(32), "title" character varying(64), "company" character varying(64), "alt_email" character varying(64), "phone" character varying(32), "mobile" character varying(32), "aim" character varying(32), "yahoo" character varying(32), "google" character varying(32), "skype" character varying(32), "password_hash" character varying(255) DEFAULT '' NOT NULL, "password_salt" character varying(255) DEFAULT '' NOT NULL, "persistence_token" character varying(255) DEFAULT '' NOT NULL, "perishable_token" character varying(255) DEFAULT '' NOT NULL, "last_request_at" timestamp, "last_login_at" timestamp, "current_login_at" timestamp, "last_login_ip" character varying(255), "current_login_ip" character varying(255), "login_count" integer DEFAULT 0 NOT NULL, "deleted_at" timestamp, "created_at" timestamp NOT NULL, "updated_at" timestamp NOT NULL, "admin" boolean DEFAULT 'f' NOT NULL, "suspended_at" timestamp, "single_access_token" character varying(255)) 
  [1m[36m (1.1ms)[0m  [1mCREATE INDEX "index_users_on_email" ON "users" ("email")[0m
  [1m[35m (1.1ms)[0m  CREATE INDEX "index_users_on_last_request_at" ON "users" ("last_request_at")
  [1m[36m (1.2ms)[0m  [1mCREATE INDEX "index_users_on_perishable_token" ON "users" ("perishable_token")[0m
  [1m[35m (1.0ms)[0m  CREATE INDEX "index_users_on_remember_token" ON "users" ("persistence_token")
  [1m[36m (1.1ms)[0m  [1mCREATE UNIQUE INDEX "index_users_on_username_and_deleted_at" ON "users" ("username", "deleted_at")[0m
  [1m[35m (4.4ms)[0m  CREATE TABLE "versions" ("id" serial primary key, "item_type" character varying(255) NOT NULL, "item_id" integer NOT NULL, "event" character varying(512) NOT NULL, "whodunnit" character varying(255), "object" text, "created_at" timestamp, "object_changes" text, "related_id" integer, "related_type" character varying(255)) 
  [1m[36m (9.0ms)[0m  [1mCREATE INDEX "index_versions_on_item_type_and_item_id" ON "versions" ("item_type", "item_id")[0m
  [1m[35m (1.4ms)[0m  CREATE INDEX "index_versions_on_whodunnit" ON "versions" ("whodunnit")
  [1m[36m (0.9ms)[0m  [1mCREATE TABLE "schema_migrations" ("version" character varying(255) NOT NULL) [0m
  [1m[35m (1.1ms)[0m  CREATE UNIQUE INDEX "unique_schema_migrations" ON "schema_migrations" ("version")
  [1m[36m (0.2ms)[0m  [1mSELECT version FROM "schema_migrations"[0m
  [1m[35m (0.5ms)[0m  INSERT INTO "schema_migrations" (version) VALUES ('20120528102124')
  [1m[36m (0.2ms)[0m  [1mBEGIN[0m
  [1m[35m (0.3ms)[0m  ROLLBACK
  [1m[36m (0.1ms)[0m  [1mBEGIN[0m
  [1m[35m (0.4ms)[0m  SELECT COUNT(*) FROM "comments" 
  [1m[36m (0.4ms)[0m  [1mSELECT COUNT(*) FROM "opportunities" [0m
  [1m[35m (0.4ms)[0m  SELECT COUNT(*) FROM "accounts" 
Started POST "/vend/register_sale" for 127.0.0.1 at 2013-03-07 23:47:05 +1300
Processing by VendController#register_sale as JSON
  Parameters: {"payload"=>{"id"=>"5e8b5134-a002-dd6b-b7c7-26126887c4ee", "sale_date"=>"2012-11-13 16:40:06", "status"=>"CLOSED", "user_id"=>"9b2a8d5f-2d20-11e2-8057-080027706aa2", "customer_id"=>"9b17ac9d-2d20-11e2-8057-080027706aa2", "register_id"=>"9af85e69-2d20-11e2-8057-080027706aa2", "market_id"=>"1", "invoice_number"=>"144", "short_code"=>"ne2zq", "totals"=>{"total_price"=>"4.87", "total_tax"=>"0.69", "total_payment"=>"5.55", "total_to_pay"=>"0"}, "note"=>nil, "updated_at"=>"2012-11-13 16:40:09", "created_at"=>"2012-11-13 16:40:09", "customer"=>{"id"=>"9b17ac9d-2d20-11e2-8057-080027706aa2", "customer_code"=>"WALKIN", "balance"=>"-6.250", "points"=>"0", "note"=>nil, "year_to_date"=>"79945.92188", "sex"=>"M", "date_of_birth"=>"1950-05-25", "updated_at"=>"2012-11-13 16:43:15", "created_at"=>"2012-11-13 12:28:03"}, "user"=>{"id"=>"9b2a8d5f-2d20-11e2-8057-080027706aa2", "name"=>"admin", "display_name"=>"A admin this time", "outlet_id"=>"9ae97219-2d20-11e2-8057-080027706aa2", "target_daily"=>nil, "target_weekly"=>nil, "target_monthly"=>nil, "created_at"=>"2011-09-08 05:18:38", "updated_at"=>"2011-09-08 05:18:38"}, "register_sale_products"=>[{"id"=>"148793f0-475a-7d49-442d-fd761ce76339", "product_id"=>"9fe945bc-2d20-11e2-8057-080027706aa2", "quantity"=>"1", "price"=>"1.90", "price_set"=>"true", "tax"=>"0.24", "price_total"=>"1.9", "tax_total"=>"0.24", "tax_id"=>"9a025ff0-2d20-11e2-8057-080027706aa2", "tax_name"=>"NZ GST", "tax_rate"=>"0.150000"}, {"id"=>"7d37dc0f-9462-06fa-cae0-0b4988b36539", "product_id"=>"a0c0df02-2d20-11e2-8057-080027706aa2", "quantity"=>"3", "price"=>"0.99", "price_set"=>"true", "tax"=>"0.15", "price_total"=>"2.97", "tax_total"=>"0.45", "tax_id"=>"9a025ff0-2d20-11e2-8057-080027706aa2", "tax_name"=>"NZ GST", "tax_rate"=>"0.150000"}], "register_sale_payments"=>[{"id"=>"39948e3e-bf93-1b60-ff44-f46a777ed1d4", "payment_date"=>"2012-11-13 16:40:06", "amount"=>"5.55", "retailer_payment_type_id"=>"9e9ba1ba-2d20-11e2-8057-080027706aa2", "payment_type_id"=>"1"}]}}
  [1m[36mAccount Load (1.0ms)[0m  [1mSELECT "accounts".* FROM "accounts" WHERE "accounts"."cf_vend_customer_id" = '9b17ac9d-2d20-11e2-8057-080027706aa2' LIMIT 1[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36m (0.7ms)[0m  [1mSELECT "tags".id FROM "tags" INNER JOIN "taggings" ON "tags"."id" = "taggings"."tag_id" WHERE "taggings"."taggable_id" IS NULL AND "taggings"."taggable_type" = 'Account' AND (taggings.context = 'tags')[0m
  [1m[35mFieldGroup Load (0.4ms)[0m  SELECT "field_groups".* FROM "field_groups" WHERE "field_groups"."klass_name" = 'Account' AND (tag_id IS NULL OR tag_id IN (NULL)) ORDER BY position
  [1m[36mAccount Exists (0.5ms)[0m  [1mSELECT 1 AS one FROM "accounts" WHERE ("accounts"."name" = 'Account for Register Sale 144' AND "accounts"."deleted_at" IS NULL) LIMIT 1[0m
  [1m[35mSQL (2.5ms)[0m  INSERT INTO "accounts" ("access", "assigned_to", "background_info", "category", "cf_vend_customer_id", "created_at", "deleted_at", "email", "fax", "name", "phone", "rating", "subscribed_users", "toll_free_phone", "updated_at", "user_id", "website") VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9, $10, $11, $12, $13, $14, $15, $16, $17) RETURNING "id"  [["access", "Public"], ["assigned_to", nil], ["background_info", nil], ["category", nil], ["cf_vend_customer_id", "9b17ac9d-2d20-11e2-8057-080027706aa2"], ["created_at", Thu, 07 Mar 2013 10:47:05 UTC +00:00], ["deleted_at", nil], ["email", nil], ["fax", nil], ["name", "Account for Register Sale 144"], ["phone", nil], ["rating", 0], ["subscribed_users", nil], ["toll_free_phone", nil], ["updated_at", Thu, 07 Mar 2013 10:47:05 UTC +00:00], ["user_id", nil], ["website", nil]]
  [1m[36mSQL (1.2ms)[0m  [1mINSERT INTO "versions" ("created_at", "event", "item_id", "item_type", "object", "object_changes", "related_id", "related_type", "whodunnit") VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9) RETURNING "id"[0m  [["created_at", Thu, 07 Mar 2013 10:47:05 UTC +00:00], ["event", "create"], ["item_id", 1], ["item_type", "Account"], ["object", nil], ["object_changes", "--- !map:ActiveSupport::HashWithIndifferentAccess \nname: \n- \"\"\n- Account for Register Sale 144\ncf_vend_customer_id: \n- \n- 9b17ac9d-2d20-11e2-8057-080027706aa2\ncreated_at: \n- \n- &id001 2013-03-07 10:47:05.287900 Z\nupdated_at: \n- \n- *id001\nid: \n- \n- 1\n"], ["related_id", nil], ["related_type", nil], ["whodunnit", nil]]
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36m (0.2ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35m (0.5ms)[0m  SELECT "tags".id FROM "tags" INNER JOIN "taggings" ON "tags"."id" = "taggings"."tag_id" WHERE "taggings"."taggable_id" IS NULL AND "taggings"."taggable_type" = 'Opportunity' AND (taggings.context = 'tags')
  [1m[36mFieldGroup Load (0.4ms)[0m  [1mSELECT "field_groups".* FROM "field_groups" WHERE "field_groups"."klass_name" = 'Opportunity' AND (tag_id IS NULL OR tag_id IN (NULL)) ORDER BY position[0m
  [1m[35mSQL (1.4ms)[0m  INSERT INTO "opportunities" ("access", "amount", "assigned_to", "background_info", "campaign_id", "closes_on", "created_at", "deleted_at", "discount", "name", "probability", "source", "stage", "subscribed_users", "updated_at", "user_id") VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9, $10, $11, $12, $13, $14, $15, $16) RETURNING "id"  [["access", "Public"], ["amount", #<BigDecimal:7f9e10260268,'0.555E1',18(18)>], ["assigned_to", nil], ["background_info", nil], ["campaign_id", nil], ["closes_on", nil], ["created_at", Thu, 07 Mar 2013 10:47:05 UTC +00:00], ["deleted_at", nil], ["discount", nil], ["name", "Register Sale 144"], ["probability", nil], ["source", nil], ["stage", "won"], ["subscribed_users", nil], ["updated_at", Thu, 07 Mar 2013 10:47:05 UTC +00:00], ["user_id", nil]]
  [1m[36mSQL (0.5ms)[0m  [1mINSERT INTO "versions" ("created_at", "event", "item_id", "item_type", "object", "object_changes", "related_id", "related_type", "whodunnit") VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9) RETURNING "id"[0m  [["created_at", Thu, 07 Mar 2013 10:47:05 UTC +00:00], ["event", "create"], ["item_id", 1], ["item_type", "Opportunity"], ["object", nil], ["object_changes", "--- !map:ActiveSupport::HashWithIndifferentAccess \nname: \n- \"\"\n- Register Sale 144\namount: \n- \n- 5.55\nstage: \n- \n- won\ncreated_at: \n- \n- &id001 2013-03-07 10:47:05.365877 Z\nupdated_at: \n- \n- *id001\nid: \n- \n- 1\n"], ["related_id", nil], ["related_type", nil], ["whodunnit", nil]]
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mSQL (1.0ms)[0m  INSERT INTO "account_opportunities" ("account_id", "created_at", "deleted_at", "opportunity_id", "updated_at") VALUES ($1, $2, $3, $4, $5) RETURNING "id"  [["account_id", 1], ["created_at", Thu, 07 Mar 2013 10:47:05 UTC +00:00], ["deleted_at", nil], ["opportunity_id", 1], ["updated_at", Thu, 07 Mar 2013 10:47:05 UTC +00:00]]
  [1m[36mSQL (0.4ms)[0m  [1mINSERT INTO "versions" ("created_at", "event", "item_id", "item_type", "object", "object_changes", "related_id", "related_type", "whodunnit") VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9) RETURNING "id"[0m  [["created_at", Thu, 07 Mar 2013 10:47:05 UTC +00:00], ["event", "create"], ["item_id", 1], ["item_type", "AccountOpportunity"], ["object", nil], ["object_changes", "--- !map:ActiveSupport::HashWithIndifferentAccess \naccount_id: \n- \n- 1\nopportunity_id: \n- \n- 1\ncreated_at: \n- \n- &id001 2013-03-07 10:47:05.400519 Z\nupdated_at: \n- \n- *id001\nid: \n- \n- 1\n"], ["related_id", nil], ["related_type", nil], ["whodunnit", nil]]
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36mUser Load (0.6ms)[0m  [1mSELECT "users".* FROM "users" WHERE "users"."email" = 'marketplace@crossroads.org.hk' LIMIT 1[0m
Completed 500 Internal Server Error in 378ms
  [1m[35m (0.4ms)[0m  ROLLBACK
Connecting to database specified by database.yml
  [1m[36mFieldGroup Load (0.9ms)[0m  [1mSELECT "field_groups".* FROM "field_groups" WHERE "field_groups"."klass_name" = 'Account' ORDER BY position[0m
  [1m[35mFieldGroup Load (0.3ms)[0m  SELECT "field_groups".* FROM "field_groups" WHERE "field_groups"."klass_name" = 'Campaign' ORDER BY position
  [1m[36mFieldGroup Load (0.2ms)[0m  [1mSELECT "field_groups".* FROM "field_groups" WHERE "field_groups"."klass_name" = 'Contact' ORDER BY position[0m
  [1m[35mFieldGroup Load (0.3ms)[0m  SELECT "field_groups".* FROM "field_groups" WHERE "field_groups"."klass_name" = 'Lead' ORDER BY position
  [1m[36mFieldGroup Load (0.3ms)[0m  [1mSELECT "field_groups".* FROM "field_groups" WHERE "field_groups"."klass_name" = 'Opportunity' ORDER BY position[0m
  [1m[35mFieldGroup Load (0.3ms)[0m  SELECT "field_groups".* FROM "field_groups" WHERE "field_groups"."klass_name" = 'Task' ORDER BY position
Creating scope :except. Overwriting existing method User.except.
  [1m[36m (121.4ms)[0m  [1mDROP DATABASE IF EXISTS "ffcrm_vend_test"[0m
  [1m[35m (248.0ms)[0m  CREATE DATABASE "ffcrm_vend_test" ENCODING = 'utf8'
  [1m[36m (16.1ms)[0m  [1mCREATE TABLE "account_contacts" ("id" serial primary key, "account_id" integer, "contact_id" integer, "deleted_at" timestamp, "created_at" timestamp NOT NULL, "updated_at" timestamp NOT NULL) [0m
  [1m[35m (2.2ms)[0m  CREATE TABLE "account_opportunities" ("id" serial primary key, "account_id" integer, "opportunity_id" integer, "deleted_at" timestamp, "created_at" timestamp NOT NULL, "updated_at" timestamp NOT NULL) 
  [1m[36m (4.2ms)[0m  [1mCREATE TABLE "accounts" ("id" serial primary key, "user_id" integer, "assigned_to" integer, "name" character varying(64) DEFAULT '' NOT NULL, "access" character varying(8) DEFAULT 'Public', "website" character varying(64), "toll_free_phone" character varying(32), "phone" character varying(32), "fax" character varying(32), "deleted_at" timestamp, "created_at" timestamp NOT NULL, "updated_at" timestamp NOT NULL, "email" character varying(64), "background_info" character varying(255), "rating" integer DEFAULT 0 NOT NULL, "category" character varying(32), "subscribed_users" text, "cf_vend_customer_id" character varying(255)) [0m
  [1m[35m (5.9ms)[0m  CREATE INDEX "index_accounts_on_assigned_to" ON "accounts" ("assigned_to")
  [1m[36m (2.0ms)[0m  [1mCREATE UNIQUE INDEX "index_accounts_on_user_id_and_name_and_deleted_at" ON "accounts" ("user_id", "name", "deleted_at")[0m
  [1m[35m (3.8ms)[0m  CREATE TABLE "activities" ("id" serial primary key, "user_id" integer, "subject_id" integer, "subject_type" character varying(255), "action" character varying(32) DEFAULT 'created', "info" character varying(255) DEFAULT '', "private" boolean DEFAULT 'f', "created_at" timestamp NOT NULL, "updated_at" timestamp NOT NULL) 
  [1m[36m (0.9ms)[0m  [1mCREATE INDEX "index_activities_on_created_at" ON "activities" ("created_at")[0m
  [1m[35m (0.9ms)[0m  CREATE INDEX "index_activities_on_user_id" ON "activities" ("user_id")
  [1m[36m (4.0ms)[0m  [1mCREATE TABLE "addresses" ("id" serial primary key, "street1" character varying(255), "street2" character varying(255), "city" character varying(64), "state" character varying(64), "zipcode" character varying(16), "country" character varying(64), "full_address" character varying(255), "address_type" character varying(16), "addressable_id" integer, "addressable_type" character varying(255), "created_at" timestamp NOT NULL, "updated_at" timestamp NOT NULL, "deleted_at" timestamp) [0m
  [1m[35m (1.1ms)[0m  CREATE INDEX "index_addresses_on_addressable_id_and_addressable_type" ON "addresses" ("addressable_id", "addressable_type")
  [1m[36m (19.3ms)[0m  [1mCREATE TABLE "avatars" ("id" serial primary key, "user_id" integer, "entity_id" integer, "entity_type" character varying(255), "image_file_size" integer, "image_file_name" character varying(255), "image_content_type" character varying(255), "created_at" timestamp NOT NULL, "updated_at" timestamp NOT NULL) [0m
  [1m[35m (9.3ms)[0m  CREATE TABLE "campaigns" ("id" serial primary key, "user_id" integer, "assigned_to" integer, "name" character varying(64) DEFAULT '' NOT NULL, "access" character varying(8) DEFAULT 'Public', "status" character varying(64), "budget" decimal(12,2), "target_leads" integer, "target_conversion" float, "target_revenue" decimal(12,2), "leads_count" integer, "opportunities_count" integer, "revenue" decimal(12,2), "starts_on" date, "ends_on" date, "objectives" text, "deleted_at" timestamp, "created_at" timestamp NOT NULL, "updated_at" timestamp NOT NULL, "background_info" character varying(255), "subscribed_users" text) 
  [1m[36m (1.0ms)[0m  [1mCREATE INDEX "index_campaigns_on_assigned_to" ON "campaigns" ("assigned_to")[0m
  [1m[35m (1.0ms)[0m  CREATE UNIQUE INDEX "index_campaigns_on_user_id_and_name_and_deleted_at" ON "campaigns" ("user_id", "name", "deleted_at")
  [1m[36m (3.6ms)[0m  [1mCREATE TABLE "comments" ("id" serial primary key, "user_id" integer, "commentable_id" integer, "commentable_type" character varying(255), "private" boolean, "title" character varying(255) DEFAULT '', "comment" text, "created_at" timestamp NOT NULL, "updated_at" timestamp NOT NULL, "state" character varying(16) DEFAULT 'Expanded' NOT NULL) [0m
  [1m[35m (2.2ms)[0m  CREATE TABLE "contact_opportunities" ("id" serial primary key, "contact_id" integer, "opportunity_id" integer, "role" character varying(32), "deleted_at" timestamp, "created_at" timestamp NOT NULL, "updated_at" timestamp NOT NULL) 
  [1m[36m (6.2ms)[0m  [1mCREATE TABLE "contacts" ("id" serial primary key, "user_id" integer, "lead_id" integer, "assigned_to" integer, "reports_to" integer, "first_name" character varying(64) DEFAULT '' NOT NULL, "last_name" character varying(64) DEFAULT '' NOT NULL, "access" character varying(8) DEFAULT 'Public', "title" character varying(64), "department" character varying(64), "source" character varying(32), "email" character varying(64), "alt_email" character varying(64), "phone" character varying(32), "mobile" character varying(32), "fax" character varying(32), "blog" character varying(128), "linkedin" character varying(128), "facebook" character varying(128), "twitter" character varying(128), "born_on" date, "do_not_call" boolean DEFAULT 'f' NOT NULL, "deleted_at" timestamp, "created_at" timestamp NOT NULL, "updated_at" timestamp NOT NULL, "background_info" character varying(255), "skype" character varying(128), "subscribed_users" text) [0m
  [1m[35m (1.4ms)[0m  CREATE INDEX "index_contacts_on_assigned_to" ON "contacts" ("assigned_to")
  [1m[36m (1.7ms)[0m  [1mCREATE UNIQUE INDEX "id_last_name_deleted" ON "contacts" ("user_id", "last_name", "deleted_at")[0m
  [1m[35m (4.9ms)[0m  CREATE TABLE "emails" ("id" serial primary key, "imap_message_id" character varying(255) NOT NULL, "user_id" integer, "mediator_id" integer, "mediator_type" character varying(255), "sent_from" character varying(255) NOT NULL, "sent_to" character varying(255) NOT NULL, "cc" character varying(255), "bcc" character varying(255), "subject" character varying(255), "body" text, "header" text, "sent_at" timestamp, "received_at" timestamp, "deleted_at" timestamp, "created_at" timestamp NOT NULL, "updated_at" timestamp NOT NULL, "state" character varying(16) DEFAULT 'Expanded' NOT NULL) 
  [1m[36m (1.3ms)[0m  [1mCREATE INDEX "index_emails_on_mediator_id_and_mediator_type" ON "emails" ("mediator_id", "mediator_type")[0m
  [1m[35m (3.7ms)[0m  CREATE TABLE "field_groups" ("id" serial primary key, "name" character varying(64), "label" character varying(128), "position" integer, "hint" character varying(255), "created_at" timestamp NOT NULL, "updated_at" timestamp NOT NULL, "tag_id" integer, "klass_name" character varying(32)) 
  [1m[36m (4.4ms)[0m  [1mCREATE TABLE "fields" ("id" serial primary key, "type" character varying(255), "field_group_id" integer, "position" integer, "name" character varying(64), "label" character varying(128), "hint" character varying(255), "placeholder" character varying(255), "as" character varying(32), "collection" text, "disabled" boolean, "required" boolean, "maxlength" integer, "created_at" timestamp NOT NULL, "updated_at" timestamp NOT NULL) [0m
  [1m[35m (1.2ms)[0m  CREATE INDEX "index_fields_on_field_group_id" ON "fields" ("field_group_id")
  [1m[36m (1.3ms)[0m  [1mCREATE INDEX "index_fields_on_name" ON "fields" ("name")[0m
  [1m[35m (4.5ms)[0m  CREATE TABLE "leads" ("id" serial primary key, "user_id" integer, "campaign_id" integer, "assigned_to" integer, "first_name" character varying(64) DEFAULT '' NOT NULL, "last_name" character varying(64) DEFAULT '' NOT NULL, "access" character varying(8) DEFAULT 'Public', "title" character varying(64), "company" character varying(64), "source" character varying(32), "status" character varying(32), "referred_by" character varying(64), "email" character varying(64), "alt_email" character varying(64), "phone" character varying(32), "mobile" character varying(32), "blog" character varying(128), "linkedin" character varying(128), "facebook" character varying(128), "twitter" character varying(128), "rating" integer DEFAULT 0 NOT NULL, "do_not_call" boolean DEFAULT 'f' NOT NULL, "deleted_at" timestamp, "created_at" timestamp NOT NULL, "updated_at" timestamp NOT NULL, "background_info" character varying(255), "skype" character varying(128), "subscribed_users" text) 
  [1m[36m (1.6ms)[0m  [1mCREATE INDEX "index_leads_on_assigned_to" ON "leads" ("assigned_to")[0m
  [1m[35m (1.4ms)[0m  CREATE UNIQUE INDEX "index_leads_on_user_id_and_last_name_and_deleted_at" ON "leads" ("user_id", "last_name", "deleted_at")
  [1m[36m (4.3ms)[0m  [1mCREATE TABLE "lists" ("id" serial primary key, "name" character varying(255), "url" text, "created_at" timestamp NOT NULL, "updated_at" timestamp NOT NULL) [0m
  [1m[35m (4.7ms)[0m  CREATE TABLE "opportunities" ("id" serial primary key, "user_id" integer, "campaign_id" integer, "assigned_to" integer, "name" character varying(64) DEFAULT '' NOT NULL, "access" character varying(8) DEFAULT 'Public', "source" character varying(32), "stage" character varying(32), "probability" integer, "amount" decimal(12,2), "discount" decimal(12,2), "closes_on" date, "deleted_at" timestamp, "created_at" timestamp NOT NULL, "updated_at" timestamp NOT NULL, "background_info" character varying(255), "subscribed_users" text) 
  [1m[36m (1.1ms)[0m  [1mCREATE INDEX "index_opportunities_on_assigned_to" ON "opportunities" ("assigned_to")[0m
  [1m[35m (1.1ms)[0m  CREATE UNIQUE INDEX "id_name_deleted" ON "opportunities" ("user_id", "name", "deleted_at")
  [1m[36m (2.3ms)[0m  [1mCREATE TABLE "permissions" ("id" serial primary key, "user_id" integer, "asset_id" integer, "asset_type" character varying(255), "created_at" timestamp NOT NULL, "updated_at" timestamp NOT NULL) [0m
  [1m[35m (0.9ms)[0m  CREATE INDEX "index_permissions_on_asset_id_and_asset_type" ON "permissions" ("asset_id", "asset_type")
  [1m[36m (0.9ms)[0m  [1mCREATE INDEX "index_permissions_on_user_id" ON "permissions" ("user_id")[0m
  [1m[35m (3.6ms)[0m  CREATE TABLE "preferences" ("id" serial primary key, "user_id" integer, "name" character varying(32) DEFAULT '' NOT NULL, "value" text, "created_at" timestamp NOT NULL, "updated_at" timestamp NOT NULL) 
  [1m[36m (1.0ms)[0m  [1mCREATE INDEX "index_preferences_on_user_id_and_name" ON "preferences" ("user_id", "name")[0m
  [1m[35m (3.2ms)[0m  CREATE TABLE "sessions" ("id" serial primary key, "session_id" character varying(255) NOT NULL, "data" text, "created_at" timestamp NOT NULL, "updated_at" timestamp NOT NULL) 
  [1m[36m (1.1ms)[0m  [1mCREATE INDEX "index_sessions_on_session_id" ON "sessions" ("session_id")[0m
  [1m[35m (0.9ms)[0m  CREATE INDEX "index_sessions_on_updated_at" ON "sessions" ("updated_at")
  [1m[36m (3.5ms)[0m  [1mCREATE TABLE "settings" ("id" serial primary key, "name" character varying(32) DEFAULT '' NOT NULL, "value" text, "created_at" timestamp NOT NULL, "updated_at" timestamp NOT NULL) [0m
  [1m[35m (1.1ms)[0m  CREATE INDEX "index_settings_on_name" ON "settings" ("name")
  [1m[36m (3.7ms)[0m  [1mCREATE TABLE "taggings" ("id" serial primary key, "tag_id" integer, "taggable_id" integer, "tagger_id" integer, "tagger_type" character varying(255), "taggable_type" character varying(255), "context" character varying(255), "created_at" timestamp) [0m
  [1m[35m (0.9ms)[0m  CREATE INDEX "index_taggings_on_tag_id" ON "taggings" ("tag_id")
  [1m[36m (1.1ms)[0m  [1mCREATE INDEX "index_taggings_on_taggable_id_and_taggable_type_and_context" ON "taggings" ("taggable_id", "taggable_type", "context")[0m
  [1m[35m (2.1ms)[0m  CREATE TABLE "tags" ("id" serial primary key, "name" character varying(255)) 
  [1m[36m (3.6ms)[0m  [1mCREATE TABLE "tasks" ("id" serial primary key, "user_id" integer, "assigned_to" integer, "completed_by" integer, "name" character varying(255) DEFAULT '' NOT NULL, "asset_id" integer, "asset_type" character varying(255), "priority" character varying(32), "category" character varying(32), "bucket" character varying(32), "due_at" timestamp, "completed_at" timestamp, "deleted_at" timestamp, "created_at" timestamp NOT NULL, "updated_at" timestamp NOT NULL, "background_info" character varying(255), "subscribed_users" text) [0m
  [1m[35m (1.2ms)[0m  CREATE INDEX "index_tasks_on_assigned_to" ON "tasks" ("assigned_to")
  [1m[36m (1.0ms)[0m  [1mCREATE UNIQUE INDEX "index_tasks_on_user_id_and_name_and_deleted_at" ON "tasks" ("user_id", "name", "deleted_at")[0m
  [1m[35m (4.2ms)[0m  CREATE TABLE "users" ("id" serial primary key, "username" character varying(32) DEFAULT '' NOT NULL, "email" character varying(64) DEFAULT '' NOT NULL, "first_name" character varying(32), "last_name" character varying(32), "title" character varying(64), "company" character varying(64), "alt_email" character varying(64), "phone" character varying(32), "mobile" character varying(32), "aim" character varying(32), "yahoo" character varying(32), "google" character varying(32), "skype" character varying(32), "password_hash" character varying(255) DEFAULT '' NOT NULL, "password_salt" character varying(255) DEFAULT '' NOT NULL, "persistence_token" character varying(255) DEFAULT '' NOT NULL, "perishable_token" character varying(255) DEFAULT '' NOT NULL, "last_request_at" timestamp, "last_login_at" timestamp, "current_login_at" timestamp, "last_login_ip" character varying(255), "current_login_ip" character varying(255), "login_count" integer DEFAULT 0 NOT NULL, "deleted_at" timestamp, "created_at" timestamp NOT NULL, "updated_at" timestamp NOT NULL, "admin" boolean DEFAULT 'f' NOT NULL, "suspended_at" timestamp, "single_access_token" character varying(255)) 
  [1m[36m (1.3ms)[0m  [1mCREATE INDEX "index_users_on_email" ON "users" ("email")[0m
  [1m[35m (1.1ms)[0m  CREATE INDEX "index_users_on_last_request_at" ON "users" ("last_request_at")
  [1m[36m (1.0ms)[0m  [1mCREATE INDEX "index_users_on_perishable_token" ON "users" ("perishable_token")[0m
  [1m[35m (0.9ms)[0m  CREATE INDEX "index_users_on_remember_token" ON "users" ("persistence_token")
  [1m[36m (1.1ms)[0m  [1mCREATE UNIQUE INDEX "index_users_on_username_and_deleted_at" ON "users" ("username", "deleted_at")[0m
  [1m[35m (14.2ms)[0m  CREATE TABLE "versions" ("id" serial primary key, "item_type" character varying(255) NOT NULL, "item_id" integer NOT NULL, "event" character varying(512) NOT NULL, "whodunnit" character varying(255), "object" text, "created_at" timestamp, "object_changes" text, "related_id" integer, "related_type" character varying(255)) 
  [1m[36m (1.1ms)[0m  [1mCREATE INDEX "index_versions_on_item_type_and_item_id" ON "versions" ("item_type", "item_id")[0m
  [1m[35m (1.0ms)[0m  CREATE INDEX "index_versions_on_whodunnit" ON "versions" ("whodunnit")
  [1m[36m (5.0ms)[0m  [1mCREATE TABLE "schema_migrations" ("version" character varying(255) NOT NULL) [0m
  [1m[35m (9.8ms)[0m  CREATE UNIQUE INDEX "unique_schema_migrations" ON "schema_migrations" ("version")
  [1m[36m (0.3ms)[0m  [1mSELECT version FROM "schema_migrations"[0m
  [1m[35m (0.5ms)[0m  INSERT INTO "schema_migrations" (version) VALUES ('20120528102124')
  [1m[36m (0.2ms)[0m  [1mBEGIN[0m
  [1m[35m (0.3ms)[0m  ROLLBACK
  [1m[36m (0.1ms)[0m  [1mBEGIN[0m
  [1m[35m (0.4ms)[0m  SELECT COUNT(*) FROM "comments" 
  [1m[36m (0.5ms)[0m  [1mSELECT COUNT(*) FROM "opportunities" [0m
  [1m[35m (0.4ms)[0m  SELECT COUNT(*) FROM "accounts" 
Started POST "/vend/register_sale" for 127.0.0.1 at 2013-03-07 23:51:42 +1300
Processing by VendController#register_sale as JSON
  Parameters: {"payload"=>{"id"=>"5e8b5134-a002-dd6b-b7c7-26126887c4ee", "sale_date"=>"2012-11-13 16:40:06", "status"=>"CLOSED", "user_id"=>"9b2a8d5f-2d20-11e2-8057-080027706aa2", "customer_id"=>"9b17ac9d-2d20-11e2-8057-080027706aa2", "register_id"=>"9af85e69-2d20-11e2-8057-080027706aa2", "market_id"=>"1", "invoice_number"=>"144", "short_code"=>"ne2zq", "totals"=>{"total_price"=>"4.87", "total_tax"=>"0.69", "total_payment"=>"5.55", "total_to_pay"=>"0"}, "note"=>nil, "updated_at"=>"2012-11-13 16:40:09", "created_at"=>"2012-11-13 16:40:09", "customer"=>{"id"=>"9b17ac9d-2d20-11e2-8057-080027706aa2", "customer_code"=>"WALKIN", "balance"=>"-6.250", "points"=>"0", "note"=>nil, "year_to_date"=>"79945.92188", "sex"=>"M", "date_of_birth"=>"1950-05-25", "updated_at"=>"2012-11-13 16:43:15", "created_at"=>"2012-11-13 12:28:03"}, "user"=>{"id"=>"9b2a8d5f-2d20-11e2-8057-080027706aa2", "name"=>"admin", "display_name"=>"A admin this time", "outlet_id"=>"9ae97219-2d20-11e2-8057-080027706aa2", "target_daily"=>nil, "target_weekly"=>nil, "target_monthly"=>nil, "created_at"=>"2011-09-08 05:18:38", "updated_at"=>"2011-09-08 05:18:38"}, "register_sale_products"=>[{"id"=>"148793f0-475a-7d49-442d-fd761ce76339", "product_id"=>"9fe945bc-2d20-11e2-8057-080027706aa2", "quantity"=>"1", "price"=>"1.90", "price_set"=>"true", "tax"=>"0.24", "price_total"=>"1.9", "tax_total"=>"0.24", "tax_id"=>"9a025ff0-2d20-11e2-8057-080027706aa2", "tax_name"=>"NZ GST", "tax_rate"=>"0.150000"}, {"id"=>"7d37dc0f-9462-06fa-cae0-0b4988b36539", "product_id"=>"a0c0df02-2d20-11e2-8057-080027706aa2", "quantity"=>"3", "price"=>"0.99", "price_set"=>"true", "tax"=>"0.15", "price_total"=>"2.97", "tax_total"=>"0.45", "tax_id"=>"9a025ff0-2d20-11e2-8057-080027706aa2", "tax_name"=>"NZ GST", "tax_rate"=>"0.150000"}], "register_sale_payments"=>[{"id"=>"39948e3e-bf93-1b60-ff44-f46a777ed1d4", "payment_date"=>"2012-11-13 16:40:06", "amount"=>"5.55", "retailer_payment_type_id"=>"9e9ba1ba-2d20-11e2-8057-080027706aa2", "payment_type_id"=>"1"}]}}
  [1m[36mAccount Load (0.6ms)[0m  [1mSELECT "accounts".* FROM "accounts" WHERE "accounts"."cf_vend_customer_id" = '9b17ac9d-2d20-11e2-8057-080027706aa2' LIMIT 1[0m
  [1m[35m (0.2ms)[0m  SAVEPOINT active_record_1
  [1m[36m (0.9ms)[0m  [1mSELECT "tags".id FROM "tags" INNER JOIN "taggings" ON "tags"."id" = "taggings"."tag_id" WHERE "taggings"."taggable_id" IS NULL AND "taggings"."taggable_type" = 'Account' AND (taggings.context = 'tags')[0m
  [1m[35mFieldGroup Load (0.5ms)[0m  SELECT "field_groups".* FROM "field_groups" WHERE "field_groups"."klass_name" = 'Account' AND (tag_id IS NULL OR tag_id IN (NULL)) ORDER BY position
  [1m[36mAccount Exists (0.4ms)[0m  [1mSELECT 1 AS one FROM "accounts" WHERE ("accounts"."name" = 'Account for Register Sale 144' AND "accounts"."deleted_at" IS NULL) LIMIT 1[0m
  [1m[35mSQL (1.8ms)[0m  INSERT INTO "accounts" ("access", "assigned_to", "background_info", "category", "cf_vend_customer_id", "created_at", "deleted_at", "email", "fax", "name", "phone", "rating", "subscribed_users", "toll_free_phone", "updated_at", "user_id", "website") VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9, $10, $11, $12, $13, $14, $15, $16, $17) RETURNING "id"  [["access", "Public"], ["assigned_to", nil], ["background_info", nil], ["category", nil], ["cf_vend_customer_id", "9b17ac9d-2d20-11e2-8057-080027706aa2"], ["created_at", Thu, 07 Mar 2013 10:51:42 UTC +00:00], ["deleted_at", nil], ["email", nil], ["fax", nil], ["name", "Account for Register Sale 144"], ["phone", nil], ["rating", 0], ["subscribed_users", nil], ["toll_free_phone", nil], ["updated_at", Thu, 07 Mar 2013 10:51:42 UTC +00:00], ["user_id", nil], ["website", nil]]
  [1m[36mSQL (1.1ms)[0m  [1mINSERT INTO "versions" ("created_at", "event", "item_id", "item_type", "object", "object_changes", "related_id", "related_type", "whodunnit") VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9) RETURNING "id"[0m  [["created_at", Thu, 07 Mar 2013 10:51:42 UTC +00:00], ["event", "create"], ["item_id", 1], ["item_type", "Account"], ["object", nil], ["object_changes", "--- !map:ActiveSupport::HashWithIndifferentAccess \nname: \n- \"\"\n- Account for Register Sale 144\ncf_vend_customer_id: \n- \n- 9b17ac9d-2d20-11e2-8057-080027706aa2\ncreated_at: \n- \n- &id001 2013-03-07 10:51:42.710611 Z\nupdated_at: \n- \n- *id001\nid: \n- \n- 1\n"], ["related_id", nil], ["related_type", nil], ["whodunnit", nil]]
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36m (0.2ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35m (0.4ms)[0m  SELECT "tags".id FROM "tags" INNER JOIN "taggings" ON "tags"."id" = "taggings"."tag_id" WHERE "taggings"."taggable_id" IS NULL AND "taggings"."taggable_type" = 'Opportunity' AND (taggings.context = 'tags')
  [1m[36mFieldGroup Load (0.2ms)[0m  [1mSELECT "field_groups".* FROM "field_groups" WHERE "field_groups"."klass_name" = 'Opportunity' AND (tag_id IS NULL OR tag_id IN (NULL)) ORDER BY position[0m
  [1m[35mSQL (1.4ms)[0m  INSERT INTO "opportunities" ("access", "amount", "assigned_to", "background_info", "campaign_id", "closes_on", "created_at", "deleted_at", "discount", "name", "probability", "source", "stage", "subscribed_users", "updated_at", "user_id") VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9, $10, $11, $12, $13, $14, $15, $16) RETURNING "id"  [["access", "Public"], ["amount", #<BigDecimal:7f8852a75b20,'0.555E1',18(18)>], ["assigned_to", nil], ["background_info", nil], ["campaign_id", nil], ["closes_on", nil], ["created_at", Thu, 07 Mar 2013 10:51:42 UTC +00:00], ["deleted_at", nil], ["discount", nil], ["name", "Register Sale 144"], ["probability", nil], ["source", nil], ["stage", "won"], ["subscribed_users", nil], ["updated_at", Thu, 07 Mar 2013 10:51:42 UTC +00:00], ["user_id", nil]]
  [1m[36mSQL (0.5ms)[0m  [1mINSERT INTO "versions" ("created_at", "event", "item_id", "item_type", "object", "object_changes", "related_id", "related_type", "whodunnit") VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9) RETURNING "id"[0m  [["created_at", Thu, 07 Mar 2013 10:51:42 UTC +00:00], ["event", "create"], ["item_id", 1], ["item_type", "Opportunity"], ["object", nil], ["object_changes", "--- !map:ActiveSupport::HashWithIndifferentAccess \nname: \n- \"\"\n- Register Sale 144\namount: \n- \n- 5.55\nstage: \n- \n- won\ncreated_at: \n- \n- &id001 2013-03-07 10:51:42.808054 Z\nupdated_at: \n- \n- *id001\nid: \n- \n- 1\n"], ["related_id", nil], ["related_type", nil], ["whodunnit", nil]]
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mSQL (1.3ms)[0m  INSERT INTO "account_opportunities" ("account_id", "created_at", "deleted_at", "opportunity_id", "updated_at") VALUES ($1, $2, $3, $4, $5) RETURNING "id"  [["account_id", 1], ["created_at", Thu, 07 Mar 2013 10:51:42 UTC +00:00], ["deleted_at", nil], ["opportunity_id", 1], ["updated_at", Thu, 07 Mar 2013 10:51:42 UTC +00:00]]
  [1m[36mSQL (0.5ms)[0m  [1mINSERT INTO "versions" ("created_at", "event", "item_id", "item_type", "object", "object_changes", "related_id", "related_type", "whodunnit") VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9) RETURNING "id"[0m  [["created_at", Thu, 07 Mar 2013 10:51:42 UTC +00:00], ["event", "create"], ["item_id", 1], ["item_type", "AccountOpportunity"], ["object", nil], ["object_changes", "--- !map:ActiveSupport::HashWithIndifferentAccess \naccount_id: \n- \n- 1\nopportunity_id: \n- \n- 1\ncreated_at: \n- \n- &id001 2013-03-07 10:51:42.843678 Z\nupdated_at: \n- \n- *id001\nid: \n- \n- 1\n"], ["related_id", nil], ["related_type", nil], ["whodunnit", nil]]
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36mUser Load (1.1ms)[0m  [1mSELECT "users".* FROM "users" WHERE "users"."email" = 'marketplace@crossroads.org.hk' LIMIT 1[0m
  [1m[35m (0.2ms)[0m  SAVEPOINT active_record_1
  [1m[36mUser Exists (0.4ms)[0m  [1mSELECT 1 AS one FROM "users" WHERE "users"."email" = 'marketplace@crossroads.org.hk' LIMIT 1[0m
  [1m[35mUser Exists (0.4ms)[0m  SELECT 1 AS one FROM "users" WHERE "users"."username" = '' LIMIT 1
  [1m[36mUser Exists (0.4ms)[0m  [1mSELECT 1 AS one FROM "users" WHERE "users"."persistence_token" = '6251e602000a89dd8d6151ac18eb9c6d7fcb4f8e641cf1f706d8233a932a525896fef012a76ed5b56f49e2fb16b92e48658ecd901181fb3d62db64c18392d79e' LIMIT 1[0m
  [1m[35mUser Exists (0.4ms)[0m  SELECT 1 AS one FROM "users" WHERE "users"."single_access_token" = 'v1h7BlD3XXSh5QupkQy' LIMIT 1
  [1m[36m (0.1ms)[0m  [1mROLLBACK TO SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mOpportunity Load (0.5ms)[0m  [1mSELECT "opportunities".* FROM "opportunities" WHERE "opportunities"."id" = 1 LIMIT 1[0m
  [1m[35mCACHE (0.0ms)[0m  SELECT 1 AS one FROM "users" WHERE "users"."email" = 'marketplace@crossroads.org.hk' LIMIT 1
  [1m[36mCACHE (0.0ms)[0m  [1mSELECT 1 AS one FROM "users" WHERE "users"."username" = '' LIMIT 1[0m
  [1m[35mCACHE (0.0ms)[0m  SELECT 1 AS one FROM "users" WHERE "users"."persistence_token" = '6251e602000a89dd8d6151ac18eb9c6d7fcb4f8e641cf1f706d8233a932a525896fef012a76ed5b56f49e2fb16b92e48658ecd901181fb3d62db64c18392d79e' LIMIT 1
  [1m[36mCACHE (0.0ms)[0m  [1mSELECT 1 AS one FROM "users" WHERE "users"."single_access_token" = 'v1h7BlD3XXSh5QupkQy' LIMIT 1[0m
  [1m[35mSQL (1.0ms)[0m  INSERT INTO "comments" ("comment", "commentable_id", "commentable_type", "created_at", "private", "state", "title", "updated_at", "user_id") VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9) RETURNING "id"  [["comment", "https://globalhandicrafts.vendhq.com/sale/5e8b5134-a002-dd6b-b7c7-26126887c4ee"], ["commentable_id", 1], ["commentable_type", "Opportunity"], ["created_at", Thu, 07 Mar 2013 10:51:42 UTC +00:00], ["private", nil], ["state", "Expanded"], ["title", ""], ["updated_at", Thu, 07 Mar 2013 10:51:42 UTC +00:00], ["user_id", nil]]
  [1m[36mSQL (0.4ms)[0m  [1mINSERT INTO "versions" ("created_at", "event", "item_id", "item_type", "object", "object_changes", "related_id", "related_type", "whodunnit") VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9) RETURNING "id"[0m  [["created_at", Thu, 07 Mar 2013 10:51:42 UTC +00:00], ["event", "create"], ["item_id", 1], ["item_type", "Comment"], ["object", nil], ["object_changes", "--- !map:ActiveSupport::HashWithIndifferentAccess \ncomment: \n- \n- https://globalhandicrafts.vendhq.com/sale/5e8b5134-a002-dd6b-b7c7-26126887c4ee\ncommentable_id: \n- \n- 1\ncommentable_type: \n- \n- Opportunity\ncreated_at: \n- \n- &id001 2013-03-07 10:51:42.965721 Z\nupdated_at: \n- \n- *id001\nid: \n- \n- 1\n"], ["related_id", 1], ["related_type", "Opportunity"], ["whodunnit", nil]]
  [1m[35m (0.4ms)[0m  SELECT "tags".id FROM "tags" INNER JOIN "taggings" ON "tags"."id" = "taggings"."tag_id" WHERE "taggings"."taggable_id" = 1 AND "taggings"."taggable_type" = 'Opportunity' AND (taggings.context = 'tags')
  [1m[36mFieldGroup Load (0.3ms)[0m  [1mSELECT "field_groups".* FROM "field_groups" WHERE "field_groups"."klass_name" = 'Opportunity' AND (tag_id IS NULL OR tag_id IN (NULL)) ORDER BY position[0m
  [1m[35mOpportunity Load (0.6ms)[0m  SELECT "opportunities".* FROM "opportunities" WHERE "opportunities"."id" = $1 LIMIT 1  [["id", 1]]
  [1m[36m (0.4ms)[0m  [1mUPDATE "opportunities" SET "updated_at" = '2013-03-07 10:51:42.977882', "subscribed_users" = '--- !ruby/object:Set 
hash: 
 ~: true
' WHERE "opportunities"."id" = 1[0m
  [1m[35m (0.2ms)[0m  RELEASE SAVEPOINT active_record_1
Completed 201 Created in 452ms (Views: 0.2ms | ActiveRecord: 0.0ms)
  [1m[36m (0.4ms)[0m  [1mSELECT COUNT(*) FROM "accounts" [0m
  [1m[35m (0.2ms)[0m  SELECT COUNT(*) FROM "opportunities" 
  [1m[36m (0.2ms)[0m  [1mSELECT COUNT(*) FROM "comments" [0m
  [1m[35m (0.4ms)[0m  ROLLBACK
Connecting to database specified by database.yml
  [1m[36mFieldGroup Load (1.1ms)[0m  [1mSELECT "field_groups".* FROM "field_groups" WHERE "field_groups"."klass_name" = 'Account' ORDER BY position[0m
  [1m[35mFieldGroup Load (0.3ms)[0m  SELECT "field_groups".* FROM "field_groups" WHERE "field_groups"."klass_name" = 'Campaign' ORDER BY position
  [1m[36mFieldGroup Load (0.3ms)[0m  [1mSELECT "field_groups".* FROM "field_groups" WHERE "field_groups"."klass_name" = 'Contact' ORDER BY position[0m
  [1m[35mFieldGroup Load (0.3ms)[0m  SELECT "field_groups".* FROM "field_groups" WHERE "field_groups"."klass_name" = 'Lead' ORDER BY position
  [1m[36mFieldGroup Load (0.3ms)[0m  [1mSELECT "field_groups".* FROM "field_groups" WHERE "field_groups"."klass_name" = 'Opportunity' ORDER BY position[0m
  [1m[35mFieldGroup Load (0.2ms)[0m  SELECT "field_groups".* FROM "field_groups" WHERE "field_groups"."klass_name" = 'Task' ORDER BY position
Creating scope :except. Overwriting existing method User.except.
  [1m[36m (122.7ms)[0m  [1mDROP DATABASE IF EXISTS "ffcrm_vend_test"[0m
  [1m[35m (244.7ms)[0m  CREATE DATABASE "ffcrm_vend_test" ENCODING = 'utf8'
  [1m[36m (13.5ms)[0m  [1mCREATE TABLE "account_contacts" ("id" serial primary key, "account_id" integer, "contact_id" integer, "deleted_at" timestamp, "created_at" timestamp NOT NULL, "updated_at" timestamp NOT NULL) [0m
  [1m[35m (2.5ms)[0m  CREATE TABLE "account_opportunities" ("id" serial primary key, "account_id" integer, "opportunity_id" integer, "deleted_at" timestamp, "created_at" timestamp NOT NULL, "updated_at" timestamp NOT NULL) 
  [1m[36m (16.5ms)[0m  [1mCREATE TABLE "accounts" ("id" serial primary key, "user_id" integer, "assigned_to" integer, "name" character varying(64) DEFAULT '' NOT NULL, "access" character varying(8) DEFAULT 'Public', "website" character varying(64), "toll_free_phone" character varying(32), "phone" character varying(32), "fax" character varying(32), "deleted_at" timestamp, "created_at" timestamp NOT NULL, "updated_at" timestamp NOT NULL, "email" character varying(64), "background_info" character varying(255), "rating" integer DEFAULT 0 NOT NULL, "category" character varying(32), "subscribed_users" text, "cf_vend_customer_id" character varying(255)) [0m
  [1m[35m (1.4ms)[0m  CREATE INDEX "index_accounts_on_assigned_to" ON "accounts" ("assigned_to")
  [1m[36m (1.4ms)[0m  [1mCREATE UNIQUE INDEX "index_accounts_on_user_id_and_name_and_deleted_at" ON "accounts" ("user_id", "name", "deleted_at")[0m
  [1m[35m (3.5ms)[0m  CREATE TABLE "activities" ("id" serial primary key, "user_id" integer, "subject_id" integer, "subject_type" character varying(255), "action" character varying(32) DEFAULT 'created', "info" character varying(255) DEFAULT '', "private" boolean DEFAULT 'f', "created_at" timestamp NOT NULL, "updated_at" timestamp NOT NULL) 
  [1m[36m (0.8ms)[0m  [1mCREATE INDEX "index_activities_on_created_at" ON "activities" ("created_at")[0m
  [1m[35m (1.0ms)[0m  CREATE INDEX "index_activities_on_user_id" ON "activities" ("user_id")
  [1m[36m (19.6ms)[0m  [1mCREATE TABLE "addresses" ("id" serial primary key, "street1" character varying(255), "street2" character varying(255), "city" character varying(64), "state" character varying(64), "zipcode" character varying(16), "country" character varying(64), "full_address" character varying(255), "address_type" character varying(16), "addressable_id" integer, "addressable_type" character varying(255), "created_at" timestamp NOT NULL, "updated_at" timestamp NOT NULL, "deleted_at" timestamp) [0m
  [1m[35m (5.3ms)[0m  CREATE INDEX "index_addresses_on_addressable_id_and_addressable_type" ON "addresses" ("addressable_id", "addressable_type")
  [1m[36m (8.7ms)[0m  [1mCREATE TABLE "avatars" ("id" serial primary key, "user_id" integer, "entity_id" integer, "entity_type" character varying(255), "image_file_size" integer, "image_file_name" character varying(255), "image_content_type" character varying(255), "created_at" timestamp NOT NULL, "updated_at" timestamp NOT NULL) [0m
  [1m[35m (5.5ms)[0m  CREATE TABLE "campaigns" ("id" serial primary key, "user_id" integer, "assigned_to" integer, "name" character varying(64) DEFAULT '' NOT NULL, "access" character varying(8) DEFAULT 'Public', "status" character varying(64), "budget" decimal(12,2), "target_leads" integer, "target_conversion" float, "target_revenue" decimal(12,2), "leads_count" integer, "opportunities_count" integer, "revenue" decimal(12,2), "starts_on" date, "ends_on" date, "objectives" text, "deleted_at" timestamp, "created_at" timestamp NOT NULL, "updated_at" timestamp NOT NULL, "background_info" character varying(255), "subscribed_users" text) 
  [1m[36m (1.2ms)[0m  [1mCREATE INDEX "index_campaigns_on_assigned_to" ON "campaigns" ("assigned_to")[0m
  [1m[35m (1.7ms)[0m  CREATE UNIQUE INDEX "index_campaigns_on_user_id_and_name_and_deleted_at" ON "campaigns" ("user_id", "name", "deleted_at")
  [1m[36m (5.1ms)[0m  [1mCREATE TABLE "comments" ("id" serial primary key, "user_id" integer, "commentable_id" integer, "commentable_type" character varying(255), "private" boolean, "title" character varying(255) DEFAULT '', "comment" text, "created_at" timestamp NOT NULL, "updated_at" timestamp NOT NULL, "state" character varying(16) DEFAULT 'Expanded' NOT NULL) [0m
  [1m[35m (3.1ms)[0m  CREATE TABLE "contact_opportunities" ("id" serial primary key, "contact_id" integer, "opportunity_id" integer, "role" character varying(32), "deleted_at" timestamp, "created_at" timestamp NOT NULL, "updated_at" timestamp NOT NULL) 
  [1m[36m (6.2ms)[0m  [1mCREATE TABLE "contacts" ("id" serial primary key, "user_id" integer, "lead_id" integer, "assigned_to" integer, "reports_to" integer, "first_name" character varying(64) DEFAULT '' NOT NULL, "last_name" character varying(64) DEFAULT '' NOT NULL, "access" character varying(8) DEFAULT 'Public', "title" character varying(64), "department" character varying(64), "source" character varying(32), "email" character varying(64), "alt_email" character varying(64), "phone" character varying(32), "mobile" character varying(32), "fax" character varying(32), "blog" character varying(128), "linkedin" character varying(128), "facebook" character varying(128), "twitter" character varying(128), "born_on" date, "do_not_call" boolean DEFAULT 'f' NOT NULL, "deleted_at" timestamp, "created_at" timestamp NOT NULL, "updated_at" timestamp NOT NULL, "background_info" character varying(255), "skype" character varying(128), "subscribed_users" text) [0m
  [1m[35m (0.9ms)[0m  CREATE INDEX "index_contacts_on_assigned_to" ON "contacts" ("assigned_to")
  [1m[36m (1.1ms)[0m  [1mCREATE UNIQUE INDEX "id_last_name_deleted" ON "contacts" ("user_id", "last_name", "deleted_at")[0m
  [1m[35m (4.2ms)[0m  CREATE TABLE "emails" ("id" serial primary key, "imap_message_id" character varying(255) NOT NULL, "user_id" integer, "mediator_id" integer, "mediator_type" character varying(255), "sent_from" character varying(255) NOT NULL, "sent_to" character varying(255) NOT NULL, "cc" character varying(255), "bcc" character varying(255), "subject" character varying(255), "body" text, "header" text, "sent_at" timestamp, "received_at" timestamp, "deleted_at" timestamp, "created_at" timestamp NOT NULL, "updated_at" timestamp NOT NULL, "state" character varying(16) DEFAULT 'Expanded' NOT NULL) 
  [1m[36m (1.1ms)[0m  [1mCREATE INDEX "index_emails_on_mediator_id_and_mediator_type" ON "emails" ("mediator_id", "mediator_type")[0m
  [1m[35m (2.3ms)[0m  CREATE TABLE "field_groups" ("id" serial primary key, "name" character varying(64), "label" character varying(128), "position" integer, "hint" character varying(255), "created_at" timestamp NOT NULL, "updated_at" timestamp NOT NULL, "tag_id" integer, "klass_name" character varying(32)) 
  [1m[36m (3.2ms)[0m  [1mCREATE TABLE "fields" ("id" serial primary key, "type" character varying(255), "field_group_id" integer, "position" integer, "name" character varying(64), "label" character varying(128), "hint" character varying(255), "placeholder" character varying(255), "as" character varying(32), "collection" text, "disabled" boolean, "required" boolean, "maxlength" integer, "created_at" timestamp NOT NULL, "updated_at" timestamp NOT NULL) [0m
  [1m[35m (0.9ms)[0m  CREATE INDEX "index_fields_on_field_group_id" ON "fields" ("field_group_id")
  [1m[36m (1.1ms)[0m  [1mCREATE INDEX "index_fields_on_name" ON "fields" ("name")[0m
  [1m[35m (4.3ms)[0m  CREATE TABLE "leads" ("id" serial primary key, "user_id" integer, "campaign_id" integer, "assigned_to" integer, "first_name" character varying(64) DEFAULT '' NOT NULL, "last_name" character varying(64) DEFAULT '' NOT NULL, "access" character varying(8) DEFAULT 'Public', "title" character varying(64), "company" character varying(64), "source" character varying(32), "status" character varying(32), "referred_by" character varying(64), "email" character varying(64), "alt_email" character varying(64), "phone" character varying(32), "mobile" character varying(32), "blog" character varying(128), "linkedin" character varying(128), "facebook" character varying(128), "twitter" character varying(128), "rating" integer DEFAULT 0 NOT NULL, "do_not_call" boolean DEFAULT 'f' NOT NULL, "deleted_at" timestamp, "created_at" timestamp NOT NULL, "updated_at" timestamp NOT NULL, "background_info" character varying(255), "skype" character varying(128), "subscribed_users" text) 
  [1m[36m (1.1ms)[0m  [1mCREATE INDEX "index_leads_on_assigned_to" ON "leads" ("assigned_to")[0m
  [1m[35m (1.1ms)[0m  CREATE UNIQUE INDEX "index_leads_on_user_id_and_last_name_and_deleted_at" ON "leads" ("user_id", "last_name", "deleted_at")
  [1m[36m (3.3ms)[0m  [1mCREATE TABLE "lists" ("id" serial primary key, "name" character varying(255), "url" text, "created_at" timestamp NOT NULL, "updated_at" timestamp NOT NULL) [0m
  [1m[35m (4.0ms)[0m  CREATE TABLE "opportunities" ("id" serial primary key, "user_id" integer, "campaign_id" integer, "assigned_to" integer, "name" character varying(64) DEFAULT '' NOT NULL, "access" character varying(8) DEFAULT 'Public', "source" character varying(32), "stage" character varying(32), "probability" integer, "amount" decimal(12,2), "discount" decimal(12,2), "closes_on" date, "deleted_at" timestamp, "created_at" timestamp NOT NULL, "updated_at" timestamp NOT NULL, "background_info" character varying(255), "subscribed_users" text) 
  [1m[36m (1.0ms)[0m  [1mCREATE INDEX "index_opportunities_on_assigned_to" ON "opportunities" ("assigned_to")[0m
  [1m[35m (1.3ms)[0m  CREATE UNIQUE INDEX "id_name_deleted" ON "opportunities" ("user_id", "name", "deleted_at")
  [1m[36m (3.4ms)[0m  [1mCREATE TABLE "permissions" ("id" serial primary key, "user_id" integer, "asset_id" integer, "asset_type" character varying(255), "created_at" timestamp NOT NULL, "updated_at" timestamp NOT NULL) [0m
  [1m[35m (1.0ms)[0m  CREATE INDEX "index_permissions_on_asset_id_and_asset_type" ON "permissions" ("asset_id", "asset_type")
  [1m[36m (1.1ms)[0m  [1mCREATE INDEX "index_permissions_on_user_id" ON "permissions" ("user_id")[0m
  [1m[35m (3.5ms)[0m  CREATE TABLE "preferences" ("id" serial primary key, "user_id" integer, "name" character varying(32) DEFAULT '' NOT NULL, "value" text, "created_at" timestamp NOT NULL, "updated_at" timestamp NOT NULL) 
  [1m[36m (1.1ms)[0m  [1mCREATE INDEX "index_preferences_on_user_id_and_name" ON "preferences" ("user_id", "name")[0m
  [1m[35m (3.4ms)[0m  CREATE TABLE "sessions" ("id" serial primary key, "session_id" character varying(255) NOT NULL, "data" text, "created_at" timestamp NOT NULL, "updated_at" timestamp NOT NULL) 
  [1m[36m (0.9ms)[0m  [1mCREATE INDEX "index_sessions_on_session_id" ON "sessions" ("session_id")[0m
  [1m[35m (0.9ms)[0m  CREATE INDEX "index_sessions_on_updated_at" ON "sessions" ("updated_at")
  [1m[36m (3.4ms)[0m  [1mCREATE TABLE "settings" ("id" serial primary key, "name" character varying(32) DEFAULT '' NOT NULL, "value" text, "created_at" timestamp NOT NULL, "updated_at" timestamp NOT NULL) [0m
  [1m[35m (0.9ms)[0m  CREATE INDEX "index_settings_on_name" ON "settings" ("name")
  [1m[36m (3.5ms)[0m  [1mCREATE TABLE "taggings" ("id" serial primary key, "tag_id" integer, "taggable_id" integer, "tagger_id" integer, "tagger_type" character varying(255), "taggable_type" character varying(255), "context" character varying(255), "created_at" timestamp) [0m
  [1m[35m (0.9ms)[0m  CREATE INDEX "index_taggings_on_tag_id" ON "taggings" ("tag_id")
  [1m[36m (1.2ms)[0m  [1mCREATE INDEX "index_taggings_on_taggable_id_and_taggable_type_and_context" ON "taggings" ("taggable_id", "taggable_type", "context")[0m
  [1m[35m (2.3ms)[0m  CREATE TABLE "tags" ("id" serial primary key, "name" character varying(255)) 
  [1m[36m (3.3ms)[0m  [1mCREATE TABLE "tasks" ("id" serial primary key, "user_id" integer, "assigned_to" integer, "completed_by" integer, "name" character varying(255) DEFAULT '' NOT NULL, "asset_id" integer, "asset_type" character varying(255), "priority" character varying(32), "category" character varying(32), "bucket" character varying(32), "due_at" timestamp, "completed_at" timestamp, "deleted_at" timestamp, "created_at" timestamp NOT NULL, "updated_at" timestamp NOT NULL, "background_info" character varying(255), "subscribed_users" text) [0m
  [1m[35m (1.0ms)[0m  CREATE INDEX "index_tasks_on_assigned_to" ON "tasks" ("assigned_to")
  [1m[36m (1.1ms)[0m  [1mCREATE UNIQUE INDEX "index_tasks_on_user_id_and_name_and_deleted_at" ON "tasks" ("user_id", "name", "deleted_at")[0m
  [1m[35m (4.4ms)[0m  CREATE TABLE "users" ("id" serial primary key, "username" character varying(32) DEFAULT '' NOT NULL, "email" character varying(64) DEFAULT '' NOT NULL, "first_name" character varying(32), "last_name" character varying(32), "title" character varying(64), "company" character varying(64), "alt_email" character varying(64), "phone" character varying(32), "mobile" character varying(32), "aim" character varying(32), "yahoo" character varying(32), "google" character varying(32), "skype" character varying(32), "password_hash" character varying(255) DEFAULT '' NOT NULL, "password_salt" character varying(255) DEFAULT '' NOT NULL, "persistence_token" character varying(255) DEFAULT '' NOT NULL, "perishable_token" character varying(255) DEFAULT '' NOT NULL, "last_request_at" timestamp, "last_login_at" timestamp, "current_login_at" timestamp, "last_login_ip" character varying(255), "current_login_ip" character varying(255), "login_count" integer DEFAULT 0 NOT NULL, "deleted_at" timestamp, "created_at" timestamp NOT NULL, "updated_at" timestamp NOT NULL, "admin" boolean DEFAULT 'f' NOT NULL, "suspended_at" timestamp, "single_access_token" character varying(255)) 
  [1m[36m (1.1ms)[0m  [1mCREATE INDEX "index_users_on_email" ON "users" ("email")[0m
  [1m[35m (0.9ms)[0m  CREATE INDEX "index_users_on_last_request_at" ON "users" ("last_request_at")
  [1m[36m (0.9ms)[0m  [1mCREATE INDEX "index_users_on_perishable_token" ON "users" ("perishable_token")[0m
  [1m[35m (1.0ms)[0m  CREATE INDEX "index_users_on_remember_token" ON "users" ("persistence_token")
  [1m[36m (1.2ms)[0m  [1mCREATE UNIQUE INDEX "index_users_on_username_and_deleted_at" ON "users" ("username", "deleted_at")[0m
  [1m[35m (13.1ms)[0m  CREATE TABLE "versions" ("id" serial primary key, "item_type" character varying(255) NOT NULL, "item_id" integer NOT NULL, "event" character varying(512) NOT NULL, "whodunnit" character varying(255), "object" text, "created_at" timestamp, "object_changes" text, "related_id" integer, "related_type" character varying(255)) 
  [1m[36m (1.1ms)[0m  [1mCREATE INDEX "index_versions_on_item_type_and_item_id" ON "versions" ("item_type", "item_id")[0m
  [1m[35m (7.3ms)[0m  CREATE INDEX "index_versions_on_whodunnit" ON "versions" ("whodunnit")
  [1m[36m (12.4ms)[0m  [1mCREATE TABLE "schema_migrations" ("version" character varying(255) NOT NULL) [0m
  [1m[35m (1.4ms)[0m  CREATE UNIQUE INDEX "unique_schema_migrations" ON "schema_migrations" ("version")
  [1m[36m (0.2ms)[0m  [1mSELECT version FROM "schema_migrations"[0m
  [1m[35m (0.4ms)[0m  INSERT INTO "schema_migrations" (version) VALUES ('20120528102124')
  [1m[36m (0.2ms)[0m  [1mBEGIN[0m
  [1m[35m (0.5ms)[0m  SELECT COUNT(*) FROM "accounts" 
Started POST "/vend/register_sale" for 127.0.0.1 at 2013-03-07 23:54:29 +1300
Processing by VendController#register_sale as JSON
  Parameters: {"payload"=>{"id"=>"5e8b5134-a002-dd6b-b7c7-26126887c4ee", "sale_date"=>"2012-11-13 16:40:06", "status"=>"CLOSED", "user_id"=>"9b2a8d5f-2d20-11e2-8057-080027706aa2", "customer_id"=>"9b17ac9d-2d20-11e2-8057-080027706aa2", "register_id"=>"9af85e69-2d20-11e2-8057-080027706aa2", "market_id"=>"1", "invoice_number"=>"144", "short_code"=>"ne2zq", "totals"=>{"total_price"=>"4.87", "total_tax"=>"0.69", "total_payment"=>"5.55", "total_to_pay"=>"0"}, "note"=>nil, "updated_at"=>"2012-11-13 16:40:09", "created_at"=>"2012-11-13 16:40:09", "customer"=>{"id"=>"9b17ac9d-2d20-11e2-8057-080027706aa2", "customer_code"=>"WALKIN", "balance"=>"-6.250", "points"=>"0", "note"=>nil, "year_to_date"=>"79945.92188", "sex"=>"M", "date_of_birth"=>"1950-05-25", "updated_at"=>"2012-11-13 16:43:15", "created_at"=>"2012-11-13 12:28:03"}, "user"=>{"id"=>"9b2a8d5f-2d20-11e2-8057-080027706aa2", "name"=>"admin", "display_name"=>"A admin this time", "outlet_id"=>"9ae97219-2d20-11e2-8057-080027706aa2", "target_daily"=>nil, "target_weekly"=>nil, "target_monthly"=>nil, "created_at"=>"2011-09-08 05:18:38", "updated_at"=>"2011-09-08 05:18:38"}, "register_sale_products"=>[{"id"=>"148793f0-475a-7d49-442d-fd761ce76339", "product_id"=>"9fe945bc-2d20-11e2-8057-080027706aa2", "quantity"=>"1", "price"=>"1.90", "price_set"=>"true", "tax"=>"0.24", "price_total"=>"1.9", "tax_total"=>"0.24", "tax_id"=>"9a025ff0-2d20-11e2-8057-080027706aa2", "tax_name"=>"NZ GST", "tax_rate"=>"0.150000"}, {"id"=>"7d37dc0f-9462-06fa-cae0-0b4988b36539", "product_id"=>"a0c0df02-2d20-11e2-8057-080027706aa2", "quantity"=>"3", "price"=>"0.99", "price_set"=>"true", "tax"=>"0.15", "price_total"=>"2.97", "tax_total"=>"0.45", "tax_id"=>"9a025ff0-2d20-11e2-8057-080027706aa2", "tax_name"=>"NZ GST", "tax_rate"=>"0.150000"}], "register_sale_payments"=>[{"id"=>"39948e3e-bf93-1b60-ff44-f46a777ed1d4", "payment_date"=>"2012-11-13 16:40:06", "amount"=>"5.55", "retailer_payment_type_id"=>"9e9ba1ba-2d20-11e2-8057-080027706aa2", "payment_type_id"=>"1"}]}}
  [1m[36mAccount Load (0.5ms)[0m  [1mSELECT "accounts".* FROM "accounts" WHERE "accounts"."cf_vend_customer_id" = '9b17ac9d-2d20-11e2-8057-080027706aa2' LIMIT 1[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36m (0.7ms)[0m  [1mSELECT "tags".id FROM "tags" INNER JOIN "taggings" ON "tags"."id" = "taggings"."tag_id" WHERE "taggings"."taggable_id" IS NULL AND "taggings"."taggable_type" = 'Account' AND (taggings.context = 'tags')[0m
  [1m[35mFieldGroup Load (0.5ms)[0m  SELECT "field_groups".* FROM "field_groups" WHERE "field_groups"."klass_name" = 'Account' AND (tag_id IS NULL OR tag_id IN (NULL)) ORDER BY position
  [1m[36mAccount Exists (0.4ms)[0m  [1mSELECT 1 AS one FROM "accounts" WHERE ("accounts"."name" = 'Account for Register Sale 144' AND "accounts"."deleted_at" IS NULL) LIMIT 1[0m
  [1m[35mSQL (1.2ms)[0m  INSERT INTO "accounts" ("access", "assigned_to", "background_info", "category", "cf_vend_customer_id", "created_at", "deleted_at", "email", "fax", "name", "phone", "rating", "subscribed_users", "toll_free_phone", "updated_at", "user_id", "website") VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9, $10, $11, $12, $13, $14, $15, $16, $17) RETURNING "id"  [["access", "Public"], ["assigned_to", nil], ["background_info", nil], ["category", nil], ["cf_vend_customer_id", "9b17ac9d-2d20-11e2-8057-080027706aa2"], ["created_at", Thu, 07 Mar 2013 10:54:29 UTC +00:00], ["deleted_at", nil], ["email", nil], ["fax", nil], ["name", "Account for Register Sale 144"], ["phone", nil], ["rating", 0], ["subscribed_users", nil], ["toll_free_phone", nil], ["updated_at", Thu, 07 Mar 2013 10:54:29 UTC +00:00], ["user_id", nil], ["website", nil]]
  [1m[36mSQL (1.4ms)[0m  [1mINSERT INTO "versions" ("created_at", "event", "item_id", "item_type", "object", "object_changes", "related_id", "related_type", "whodunnit") VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9) RETURNING "id"[0m  [["created_at", Thu, 07 Mar 2013 10:54:29 UTC +00:00], ["event", "create"], ["item_id", 1], ["item_type", "Account"], ["object", nil], ["object_changes", "--- !map:ActiveSupport::HashWithIndifferentAccess \nname: \n- \"\"\n- Account for Register Sale 144\ncf_vend_customer_id: \n- \n- 9b17ac9d-2d20-11e2-8057-080027706aa2\ncreated_at: \n- \n- &id001 2013-03-07 10:54:29.444915 Z\nupdated_at: \n- \n- *id001\nid: \n- \n- 1\n"], ["related_id", nil], ["related_type", nil], ["whodunnit", nil]]
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36m (0.2ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35m (0.5ms)[0m  SELECT "tags".id FROM "tags" INNER JOIN "taggings" ON "tags"."id" = "taggings"."tag_id" WHERE "taggings"."taggable_id" IS NULL AND "taggings"."taggable_type" = 'Opportunity' AND (taggings.context = 'tags')
  [1m[36mFieldGroup Load (0.2ms)[0m  [1mSELECT "field_groups".* FROM "field_groups" WHERE "field_groups"."klass_name" = 'Opportunity' AND (tag_id IS NULL OR tag_id IN (NULL)) ORDER BY position[0m
  [1m[35mSQL (1.5ms)[0m  INSERT INTO "opportunities" ("access", "amount", "assigned_to", "background_info", "campaign_id", "closes_on", "created_at", "deleted_at", "discount", "name", "probability", "source", "stage", "subscribed_users", "updated_at", "user_id") VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9, $10, $11, $12, $13, $14, $15, $16) RETURNING "id"  [["access", "Public"], ["amount", #<BigDecimal:7f881bcf4f68,'0.555E1',18(18)>], ["assigned_to", nil], ["background_info", nil], ["campaign_id", nil], ["closes_on", nil], ["created_at", Thu, 07 Mar 2013 10:54:29 UTC +00:00], ["deleted_at", nil], ["discount", nil], ["name", "Register Sale 144"], ["probability", nil], ["source", nil], ["stage", "won"], ["subscribed_users", nil], ["updated_at", Thu, 07 Mar 2013 10:54:29 UTC +00:00], ["user_id", nil]]
  [1m[36mSQL (0.5ms)[0m  [1mINSERT INTO "versions" ("created_at", "event", "item_id", "item_type", "object", "object_changes", "related_id", "related_type", "whodunnit") VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9) RETURNING "id"[0m  [["created_at", Thu, 07 Mar 2013 10:54:29 UTC +00:00], ["event", "create"], ["item_id", 1], ["item_type", "Opportunity"], ["object", nil], ["object_changes", "--- !map:ActiveSupport::HashWithIndifferentAccess \nname: \n- \"\"\n- Register Sale 144\namount: \n- \n- 5.55\nstage: \n- \n- won\ncreated_at: \n- \n- &id001 2013-03-07 10:54:29.543672 Z\nupdated_at: \n- \n- *id001\nid: \n- \n- 1\n"], ["related_id", nil], ["related_type", nil], ["whodunnit", nil]]
  [1m[35m (0.2ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mSQL (1.3ms)[0m  INSERT INTO "account_opportunities" ("account_id", "created_at", "deleted_at", "opportunity_id", "updated_at") VALUES ($1, $2, $3, $4, $5) RETURNING "id"  [["account_id", 1], ["created_at", Thu, 07 Mar 2013 10:54:29 UTC +00:00], ["deleted_at", nil], ["opportunity_id", 1], ["updated_at", Thu, 07 Mar 2013 10:54:29 UTC +00:00]]
  [1m[36mSQL (0.5ms)[0m  [1mINSERT INTO "versions" ("created_at", "event", "item_id", "item_type", "object", "object_changes", "related_id", "related_type", "whodunnit") VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9) RETURNING "id"[0m  [["created_at", Thu, 07 Mar 2013 10:54:29 UTC +00:00], ["event", "create"], ["item_id", 1], ["item_type", "AccountOpportunity"], ["object", nil], ["object_changes", "--- !map:ActiveSupport::HashWithIndifferentAccess \naccount_id: \n- \n- 1\nopportunity_id: \n- \n- 1\ncreated_at: \n- \n- &id001 2013-03-07 10:54:29.585335 Z\nupdated_at: \n- \n- *id001\nid: \n- \n- 1\n"], ["related_id", nil], ["related_type", nil], ["whodunnit", nil]]
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36mUser Load (0.9ms)[0m  [1mSELECT "users".* FROM "users" WHERE "users"."email" = 'marketplace@crossroads.org.hk' LIMIT 1[0m
  [1m[35m (0.2ms)[0m  SAVEPOINT active_record_1
  [1m[36mUser Exists (0.4ms)[0m  [1mSELECT 1 AS one FROM "users" WHERE "users"."email" = 'marketplace@crossroads.org.hk' LIMIT 1[0m
  [1m[35mUser Exists (0.4ms)[0m  SELECT 1 AS one FROM "users" WHERE "users"."username" = '' LIMIT 1
  [1m[36mUser Exists (0.3ms)[0m  [1mSELECT 1 AS one FROM "users" WHERE "users"."persistence_token" = '0e63f1830116d00fd5fe3977da1dda7d61392b32e990c3deb39b1e678490a52d330d80dd5e08d5c7082dc4d9f6c93e233f427a463981353cbd05fe1e50c7ff42' LIMIT 1[0m
  [1m[35mUser Exists (0.3ms)[0m  SELECT 1 AS one FROM "users" WHERE "users"."single_access_token" = 'S9yafzefWVfssPTe4bA' LIMIT 1
  [1m[36m (0.1ms)[0m  [1mROLLBACK TO SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mOpportunity Load (0.4ms)[0m  [1mSELECT "opportunities".* FROM "opportunities" WHERE "opportunities"."id" = 1 LIMIT 1[0m
  [1m[35mCACHE (0.0ms)[0m  SELECT 1 AS one FROM "users" WHERE "users"."email" = 'marketplace@crossroads.org.hk' LIMIT 1
  [1m[36mCACHE (0.0ms)[0m  [1mSELECT 1 AS one FROM "users" WHERE "users"."username" = '' LIMIT 1[0m
  [1m[35mCACHE (0.0ms)[0m  SELECT 1 AS one FROM "users" WHERE "users"."persistence_token" = '0e63f1830116d00fd5fe3977da1dda7d61392b32e990c3deb39b1e678490a52d330d80dd5e08d5c7082dc4d9f6c93e233f427a463981353cbd05fe1e50c7ff42' LIMIT 1
  [1m[36mCACHE (0.0ms)[0m  [1mSELECT 1 AS one FROM "users" WHERE "users"."single_access_token" = 'S9yafzefWVfssPTe4bA' LIMIT 1[0m
  [1m[35mSQL (1.0ms)[0m  INSERT INTO "comments" ("comment", "commentable_id", "commentable_type", "created_at", "private", "state", "title", "updated_at", "user_id") VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9) RETURNING "id"  [["comment", "https://globalhandicrafts.vendhq.com/sale/5e8b5134-a002-dd6b-b7c7-26126887c4ee"], ["commentable_id", 1], ["commentable_type", "Opportunity"], ["created_at", Thu, 07 Mar 2013 10:54:29 UTC +00:00], ["private", nil], ["state", "Expanded"], ["title", ""], ["updated_at", Thu, 07 Mar 2013 10:54:29 UTC +00:00], ["user_id", nil]]
  [1m[36mSQL (0.4ms)[0m  [1mINSERT INTO "versions" ("created_at", "event", "item_id", "item_type", "object", "object_changes", "related_id", "related_type", "whodunnit") VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9) RETURNING "id"[0m  [["created_at", Thu, 07 Mar 2013 10:54:29 UTC +00:00], ["event", "create"], ["item_id", 1], ["item_type", "Comment"], ["object", nil], ["object_changes", "--- !map:ActiveSupport::HashWithIndifferentAccess \ncomment: \n- \n- https://globalhandicrafts.vendhq.com/sale/5e8b5134-a002-dd6b-b7c7-26126887c4ee\ncommentable_id: \n- \n- 1\ncommentable_type: \n- \n- Opportunity\ncreated_at: \n- \n- &id001 2013-03-07 10:54:29.722828 Z\nupdated_at: \n- \n- *id001\nid: \n- \n- 1\n"], ["related_id", 1], ["related_type", "Opportunity"], ["whodunnit", nil]]
  [1m[35m (0.4ms)[0m  SELECT "tags".id FROM "tags" INNER JOIN "taggings" ON "tags"."id" = "taggings"."tag_id" WHERE "taggings"."taggable_id" = 1 AND "taggings"."taggable_type" = 'Opportunity' AND (taggings.context = 'tags')
  [1m[36mFieldGroup Load (0.2ms)[0m  [1mSELECT "field_groups".* FROM "field_groups" WHERE "field_groups"."klass_name" = 'Opportunity' AND (tag_id IS NULL OR tag_id IN (NULL)) ORDER BY position[0m
  [1m[35mOpportunity Load (0.5ms)[0m  SELECT "opportunities".* FROM "opportunities" WHERE "opportunities"."id" = $1 LIMIT 1  [["id", 1]]
  [1m[36m (0.4ms)[0m  [1mUPDATE "opportunities" SET "updated_at" = '2013-03-07 10:54:29.734057', "subscribed_users" = '--- !ruby/object:Set 
hash: 
 ~: true
' WHERE "opportunities"."id" = 1[0m
  [1m[35m (0.2ms)[0m  RELEASE SAVEPOINT active_record_1
Completed 201 Created in 431ms (Views: 0.2ms | ActiveRecord: 0.0ms)
  [1m[36m (0.4ms)[0m  [1mSELECT COUNT(*) FROM "accounts" [0m
  [1m[35m (0.2ms)[0m  SELECT COUNT(*) FROM "accounts" 
Started POST "/vend/register_sale" for 127.0.0.1 at 2013-03-07 23:54:29 +1300
Processing by VendController#register_sale as JSON
  Parameters: {"payload"=>{"id"=>"5e8b5134-a002-dd6b-b7c7-26126887c4ee", "sale_date"=>"2012-11-13 16:40:06", "status"=>"CLOSED", "user_id"=>"9b2a8d5f-2d20-11e2-8057-080027706aa2", "customer_id"=>"9b17ac9d-2d20-11e2-8057-080027706aa2", "register_id"=>"9af85e69-2d20-11e2-8057-080027706aa2", "market_id"=>"1", "invoice_number"=>"144", "short_code"=>"ne2zq", "totals"=>{"total_price"=>"4.87", "total_tax"=>"0.69", "total_payment"=>"5.55", "total_to_pay"=>"0"}, "note"=>nil, "updated_at"=>"2012-11-13 16:40:09", "created_at"=>"2012-11-13 16:40:09", "customer"=>{"id"=>"9b17ac9d-2d20-11e2-8057-080027706aa2", "customer_code"=>"WALKIN", "balance"=>"-6.250", "points"=>"0", "note"=>nil, "year_to_date"=>"79945.92188", "sex"=>"M", "date_of_birth"=>"1950-05-25", "updated_at"=>"2012-11-13 16:43:15", "created_at"=>"2012-11-13 12:28:03"}, "user"=>{"id"=>"9b2a8d5f-2d20-11e2-8057-080027706aa2", "name"=>"admin", "display_name"=>"A admin this time", "outlet_id"=>"9ae97219-2d20-11e2-8057-080027706aa2", "target_daily"=>nil, "target_weekly"=>nil, "target_monthly"=>nil, "created_at"=>"2011-09-08 05:18:38", "updated_at"=>"2011-09-08 05:18:38"}, "register_sale_products"=>[{"id"=>"148793f0-475a-7d49-442d-fd761ce76339", "product_id"=>"9fe945bc-2d20-11e2-8057-080027706aa2", "quantity"=>"1", "price"=>"1.90", "price_set"=>"true", "tax"=>"0.24", "price_total"=>"1.9", "tax_total"=>"0.24", "tax_id"=>"9a025ff0-2d20-11e2-8057-080027706aa2", "tax_name"=>"NZ GST", "tax_rate"=>"0.150000"}, {"id"=>"7d37dc0f-9462-06fa-cae0-0b4988b36539", "product_id"=>"a0c0df02-2d20-11e2-8057-080027706aa2", "quantity"=>"3", "price"=>"0.99", "price_set"=>"true", "tax"=>"0.15", "price_total"=>"2.97", "tax_total"=>"0.45", "tax_id"=>"9a025ff0-2d20-11e2-8057-080027706aa2", "tax_name"=>"NZ GST", "tax_rate"=>"0.150000"}], "register_sale_payments"=>[{"id"=>"39948e3e-bf93-1b60-ff44-f46a777ed1d4", "payment_date"=>"2012-11-13 16:40:06", "amount"=>"5.55", "retailer_payment_type_id"=>"9e9ba1ba-2d20-11e2-8057-080027706aa2", "payment_type_id"=>"1"}]}}
  [1m[36mAccount Load (0.4ms)[0m  [1mSELECT "accounts".* FROM "accounts" WHERE "accounts"."cf_vend_customer_id" = '9b17ac9d-2d20-11e2-8057-080027706aa2' LIMIT 1[0m
  [1m[35m (0.2ms)[0m  SAVEPOINT active_record_1
  [1m[36m (0.4ms)[0m  [1mSELECT "tags".id FROM "tags" INNER JOIN "taggings" ON "tags"."id" = "taggings"."tag_id" WHERE "taggings"."taggable_id" IS NULL AND "taggings"."taggable_type" = 'Opportunity' AND (taggings.context = 'tags')[0m
  [1m[35mFieldGroup Load (0.2ms)[0m  SELECT "field_groups".* FROM "field_groups" WHERE "field_groups"."klass_name" = 'Opportunity' AND (tag_id IS NULL OR tag_id IN (NULL)) ORDER BY position
  [1m[36mSQL (0.5ms)[0m  [1mINSERT INTO "opportunities" ("access", "amount", "assigned_to", "background_info", "campaign_id", "closes_on", "created_at", "deleted_at", "discount", "name", "probability", "source", "stage", "subscribed_users", "updated_at", "user_id") VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9, $10, $11, $12, $13, $14, $15, $16) RETURNING "id"[0m  [["access", "Public"], ["amount", #<BigDecimal:7f881e270008,'0.555E1',18(18)>], ["assigned_to", nil], ["background_info", nil], ["campaign_id", nil], ["closes_on", nil], ["created_at", Thu, 07 Mar 2013 10:54:29 UTC +00:00], ["deleted_at", nil], ["discount", nil], ["name", "Register Sale 144"], ["probability", nil], ["source", nil], ["stage", "won"], ["subscribed_users", nil], ["updated_at", Thu, 07 Mar 2013 10:54:29 UTC +00:00], ["user_id", nil]]
  [1m[35mSQL (0.4ms)[0m  INSERT INTO "versions" ("created_at", "event", "item_id", "item_type", "object", "object_changes", "related_id", "related_type", "whodunnit") VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9) RETURNING "id"  [["created_at", Thu, 07 Mar 2013 10:54:29 UTC +00:00], ["event", "create"], ["item_id", 2], ["item_type", "Opportunity"], ["object", nil], ["object_changes", "--- !map:ActiveSupport::HashWithIndifferentAccess \nname: \n- \"\"\n- Register Sale 144\namount: \n- \n- 5.55\nstage: \n- \n- won\ncreated_at: \n- \n- &id001 2013-03-07 10:54:29.765996 Z\nupdated_at: \n- \n- *id001\nid: \n- \n- 2\n"], ["related_id", nil], ["related_type", nil], ["whodunnit", nil]]
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mSQL (0.5ms)[0m  [1mINSERT INTO "account_opportunities" ("account_id", "created_at", "deleted_at", "opportunity_id", "updated_at") VALUES ($1, $2, $3, $4, $5) RETURNING "id"[0m  [["account_id", 1], ["created_at", Thu, 07 Mar 2013 10:54:29 UTC +00:00], ["deleted_at", nil], ["opportunity_id", 2], ["updated_at", Thu, 07 Mar 2013 10:54:29 UTC +00:00]]
  [1m[35mSQL (0.4ms)[0m  INSERT INTO "versions" ("created_at", "event", "item_id", "item_type", "object", "object_changes", "related_id", "related_type", "whodunnit") VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9) RETURNING "id"  [["created_at", Thu, 07 Mar 2013 10:54:29 UTC +00:00], ["event", "create"], ["item_id", 2], ["item_type", "AccountOpportunity"], ["object", nil], ["object_changes", "--- !map:ActiveSupport::HashWithIndifferentAccess \naccount_id: \n- \n- 1\nopportunity_id: \n- \n- 2\ncreated_at: \n- \n- &id001 2013-03-07 10:54:29.772125 Z\nupdated_at: \n- \n- *id001\nid: \n- \n- 2\n"], ["related_id", nil], ["related_type", nil], ["whodunnit", nil]]
  [1m[36m (0.2ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35mUser Load (0.3ms)[0m  SELECT "users".* FROM "users" WHERE "users"."email" = 'marketplace@crossroads.org.hk' LIMIT 1
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mUser Exists (0.4ms)[0m  SELECT 1 AS one FROM "users" WHERE "users"."email" = 'marketplace@crossroads.org.hk' LIMIT 1
  [1m[36mUser Exists (0.3ms)[0m  [1mSELECT 1 AS one FROM "users" WHERE "users"."username" = '' LIMIT 1[0m
  [1m[35mUser Exists (0.3ms)[0m  SELECT 1 AS one FROM "users" WHERE "users"."persistence_token" = '0739a4914dc19a37c76dc645b3d12ebcd8e4e944830938ca01b4cd8e245598fe00daa1939d71630840dd385982b402144062154594f44504756c78e313090a02' LIMIT 1
  [1m[36mUser Exists (0.3ms)[0m  [1mSELECT 1 AS one FROM "users" WHERE "users"."single_access_token" = 'Y0tCFbDFOttaXzf2o6A9' LIMIT 1[0m
  [1m[35m (0.2ms)[0m  ROLLBACK TO SAVEPOINT active_record_1
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mOpportunity Load (0.4ms)[0m  SELECT "opportunities".* FROM "opportunities" WHERE "opportunities"."id" = 2 LIMIT 1
  [1m[36mCACHE (0.0ms)[0m  [1mSELECT 1 AS one FROM "users" WHERE "users"."email" = 'marketplace@crossroads.org.hk' LIMIT 1[0m
  [1m[35mCACHE (0.0ms)[0m  SELECT 1 AS one FROM "users" WHERE "users"."username" = '' LIMIT 1
  [1m[36mCACHE (0.0ms)[0m  [1mSELECT 1 AS one FROM "users" WHERE "users"."persistence_token" = '0739a4914dc19a37c76dc645b3d12ebcd8e4e944830938ca01b4cd8e245598fe00daa1939d71630840dd385982b402144062154594f44504756c78e313090a02' LIMIT 1[0m
  [1m[35mCACHE (0.0ms)[0m  SELECT 1 AS one FROM "users" WHERE "users"."single_access_token" = 'Y0tCFbDFOttaXzf2o6A9' LIMIT 1
  [1m[36mSQL (0.5ms)[0m  [1mINSERT INTO "comments" ("comment", "commentable_id", "commentable_type", "created_at", "private", "state", "title", "updated_at", "user_id") VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9) RETURNING "id"[0m  [["comment", "https://globalhandicrafts.vendhq.com/sale/5e8b5134-a002-dd6b-b7c7-26126887c4ee"], ["commentable_id", 2], ["commentable_type", "Opportunity"], ["created_at", Thu, 07 Mar 2013 10:54:29 UTC +00:00], ["private", nil], ["state", "Expanded"], ["title", ""], ["updated_at", Thu, 07 Mar 2013 10:54:29 UTC +00:00], ["user_id", nil]]
  [1m[35mSQL (0.3ms)[0m  INSERT INTO "versions" ("created_at", "event", "item_id", "item_type", "object", "object_changes", "related_id", "related_type", "whodunnit") VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9) RETURNING "id"  [["created_at", Thu, 07 Mar 2013 10:54:29 UTC +00:00], ["event", "create"], ["item_id", 2], ["item_type", "Comment"], ["object", nil], ["object_changes", "--- !map:ActiveSupport::HashWithIndifferentAccess \ncomment: \n- \n- https://globalhandicrafts.vendhq.com/sale/5e8b5134-a002-dd6b-b7c7-26126887c4ee\ncommentable_id: \n- \n- 2\ncommentable_type: \n- \n- Opportunity\ncreated_at: \n- \n- &id001 2013-03-07 10:54:29.789644 Z\nupdated_at: \n- \n- *id001\nid: \n- \n- 2\n"], ["related_id", 2], ["related_type", "Opportunity"], ["whodunnit", nil]]
  [1m[36m (0.5ms)[0m  [1mSELECT "tags".id FROM "tags" INNER JOIN "taggings" ON "tags"."id" = "taggings"."tag_id" WHERE "taggings"."taggable_id" = 2 AND "taggings"."taggable_type" = 'Opportunity' AND (taggings.context = 'tags')[0m
  [1m[35mFieldGroup Load (0.3ms)[0m  SELECT "field_groups".* FROM "field_groups" WHERE "field_groups"."klass_name" = 'Opportunity' AND (tag_id IS NULL OR tag_id IN (NULL)) ORDER BY position
  [1m[36mOpportunity Load (0.3ms)[0m  [1mSELECT "opportunities".* FROM "opportunities" WHERE "opportunities"."id" = $1 LIMIT 1[0m  [["id", 2]]
  [1m[35m (0.3ms)[0m  UPDATE "opportunities" SET "updated_at" = '2013-03-07 10:54:29.798203', "subscribed_users" = '--- !ruby/object:Set 
hash: 
 ~: true
' WHERE "opportunities"."id" = 2
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
Completed 201 Created in 42ms (Views: 0.1ms | ActiveRecord: 0.0ms)
  [1m[35m (0.3ms)[0m  SELECT COUNT(*) FROM "accounts" 
  [1m[36m (0.7ms)[0m  [1mROLLBACK[0m
  [1m[35m (0.1ms)[0m  BEGIN
  [1m[36m (0.1ms)[0m  [1mROLLBACK[0m
Connecting to database specified by database.yml
  [1m[36mFieldGroup Load (1.0ms)[0m  [1mSELECT "field_groups".* FROM "field_groups" WHERE "field_groups"."klass_name" = 'Account' ORDER BY position[0m
  [1m[35mFieldGroup Load (0.2ms)[0m  SELECT "field_groups".* FROM "field_groups" WHERE "field_groups"."klass_name" = 'Campaign' ORDER BY position
  [1m[36mFieldGroup Load (0.3ms)[0m  [1mSELECT "field_groups".* FROM "field_groups" WHERE "field_groups"."klass_name" = 'Contact' ORDER BY position[0m
  [1m[35mFieldGroup Load (0.3ms)[0m  SELECT "field_groups".* FROM "field_groups" WHERE "field_groups"."klass_name" = 'Lead' ORDER BY position
  [1m[36mFieldGroup Load (0.2ms)[0m  [1mSELECT "field_groups".* FROM "field_groups" WHERE "field_groups"."klass_name" = 'Opportunity' ORDER BY position[0m
  [1m[35mFieldGroup Load (0.3ms)[0m  SELECT "field_groups".* FROM "field_groups" WHERE "field_groups"."klass_name" = 'Task' ORDER BY position
Creating scope :except. Overwriting existing method User.except.
  [1m[36m (123.4ms)[0m  [1mDROP DATABASE IF EXISTS "ffcrm_vend_test"[0m
  [1m[35m (252.5ms)[0m  CREATE DATABASE "ffcrm_vend_test" ENCODING = 'utf8'
  [1m[36m (5.5ms)[0m  [1mCREATE TABLE "account_contacts" ("id" serial primary key, "account_id" integer, "contact_id" integer, "deleted_at" timestamp, "created_at" timestamp NOT NULL, "updated_at" timestamp NOT NULL) [0m
  [1m[35m (2.3ms)[0m  CREATE TABLE "account_opportunities" ("id" serial primary key, "account_id" integer, "opportunity_id" integer, "deleted_at" timestamp, "created_at" timestamp NOT NULL, "updated_at" timestamp NOT NULL) 
  [1m[36m (4.5ms)[0m  [1mCREATE TABLE "accounts" ("id" serial primary key, "user_id" integer, "assigned_to" integer, "name" character varying(64) DEFAULT '' NOT NULL, "access" character varying(8) DEFAULT 'Public', "website" character varying(64), "toll_free_phone" character varying(32), "phone" character varying(32), "fax" character varying(32), "deleted_at" timestamp, "created_at" timestamp NOT NULL, "updated_at" timestamp NOT NULL, "email" character varying(64), "background_info" character varying(255), "rating" integer DEFAULT 0 NOT NULL, "category" character varying(32), "subscribed_users" text, "cf_vend_customer_id" character varying(255)) [0m
  [1m[35m (1.2ms)[0m  CREATE INDEX "index_accounts_on_assigned_to" ON "accounts" ("assigned_to")
  [1m[36m (1.3ms)[0m  [1mCREATE UNIQUE INDEX "index_accounts_on_user_id_and_name_and_deleted_at" ON "accounts" ("user_id", "name", "deleted_at")[0m
  [1m[35m (4.2ms)[0m  CREATE TABLE "activities" ("id" serial primary key, "user_id" integer, "subject_id" integer, "subject_type" character varying(255), "action" character varying(32) DEFAULT 'created', "info" character varying(255) DEFAULT '', "private" boolean DEFAULT 'f', "created_at" timestamp NOT NULL, "updated_at" timestamp NOT NULL) 
  [1m[36m (1.1ms)[0m  [1mCREATE INDEX "index_activities_on_created_at" ON "activities" ("created_at")[0m
  [1m[35m (0.9ms)[0m  CREATE INDEX "index_activities_on_user_id" ON "activities" ("user_id")
  [1m[36m (4.2ms)[0m  [1mCREATE TABLE "addresses" ("id" serial primary key, "street1" character varying(255), "street2" character varying(255), "city" character varying(64), "state" character varying(64), "zipcode" character varying(16), "country" character varying(64), "full_address" character varying(255), "address_type" character varying(16), "addressable_id" integer, "addressable_type" character varying(255), "created_at" timestamp NOT NULL, "updated_at" timestamp NOT NULL, "deleted_at" timestamp) [0m
  [1m[35m (1.1ms)[0m  CREATE INDEX "index_addresses_on_addressable_id_and_addressable_type" ON "addresses" ("addressable_id", "addressable_type")
  [1m[36m (4.0ms)[0m  [1mCREATE TABLE "avatars" ("id" serial primary key, "user_id" integer, "entity_id" integer, "entity_type" character varying(255), "image_file_size" integer, "image_file_name" character varying(255), "image_content_type" character varying(255), "created_at" timestamp NOT NULL, "updated_at" timestamp NOT NULL) [0m
  [1m[35m (4.2ms)[0m  CREATE TABLE "campaigns" ("id" serial primary key, "user_id" integer, "assigned_to" integer, "name" character varying(64) DEFAULT '' NOT NULL, "access" character varying(8) DEFAULT 'Public', "status" character varying(64), "budget" decimal(12,2), "target_leads" integer, "target_conversion" float, "target_revenue" decimal(12,2), "leads_count" integer, "opportunities_count" integer, "revenue" decimal(12,2), "starts_on" date, "ends_on" date, "objectives" text, "deleted_at" timestamp, "created_at" timestamp NOT NULL, "updated_at" timestamp NOT NULL, "background_info" character varying(255), "subscribed_users" text) 
  [1m[36m (1.0ms)[0m  [1mCREATE INDEX "index_campaigns_on_assigned_to" ON "campaigns" ("assigned_to")[0m
  [1m[35m (1.0ms)[0m  CREATE UNIQUE INDEX "index_campaigns_on_user_id_and_name_and_deleted_at" ON "campaigns" ("user_id", "name", "deleted_at")
  [1m[36m (3.6ms)[0m  [1mCREATE TABLE "comments" ("id" serial primary key, "user_id" integer, "commentable_id" integer, "commentable_type" character varying(255), "private" boolean, "title" character varying(255) DEFAULT '', "comment" text, "created_at" timestamp NOT NULL, "updated_at" timestamp NOT NULL, "state" character varying(16) DEFAULT 'Expanded' NOT NULL) [0m
  [1m[35m (3.0ms)[0m  CREATE TABLE "contact_opportunities" ("id" serial primary key, "contact_id" integer, "opportunity_id" integer, "role" character varying(32), "deleted_at" timestamp, "created_at" timestamp NOT NULL, "updated_at" timestamp NOT NULL) 
  [1m[36m (4.6ms)[0m  [1mCREATE TABLE "contacts" ("id" serial primary key, "user_id" integer, "lead_id" integer, "assigned_to" integer, "reports_to" integer, "first_name" character varying(64) DEFAULT '' NOT NULL, "last_name" character varying(64) DEFAULT '' NOT NULL, "access" character varying(8) DEFAULT 'Public', "title" character varying(64), "department" character varying(64), "source" character varying(32), "email" character varying(64), "alt_email" character varying(64), "phone" character varying(32), "mobile" character varying(32), "fax" character varying(32), "blog" character varying(128), "linkedin" character varying(128), "facebook" character varying(128), "twitter" character varying(128), "born_on" date, "do_not_call" boolean DEFAULT 'f' NOT NULL, "deleted_at" timestamp, "created_at" timestamp NOT NULL, "updated_at" timestamp NOT NULL, "background_info" character varying(255), "skype" character varying(128), "subscribed_users" text) [0m
  [1m[35m (1.2ms)[0m  CREATE INDEX "index_contacts_on_assigned_to" ON "contacts" ("assigned_to")
  [1m[36m (1.1ms)[0m  [1mCREATE UNIQUE INDEX "id_last_name_deleted" ON "contacts" ("user_id", "last_name", "deleted_at")[0m
  [1m[35m (4.6ms)[0m  CREATE TABLE "emails" ("id" serial primary key, "imap_message_id" character varying(255) NOT NULL, "user_id" integer, "mediator_id" integer, "mediator_type" character varying(255), "sent_from" character varying(255) NOT NULL, "sent_to" character varying(255) NOT NULL, "cc" character varying(255), "bcc" character varying(255), "subject" character varying(255), "body" text, "header" text, "sent_at" timestamp, "received_at" timestamp, "deleted_at" timestamp, "created_at" timestamp NOT NULL, "updated_at" timestamp NOT NULL, "state" character varying(16) DEFAULT 'Expanded' NOT NULL) 
  [1m[36m (1.3ms)[0m  [1mCREATE INDEX "index_emails_on_mediator_id_and_mediator_type" ON "emails" ("mediator_id", "mediator_type")[0m
  [1m[35m (2.6ms)[0m  CREATE TABLE "field_groups" ("id" serial primary key, "name" character varying(64), "label" character varying(128), "position" integer, "hint" character varying(255), "created_at" timestamp NOT NULL, "updated_at" timestamp NOT NULL, "tag_id" integer, "klass_name" character varying(32)) 
  [1m[36m (4.6ms)[0m  [1mCREATE TABLE "fields" ("id" serial primary key, "type" character varying(255), "field_group_id" integer, "position" integer, "name" character varying(64), "label" character varying(128), "hint" character varying(255), "placeholder" character varying(255), "as" character varying(32), "collection" text, "disabled" boolean, "required" boolean, "maxlength" integer, "created_at" timestamp NOT NULL, "updated_at" timestamp NOT NULL) [0m
  [1m[35m (1.3ms)[0m  CREATE INDEX "index_fields_on_field_group_id" ON "fields" ("field_group_id")
  [1m[36m (1.0ms)[0m  [1mCREATE INDEX "index_fields_on_name" ON "fields" ("name")[0m
  [1m[35m (5.5ms)[0m  CREATE TABLE "leads" ("id" serial primary key, "user_id" integer, "campaign_id" integer, "assigned_to" integer, "first_name" character varying(64) DEFAULT '' NOT NULL, "last_name" character varying(64) DEFAULT '' NOT NULL, "access" character varying(8) DEFAULT 'Public', "title" character varying(64), "company" character varying(64), "source" character varying(32), "status" character varying(32), "referred_by" character varying(64), "email" character varying(64), "alt_email" character varying(64), "phone" character varying(32), "mobile" character varying(32), "blog" character varying(128), "linkedin" character varying(128), "facebook" character varying(128), "twitter" character varying(128), "rating" integer DEFAULT 0 NOT NULL, "do_not_call" boolean DEFAULT 'f' NOT NULL, "deleted_at" timestamp, "created_at" timestamp NOT NULL, "updated_at" timestamp NOT NULL, "background_info" character varying(255), "skype" character varying(128), "subscribed_users" text) 
  [1m[36m (1.0ms)[0m  [1mCREATE INDEX "index_leads_on_assigned_to" ON "leads" ("assigned_to")[0m
  [1m[35m (1.2ms)[0m  CREATE UNIQUE INDEX "index_leads_on_user_id_and_last_name_and_deleted_at" ON "leads" ("user_id", "last_name", "deleted_at")
  [1m[36m (3.1ms)[0m  [1mCREATE TABLE "lists" ("id" serial primary key, "name" character varying(255), "url" text, "created_at" timestamp NOT NULL, "updated_at" timestamp NOT NULL) [0m
  [1m[35m (4.4ms)[0m  CREATE TABLE "opportunities" ("id" serial primary key, "user_id" integer, "campaign_id" integer, "assigned_to" integer, "name" character varying(64) DEFAULT '' NOT NULL, "access" character varying(8) DEFAULT 'Public', "source" character varying(32), "stage" character varying(32), "probability" integer, "amount" decimal(12,2), "discount" decimal(12,2), "closes_on" date, "deleted_at" timestamp, "created_at" timestamp NOT NULL, "updated_at" timestamp NOT NULL, "background_info" character varying(255), "subscribed_users" text) 
  [1m[36m (1.1ms)[0m  [1mCREATE INDEX "index_opportunities_on_assigned_to" ON "opportunities" ("assigned_to")[0m
  [1m[35m (1.0ms)[0m  CREATE UNIQUE INDEX "id_name_deleted" ON "opportunities" ("user_id", "name", "deleted_at")
  [1m[36m (2.7ms)[0m  [1mCREATE TABLE "permissions" ("id" serial primary key, "user_id" integer, "asset_id" integer, "asset_type" character varying(255), "created_at" timestamp NOT NULL, "updated_at" timestamp NOT NULL) [0m
  [1m[35m (1.7ms)[0m  CREATE INDEX "index_permissions_on_asset_id_and_asset_type" ON "permissions" ("asset_id", "asset_type")
  [1m[36m (0.8ms)[0m  [1mCREATE INDEX "index_permissions_on_user_id" ON "permissions" ("user_id")[0m
  [1m[35m (3.1ms)[0m  CREATE TABLE "preferences" ("id" serial primary key, "user_id" integer, "name" character varying(32) DEFAULT '' NOT NULL, "value" text, "created_at" timestamp NOT NULL, "updated_at" timestamp NOT NULL) 
  [1m[36m (1.5ms)[0m  [1mCREATE INDEX "index_preferences_on_user_id_and_name" ON "preferences" ("user_id", "name")[0m
  [1m[35m (5.1ms)[0m  CREATE TABLE "sessions" ("id" serial primary key, "session_id" character varying(255) NOT NULL, "data" text, "created_at" timestamp NOT NULL, "updated_at" timestamp NOT NULL) 
  [1m[36m (1.1ms)[0m  [1mCREATE INDEX "index_sessions_on_session_id" ON "sessions" ("session_id")[0m
  [1m[35m (1.2ms)[0m  CREATE INDEX "index_sessions_on_updated_at" ON "sessions" ("updated_at")
  [1m[36m (3.3ms)[0m  [1mCREATE TABLE "settings" ("id" serial primary key, "name" character varying(32) DEFAULT '' NOT NULL, "value" text, "created_at" timestamp NOT NULL, "updated_at" timestamp NOT NULL) [0m
  [1m[35m (1.1ms)[0m  CREATE INDEX "index_settings_on_name" ON "settings" ("name")
  [1m[36m (4.9ms)[0m  [1mCREATE TABLE "taggings" ("id" serial primary key, "tag_id" integer, "taggable_id" integer, "tagger_id" integer, "tagger_type" character varying(255), "taggable_type" character varying(255), "context" character varying(255), "created_at" timestamp) [0m
  [1m[35m (1.2ms)[0m  CREATE INDEX "index_taggings_on_tag_id" ON "taggings" ("tag_id")
  [1m[36m (1.2ms)[0m  [1mCREATE INDEX "index_taggings_on_taggable_id_and_taggable_type_and_context" ON "taggings" ("taggable_id", "taggable_type", "context")[0m
  [1m[35m (3.0ms)[0m  CREATE TABLE "tags" ("id" serial primary key, "name" character varying(255)) 
  [1m[36m (5.0ms)[0m  [1mCREATE TABLE "tasks" ("id" serial primary key, "user_id" integer, "assigned_to" integer, "completed_by" integer, "name" character varying(255) DEFAULT '' NOT NULL, "asset_id" integer, "asset_type" character varying(255), "priority" character varying(32), "category" character varying(32), "bucket" character varying(32), "due_at" timestamp, "completed_at" timestamp, "deleted_at" timestamp, "created_at" timestamp NOT NULL, "updated_at" timestamp NOT NULL, "background_info" character varying(255), "subscribed_users" text) [0m
  [1m[35m (1.3ms)[0m  CREATE INDEX "index_tasks_on_assigned_to" ON "tasks" ("assigned_to")
  [1m[36m (1.1ms)[0m  [1mCREATE UNIQUE INDEX "index_tasks_on_user_id_and_name_and_deleted_at" ON "tasks" ("user_id", "name", "deleted_at")[0m
  [1m[35m (6.1ms)[0m  CREATE TABLE "users" ("id" serial primary key, "username" character varying(32) DEFAULT '' NOT NULL, "email" character varying(64) DEFAULT '' NOT NULL, "first_name" character varying(32), "last_name" character varying(32), "title" character varying(64), "company" character varying(64), "alt_email" character varying(64), "phone" character varying(32), "mobile" character varying(32), "aim" character varying(32), "yahoo" character varying(32), "google" character varying(32), "skype" character varying(32), "password_hash" character varying(255) DEFAULT '' NOT NULL, "password_salt" character varying(255) DEFAULT '' NOT NULL, "persistence_token" character varying(255) DEFAULT '' NOT NULL, "perishable_token" character varying(255) DEFAULT '' NOT NULL, "last_request_at" timestamp, "last_login_at" timestamp, "current_login_at" timestamp, "last_login_ip" character varying(255), "current_login_ip" character varying(255), "login_count" integer DEFAULT 0 NOT NULL, "deleted_at" timestamp, "created_at" timestamp NOT NULL, "updated_at" timestamp NOT NULL, "admin" boolean DEFAULT 'f' NOT NULL, "suspended_at" timestamp, "single_access_token" character varying(255)) 
  [1m[36m (1.0ms)[0m  [1mCREATE INDEX "index_users_on_email" ON "users" ("email")[0m
  [1m[35m (1.0ms)[0m  CREATE INDEX "index_users_on_last_request_at" ON "users" ("last_request_at")
  [1m[36m (1.2ms)[0m  [1mCREATE INDEX "index_users_on_perishable_token" ON "users" ("perishable_token")[0m
  [1m[35m (1.1ms)[0m  CREATE INDEX "index_users_on_remember_token" ON "users" ("persistence_token")
  [1m[36m (1.2ms)[0m  [1mCREATE UNIQUE INDEX "index_users_on_username_and_deleted_at" ON "users" ("username", "deleted_at")[0m
  [1m[35m (4.3ms)[0m  CREATE TABLE "versions" ("id" serial primary key, "item_type" character varying(255) NOT NULL, "item_id" integer NOT NULL, "event" character varying(512) NOT NULL, "whodunnit" character varying(255), "object" text, "created_at" timestamp, "object_changes" text, "related_id" integer, "related_type" character varying(255)) 
  [1m[36m (1.1ms)[0m  [1mCREATE INDEX "index_versions_on_item_type_and_item_id" ON "versions" ("item_type", "item_id")[0m
  [1m[35m (0.9ms)[0m  CREATE INDEX "index_versions_on_whodunnit" ON "versions" ("whodunnit")
  [1m[36m (0.9ms)[0m  [1mCREATE TABLE "schema_migrations" ("version" character varying(255) NOT NULL) [0m
  [1m[35m (1.0ms)[0m  CREATE UNIQUE INDEX "unique_schema_migrations" ON "schema_migrations" ("version")
  [1m[36m (0.3ms)[0m  [1mSELECT version FROM "schema_migrations"[0m
  [1m[35m (0.4ms)[0m  INSERT INTO "schema_migrations" (version) VALUES ('20120528102124')
  [1m[36m (0.2ms)[0m  [1mBEGIN[0m
  [1m[35m (0.3ms)[0m  ROLLBACK
  [1m[36m (0.1ms)[0m  [1mBEGIN[0m
  [1m[35m (0.7ms)[0m  SELECT COUNT(*) FROM "accounts" 
Started POST "/vend/register_sale" for 127.0.0.1 at 2013-03-08 00:02:28 +1300
Processing by VendController#register_sale as JSON
  Parameters: {"payload"=>{"id"=>"5e8b5134-a002-dd6b-b7c7-26126887c4ee", "sale_date"=>"2012-11-13 16:40:06", "status"=>"CLOSED", "user_id"=>"9b2a8d5f-2d20-11e2-8057-080027706aa2", "customer_id"=>"9b17ac9d-2d20-11e2-8057-080027706aa2", "register_id"=>"9af85e69-2d20-11e2-8057-080027706aa2", "market_id"=>"1", "invoice_number"=>"144", "short_code"=>"ne2zq", "totals"=>{"total_price"=>"4.87", "total_tax"=>"0.69", "total_payment"=>"5.55", "total_to_pay"=>"0"}, "note"=>nil, "updated_at"=>"2012-11-13 16:40:09", "created_at"=>"2012-11-13 16:40:09", "customer"=>{"id"=>"9b17ac9d-2d20-11e2-8057-080027706aa2", "customer_code"=>"WALKIN", "balance"=>"-6.250", "points"=>"0", "note"=>nil, "year_to_date"=>"79945.92188", "sex"=>"M", "date_of_birth"=>"1950-05-25", "updated_at"=>"2012-11-13 16:43:15", "created_at"=>"2012-11-13 12:28:03"}, "user"=>{"id"=>"9b2a8d5f-2d20-11e2-8057-080027706aa2", "name"=>"admin", "display_name"=>"A admin this time", "outlet_id"=>"9ae97219-2d20-11e2-8057-080027706aa2", "target_daily"=>nil, "target_weekly"=>nil, "target_monthly"=>nil, "created_at"=>"2011-09-08 05:18:38", "updated_at"=>"2011-09-08 05:18:38"}, "register_sale_products"=>[{"id"=>"148793f0-475a-7d49-442d-fd761ce76339", "product_id"=>"9fe945bc-2d20-11e2-8057-080027706aa2", "quantity"=>"1", "price"=>"1.90", "price_set"=>"true", "tax"=>"0.24", "price_total"=>"1.9", "tax_total"=>"0.24", "tax_id"=>"9a025ff0-2d20-11e2-8057-080027706aa2", "tax_name"=>"NZ GST", "tax_rate"=>"0.150000"}, {"id"=>"7d37dc0f-9462-06fa-cae0-0b4988b36539", "product_id"=>"a0c0df02-2d20-11e2-8057-080027706aa2", "quantity"=>"3", "price"=>"0.99", "price_set"=>"true", "tax"=>"0.15", "price_total"=>"2.97", "tax_total"=>"0.45", "tax_id"=>"9a025ff0-2d20-11e2-8057-080027706aa2", "tax_name"=>"NZ GST", "tax_rate"=>"0.150000"}], "register_sale_payments"=>[{"id"=>"39948e3e-bf93-1b60-ff44-f46a777ed1d4", "payment_date"=>"2012-11-13 16:40:06", "amount"=>"5.55", "retailer_payment_type_id"=>"9e9ba1ba-2d20-11e2-8057-080027706aa2", "payment_type_id"=>"1"}]}}
  [1m[36mAccount Load (0.6ms)[0m  [1mSELECT "accounts".* FROM "accounts" WHERE "accounts"."cf_vend_customer_id" = '9b17ac9d-2d20-11e2-8057-080027706aa2' LIMIT 1[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36m (0.7ms)[0m  [1mSELECT "tags".id FROM "tags" INNER JOIN "taggings" ON "tags"."id" = "taggings"."tag_id" WHERE "taggings"."taggable_id" IS NULL AND "taggings"."taggable_type" = 'Account' AND (taggings.context = 'tags')[0m
  [1m[35mFieldGroup Load (0.4ms)[0m  SELECT "field_groups".* FROM "field_groups" WHERE "field_groups"."klass_name" = 'Account' AND (tag_id IS NULL OR tag_id IN (NULL)) ORDER BY position
  [1m[36mAccount Exists (0.4ms)[0m  [1mSELECT 1 AS one FROM "accounts" WHERE ("accounts"."name" = 'Account for Register Sale 144' AND "accounts"."deleted_at" IS NULL) LIMIT 1[0m
  [1m[35mSQL (1.3ms)[0m  INSERT INTO "accounts" ("access", "assigned_to", "background_info", "category", "cf_vend_customer_id", "created_at", "deleted_at", "email", "fax", "name", "phone", "rating", "subscribed_users", "toll_free_phone", "updated_at", "user_id", "website") VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9, $10, $11, $12, $13, $14, $15, $16, $17) RETURNING "id"  [["access", "Public"], ["assigned_to", nil], ["background_info", nil], ["category", nil], ["cf_vend_customer_id", "9b17ac9d-2d20-11e2-8057-080027706aa2"], ["created_at", Thu, 07 Mar 2013 11:02:28 UTC +00:00], ["deleted_at", nil], ["email", nil], ["fax", nil], ["name", "Account for Register Sale 144"], ["phone", nil], ["rating", 0], ["subscribed_users", nil], ["toll_free_phone", nil], ["updated_at", Thu, 07 Mar 2013 11:02:28 UTC +00:00], ["user_id", nil], ["website", nil]]
  [1m[36mSQL (1.2ms)[0m  [1mINSERT INTO "versions" ("created_at", "event", "item_id", "item_type", "object", "object_changes", "related_id", "related_type", "whodunnit") VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9) RETURNING "id"[0m  [["created_at", Thu, 07 Mar 2013 11:02:28 UTC +00:00], ["event", "create"], ["item_id", 1], ["item_type", "Account"], ["object", nil], ["object_changes", "--- !map:ActiveSupport::HashWithIndifferentAccess \nname: \n- \"\"\n- Account for Register Sale 144\ncf_vend_customer_id: \n- \n- 9b17ac9d-2d20-11e2-8057-080027706aa2\ncreated_at: \n- \n- &id001 2013-03-07 11:02:28.433802 Z\nupdated_at: \n- \n- *id001\nid: \n- \n- 1\n"], ["related_id", nil], ["related_type", nil], ["whodunnit", nil]]
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35m (0.5ms)[0m  SELECT "tags".id FROM "tags" INNER JOIN "taggings" ON "tags"."id" = "taggings"."tag_id" WHERE "taggings"."taggable_id" IS NULL AND "taggings"."taggable_type" = 'Opportunity' AND (taggings.context = 'tags')
  [1m[36mFieldGroup Load (0.2ms)[0m  [1mSELECT "field_groups".* FROM "field_groups" WHERE "field_groups"."klass_name" = 'Opportunity' AND (tag_id IS NULL OR tag_id IN (NULL)) ORDER BY position[0m
  [1m[35mSQL (1.5ms)[0m  INSERT INTO "opportunities" ("access", "amount", "assigned_to", "background_info", "campaign_id", "closes_on", "created_at", "deleted_at", "discount", "name", "probability", "source", "stage", "subscribed_users", "updated_at", "user_id") VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9, $10, $11, $12, $13, $14, $15, $16) RETURNING "id"  [["access", "Public"], ["amount", #<BigDecimal:7fbfa32d12d8,'0.555E1',18(18)>], ["assigned_to", nil], ["background_info", nil], ["campaign_id", nil], ["closes_on", nil], ["created_at", Thu, 07 Mar 2013 11:02:28 UTC +00:00], ["deleted_at", nil], ["discount", nil], ["name", "Register Sale 144"], ["probability", nil], ["source", nil], ["stage", "won"], ["subscribed_users", nil], ["updated_at", Thu, 07 Mar 2013 11:02:28 UTC +00:00], ["user_id", nil]]
  [1m[36mSQL (0.4ms)[0m  [1mINSERT INTO "versions" ("created_at", "event", "item_id", "item_type", "object", "object_changes", "related_id", "related_type", "whodunnit") VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9) RETURNING "id"[0m  [["created_at", Thu, 07 Mar 2013 11:02:28 UTC +00:00], ["event", "create"], ["item_id", 1], ["item_type", "Opportunity"], ["object", nil], ["object_changes", "--- !map:ActiveSupport::HashWithIndifferentAccess \nname: \n- \"\"\n- Register Sale 144\namount: \n- \n- 5.55\nstage: \n- \n- won\ncreated_at: \n- \n- &id001 2013-03-07 11:02:28.488846 Z\nupdated_at: \n- \n- *id001\nid: \n- \n- 1\n"], ["related_id", nil], ["related_type", nil], ["whodunnit", nil]]
  [1m[35m (0.2ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36m (0.2ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mSQL (1.1ms)[0m  INSERT INTO "account_opportunities" ("account_id", "created_at", "deleted_at", "opportunity_id", "updated_at") VALUES ($1, $2, $3, $4, $5) RETURNING "id"  [["account_id", 1], ["created_at", Thu, 07 Mar 2013 11:02:28 UTC +00:00], ["deleted_at", nil], ["opportunity_id", 1], ["updated_at", Thu, 07 Mar 2013 11:02:28 UTC +00:00]]
  [1m[36mSQL (0.4ms)[0m  [1mINSERT INTO "versions" ("created_at", "event", "item_id", "item_type", "object", "object_changes", "related_id", "related_type", "whodunnit") VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9) RETURNING "id"[0m  [["created_at", Thu, 07 Mar 2013 11:02:28 UTC +00:00], ["event", "create"], ["item_id", 1], ["item_type", "AccountOpportunity"], ["object", nil], ["object_changes", "--- !map:ActiveSupport::HashWithIndifferentAccess \naccount_id: \n- \n- 1\nopportunity_id: \n- \n- 1\ncreated_at: \n- \n- &id001 2013-03-07 11:02:28.520925 Z\nupdated_at: \n- \n- *id001\nid: \n- \n- 1\n"], ["related_id", nil], ["related_type", nil], ["whodunnit", nil]]
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36mUser Load (0.7ms)[0m  [1mSELECT "users".* FROM "users" WHERE "users"."email" = 'marketplace@crossroads.org.hk' LIMIT 1[0m
  [1m[35m (0.2ms)[0m  SAVEPOINT active_record_1
  [1m[36mUser Exists (0.3ms)[0m  [1mSELECT 1 AS one FROM "users" WHERE "users"."email" = 'marketplace@crossroads.org.hk' LIMIT 1[0m
  [1m[35mUser Exists (0.4ms)[0m  SELECT 1 AS one FROM "users" WHERE "users"."username" = '' LIMIT 1
  [1m[36mUser Exists (0.3ms)[0m  [1mSELECT 1 AS one FROM "users" WHERE "users"."persistence_token" = 'd77018f98c98781442e8cdf2bec3be80cccfe8c9f52f7223046901a2bc9f8bbe8c2398e44ac7be5a9f408af639c5a20a6ab78c3ad68bfe8bb7df1191f670a22d' LIMIT 1[0m
  [1m[35mUser Exists (0.3ms)[0m  SELECT 1 AS one FROM "users" WHERE "users"."single_access_token" = 'YdgyEca3gT9irWUQymIZ' LIMIT 1
  [1m[36m (0.1ms)[0m  [1mROLLBACK TO SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mOpportunity Load (0.7ms)[0m  [1mSELECT "opportunities".* FROM "opportunities" WHERE "opportunities"."id" = 1 LIMIT 1[0m
  [1m[35mCACHE (0.0ms)[0m  SELECT 1 AS one FROM "users" WHERE "users"."email" = 'marketplace@crossroads.org.hk' LIMIT 1
  [1m[36mCACHE (0.0ms)[0m  [1mSELECT 1 AS one FROM "users" WHERE "users"."username" = '' LIMIT 1[0m
  [1m[35mCACHE (0.0ms)[0m  SELECT 1 AS one FROM "users" WHERE "users"."persistence_token" = 'd77018f98c98781442e8cdf2bec3be80cccfe8c9f52f7223046901a2bc9f8bbe8c2398e44ac7be5a9f408af639c5a20a6ab78c3ad68bfe8bb7df1191f670a22d' LIMIT 1
  [1m[36mCACHE (0.0ms)[0m  [1mSELECT 1 AS one FROM "users" WHERE "users"."single_access_token" = 'YdgyEca3gT9irWUQymIZ' LIMIT 1[0m
  [1m[35mSQL (1.6ms)[0m  INSERT INTO "comments" ("comment", "commentable_id", "commentable_type", "created_at", "private", "state", "title", "updated_at", "user_id") VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9) RETURNING "id"  [["comment", "https://globalhandicrafts.vendhq.com/sale/5e8b5134-a002-dd6b-b7c7-26126887c4ee"], ["commentable_id", 1], ["commentable_type", "Opportunity"], ["created_at", Thu, 07 Mar 2013 11:02:28 UTC +00:00], ["private", nil], ["state", "Expanded"], ["title", ""], ["updated_at", Thu, 07 Mar 2013 11:02:28 UTC +00:00], ["user_id", nil]]
  [1m[36mSQL (0.4ms)[0m  [1mINSERT INTO "versions" ("created_at", "event", "item_id", "item_type", "object", "object_changes", "related_id", "related_type", "whodunnit") VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9) RETURNING "id"[0m  [["created_at", Thu, 07 Mar 2013 11:02:28 UTC +00:00], ["event", "create"], ["item_id", 1], ["item_type", "Comment"], ["object", nil], ["object_changes", "--- !map:ActiveSupport::HashWithIndifferentAccess \ncomment: \n- \n- https://globalhandicrafts.vendhq.com/sale/5e8b5134-a002-dd6b-b7c7-26126887c4ee\ncommentable_id: \n- \n- 1\ncommentable_type: \n- \n- Opportunity\ncreated_at: \n- \n- &id001 2013-03-07 11:02:28.669335 Z\nupdated_at: \n- \n- *id001\nid: \n- \n- 1\n"], ["related_id", 1], ["related_type", "Opportunity"], ["whodunnit", nil]]
  [1m[35m (0.6ms)[0m  SELECT "tags".id FROM "tags" INNER JOIN "taggings" ON "tags"."id" = "taggings"."tag_id" WHERE "taggings"."taggable_id" = 1 AND "taggings"."taggable_type" = 'Opportunity' AND (taggings.context = 'tags')
  [1m[36mFieldGroup Load (0.4ms)[0m  [1mSELECT "field_groups".* FROM "field_groups" WHERE "field_groups"."klass_name" = 'Opportunity' AND (tag_id IS NULL OR tag_id IN (NULL)) ORDER BY position[0m
  [1m[35mOpportunity Load (0.6ms)[0m  SELECT "opportunities".* FROM "opportunities" WHERE "opportunities"."id" = $1 LIMIT 1  [["id", 1]]
  [1m[36m (0.5ms)[0m  [1mUPDATE "opportunities" SET "updated_at" = '2013-03-07 11:02:28.686734', "subscribed_users" = '--- !ruby/object:Set 
hash: 
 ~: true
' WHERE "opportunities"."id" = 1[0m
  [1m[35m (0.2ms)[0m  RELEASE SAVEPOINT active_record_1
Completed 201 Created in 443ms (Views: 0.3ms | ActiveRecord: 0.0ms)
  [1m[36m (0.5ms)[0m  [1mSELECT COUNT(*) FROM "accounts" [0m
  [1m[35m (0.3ms)[0m  SELECT COUNT(*) FROM "accounts" 
Started POST "/vend/register_sale" for 127.0.0.1 at 2013-03-08 00:02:28 +1300
Processing by VendController#register_sale as JSON
  Parameters: {"payload"=>{"id"=>"5e8b5134-a002-dd6b-b7c7-26126887c4ee", "sale_date"=>"2012-11-13 16:40:06", "status"=>"CLOSED", "user_id"=>"9b2a8d5f-2d20-11e2-8057-080027706aa2", "customer_id"=>"9b17ac9d-2d20-11e2-8057-080027706aa2", "register_id"=>"9af85e69-2d20-11e2-8057-080027706aa2", "market_id"=>"1", "invoice_number"=>"144", "short_code"=>"ne2zq", "totals"=>{"total_price"=>"4.87", "total_tax"=>"0.69", "total_payment"=>"5.55", "total_to_pay"=>"0"}, "note"=>nil, "updated_at"=>"2012-11-13 16:40:09", "created_at"=>"2012-11-13 16:40:09", "customer"=>{"id"=>"9b17ac9d-2d20-11e2-8057-080027706aa2", "customer_code"=>"WALKIN", "balance"=>"-6.250", "points"=>"0", "note"=>nil, "year_to_date"=>"79945.92188", "sex"=>"M", "date_of_birth"=>"1950-05-25", "updated_at"=>"2012-11-13 16:43:15", "created_at"=>"2012-11-13 12:28:03"}, "user"=>{"id"=>"9b2a8d5f-2d20-11e2-8057-080027706aa2", "name"=>"admin", "display_name"=>"A admin this time", "outlet_id"=>"9ae97219-2d20-11e2-8057-080027706aa2", "target_daily"=>nil, "target_weekly"=>nil, "target_monthly"=>nil, "created_at"=>"2011-09-08 05:18:38", "updated_at"=>"2011-09-08 05:18:38"}, "register_sale_products"=>[{"id"=>"148793f0-475a-7d49-442d-fd761ce76339", "product_id"=>"9fe945bc-2d20-11e2-8057-080027706aa2", "quantity"=>"1", "price"=>"1.90", "price_set"=>"true", "tax"=>"0.24", "price_total"=>"1.9", "tax_total"=>"0.24", "tax_id"=>"9a025ff0-2d20-11e2-8057-080027706aa2", "tax_name"=>"NZ GST", "tax_rate"=>"0.150000"}, {"id"=>"7d37dc0f-9462-06fa-cae0-0b4988b36539", "product_id"=>"a0c0df02-2d20-11e2-8057-080027706aa2", "quantity"=>"3", "price"=>"0.99", "price_set"=>"true", "tax"=>"0.15", "price_total"=>"2.97", "tax_total"=>"0.45", "tax_id"=>"9a025ff0-2d20-11e2-8057-080027706aa2", "tax_name"=>"NZ GST", "tax_rate"=>"0.150000"}], "register_sale_payments"=>[{"id"=>"39948e3e-bf93-1b60-ff44-f46a777ed1d4", "payment_date"=>"2012-11-13 16:40:06", "amount"=>"5.55", "retailer_payment_type_id"=>"9e9ba1ba-2d20-11e2-8057-080027706aa2", "payment_type_id"=>"1"}]}}
  [1m[36mAccount Load (0.5ms)[0m  [1mSELECT "accounts".* FROM "accounts" WHERE "accounts"."cf_vend_customer_id" = '9b17ac9d-2d20-11e2-8057-080027706aa2' LIMIT 1[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36m (0.4ms)[0m  [1mSELECT "tags".id FROM "tags" INNER JOIN "taggings" ON "tags"."id" = "taggings"."tag_id" WHERE "taggings"."taggable_id" IS NULL AND "taggings"."taggable_type" = 'Opportunity' AND (taggings.context = 'tags')[0m
  [1m[35mFieldGroup Load (0.3ms)[0m  SELECT "field_groups".* FROM "field_groups" WHERE "field_groups"."klass_name" = 'Opportunity' AND (tag_id IS NULL OR tag_id IN (NULL)) ORDER BY position
  [1m[36mSQL (0.5ms)[0m  [1mINSERT INTO "opportunities" ("access", "amount", "assigned_to", "background_info", "campaign_id", "closes_on", "created_at", "deleted_at", "discount", "name", "probability", "source", "stage", "subscribed_users", "updated_at", "user_id") VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9, $10, $11, $12, $13, $14, $15, $16) RETURNING "id"[0m  [["access", "Public"], ["amount", #<BigDecimal:7fbfa5f66168,'0.555E1',18(18)>], ["assigned_to", nil], ["background_info", nil], ["campaign_id", nil], ["closes_on", nil], ["created_at", Thu, 07 Mar 2013 11:02:28 UTC +00:00], ["deleted_at", nil], ["discount", nil], ["name", "Register Sale 144"], ["probability", nil], ["source", nil], ["stage", "won"], ["subscribed_users", nil], ["updated_at", Thu, 07 Mar 2013 11:02:28 UTC +00:00], ["user_id", nil]]
  [1m[35mSQL (0.5ms)[0m  INSERT INTO "versions" ("created_at", "event", "item_id", "item_type", "object", "object_changes", "related_id", "related_type", "whodunnit") VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9) RETURNING "id"  [["created_at", Thu, 07 Mar 2013 11:02:28 UTC +00:00], ["event", "create"], ["item_id", 2], ["item_type", "Opportunity"], ["object", nil], ["object_changes", "--- !map:ActiveSupport::HashWithIndifferentAccess \nname: \n- \"\"\n- Register Sale 144\namount: \n- \n- 5.55\nstage: \n- \n- won\ncreated_at: \n- \n- &id001 2013-03-07 11:02:28.733039 Z\nupdated_at: \n- \n- *id001\nid: \n- \n- 2\n"], ["related_id", nil], ["related_type", nil], ["whodunnit", nil]]
  [1m[36m (0.2ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mSQL (0.5ms)[0m  [1mINSERT INTO "account_opportunities" ("account_id", "created_at", "deleted_at", "opportunity_id", "updated_at") VALUES ($1, $2, $3, $4, $5) RETURNING "id"[0m  [["account_id", 1], ["created_at", Thu, 07 Mar 2013 11:02:28 UTC +00:00], ["deleted_at", nil], ["opportunity_id", 2], ["updated_at", Thu, 07 Mar 2013 11:02:28 UTC +00:00]]
  [1m[35mSQL (0.5ms)[0m  INSERT INTO "versions" ("created_at", "event", "item_id", "item_type", "object", "object_changes", "related_id", "related_type", "whodunnit") VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9) RETURNING "id"  [["created_at", Thu, 07 Mar 2013 11:02:28 UTC +00:00], ["event", "create"], ["item_id", 2], ["item_type", "AccountOpportunity"], ["object", nil], ["object_changes", "--- !map:ActiveSupport::HashWithIndifferentAccess \naccount_id: \n- \n- 1\nopportunity_id: \n- \n- 2\ncreated_at: \n- \n- &id001 2013-03-07 11:02:28.741440 Z\nupdated_at: \n- \n- *id001\nid: \n- \n- 2\n"], ["related_id", nil], ["related_type", nil], ["whodunnit", nil]]
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35mUser Load (0.5ms)[0m  SELECT "users".* FROM "users" WHERE "users"."email" = 'marketplace@crossroads.org.hk' LIMIT 1
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mUser Exists (0.4ms)[0m  SELECT 1 AS one FROM "users" WHERE "users"."email" = 'marketplace@crossroads.org.hk' LIMIT 1
  [1m[36mUser Exists (0.4ms)[0m  [1mSELECT 1 AS one FROM "users" WHERE "users"."username" = '' LIMIT 1[0m
  [1m[35mUser Exists (0.3ms)[0m  SELECT 1 AS one FROM "users" WHERE "users"."persistence_token" = '85e314157e4c42ced91314be09926c719dd3f43b7e6585f01337081e481e61323bcadf8d12d7d3ce914fa61097d9840749db221c53b41e9e173239ae2cd3bdc5' LIMIT 1
  [1m[36mUser Exists (0.3ms)[0m  [1mSELECT 1 AS one FROM "users" WHERE "users"."single_access_token" = 'LJjpUKdZC9j9DH3H8ceQ' LIMIT 1[0m
  [1m[35m (0.1ms)[0m  ROLLBACK TO SAVEPOINT active_record_1
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mOpportunity Load (0.4ms)[0m  SELECT "opportunities".* FROM "opportunities" WHERE "opportunities"."id" = 2 LIMIT 1
  [1m[36mCACHE (0.0ms)[0m  [1mSELECT 1 AS one FROM "users" WHERE "users"."email" = 'marketplace@crossroads.org.hk' LIMIT 1[0m
  [1m[35mCACHE (0.0ms)[0m  SELECT 1 AS one FROM "users" WHERE "users"."username" = '' LIMIT 1
  [1m[36mCACHE (0.0ms)[0m  [1mSELECT 1 AS one FROM "users" WHERE "users"."persistence_token" = '85e314157e4c42ced91314be09926c719dd3f43b7e6585f01337081e481e61323bcadf8d12d7d3ce914fa61097d9840749db221c53b41e9e173239ae2cd3bdc5' LIMIT 1[0m
  [1m[35mCACHE (0.0ms)[0m  SELECT 1 AS one FROM "users" WHERE "users"."single_access_token" = 'LJjpUKdZC9j9DH3H8ceQ' LIMIT 1
  [1m[36mSQL (0.4ms)[0m  [1mINSERT INTO "comments" ("comment", "commentable_id", "commentable_type", "created_at", "private", "state", "title", "updated_at", "user_id") VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9) RETURNING "id"[0m  [["comment", "https://globalhandicrafts.vendhq.com/sale/5e8b5134-a002-dd6b-b7c7-26126887c4ee"], ["commentable_id", 2], ["commentable_type", "Opportunity"], ["created_at", Thu, 07 Mar 2013 11:02:28 UTC +00:00], ["private", nil], ["state", "Expanded"], ["title", ""], ["updated_at", Thu, 07 Mar 2013 11:02:28 UTC +00:00], ["user_id", nil]]
  [1m[35mSQL (0.6ms)[0m  INSERT INTO "versions" ("created_at", "event", "item_id", "item_type", "object", "object_changes", "related_id", "related_type", "whodunnit") VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9) RETURNING "id"  [["created_at", Thu, 07 Mar 2013 11:02:28 UTC +00:00], ["event", "create"], ["item_id", 2], ["item_type", "Comment"], ["object", nil], ["object_changes", "--- !map:ActiveSupport::HashWithIndifferentAccess \ncomment: \n- \n- https://globalhandicrafts.vendhq.com/sale/5e8b5134-a002-dd6b-b7c7-26126887c4ee\ncommentable_id: \n- \n- 2\ncommentable_type: \n- \n- Opportunity\ncreated_at: \n- \n- &id001 2013-03-07 11:02:28.767815 Z\nupdated_at: \n- \n- *id001\nid: \n- \n- 2\n"], ["related_id", 2], ["related_type", "Opportunity"], ["whodunnit", nil]]
  [1m[36m (0.5ms)[0m  [1mSELECT "tags".id FROM "tags" INNER JOIN "taggings" ON "tags"."id" = "taggings"."tag_id" WHERE "taggings"."taggable_id" = 2 AND "taggings"."taggable_type" = 'Opportunity' AND (taggings.context = 'tags')[0m
  [1m[35mFieldGroup Load (0.3ms)[0m  SELECT "field_groups".* FROM "field_groups" WHERE "field_groups"."klass_name" = 'Opportunity' AND (tag_id IS NULL OR tag_id IN (NULL)) ORDER BY position
  [1m[36mOpportunity Load (0.3ms)[0m  [1mSELECT "opportunities".* FROM "opportunities" WHERE "opportunities"."id" = $1 LIMIT 1[0m  [["id", 2]]
  [1m[35m (0.3ms)[0m  UPDATE "opportunities" SET "updated_at" = '2013-03-07 11:02:28.777849', "subscribed_users" = '--- !ruby/object:Set 
hash: 
 ~: true
' WHERE "opportunities"."id" = 2
  [1m[36m (0.2ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
Completed 201 Created in 57ms (Views: 0.1ms | ActiveRecord: 0.0ms)
  [1m[35m (0.3ms)[0m  SELECT COUNT(*) FROM "accounts" 
  [1m[36mOpportunity Load (0.3ms)[0m  [1mSELECT "opportunities".* FROM "opportunities" ORDER BY "opportunities"."id" DESC LIMIT 1[0m
  [1m[35m (0.7ms)[0m  ROLLBACK
Connecting to database specified by database.yml
  [1m[36mFieldGroup Load (1.1ms)[0m  [1mSELECT "field_groups".* FROM "field_groups" WHERE "field_groups"."klass_name" = 'Account' ORDER BY position[0m
  [1m[35mFieldGroup Load (0.2ms)[0m  SELECT "field_groups".* FROM "field_groups" WHERE "field_groups"."klass_name" = 'Campaign' ORDER BY position
  [1m[36mFieldGroup Load (0.2ms)[0m  [1mSELECT "field_groups".* FROM "field_groups" WHERE "field_groups"."klass_name" = 'Contact' ORDER BY position[0m
  [1m[35mFieldGroup Load (0.2ms)[0m  SELECT "field_groups".* FROM "field_groups" WHERE "field_groups"."klass_name" = 'Lead' ORDER BY position
  [1m[36mFieldGroup Load (0.2ms)[0m  [1mSELECT "field_groups".* FROM "field_groups" WHERE "field_groups"."klass_name" = 'Opportunity' ORDER BY position[0m
  [1m[35mFieldGroup Load (0.3ms)[0m  SELECT "field_groups".* FROM "field_groups" WHERE "field_groups"."klass_name" = 'Task' ORDER BY position
Creating scope :except. Overwriting existing method User.except.
  [1m[36m (118.8ms)[0m  [1mDROP DATABASE IF EXISTS "ffcrm_vend_test"[0m
  [1m[35m (242.9ms)[0m  CREATE DATABASE "ffcrm_vend_test" ENCODING = 'utf8'
  [1m[36m (5.4ms)[0m  [1mCREATE TABLE "account_contacts" ("id" serial primary key, "account_id" integer, "contact_id" integer, "deleted_at" timestamp, "created_at" timestamp NOT NULL, "updated_at" timestamp NOT NULL) [0m
  [1m[35m (2.3ms)[0m  CREATE TABLE "account_opportunities" ("id" serial primary key, "account_id" integer, "opportunity_id" integer, "deleted_at" timestamp, "created_at" timestamp NOT NULL, "updated_at" timestamp NOT NULL) 
  [1m[36m (4.2ms)[0m  [1mCREATE TABLE "accounts" ("id" serial primary key, "user_id" integer, "assigned_to" integer, "name" character varying(64) DEFAULT '' NOT NULL, "access" character varying(8) DEFAULT 'Public', "website" character varying(64), "toll_free_phone" character varying(32), "phone" character varying(32), "fax" character varying(32), "deleted_at" timestamp, "created_at" timestamp NOT NULL, "updated_at" timestamp NOT NULL, "email" character varying(64), "background_info" character varying(255), "rating" integer DEFAULT 0 NOT NULL, "category" character varying(32), "subscribed_users" text, "cf_vend_customer_id" character varying(255)) [0m
  [1m[35m (1.1ms)[0m  CREATE INDEX "index_accounts_on_assigned_to" ON "accounts" ("assigned_to")
  [1m[36m (1.4ms)[0m  [1mCREATE UNIQUE INDEX "index_accounts_on_user_id_and_name_and_deleted_at" ON "accounts" ("user_id", "name", "deleted_at")[0m
  [1m[35m (3.8ms)[0m  CREATE TABLE "activities" ("id" serial primary key, "user_id" integer, "subject_id" integer, "subject_type" character varying(255), "action" character varying(32) DEFAULT 'created', "info" character varying(255) DEFAULT '', "private" boolean DEFAULT 'f', "created_at" timestamp NOT NULL, "updated_at" timestamp NOT NULL) 
  [1m[36m (0.9ms)[0m  [1mCREATE INDEX "index_activities_on_created_at" ON "activities" ("created_at")[0m
  [1m[35m (0.9ms)[0m  CREATE INDEX "index_activities_on_user_id" ON "activities" ("user_id")
  [1m[36m (3.5ms)[0m  [1mCREATE TABLE "addresses" ("id" serial primary key, "street1" character varying(255), "street2" character varying(255), "city" character varying(64), "state" character varying(64), "zipcode" character varying(16), "country" character varying(64), "full_address" character varying(255), "address_type" character varying(16), "addressable_id" integer, "addressable_type" character varying(255), "created_at" timestamp NOT NULL, "updated_at" timestamp NOT NULL, "deleted_at" timestamp) [0m
  [1m[35m (1.0ms)[0m  CREATE INDEX "index_addresses_on_addressable_id_and_addressable_type" ON "addresses" ("addressable_id", "addressable_type")
  [1m[36m (3.3ms)[0m  [1mCREATE TABLE "avatars" ("id" serial primary key, "user_id" integer, "entity_id" integer, "entity_type" character varying(255), "image_file_size" integer, "image_file_name" character varying(255), "image_content_type" character varying(255), "created_at" timestamp NOT NULL, "updated_at" timestamp NOT NULL) [0m
  [1m[35m (3.8ms)[0m  CREATE TABLE "campaigns" ("id" serial primary key, "user_id" integer, "assigned_to" integer, "name" character varying(64) DEFAULT '' NOT NULL, "access" character varying(8) DEFAULT 'Public', "status" character varying(64), "budget" decimal(12,2), "target_leads" integer, "target_conversion" float, "target_revenue" decimal(12,2), "leads_count" integer, "opportunities_count" integer, "revenue" decimal(12,2), "starts_on" date, "ends_on" date, "objectives" text, "deleted_at" timestamp, "created_at" timestamp NOT NULL, "updated_at" timestamp NOT NULL, "background_info" character varying(255), "subscribed_users" text) 
  [1m[36m (1.1ms)[0m  [1mCREATE INDEX "index_campaigns_on_assigned_to" ON "campaigns" ("assigned_to")[0m
  [1m[35m (1.1ms)[0m  CREATE UNIQUE INDEX "index_campaigns_on_user_id_and_name_and_deleted_at" ON "campaigns" ("user_id", "name", "deleted_at")
  [1m[36m (3.6ms)[0m  [1mCREATE TABLE "comments" ("id" serial primary key, "user_id" integer, "commentable_id" integer, "commentable_type" character varying(255), "private" boolean, "title" character varying(255) DEFAULT '', "comment" text, "created_at" timestamp NOT NULL, "updated_at" timestamp NOT NULL, "state" character varying(16) DEFAULT 'Expanded' NOT NULL) [0m
  [1m[35m (2.3ms)[0m  CREATE TABLE "contact_opportunities" ("id" serial primary key, "contact_id" integer, "opportunity_id" integer, "role" character varying(32), "deleted_at" timestamp, "created_at" timestamp NOT NULL, "updated_at" timestamp NOT NULL) 
  [1m[36m (5.2ms)[0m  [1mCREATE TABLE "contacts" ("id" serial primary key, "user_id" integer, "lead_id" integer, "assigned_to" integer, "reports_to" integer, "first_name" character varying(64) DEFAULT '' NOT NULL, "last_name" character varying(64) DEFAULT '' NOT NULL, "access" character varying(8) DEFAULT 'Public', "title" character varying(64), "department" character varying(64), "source" character varying(32), "email" character varying(64), "alt_email" character varying(64), "phone" character varying(32), "mobile" character varying(32), "fax" character varying(32), "blog" character varying(128), "linkedin" character varying(128), "facebook" character varying(128), "twitter" character varying(128), "born_on" date, "do_not_call" boolean DEFAULT 'f' NOT NULL, "deleted_at" timestamp, "created_at" timestamp NOT NULL, "updated_at" timestamp NOT NULL, "background_info" character varying(255), "skype" character varying(128), "subscribed_users" text) [0m
  [1m[35m (1.0ms)[0m  CREATE INDEX "index_contacts_on_assigned_to" ON "contacts" ("assigned_to")
  [1m[36m (1.4ms)[0m  [1mCREATE UNIQUE INDEX "id_last_name_deleted" ON "contacts" ("user_id", "last_name", "deleted_at")[0m
  [1m[35m (4.2ms)[0m  CREATE TABLE "emails" ("id" serial primary key, "imap_message_id" character varying(255) NOT NULL, "user_id" integer, "mediator_id" integer, "mediator_type" character varying(255), "sent_from" character varying(255) NOT NULL, "sent_to" character varying(255) NOT NULL, "cc" character varying(255), "bcc" character varying(255), "subject" character varying(255), "body" text, "header" text, "sent_at" timestamp, "received_at" timestamp, "deleted_at" timestamp, "created_at" timestamp NOT NULL, "updated_at" timestamp NOT NULL, "state" character varying(16) DEFAULT 'Expanded' NOT NULL) 
  [1m[36m (1.3ms)[0m  [1mCREATE INDEX "index_emails_on_mediator_id_and_mediator_type" ON "emails" ("mediator_id", "mediator_type")[0m
  [1m[35m (3.4ms)[0m  CREATE TABLE "field_groups" ("id" serial primary key, "name" character varying(64), "label" character varying(128), "position" integer, "hint" character varying(255), "created_at" timestamp NOT NULL, "updated_at" timestamp NOT NULL, "tag_id" integer, "klass_name" character varying(32)) 
  [1m[36m (3.7ms)[0m  [1mCREATE TABLE "fields" ("id" serial primary key, "type" character varying(255), "field_group_id" integer, "position" integer, "name" character varying(64), "label" character varying(128), "hint" character varying(255), "placeholder" character varying(255), "as" character varying(32), "collection" text, "disabled" boolean, "required" boolean, "maxlength" integer, "created_at" timestamp NOT NULL, "updated_at" timestamp NOT NULL) [0m
  [1m[35m (1.6ms)[0m  CREATE INDEX "index_fields_on_field_group_id" ON "fields" ("field_group_id")
  [1m[36m (1.2ms)[0m  [1mCREATE INDEX "index_fields_on_name" ON "fields" ("name")[0m
  [1m[35m (6.1ms)[0m  CREATE TABLE "leads" ("id" serial primary key, "user_id" integer, "campaign_id" integer, "assigned_to" integer, "first_name" character varying(64) DEFAULT '' NOT NULL, "last_name" character varying(64) DEFAULT '' NOT NULL, "access" character varying(8) DEFAULT 'Public', "title" character varying(64), "company" character varying(64), "source" character varying(32), "status" character varying(32), "referred_by" character varying(64), "email" character varying(64), "alt_email" character varying(64), "phone" character varying(32), "mobile" character varying(32), "blog" character varying(128), "linkedin" character varying(128), "facebook" character varying(128), "twitter" character varying(128), "rating" integer DEFAULT 0 NOT NULL, "do_not_call" boolean DEFAULT 'f' NOT NULL, "deleted_at" timestamp, "created_at" timestamp NOT NULL, "updated_at" timestamp NOT NULL, "background_info" character varying(255), "skype" character varying(128), "subscribed_users" text) 
  [1m[36m (1.3ms)[0m  [1mCREATE INDEX "index_leads_on_assigned_to" ON "leads" ("assigned_to")[0m
  [1m[35m (1.4ms)[0m  CREATE UNIQUE INDEX "index_leads_on_user_id_and_last_name_and_deleted_at" ON "leads" ("user_id", "last_name", "deleted_at")
  [1m[36m (21.4ms)[0m  [1mCREATE TABLE "lists" ("id" serial primary key, "name" character varying(255), "url" text, "created_at" timestamp NOT NULL, "updated_at" timestamp NOT NULL) [0m
  [1m[35m (17.7ms)[0m  CREATE TABLE "opportunities" ("id" serial primary key, "user_id" integer, "campaign_id" integer, "assigned_to" integer, "name" character varying(64) DEFAULT '' NOT NULL, "access" character varying(8) DEFAULT 'Public', "source" character varying(32), "stage" character varying(32), "probability" integer, "amount" decimal(12,2), "discount" decimal(12,2), "closes_on" date, "deleted_at" timestamp, "created_at" timestamp NOT NULL, "updated_at" timestamp NOT NULL, "background_info" character varying(255), "subscribed_users" text) 
  [1m[36m (1.3ms)[0m  [1mCREATE INDEX "index_opportunities_on_assigned_to" ON "opportunities" ("assigned_to")[0m
  [1m[35m (1.5ms)[0m  CREATE UNIQUE INDEX "id_name_deleted" ON "opportunities" ("user_id", "name", "deleted_at")
  [1m[36m (2.6ms)[0m  [1mCREATE TABLE "permissions" ("id" serial primary key, "user_id" integer, "asset_id" integer, "asset_type" character varying(255), "created_at" timestamp NOT NULL, "updated_at" timestamp NOT NULL) [0m
  [1m[35m (1.7ms)[0m  CREATE INDEX "index_permissions_on_asset_id_and_asset_type" ON "permissions" ("asset_id", "asset_type")
  [1m[36m (1.2ms)[0m  [1mCREATE INDEX "index_permissions_on_user_id" ON "permissions" ("user_id")[0m
  [1m[35m (14.1ms)[0m  CREATE TABLE "preferences" ("id" serial primary key, "user_id" integer, "name" character varying(32) DEFAULT '' NOT NULL, "value" text, "created_at" timestamp NOT NULL, "updated_at" timestamp NOT NULL) 
  [1m[36m (1.4ms)[0m  [1mCREATE INDEX "index_preferences_on_user_id_and_name" ON "preferences" ("user_id", "name")[0m
  [1m[35m (3.3ms)[0m  CREATE TABLE "sessions" ("id" serial primary key, "session_id" character varying(255) NOT NULL, "data" text, "created_at" timestamp NOT NULL, "updated_at" timestamp NOT NULL) 
  [1m[36m (1.1ms)[0m  [1mCREATE INDEX "index_sessions_on_session_id" ON "sessions" ("session_id")[0m
  [1m[35m (1.1ms)[0m  CREATE INDEX "index_sessions_on_updated_at" ON "sessions" ("updated_at")
  [1m[36m (3.3ms)[0m  [1mCREATE TABLE "settings" ("id" serial primary key, "name" character varying(32) DEFAULT '' NOT NULL, "value" text, "created_at" timestamp NOT NULL, "updated_at" timestamp NOT NULL) [0m
  [1m[35m (1.1ms)[0m  CREATE INDEX "index_settings_on_name" ON "settings" ("name")
  [1m[36m (3.4ms)[0m  [1mCREATE TABLE "taggings" ("id" serial primary key, "tag_id" integer, "taggable_id" integer, "tagger_id" integer, "tagger_type" character varying(255), "taggable_type" character varying(255), "context" character varying(255), "created_at" timestamp) [0m
  [1m[35m (1.0ms)[0m  CREATE INDEX "index_taggings_on_tag_id" ON "taggings" ("tag_id")
  [1m[36m (1.0ms)[0m  [1mCREATE INDEX "index_taggings_on_taggable_id_and_taggable_type_and_context" ON "taggings" ("taggable_id", "taggable_type", "context")[0m
  [1m[35m (2.4ms)[0m  CREATE TABLE "tags" ("id" serial primary key, "name" character varying(255)) 
  [1m[36m (3.4ms)[0m  [1mCREATE TABLE "tasks" ("id" serial primary key, "user_id" integer, "assigned_to" integer, "completed_by" integer, "name" character varying(255) DEFAULT '' NOT NULL, "asset_id" integer, "asset_type" character varying(255), "priority" character varying(32), "category" character varying(32), "bucket" character varying(32), "due_at" timestamp, "completed_at" timestamp, "deleted_at" timestamp, "created_at" timestamp NOT NULL, "updated_at" timestamp NOT NULL, "background_info" character varying(255), "subscribed_users" text) [0m
  [1m[35m (1.0ms)[0m  CREATE INDEX "index_tasks_on_assigned_to" ON "tasks" ("assigned_to")
  [1m[36m (1.2ms)[0m  [1mCREATE UNIQUE INDEX "index_tasks_on_user_id_and_name_and_deleted_at" ON "tasks" ("user_id", "name", "deleted_at")[0m
  [1m[35m (4.4ms)[0m  CREATE TABLE "users" ("id" serial primary key, "username" character varying(32) DEFAULT '' NOT NULL, "email" character varying(64) DEFAULT '' NOT NULL, "first_name" character varying(32), "last_name" character varying(32), "title" character varying(64), "company" character varying(64), "alt_email" character varying(64), "phone" character varying(32), "mobile" character varying(32), "aim" character varying(32), "yahoo" character varying(32), "google" character varying(32), "skype" character varying(32), "password_hash" character varying(255) DEFAULT '' NOT NULL, "password_salt" character varying(255) DEFAULT '' NOT NULL, "persistence_token" character varying(255) DEFAULT '' NOT NULL, "perishable_token" character varying(255) DEFAULT '' NOT NULL, "last_request_at" timestamp, "last_login_at" timestamp, "current_login_at" timestamp, "last_login_ip" character varying(255), "current_login_ip" character varying(255), "login_count" integer DEFAULT 0 NOT NULL, "deleted_at" timestamp, "created_at" timestamp NOT NULL, "updated_at" timestamp NOT NULL, "admin" boolean DEFAULT 'f' NOT NULL, "suspended_at" timestamp, "single_access_token" character varying(255)) 
  [1m[36m (1.0ms)[0m  [1mCREATE INDEX "index_users_on_email" ON "users" ("email")[0m
  [1m[35m (1.1ms)[0m  CREATE INDEX "index_users_on_last_request_at" ON "users" ("last_request_at")
  [1m[36m (1.0ms)[0m  [1mCREATE INDEX "index_users_on_perishable_token" ON "users" ("perishable_token")[0m
  [1m[35m (1.1ms)[0m  CREATE INDEX "index_users_on_remember_token" ON "users" ("persistence_token")
  [1m[36m (1.4ms)[0m  [1mCREATE UNIQUE INDEX "index_users_on_username_and_deleted_at" ON "users" ("username", "deleted_at")[0m
  [1m[35m (3.4ms)[0m  CREATE TABLE "versions" ("id" serial primary key, "item_type" character varying(255) NOT NULL, "item_id" integer NOT NULL, "event" character varying(512) NOT NULL, "whodunnit" character varying(255), "object" text, "created_at" timestamp, "object_changes" text, "related_id" integer, "related_type" character varying(255)) 
  [1m[36m (1.0ms)[0m  [1mCREATE INDEX "index_versions_on_item_type_and_item_id" ON "versions" ("item_type", "item_id")[0m
  [1m[35m (1.1ms)[0m  CREATE INDEX "index_versions_on_whodunnit" ON "versions" ("whodunnit")
  [1m[36m (0.8ms)[0m  [1mCREATE TABLE "schema_migrations" ("version" character varying(255) NOT NULL) [0m
  [1m[35m (1.0ms)[0m  CREATE UNIQUE INDEX "unique_schema_migrations" ON "schema_migrations" ("version")
  [1m[36m (0.2ms)[0m  [1mSELECT version FROM "schema_migrations"[0m
  [1m[35m (0.4ms)[0m  INSERT INTO "schema_migrations" (version) VALUES ('20120528102124')
  [1m[36m (0.1ms)[0m  [1mBEGIN[0m
  [1m[35m (0.6ms)[0m  SELECT COUNT(*) FROM "accounts" 
Started POST "/vend/register_sale" for 127.0.0.1 at 2013-03-08 00:04:02 +1300
Processing by VendController#register_sale as JSON
  Parameters: {"payload"=>{"id"=>"5e8b5134-a002-dd6b-b7c7-26126887c4ee", "sale_date"=>"2012-11-13 16:40:06", "status"=>"CLOSED", "user_id"=>"9b2a8d5f-2d20-11e2-8057-080027706aa2", "customer_id"=>"9b17ac9d-2d20-11e2-8057-080027706aa2", "register_id"=>"9af85e69-2d20-11e2-8057-080027706aa2", "market_id"=>"1", "invoice_number"=>"144", "short_code"=>"ne2zq", "totals"=>{"total_price"=>"4.87", "total_tax"=>"0.69", "total_payment"=>"5.55", "total_to_pay"=>"0"}, "note"=>nil, "updated_at"=>"2012-11-13 16:40:09", "created_at"=>"2012-11-13 16:40:09", "customer"=>{"id"=>"9b17ac9d-2d20-11e2-8057-080027706aa2", "customer_code"=>"WALKIN", "balance"=>"-6.250", "points"=>"0", "note"=>nil, "year_to_date"=>"79945.92188", "sex"=>"M", "date_of_birth"=>"1950-05-25", "updated_at"=>"2012-11-13 16:43:15", "created_at"=>"2012-11-13 12:28:03"}, "user"=>{"id"=>"9b2a8d5f-2d20-11e2-8057-080027706aa2", "name"=>"admin", "display_name"=>"A admin this time", "outlet_id"=>"9ae97219-2d20-11e2-8057-080027706aa2", "target_daily"=>nil, "target_weekly"=>nil, "target_monthly"=>nil, "created_at"=>"2011-09-08 05:18:38", "updated_at"=>"2011-09-08 05:18:38"}, "register_sale_products"=>[{"id"=>"148793f0-475a-7d49-442d-fd761ce76339", "product_id"=>"9fe945bc-2d20-11e2-8057-080027706aa2", "quantity"=>"1", "price"=>"1.90", "price_set"=>"true", "tax"=>"0.24", "price_total"=>"1.9", "tax_total"=>"0.24", "tax_id"=>"9a025ff0-2d20-11e2-8057-080027706aa2", "tax_name"=>"NZ GST", "tax_rate"=>"0.150000"}, {"id"=>"7d37dc0f-9462-06fa-cae0-0b4988b36539", "product_id"=>"a0c0df02-2d20-11e2-8057-080027706aa2", "quantity"=>"3", "price"=>"0.99", "price_set"=>"true", "tax"=>"0.15", "price_total"=>"2.97", "tax_total"=>"0.45", "tax_id"=>"9a025ff0-2d20-11e2-8057-080027706aa2", "tax_name"=>"NZ GST", "tax_rate"=>"0.150000"}], "register_sale_payments"=>[{"id"=>"39948e3e-bf93-1b60-ff44-f46a777ed1d4", "payment_date"=>"2012-11-13 16:40:06", "amount"=>"5.55", "retailer_payment_type_id"=>"9e9ba1ba-2d20-11e2-8057-080027706aa2", "payment_type_id"=>"1"}]}}
  [1m[36mAccount Load (0.5ms)[0m  [1mSELECT "accounts".* FROM "accounts" WHERE "accounts"."cf_vend_customer_id" = '9b17ac9d-2d20-11e2-8057-080027706aa2' LIMIT 1[0m
  [1m[35m (0.2ms)[0m  SAVEPOINT active_record_1
  [1m[36m (0.7ms)[0m  [1mSELECT "tags".id FROM "tags" INNER JOIN "taggings" ON "tags"."id" = "taggings"."tag_id" WHERE "taggings"."taggable_id" IS NULL AND "taggings"."taggable_type" = 'Account' AND (taggings.context = 'tags')[0m
  [1m[35mFieldGroup Load (0.5ms)[0m  SELECT "field_groups".* FROM "field_groups" WHERE "field_groups"."klass_name" = 'Account' AND (tag_id IS NULL OR tag_id IN (NULL)) ORDER BY position
  [1m[36mAccount Exists (0.4ms)[0m  [1mSELECT 1 AS one FROM "accounts" WHERE ("accounts"."name" = 'Account for Register Sale 144' AND "accounts"."deleted_at" IS NULL) LIMIT 1[0m
  [1m[35mSQL (1.2ms)[0m  INSERT INTO "accounts" ("access", "assigned_to", "background_info", "category", "cf_vend_customer_id", "created_at", "deleted_at", "email", "fax", "name", "phone", "rating", "subscribed_users", "toll_free_phone", "updated_at", "user_id", "website") VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9, $10, $11, $12, $13, $14, $15, $16, $17) RETURNING "id"  [["access", "Public"], ["assigned_to", nil], ["background_info", nil], ["category", nil], ["cf_vend_customer_id", "9b17ac9d-2d20-11e2-8057-080027706aa2"], ["created_at", Thu, 07 Mar 2013 11:04:02 UTC +00:00], ["deleted_at", nil], ["email", nil], ["fax", nil], ["name", "Account for Register Sale 144"], ["phone", nil], ["rating", 0], ["subscribed_users", nil], ["toll_free_phone", nil], ["updated_at", Thu, 07 Mar 2013 11:04:02 UTC +00:00], ["user_id", nil], ["website", nil]]
  [1m[36mSQL (1.3ms)[0m  [1mINSERT INTO "versions" ("created_at", "event", "item_id", "item_type", "object", "object_changes", "related_id", "related_type", "whodunnit") VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9) RETURNING "id"[0m  [["created_at", Thu, 07 Mar 2013 11:04:02 UTC +00:00], ["event", "create"], ["item_id", 1], ["item_type", "Account"], ["object", nil], ["object_changes", "--- !map:ActiveSupport::HashWithIndifferentAccess \nname: \n- \"\"\n- Account for Register Sale 144\ncf_vend_customer_id: \n- \n- 9b17ac9d-2d20-11e2-8057-080027706aa2\ncreated_at: \n- \n- &id001 2013-03-07 11:04:02.233317 Z\nupdated_at: \n- \n- *id001\nid: \n- \n- 1\n"], ["related_id", nil], ["related_type", nil], ["whodunnit", nil]]
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36m (0.2ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35m (0.5ms)[0m  SELECT "tags".id FROM "tags" INNER JOIN "taggings" ON "tags"."id" = "taggings"."tag_id" WHERE "taggings"."taggable_id" IS NULL AND "taggings"."taggable_type" = 'Opportunity' AND (taggings.context = 'tags')
  [1m[36mFieldGroup Load (0.4ms)[0m  [1mSELECT "field_groups".* FROM "field_groups" WHERE "field_groups"."klass_name" = 'Opportunity' AND (tag_id IS NULL OR tag_id IN (NULL)) ORDER BY position[0m
  [1m[35mSQL (1.7ms)[0m  INSERT INTO "opportunities" ("access", "amount", "assigned_to", "background_info", "campaign_id", "closes_on", "created_at", "deleted_at", "discount", "name", "probability", "source", "stage", "subscribed_users", "updated_at", "user_id") VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9, $10, $11, $12, $13, $14, $15, $16) RETURNING "id"  [["access", "Public"], ["amount", #<BigDecimal:7f869a2e1e90,'0.555E1',18(18)>], ["assigned_to", nil], ["background_info", nil], ["campaign_id", nil], ["closes_on", nil], ["created_at", Thu, 07 Mar 2013 11:04:02 UTC +00:00], ["deleted_at", nil], ["discount", nil], ["name", "Register Sale 144"], ["probability", nil], ["source", nil], ["stage", "won"], ["subscribed_users", nil], ["updated_at", Thu, 07 Mar 2013 11:04:02 UTC +00:00], ["user_id", nil]]
  [1m[36mSQL (0.5ms)[0m  [1mINSERT INTO "versions" ("created_at", "event", "item_id", "item_type", "object", "object_changes", "related_id", "related_type", "whodunnit") VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9) RETURNING "id"[0m  [["created_at", Thu, 07 Mar 2013 11:04:02 UTC +00:00], ["event", "create"], ["item_id", 1], ["item_type", "Opportunity"], ["object", nil], ["object_changes", "--- !map:ActiveSupport::HashWithIndifferentAccess \nname: \n- \"\"\n- Register Sale 144\namount: \n- \n- 5.55\nstage: \n- \n- won\ncreated_at: \n- \n- &id001 2013-03-07 11:04:02.341027 Z\nupdated_at: \n- \n- *id001\nid: \n- \n- 1\n"], ["related_id", nil], ["related_type", nil], ["whodunnit", nil]]
  [1m[35m (0.2ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mSQL (1.0ms)[0m  INSERT INTO "account_opportunities" ("account_id", "created_at", "deleted_at", "opportunity_id", "updated_at") VALUES ($1, $2, $3, $4, $5) RETURNING "id"  [["account_id", 1], ["created_at", Thu, 07 Mar 2013 11:04:02 UTC +00:00], ["deleted_at", nil], ["opportunity_id", 1], ["updated_at", Thu, 07 Mar 2013 11:04:02 UTC +00:00]]
  [1m[36mSQL (0.4ms)[0m  [1mINSERT INTO "versions" ("created_at", "event", "item_id", "item_type", "object", "object_changes", "related_id", "related_type", "whodunnit") VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9) RETURNING "id"[0m  [["created_at", Thu, 07 Mar 2013 11:04:02 UTC +00:00], ["event", "create"], ["item_id", 1], ["item_type", "AccountOpportunity"], ["object", nil], ["object_changes", "--- !map:ActiveSupport::HashWithIndifferentAccess \naccount_id: \n- \n- 1\nopportunity_id: \n- \n- 1\ncreated_at: \n- \n- &id001 2013-03-07 11:04:02.383344 Z\nupdated_at: \n- \n- *id001\nid: \n- \n- 1\n"], ["related_id", nil], ["related_type", nil], ["whodunnit", nil]]
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36mUser Load (0.6ms)[0m  [1mSELECT "users".* FROM "users" WHERE "users"."email" = 'marketplace@crossroads.org.hk' LIMIT 1[0m
  [1m[35m (0.2ms)[0m  SAVEPOINT active_record_1
  [1m[36mUser Exists (0.4ms)[0m  [1mSELECT 1 AS one FROM "users" WHERE "users"."email" = 'marketplace@crossroads.org.hk' LIMIT 1[0m
  [1m[35mUser Exists (0.3ms)[0m  SELECT 1 AS one FROM "users" WHERE "users"."username" = '' LIMIT 1
  [1m[36mUser Exists (0.3ms)[0m  [1mSELECT 1 AS one FROM "users" WHERE "users"."persistence_token" = 'fa550cfe26dfcf0c0a3348cdd859fae97211425f46dd588ed37bb37e38ac1b5c9fd089b00a3d5552dd96239de5af40e7180e31c89fcadfdea472309d8fd06537' LIMIT 1[0m
  [1m[35mUser Exists (0.2ms)[0m  SELECT 1 AS one FROM "users" WHERE "users"."single_access_token" = 'JMfhYGWE9LZHvy378V' LIMIT 1
  [1m[36m (0.1ms)[0m  [1mROLLBACK TO SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mOpportunity Load (0.4ms)[0m  [1mSELECT "opportunities".* FROM "opportunities" WHERE "opportunities"."id" = 1 LIMIT 1[0m
  [1m[35mCACHE (0.0ms)[0m  SELECT 1 AS one FROM "users" WHERE "users"."email" = 'marketplace@crossroads.org.hk' LIMIT 1
  [1m[36mCACHE (0.0ms)[0m  [1mSELECT 1 AS one FROM "users" WHERE "users"."username" = '' LIMIT 1[0m
  [1m[35mCACHE (0.0ms)[0m  SELECT 1 AS one FROM "users" WHERE "users"."persistence_token" = 'fa550cfe26dfcf0c0a3348cdd859fae97211425f46dd588ed37bb37e38ac1b5c9fd089b00a3d5552dd96239de5af40e7180e31c89fcadfdea472309d8fd06537' LIMIT 1
  [1m[36mCACHE (0.0ms)[0m  [1mSELECT 1 AS one FROM "users" WHERE "users"."single_access_token" = 'JMfhYGWE9LZHvy378V' LIMIT 1[0m
  [1m[35mSQL (1.0ms)[0m  INSERT INTO "comments" ("comment", "commentable_id", "commentable_type", "created_at", "private", "state", "title", "updated_at", "user_id") VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9) RETURNING "id"  [["comment", "https://globalhandicrafts.vendhq.com/sale/5e8b5134-a002-dd6b-b7c7-26126887c4ee"], ["commentable_id", 1], ["commentable_type", "Opportunity"], ["created_at", Thu, 07 Mar 2013 11:04:02 UTC +00:00], ["private", nil], ["state", "Expanded"], ["title", ""], ["updated_at", Thu, 07 Mar 2013 11:04:02 UTC +00:00], ["user_id", nil]]
  [1m[36mSQL (0.4ms)[0m  [1mINSERT INTO "versions" ("created_at", "event", "item_id", "item_type", "object", "object_changes", "related_id", "related_type", "whodunnit") VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9) RETURNING "id"[0m  [["created_at", Thu, 07 Mar 2013 11:04:02 UTC +00:00], ["event", "create"], ["item_id", 1], ["item_type", "Comment"], ["object", nil], ["object_changes", "--- !map:ActiveSupport::HashWithIndifferentAccess \ncomment: \n- \n- https://globalhandicrafts.vendhq.com/sale/5e8b5134-a002-dd6b-b7c7-26126887c4ee\ncommentable_id: \n- \n- 1\ncommentable_type: \n- \n- Opportunity\ncreated_at: \n- \n- &id001 2013-03-07 11:04:02.473882 Z\nupdated_at: \n- \n- *id001\nid: \n- \n- 1\n"], ["related_id", 1], ["related_type", "Opportunity"], ["whodunnit", nil]]
  [1m[35m (0.4ms)[0m  SELECT "tags".id FROM "tags" INNER JOIN "taggings" ON "tags"."id" = "taggings"."tag_id" WHERE "taggings"."taggable_id" = 1 AND "taggings"."taggable_type" = 'Opportunity' AND (taggings.context = 'tags')
  [1m[36mFieldGroup Load (0.3ms)[0m  [1mSELECT "field_groups".* FROM "field_groups" WHERE "field_groups"."klass_name" = 'Opportunity' AND (tag_id IS NULL OR tag_id IN (NULL)) ORDER BY position[0m
  [1m[35mOpportunity Load (0.5ms)[0m  SELECT "opportunities".* FROM "opportunities" WHERE "opportunities"."id" = $1 LIMIT 1  [["id", 1]]
  [1m[36m (0.5ms)[0m  [1mUPDATE "opportunities" SET "updated_at" = '2013-03-07 11:04:02.485154', "subscribed_users" = '--- !ruby/object:Set 
hash: 
 ~: true
' WHERE "opportunities"."id" = 1[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
Completed 201 Created in 432ms (Views: 0.2ms | ActiveRecord: 0.0ms)
  [1m[36m (0.4ms)[0m  [1mSELECT COUNT(*) FROM "accounts" [0m
  [1m[35m (0.2ms)[0m  SELECT COUNT(*) FROM "accounts" 
Started POST "/vend/register_sale" for 127.0.0.1 at 2013-03-08 00:04:02 +1300
Processing by VendController#register_sale as JSON
  Parameters: {"payload"=>{"id"=>"5e8b5134-a002-dd6b-b7c7-26126887c4ee", "sale_date"=>"2012-11-13 16:40:06", "status"=>"CLOSED", "user_id"=>"9b2a8d5f-2d20-11e2-8057-080027706aa2", "customer_id"=>"9b17ac9d-2d20-11e2-8057-080027706aa2", "register_id"=>"9af85e69-2d20-11e2-8057-080027706aa2", "market_id"=>"1", "invoice_number"=>"144", "short_code"=>"ne2zq", "totals"=>{"total_price"=>"4.87", "total_tax"=>"0.69", "total_payment"=>"5.55", "total_to_pay"=>"0"}, "note"=>nil, "updated_at"=>"2012-11-13 16:40:09", "created_at"=>"2012-11-13 16:40:09", "customer"=>{"id"=>"9b17ac9d-2d20-11e2-8057-080027706aa2", "customer_code"=>"WALKIN", "balance"=>"-6.250", "points"=>"0", "note"=>nil, "year_to_date"=>"79945.92188", "sex"=>"M", "date_of_birth"=>"1950-05-25", "updated_at"=>"2012-11-13 16:43:15", "created_at"=>"2012-11-13 12:28:03"}, "user"=>{"id"=>"9b2a8d5f-2d20-11e2-8057-080027706aa2", "name"=>"admin", "display_name"=>"A admin this time", "outlet_id"=>"9ae97219-2d20-11e2-8057-080027706aa2", "target_daily"=>nil, "target_weekly"=>nil, "target_monthly"=>nil, "created_at"=>"2011-09-08 05:18:38", "updated_at"=>"2011-09-08 05:18:38"}, "register_sale_products"=>[{"id"=>"148793f0-475a-7d49-442d-fd761ce76339", "product_id"=>"9fe945bc-2d20-11e2-8057-080027706aa2", "quantity"=>"1", "price"=>"1.90", "price_set"=>"true", "tax"=>"0.24", "price_total"=>"1.9", "tax_total"=>"0.24", "tax_id"=>"9a025ff0-2d20-11e2-8057-080027706aa2", "tax_name"=>"NZ GST", "tax_rate"=>"0.150000"}, {"id"=>"7d37dc0f-9462-06fa-cae0-0b4988b36539", "product_id"=>"a0c0df02-2d20-11e2-8057-080027706aa2", "quantity"=>"3", "price"=>"0.99", "price_set"=>"true", "tax"=>"0.15", "price_total"=>"2.97", "tax_total"=>"0.45", "tax_id"=>"9a025ff0-2d20-11e2-8057-080027706aa2", "tax_name"=>"NZ GST", "tax_rate"=>"0.150000"}], "register_sale_payments"=>[{"id"=>"39948e3e-bf93-1b60-ff44-f46a777ed1d4", "payment_date"=>"2012-11-13 16:40:06", "amount"=>"5.55", "retailer_payment_type_id"=>"9e9ba1ba-2d20-11e2-8057-080027706aa2", "payment_type_id"=>"1"}]}}
  [1m[36mAccount Load (0.4ms)[0m  [1mSELECT "accounts".* FROM "accounts" WHERE "accounts"."cf_vend_customer_id" = '9b17ac9d-2d20-11e2-8057-080027706aa2' LIMIT 1[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36m (0.4ms)[0m  [1mSELECT "tags".id FROM "tags" INNER JOIN "taggings" ON "tags"."id" = "taggings"."tag_id" WHERE "taggings"."taggable_id" IS NULL AND "taggings"."taggable_type" = 'Opportunity' AND (taggings.context = 'tags')[0m
  [1m[35mFieldGroup Load (0.3ms)[0m  SELECT "field_groups".* FROM "field_groups" WHERE "field_groups"."klass_name" = 'Opportunity' AND (tag_id IS NULL OR tag_id IN (NULL)) ORDER BY position
  [1m[36mSQL (0.4ms)[0m  [1mINSERT INTO "opportunities" ("access", "amount", "assigned_to", "background_info", "campaign_id", "closes_on", "created_at", "deleted_at", "discount", "name", "probability", "source", "stage", "subscribed_users", "updated_at", "user_id") VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9, $10, $11, $12, $13, $14, $15, $16) RETURNING "id"[0m  [["access", "Public"], ["amount", #<BigDecimal:7f869c4930e8,'0.555E1',18(18)>], ["assigned_to", nil], ["background_info", nil], ["campaign_id", nil], ["closes_on", nil], ["created_at", Thu, 07 Mar 2013 11:04:02 UTC +00:00], ["deleted_at", nil], ["discount", nil], ["name", "Register Sale 144"], ["probability", nil], ["source", nil], ["stage", "won"], ["subscribed_users", nil], ["updated_at", Thu, 07 Mar 2013 11:04:02 UTC +00:00], ["user_id", nil]]
  [1m[35mSQL (0.4ms)[0m  INSERT INTO "versions" ("created_at", "event", "item_id", "item_type", "object", "object_changes", "related_id", "related_type", "whodunnit") VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9) RETURNING "id"  [["created_at", Thu, 07 Mar 2013 11:04:02 UTC +00:00], ["event", "create"], ["item_id", 2], ["item_type", "Opportunity"], ["object", nil], ["object_changes", "--- !map:ActiveSupport::HashWithIndifferentAccess \nname: \n- \"\"\n- Register Sale 144\namount: \n- \n- 5.55\nstage: \n- \n- won\ncreated_at: \n- \n- &id001 2013-03-07 11:04:02.561742 Z\nupdated_at: \n- \n- *id001\nid: \n- \n- 2\n"], ["related_id", nil], ["related_type", nil], ["whodunnit", nil]]
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mSQL (0.3ms)[0m  [1mINSERT INTO "account_opportunities" ("account_id", "created_at", "deleted_at", "opportunity_id", "updated_at") VALUES ($1, $2, $3, $4, $5) RETURNING "id"[0m  [["account_id", 1], ["created_at", Thu, 07 Mar 2013 11:04:02 UTC +00:00], ["deleted_at", nil], ["opportunity_id", 2], ["updated_at", Thu, 07 Mar 2013 11:04:02 UTC +00:00]]
  [1m[35mSQL (0.4ms)[0m  INSERT INTO "versions" ("created_at", "event", "item_id", "item_type", "object", "object_changes", "related_id", "related_type", "whodunnit") VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9) RETURNING "id"  [["created_at", Thu, 07 Mar 2013 11:04:02 UTC +00:00], ["event", "create"], ["item_id", 2], ["item_type", "AccountOpportunity"], ["object", nil], ["object_changes", "--- !map:ActiveSupport::HashWithIndifferentAccess \naccount_id: \n- \n- 1\nopportunity_id: \n- \n- 2\ncreated_at: \n- \n- &id001 2013-03-07 11:04:02.567948 Z\nupdated_at: \n- \n- *id001\nid: \n- \n- 2\n"], ["related_id", nil], ["related_type", nil], ["whodunnit", nil]]
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35mUser Load (0.3ms)[0m  SELECT "users".* FROM "users" WHERE "users"."email" = 'marketplace@crossroads.org.hk' LIMIT 1
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mUser Exists (0.2ms)[0m  SELECT 1 AS one FROM "users" WHERE "users"."email" = 'marketplace@crossroads.org.hk' LIMIT 1
  [1m[36mUser Exists (0.3ms)[0m  [1mSELECT 1 AS one FROM "users" WHERE "users"."username" = '' LIMIT 1[0m
  [1m[35mUser Exists (0.3ms)[0m  SELECT 1 AS one FROM "users" WHERE "users"."persistence_token" = '66aba18bbd784de4c1a913be46a4695a480e703901b49a4da07503540bd8680fae7b9f3ce2b851f545364e6dd9d919dff0c05f91c5ff90c479c972363c879b75' LIMIT 1
  [1m[36mUser Exists (0.2ms)[0m  [1mSELECT 1 AS one FROM "users" WHERE "users"."single_access_token" = 'Mzavw3WHbaoysKUM8isH' LIMIT 1[0m
  [1m[35m (0.1ms)[0m  ROLLBACK TO SAVEPOINT active_record_1
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mOpportunity Load (0.3ms)[0m  SELECT "opportunities".* FROM "opportunities" WHERE "opportunities"."id" = 2 LIMIT 1
  [1m[36mCACHE (0.0ms)[0m  [1mSELECT 1 AS one FROM "users" WHERE "users"."email" = 'marketplace@crossroads.org.hk' LIMIT 1[0m
  [1m[35mCACHE (0.0ms)[0m  SELECT 1 AS one FROM "users" WHERE "users"."username" = '' LIMIT 1
  [1m[36mCACHE (0.0ms)[0m  [1mSELECT 1 AS one FROM "users" WHERE "users"."persistence_token" = '66aba18bbd784de4c1a913be46a4695a480e703901b49a4da07503540bd8680fae7b9f3ce2b851f545364e6dd9d919dff0c05f91c5ff90c479c972363c879b75' LIMIT 1[0m
  [1m[35mCACHE (0.0ms)[0m  SELECT 1 AS one FROM "users" WHERE "users"."single_access_token" = 'Mzavw3WHbaoysKUM8isH' LIMIT 1
  [1m[36mSQL (0.4ms)[0m  [1mINSERT INTO "comments" ("comment", "commentable_id", "commentable_type", "created_at", "private", "state", "title", "updated_at", "user_id") VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9) RETURNING "id"[0m  [["comment", "https://globalhandicrafts.vendhq.com/sale/5e8b5134-a002-dd6b-b7c7-26126887c4ee"], ["commentable_id", 2], ["commentable_type", "Opportunity"], ["created_at", Thu, 07 Mar 2013 11:04:02 UTC +00:00], ["private", nil], ["state", "Expanded"], ["title", ""], ["updated_at", Thu, 07 Mar 2013 11:04:02 UTC +00:00], ["user_id", nil]]
  [1m[35mSQL (0.4ms)[0m  INSERT INTO "versions" ("created_at", "event", "item_id", "item_type", "object", "object_changes", "related_id", "related_type", "whodunnit") VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9) RETURNING "id"  [["created_at", Thu, 07 Mar 2013 11:04:02 UTC +00:00], ["event", "create"], ["item_id", 2], ["item_type", "Comment"], ["object", nil], ["object_changes", "--- !map:ActiveSupport::HashWithIndifferentAccess \ncomment: \n- \n- https://globalhandicrafts.vendhq.com/sale/5e8b5134-a002-dd6b-b7c7-26126887c4ee\ncommentable_id: \n- \n- 2\ncommentable_type: \n- \n- Opportunity\ncreated_at: \n- \n- &id001 2013-03-07 11:04:02.584527 Z\nupdated_at: \n- \n- *id001\nid: \n- \n- 2\n"], ["related_id", 2], ["related_type", "Opportunity"], ["whodunnit", nil]]
  [1m[36m (0.4ms)[0m  [1mSELECT "tags".id FROM "tags" INNER JOIN "taggings" ON "tags"."id" = "taggings"."tag_id" WHERE "taggings"."taggable_id" = 2 AND "taggings"."taggable_type" = 'Opportunity' AND (taggings.context = 'tags')[0m
  [1m[35mFieldGroup Load (0.2ms)[0m  SELECT "field_groups".* FROM "field_groups" WHERE "field_groups"."klass_name" = 'Opportunity' AND (tag_id IS NULL OR tag_id IN (NULL)) ORDER BY position
  [1m[36mOpportunity Load (0.3ms)[0m  [1mSELECT "opportunities".* FROM "opportunities" WHERE "opportunities"."id" = $1 LIMIT 1[0m  [["id", 2]]
  [1m[35m (0.3ms)[0m  UPDATE "opportunities" SET "updated_at" = '2013-03-07 11:04:02.592950', "subscribed_users" = '--- !ruby/object:Set 
hash: 
 ~: true
' WHERE "opportunities"."id" = 2
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
Completed 201 Created in 40ms (Views: 0.1ms | ActiveRecord: 0.0ms)
  [1m[35m (0.3ms)[0m  SELECT COUNT(*) FROM "accounts" 
  [1m[36mOpportunity Load (0.3ms)[0m  [1mSELECT "opportunities".* FROM "opportunities" ORDER BY "opportunities"."id" DESC LIMIT 1[0m
  [1m[35mComment Load (0.5ms)[0m  SELECT "comments".* FROM "comments" WHERE "comments"."commentable_id" = 2 AND "comments"."commentable_type" = 'Opportunity' LIMIT 1
  [1m[36m (0.7ms)[0m  [1mROLLBACK[0m
  [1m[35m (0.1ms)[0m  BEGIN
  [1m[36m (0.2ms)[0m  [1mROLLBACK[0m
Connecting to database specified by database.yml
  [1m[36mFieldGroup Load (5.1ms)[0m  [1mSELECT "field_groups".* FROM "field_groups" WHERE "field_groups"."klass_name" = 'Account' ORDER BY position[0m
  [1m[35mFieldGroup Load (0.2ms)[0m  SELECT "field_groups".* FROM "field_groups" WHERE "field_groups"."klass_name" = 'Campaign' ORDER BY position
  [1m[36mFieldGroup Load (0.3ms)[0m  [1mSELECT "field_groups".* FROM "field_groups" WHERE "field_groups"."klass_name" = 'Contact' ORDER BY position[0m
  [1m[35mFieldGroup Load (0.2ms)[0m  SELECT "field_groups".* FROM "field_groups" WHERE "field_groups"."klass_name" = 'Lead' ORDER BY position
  [1m[36mFieldGroup Load (0.3ms)[0m  [1mSELECT "field_groups".* FROM "field_groups" WHERE "field_groups"."klass_name" = 'Opportunity' ORDER BY position[0m
  [1m[35mFieldGroup Load (0.3ms)[0m  SELECT "field_groups".* FROM "field_groups" WHERE "field_groups"."klass_name" = 'Task' ORDER BY position
Creating scope :except. Overwriting existing method User.except.
  [1m[36m (145.0ms)[0m  [1mDROP DATABASE IF EXISTS "ffcrm_vend_test"[0m
  [1m[35m (423.7ms)[0m  CREATE DATABASE "ffcrm_vend_test" ENCODING = 'utf8'
  [1m[36m (5.9ms)[0m  [1mCREATE TABLE "account_contacts" ("id" serial primary key, "account_id" integer, "contact_id" integer, "deleted_at" timestamp, "created_at" timestamp NOT NULL, "updated_at" timestamp NOT NULL) [0m
  [1m[35m (2.4ms)[0m  CREATE TABLE "account_opportunities" ("id" serial primary key, "account_id" integer, "opportunity_id" integer, "deleted_at" timestamp, "created_at" timestamp NOT NULL, "updated_at" timestamp NOT NULL) 
  [1m[36m (4.5ms)[0m  [1mCREATE TABLE "accounts" ("id" serial primary key, "user_id" integer, "assigned_to" integer, "name" character varying(64) DEFAULT '' NOT NULL, "access" character varying(8) DEFAULT 'Public', "website" character varying(64), "toll_free_phone" character varying(32), "phone" character varying(32), "fax" character varying(32), "deleted_at" timestamp, "created_at" timestamp NOT NULL, "updated_at" timestamp NOT NULL, "email" character varying(64), "background_info" character varying(255), "rating" integer DEFAULT 0 NOT NULL, "category" character varying(32), "subscribed_users" text, "cf_vend_customer_id" character varying(255)) [0m
  [1m[35m (1.2ms)[0m  CREATE INDEX "index_accounts_on_assigned_to" ON "accounts" ("assigned_to")
  [1m[36m (1.2ms)[0m  [1mCREATE UNIQUE INDEX "index_accounts_on_user_id_and_name_and_deleted_at" ON "accounts" ("user_id", "name", "deleted_at")[0m
  [1m[35m (3.6ms)[0m  CREATE TABLE "activities" ("id" serial primary key, "user_id" integer, "subject_id" integer, "subject_type" character varying(255), "action" character varying(32) DEFAULT 'created', "info" character varying(255) DEFAULT '', "private" boolean DEFAULT 'f', "created_at" timestamp NOT NULL, "updated_at" timestamp NOT NULL) 
  [1m[36m (1.0ms)[0m  [1mCREATE INDEX "index_activities_on_created_at" ON "activities" ("created_at")[0m
  [1m[35m (1.0ms)[0m  CREATE INDEX "index_activities_on_user_id" ON "activities" ("user_id")
  [1m[36m (3.3ms)[0m  [1mCREATE TABLE "addresses" ("id" serial primary key, "street1" character varying(255), "street2" character varying(255), "city" character varying(64), "state" character varying(64), "zipcode" character varying(16), "country" character varying(64), "full_address" character varying(255), "address_type" character varying(16), "addressable_id" integer, "addressable_type" character varying(255), "created_at" timestamp NOT NULL, "updated_at" timestamp NOT NULL, "deleted_at" timestamp) [0m
  [1m[35m (1.0ms)[0m  CREATE INDEX "index_addresses_on_addressable_id_and_addressable_type" ON "addresses" ("addressable_id", "addressable_type")
  [1m[36m (4.8ms)[0m  [1mCREATE TABLE "avatars" ("id" serial primary key, "user_id" integer, "entity_id" integer, "entity_type" character varying(255), "image_file_size" integer, "image_file_name" character varying(255), "image_content_type" character varying(255), "created_at" timestamp NOT NULL, "updated_at" timestamp NOT NULL) [0m
  [1m[35m (4.0ms)[0m  CREATE TABLE "campaigns" ("id" serial primary key, "user_id" integer, "assigned_to" integer, "name" character varying(64) DEFAULT '' NOT NULL, "access" character varying(8) DEFAULT 'Public', "status" character varying(64), "budget" decimal(12,2), "target_leads" integer, "target_conversion" float, "target_revenue" decimal(12,2), "leads_count" integer, "opportunities_count" integer, "revenue" decimal(12,2), "starts_on" date, "ends_on" date, "objectives" text, "deleted_at" timestamp, "created_at" timestamp NOT NULL, "updated_at" timestamp NOT NULL, "background_info" character varying(255), "subscribed_users" text) 
  [1m[36m (1.0ms)[0m  [1mCREATE INDEX "index_campaigns_on_assigned_to" ON "campaigns" ("assigned_to")[0m
  [1m[35m (1.1ms)[0m  CREATE UNIQUE INDEX "index_campaigns_on_user_id_and_name_and_deleted_at" ON "campaigns" ("user_id", "name", "deleted_at")
  [1m[36m (4.7ms)[0m  [1mCREATE TABLE "comments" ("id" serial primary key, "user_id" integer, "commentable_id" integer, "commentable_type" character varying(255), "private" boolean, "title" character varying(255) DEFAULT '', "comment" text, "created_at" timestamp NOT NULL, "updated_at" timestamp NOT NULL, "state" character varying(16) DEFAULT 'Expanded' NOT NULL) [0m
  [1m[35m (2.3ms)[0m  CREATE TABLE "contact_opportunities" ("id" serial primary key, "contact_id" integer, "opportunity_id" integer, "role" character varying(32), "deleted_at" timestamp, "created_at" timestamp NOT NULL, "updated_at" timestamp NOT NULL) 
  [1m[36m (4.4ms)[0m  [1mCREATE TABLE "contacts" ("id" serial primary key, "user_id" integer, "lead_id" integer, "assigned_to" integer, "reports_to" integer, "first_name" character varying(64) DEFAULT '' NOT NULL, "last_name" character varying(64) DEFAULT '' NOT NULL, "access" character varying(8) DEFAULT 'Public', "title" character varying(64), "department" character varying(64), "source" character varying(32), "email" character varying(64), "alt_email" character varying(64), "phone" character varying(32), "mobile" character varying(32), "fax" character varying(32), "blog" character varying(128), "linkedin" character varying(128), "facebook" character varying(128), "twitter" character varying(128), "born_on" date, "do_not_call" boolean DEFAULT 'f' NOT NULL, "deleted_at" timestamp, "created_at" timestamp NOT NULL, "updated_at" timestamp NOT NULL, "background_info" character varying(255), "skype" character varying(128), "subscribed_users" text) [0m
  [1m[35m (0.9ms)[0m  CREATE INDEX "index_contacts_on_assigned_to" ON "contacts" ("assigned_to")
  [1m[36m (1.0ms)[0m  [1mCREATE UNIQUE INDEX "id_last_name_deleted" ON "contacts" ("user_id", "last_name", "deleted_at")[0m
  [1m[35m (3.9ms)[0m  CREATE TABLE "emails" ("id" serial primary key, "imap_message_id" character varying(255) NOT NULL, "user_id" integer, "mediator_id" integer, "mediator_type" character varying(255), "sent_from" character varying(255) NOT NULL, "sent_to" character varying(255) NOT NULL, "cc" character varying(255), "bcc" character varying(255), "subject" character varying(255), "body" text, "header" text, "sent_at" timestamp, "received_at" timestamp, "deleted_at" timestamp, "created_at" timestamp NOT NULL, "updated_at" timestamp NOT NULL, "state" character varying(16) DEFAULT 'Expanded' NOT NULL) 
  [1m[36m (1.2ms)[0m  [1mCREATE INDEX "index_emails_on_mediator_id_and_mediator_type" ON "emails" ("mediator_id", "mediator_type")[0m
  [1m[35m (2.3ms)[0m  CREATE TABLE "field_groups" ("id" serial primary key, "name" character varying(64), "label" character varying(128), "position" integer, "hint" character varying(255), "created_at" timestamp NOT NULL, "updated_at" timestamp NOT NULL, "tag_id" integer, "klass_name" character varying(32)) 
  [1m[36m (3.5ms)[0m  [1mCREATE TABLE "fields" ("id" serial primary key, "type" character varying(255), "field_group_id" integer, "position" integer, "name" character varying(64), "label" character varying(128), "hint" character varying(255), "placeholder" character varying(255), "as" character varying(32), "collection" text, "disabled" boolean, "required" boolean, "maxlength" integer, "created_at" timestamp NOT NULL, "updated_at" timestamp NOT NULL) [0m
  [1m[35m (0.9ms)[0m  CREATE INDEX "index_fields_on_field_group_id" ON "fields" ("field_group_id")
  [1m[36m (0.9ms)[0m  [1mCREATE INDEX "index_fields_on_name" ON "fields" ("name")[0m
  [1m[35m (4.1ms)[0m  CREATE TABLE "leads" ("id" serial primary key, "user_id" integer, "campaign_id" integer, "assigned_to" integer, "first_name" character varying(64) DEFAULT '' NOT NULL, "last_name" character varying(64) DEFAULT '' NOT NULL, "access" character varying(8) DEFAULT 'Public', "title" character varying(64), "company" character varying(64), "source" character varying(32), "status" character varying(32), "referred_by" character varying(64), "email" character varying(64), "alt_email" character varying(64), "phone" character varying(32), "mobile" character varying(32), "blog" character varying(128), "linkedin" character varying(128), "facebook" character varying(128), "twitter" character varying(128), "rating" integer DEFAULT 0 NOT NULL, "do_not_call" boolean DEFAULT 'f' NOT NULL, "deleted_at" timestamp, "created_at" timestamp NOT NULL, "updated_at" timestamp NOT NULL, "background_info" character varying(255), "skype" character varying(128), "subscribed_users" text) 
  [1m[36m (0.9ms)[0m  [1mCREATE INDEX "index_leads_on_assigned_to" ON "leads" ("assigned_to")[0m
  [1m[35m (1.0ms)[0m  CREATE UNIQUE INDEX "index_leads_on_user_id_and_last_name_and_deleted_at" ON "leads" ("user_id", "last_name", "deleted_at")
  [1m[36m (3.3ms)[0m  [1mCREATE TABLE "lists" ("id" serial primary key, "name" character varying(255), "url" text, "created_at" timestamp NOT NULL, "updated_at" timestamp NOT NULL) [0m
  [1m[35m (4.0ms)[0m  CREATE TABLE "opportunities" ("id" serial primary key, "user_id" integer, "campaign_id" integer, "assigned_to" integer, "name" character varying(64) DEFAULT '' NOT NULL, "access" character varying(8) DEFAULT 'Public', "source" character varying(32), "stage" character varying(32), "probability" integer, "amount" decimal(12,2), "discount" decimal(12,2), "closes_on" date, "deleted_at" timestamp, "created_at" timestamp NOT NULL, "updated_at" timestamp NOT NULL, "background_info" character varying(255), "subscribed_users" text) 
  [1m[36m (1.0ms)[0m  [1mCREATE INDEX "index_opportunities_on_assigned_to" ON "opportunities" ("assigned_to")[0m
  [1m[35m (1.0ms)[0m  CREATE UNIQUE INDEX "id_name_deleted" ON "opportunities" ("user_id", "name", "deleted_at")
  [1m[36m (2.6ms)[0m  [1mCREATE TABLE "permissions" ("id" serial primary key, "user_id" integer, "asset_id" integer, "asset_type" character varying(255), "created_at" timestamp NOT NULL, "updated_at" timestamp NOT NULL) [0m
  [1m[35m (1.0ms)[0m  CREATE INDEX "index_permissions_on_asset_id_and_asset_type" ON "permissions" ("asset_id", "asset_type")
  [1m[36m (0.8ms)[0m  [1mCREATE INDEX "index_permissions_on_user_id" ON "permissions" ("user_id")[0m
  [1m[35m (3.7ms)[0m  CREATE TABLE "preferences" ("id" serial primary key, "user_id" integer, "name" character varying(32) DEFAULT '' NOT NULL, "value" text, "created_at" timestamp NOT NULL, "updated_at" timestamp NOT NULL) 
  [1m[36m (1.1ms)[0m  [1mCREATE INDEX "index_preferences_on_user_id_and_name" ON "preferences" ("user_id", "name")[0m
  [1m[35m (3.1ms)[0m  CREATE TABLE "sessions" ("id" serial primary key, "session_id" character varying(255) NOT NULL, "data" text, "created_at" timestamp NOT NULL, "updated_at" timestamp NOT NULL) 
  [1m[36m (1.1ms)[0m  [1mCREATE INDEX "index_sessions_on_session_id" ON "sessions" ("session_id")[0m
  [1m[35m (0.8ms)[0m  CREATE INDEX "index_sessions_on_updated_at" ON "sessions" ("updated_at")
  [1m[36m (3.3ms)[0m  [1mCREATE TABLE "settings" ("id" serial primary key, "name" character varying(32) DEFAULT '' NOT NULL, "value" text, "created_at" timestamp NOT NULL, "updated_at" timestamp NOT NULL) [0m
  [1m[35m (1.1ms)[0m  CREATE INDEX "index_settings_on_name" ON "settings" ("name")
  [1m[36m (3.5ms)[0m  [1mCREATE TABLE "taggings" ("id" serial primary key, "tag_id" integer, "taggable_id" integer, "tagger_id" integer, "tagger_type" character varying(255), "taggable_type" character varying(255), "context" character varying(255), "created_at" timestamp) [0m
  [1m[35m (1.0ms)[0m  CREATE INDEX "index_taggings_on_tag_id" ON "taggings" ("tag_id")
  [1m[36m (1.1ms)[0m  [1mCREATE INDEX "index_taggings_on_taggable_id_and_taggable_type_and_context" ON "taggings" ("taggable_id", "taggable_type", "context")[0m
  [1m[35m (2.5ms)[0m  CREATE TABLE "tags" ("id" serial primary key, "name" character varying(255)) 
  [1m[36m (3.3ms)[0m  [1mCREATE TABLE "tasks" ("id" serial primary key, "user_id" integer, "assigned_to" integer, "completed_by" integer, "name" character varying(255) DEFAULT '' NOT NULL, "asset_id" integer, "asset_type" character varying(255), "priority" character varying(32), "category" character varying(32), "bucket" character varying(32), "due_at" timestamp, "completed_at" timestamp, "deleted_at" timestamp, "created_at" timestamp NOT NULL, "updated_at" timestamp NOT NULL, "background_info" character varying(255), "subscribed_users" text) [0m
  [1m[35m (1.1ms)[0m  CREATE INDEX "index_tasks_on_assigned_to" ON "tasks" ("assigned_to")
  [1m[36m (1.3ms)[0m  [1mCREATE UNIQUE INDEX "index_tasks_on_user_id_and_name_and_deleted_at" ON "tasks" ("user_id", "name", "deleted_at")[0m
  [1m[35m (4.1ms)[0m  CREATE TABLE "users" ("id" serial primary key, "username" character varying(32) DEFAULT '' NOT NULL, "email" character varying(64) DEFAULT '' NOT NULL, "first_name" character varying(32), "last_name" character varying(32), "title" character varying(64), "company" character varying(64), "alt_email" character varying(64), "phone" character varying(32), "mobile" character varying(32), "aim" character varying(32), "yahoo" character varying(32), "google" character varying(32), "skype" character varying(32), "password_hash" character varying(255) DEFAULT '' NOT NULL, "password_salt" character varying(255) DEFAULT '' NOT NULL, "persistence_token" character varying(255) DEFAULT '' NOT NULL, "perishable_token" character varying(255) DEFAULT '' NOT NULL, "last_request_at" timestamp, "last_login_at" timestamp, "current_login_at" timestamp, "last_login_ip" character varying(255), "current_login_ip" character varying(255), "login_count" integer DEFAULT 0 NOT NULL, "deleted_at" timestamp, "created_at" timestamp NOT NULL, "updated_at" timestamp NOT NULL, "admin" boolean DEFAULT 'f' NOT NULL, "suspended_at" timestamp, "single_access_token" character varying(255)) 
  [1m[36m (1.3ms)[0m  [1mCREATE INDEX "index_users_on_email" ON "users" ("email")[0m
  [1m[35m (0.9ms)[0m  CREATE INDEX "index_users_on_last_request_at" ON "users" ("last_request_at")
  [1m[36m (0.9ms)[0m  [1mCREATE INDEX "index_users_on_perishable_token" ON "users" ("perishable_token")[0m
  [1m[35m (1.0ms)[0m  CREATE INDEX "index_users_on_remember_token" ON "users" ("persistence_token")
  [1m[36m (1.2ms)[0m  [1mCREATE UNIQUE INDEX "index_users_on_username_and_deleted_at" ON "users" ("username", "deleted_at")[0m
  [1m[35m (3.7ms)[0m  CREATE TABLE "versions" ("id" serial primary key, "item_type" character varying(255) NOT NULL, "item_id" integer NOT NULL, "event" character varying(512) NOT NULL, "whodunnit" character varying(255), "object" text, "created_at" timestamp, "object_changes" text, "related_id" integer, "related_type" character varying(255)) 
  [1m[36m (0.9ms)[0m  [1mCREATE INDEX "index_versions_on_item_type_and_item_id" ON "versions" ("item_type", "item_id")[0m
  [1m[35m (1.1ms)[0m  CREATE INDEX "index_versions_on_whodunnit" ON "versions" ("whodunnit")
  [1m[36m (0.9ms)[0m  [1mCREATE TABLE "schema_migrations" ("version" character varying(255) NOT NULL) [0m
  [1m[35m (0.9ms)[0m  CREATE UNIQUE INDEX "unique_schema_migrations" ON "schema_migrations" ("version")
  [1m[36m (0.2ms)[0m  [1mSELECT version FROM "schema_migrations"[0m
  [1m[35m (0.4ms)[0m  INSERT INTO "schema_migrations" (version) VALUES ('20120528102124')
Connecting to database specified by database.yml
  [1m[36mFieldGroup Load (1.0ms)[0m  [1mSELECT "field_groups".* FROM "field_groups" WHERE "field_groups"."klass_name" = 'Account' ORDER BY position[0m
  [1m[35mFieldGroup Load (0.3ms)[0m  SELECT "field_groups".* FROM "field_groups" WHERE "field_groups"."klass_name" = 'Campaign' ORDER BY position
  [1m[36mFieldGroup Load (0.2ms)[0m  [1mSELECT "field_groups".* FROM "field_groups" WHERE "field_groups"."klass_name" = 'Contact' ORDER BY position[0m
  [1m[35mFieldGroup Load (0.3ms)[0m  SELECT "field_groups".* FROM "field_groups" WHERE "field_groups"."klass_name" = 'Lead' ORDER BY position
  [1m[36mFieldGroup Load (0.3ms)[0m  [1mSELECT "field_groups".* FROM "field_groups" WHERE "field_groups"."klass_name" = 'Opportunity' ORDER BY position[0m
  [1m[35mFieldGroup Load (0.3ms)[0m  SELECT "field_groups".* FROM "field_groups" WHERE "field_groups"."klass_name" = 'Task' ORDER BY position
Creating scope :except. Overwriting existing method User.except.
  [1m[36m (120.5ms)[0m  [1mDROP DATABASE IF EXISTS "ffcrm_vend_test"[0m
  [1m[35m (250.1ms)[0m  CREATE DATABASE "ffcrm_vend_test" ENCODING = 'utf8'
  [1m[36m (7.8ms)[0m  [1mCREATE TABLE "account_contacts" ("id" serial primary key, "account_id" integer, "contact_id" integer, "deleted_at" timestamp, "created_at" timestamp NOT NULL, "updated_at" timestamp NOT NULL) [0m
  [1m[35m (3.4ms)[0m  CREATE TABLE "account_opportunities" ("id" serial primary key, "account_id" integer, "opportunity_id" integer, "deleted_at" timestamp, "created_at" timestamp NOT NULL, "updated_at" timestamp NOT NULL) 
  [1m[36m (6.3ms)[0m  [1mCREATE TABLE "accounts" ("id" serial primary key, "user_id" integer, "assigned_to" integer, "name" character varying(64) DEFAULT '' NOT NULL, "access" character varying(8) DEFAULT 'Public', "website" character varying(64), "toll_free_phone" character varying(32), "phone" character varying(32), "fax" character varying(32), "deleted_at" timestamp, "created_at" timestamp NOT NULL, "updated_at" timestamp NOT NULL, "email" character varying(64), "background_info" character varying(255), "rating" integer DEFAULT 0 NOT NULL, "category" character varying(32), "subscribed_users" text, "cf_vend_customer_id" character varying(255)) [0m
  [1m[35m (1.5ms)[0m  CREATE INDEX "index_accounts_on_assigned_to" ON "accounts" ("assigned_to")
  [1m[36m (2.0ms)[0m  [1mCREATE UNIQUE INDEX "index_accounts_on_user_id_and_name_and_deleted_at" ON "accounts" ("user_id", "name", "deleted_at")[0m
  [1m[35m (5.5ms)[0m  CREATE TABLE "activities" ("id" serial primary key, "user_id" integer, "subject_id" integer, "subject_type" character varying(255), "action" character varying(32) DEFAULT 'created', "info" character varying(255) DEFAULT '', "private" boolean DEFAULT 'f', "created_at" timestamp NOT NULL, "updated_at" timestamp NOT NULL) 
  [1m[36m (1.4ms)[0m  [1mCREATE INDEX "index_activities_on_created_at" ON "activities" ("created_at")[0m
  [1m[35m (1.5ms)[0m  CREATE INDEX "index_activities_on_user_id" ON "activities" ("user_id")
  [1m[36m (4.8ms)[0m  [1mCREATE TABLE "addresses" ("id" serial primary key, "street1" character varying(255), "street2" character varying(255), "city" character varying(64), "state" character varying(64), "zipcode" character varying(16), "country" character varying(64), "full_address" character varying(255), "address_type" character varying(16), "addressable_id" integer, "addressable_type" character varying(255), "created_at" timestamp NOT NULL, "updated_at" timestamp NOT NULL, "deleted_at" timestamp) [0m
  [1m[35m (1.1ms)[0m  CREATE INDEX "index_addresses_on_addressable_id_and_addressable_type" ON "addresses" ("addressable_id", "addressable_type")
  [1m[36m (5.1ms)[0m  [1mCREATE TABLE "avatars" ("id" serial primary key, "user_id" integer, "entity_id" integer, "entity_type" character varying(255), "image_file_size" integer, "image_file_name" character varying(255), "image_content_type" character varying(255), "created_at" timestamp NOT NULL, "updated_at" timestamp NOT NULL) [0m
  [1m[35m (3.9ms)[0m  CREATE TABLE "campaigns" ("id" serial primary key, "user_id" integer, "assigned_to" integer, "name" character varying(64) DEFAULT '' NOT NULL, "access" character varying(8) DEFAULT 'Public', "status" character varying(64), "budget" decimal(12,2), "target_leads" integer, "target_conversion" float, "target_revenue" decimal(12,2), "leads_count" integer, "opportunities_count" integer, "revenue" decimal(12,2), "starts_on" date, "ends_on" date, "objectives" text, "deleted_at" timestamp, "created_at" timestamp NOT NULL, "updated_at" timestamp NOT NULL, "background_info" character varying(255), "subscribed_users" text) 
  [1m[36m (1.4ms)[0m  [1mCREATE INDEX "index_campaigns_on_assigned_to" ON "campaigns" ("assigned_to")[0m
  [1m[35m (1.4ms)[0m  CREATE UNIQUE INDEX "index_campaigns_on_user_id_and_name_and_deleted_at" ON "campaigns" ("user_id", "name", "deleted_at")
  [1m[36m (5.5ms)[0m  [1mCREATE TABLE "comments" ("id" serial primary key, "user_id" integer, "commentable_id" integer, "commentable_type" character varying(255), "private" boolean, "title" character varying(255) DEFAULT '', "comment" text, "created_at" timestamp NOT NULL, "updated_at" timestamp NOT NULL, "state" character varying(16) DEFAULT 'Expanded' NOT NULL) [0m
  [1m[35m (2.7ms)[0m  CREATE TABLE "contact_opportunities" ("id" serial primary key, "contact_id" integer, "opportunity_id" integer, "role" character varying(32), "deleted_at" timestamp, "created_at" timestamp NOT NULL, "updated_at" timestamp NOT NULL) 
  [1m[36m (5.9ms)[0m  [1mCREATE TABLE "contacts" ("id" serial primary key, "user_id" integer, "lead_id" integer, "assigned_to" integer, "reports_to" integer, "first_name" character varying(64) DEFAULT '' NOT NULL, "last_name" character varying(64) DEFAULT '' NOT NULL, "access" character varying(8) DEFAULT 'Public', "title" character varying(64), "department" character varying(64), "source" character varying(32), "email" character varying(64), "alt_email" character varying(64), "phone" character varying(32), "mobile" character varying(32), "fax" character varying(32), "blog" character varying(128), "linkedin" character varying(128), "facebook" character varying(128), "twitter" character varying(128), "born_on" date, "do_not_call" boolean DEFAULT 'f' NOT NULL, "deleted_at" timestamp, "created_at" timestamp NOT NULL, "updated_at" timestamp NOT NULL, "background_info" character varying(255), "skype" character varying(128), "subscribed_users" text) [0m
  [1m[35m (1.3ms)[0m  CREATE INDEX "index_contacts_on_assigned_to" ON "contacts" ("assigned_to")
  [1m[36m (2.0ms)[0m  [1mCREATE UNIQUE INDEX "id_last_name_deleted" ON "contacts" ("user_id", "last_name", "deleted_at")[0m
  [1m[35m (4.4ms)[0m  CREATE TABLE "emails" ("id" serial primary key, "imap_message_id" character varying(255) NOT NULL, "user_id" integer, "mediator_id" integer, "mediator_type" character varying(255), "sent_from" character varying(255) NOT NULL, "sent_to" character varying(255) NOT NULL, "cc" character varying(255), "bcc" character varying(255), "subject" character varying(255), "body" text, "header" text, "sent_at" timestamp, "received_at" timestamp, "deleted_at" timestamp, "created_at" timestamp NOT NULL, "updated_at" timestamp NOT NULL, "state" character varying(16) DEFAULT 'Expanded' NOT NULL) 
  [1m[36m (1.2ms)[0m  [1mCREATE INDEX "index_emails_on_mediator_id_and_mediator_type" ON "emails" ("mediator_id", "mediator_type")[0m
  [1m[35m (3.6ms)[0m  CREATE TABLE "field_groups" ("id" serial primary key, "name" character varying(64), "label" character varying(128), "position" integer, "hint" character varying(255), "created_at" timestamp NOT NULL, "updated_at" timestamp NOT NULL, "tag_id" integer, "klass_name" character varying(32)) 
  [1m[36m (4.3ms)[0m  [1mCREATE TABLE "fields" ("id" serial primary key, "type" character varying(255), "field_group_id" integer, "position" integer, "name" character varying(64), "label" character varying(128), "hint" character varying(255), "placeholder" character varying(255), "as" character varying(32), "collection" text, "disabled" boolean, "required" boolean, "maxlength" integer, "created_at" timestamp NOT NULL, "updated_at" timestamp NOT NULL) [0m
  [1m[35m (1.6ms)[0m  CREATE INDEX "index_fields_on_field_group_id" ON "fields" ("field_group_id")
  [1m[36m (1.3ms)[0m  [1mCREATE INDEX "index_fields_on_name" ON "fields" ("name")[0m
  [1m[35m (5.8ms)[0m  CREATE TABLE "leads" ("id" serial primary key, "user_id" integer, "campaign_id" integer, "assigned_to" integer, "first_name" character varying(64) DEFAULT '' NOT NULL, "last_name" character varying(64) DEFAULT '' NOT NULL, "access" character varying(8) DEFAULT 'Public', "title" character varying(64), "company" character varying(64), "source" character varying(32), "status" character varying(32), "referred_by" character varying(64), "email" character varying(64), "alt_email" character varying(64), "phone" character varying(32), "mobile" character varying(32), "blog" character varying(128), "linkedin" character varying(128), "facebook" character varying(128), "twitter" character varying(128), "rating" integer DEFAULT 0 NOT NULL, "do_not_call" boolean DEFAULT 'f' NOT NULL, "deleted_at" timestamp, "created_at" timestamp NOT NULL, "updated_at" timestamp NOT NULL, "background_info" character varying(255), "skype" character varying(128), "subscribed_users" text) 
  [1m[36m (1.2ms)[0m  [1mCREATE INDEX "index_leads_on_assigned_to" ON "leads" ("assigned_to")[0m
  [1m[35m (1.8ms)[0m  CREATE UNIQUE INDEX "index_leads_on_user_id_and_last_name_and_deleted_at" ON "leads" ("user_id", "last_name", "deleted_at")
  [1m[36m (4.7ms)[0m  [1mCREATE TABLE "lists" ("id" serial primary key, "name" character varying(255), "url" text, "created_at" timestamp NOT NULL, "updated_at" timestamp NOT NULL) [0m
  [1m[35m (6.6ms)[0m  CREATE TABLE "opportunities" ("id" serial primary key, "user_id" integer, "campaign_id" integer, "assigned_to" integer, "name" character varying(64) DEFAULT '' NOT NULL, "access" character varying(8) DEFAULT 'Public', "source" character varying(32), "stage" character varying(32), "probability" integer, "amount" decimal(12,2), "discount" decimal(12,2), "closes_on" date, "deleted_at" timestamp, "created_at" timestamp NOT NULL, "updated_at" timestamp NOT NULL, "background_info" character varying(255), "subscribed_users" text) 
  [1m[36m (1.1ms)[0m  [1mCREATE INDEX "index_opportunities_on_assigned_to" ON "opportunities" ("assigned_to")[0m
  [1m[35m (1.1ms)[0m  CREATE UNIQUE INDEX "id_name_deleted" ON "opportunities" ("user_id", "name", "deleted_at")
  [1m[36m (3.7ms)[0m  [1mCREATE TABLE "permissions" ("id" serial primary key, "user_id" integer, "asset_id" integer, "asset_type" character varying(255), "created_at" timestamp NOT NULL, "updated_at" timestamp NOT NULL) [0m
  [1m[35m (1.1ms)[0m  CREATE INDEX "index_permissions_on_asset_id_and_asset_type" ON "permissions" ("asset_id", "asset_type")
  [1m[36m (1.4ms)[0m  [1mCREATE INDEX "index_permissions_on_user_id" ON "permissions" ("user_id")[0m
  [1m[35m (3.9ms)[0m  CREATE TABLE "preferences" ("id" serial primary key, "user_id" integer, "name" character varying(32) DEFAULT '' NOT NULL, "value" text, "created_at" timestamp NOT NULL, "updated_at" timestamp NOT NULL) 
  [1m[36m (1.1ms)[0m  [1mCREATE INDEX "index_preferences_on_user_id_and_name" ON "preferences" ("user_id", "name")[0m
  [1m[35m (4.6ms)[0m  CREATE TABLE "sessions" ("id" serial primary key, "session_id" character varying(255) NOT NULL, "data" text, "created_at" timestamp NOT NULL, "updated_at" timestamp NOT NULL) 
  [1m[36m (1.3ms)[0m  [1mCREATE INDEX "index_sessions_on_session_id" ON "sessions" ("session_id")[0m
  [1m[35m (1.0ms)[0m  CREATE INDEX "index_sessions_on_updated_at" ON "sessions" ("updated_at")
  [1m[36m (4.7ms)[0m  [1mCREATE TABLE "settings" ("id" serial primary key, "name" character varying(32) DEFAULT '' NOT NULL, "value" text, "created_at" timestamp NOT NULL, "updated_at" timestamp NOT NULL) [0m
  [1m[35m (1.1ms)[0m  CREATE INDEX "index_settings_on_name" ON "settings" ("name")
  [1m[36m (5.0ms)[0m  [1mCREATE TABLE "taggings" ("id" serial primary key, "tag_id" integer, "taggable_id" integer, "tagger_id" integer, "tagger_type" character varying(255), "taggable_type" character varying(255), "context" character varying(255), "created_at" timestamp) [0m
  [1m[35m (1.4ms)[0m  CREATE INDEX "index_taggings_on_tag_id" ON "taggings" ("tag_id")
  [1m[36m (1.7ms)[0m  [1mCREATE INDEX "index_taggings_on_taggable_id_and_taggable_type_and_context" ON "taggings" ("taggable_id", "taggable_type", "context")[0m
  [1m[35m (3.3ms)[0m  CREATE TABLE "tags" ("id" serial primary key, "name" character varying(255)) 
  [1m[36m (4.4ms)[0m  [1mCREATE TABLE "tasks" ("id" serial primary key, "user_id" integer, "assigned_to" integer, "completed_by" integer, "name" character varying(255) DEFAULT '' NOT NULL, "asset_id" integer, "asset_type" character varying(255), "priority" character varying(32), "category" character varying(32), "bucket" character varying(32), "due_at" timestamp, "completed_at" timestamp, "deleted_at" timestamp, "created_at" timestamp NOT NULL, "updated_at" timestamp NOT NULL, "background_info" character varying(255), "subscribed_users" text) [0m
  [1m[35m (1.4ms)[0m  CREATE INDEX "index_tasks_on_assigned_to" ON "tasks" ("assigned_to")
  [1m[36m (1.3ms)[0m  [1mCREATE UNIQUE INDEX "index_tasks_on_user_id_and_name_and_deleted_at" ON "tasks" ("user_id", "name", "deleted_at")[0m
  [1m[35m (5.8ms)[0m  CREATE TABLE "users" ("id" serial primary key, "username" character varying(32) DEFAULT '' NOT NULL, "email" character varying(64) DEFAULT '' NOT NULL, "first_name" character varying(32), "last_name" character varying(32), "title" character varying(64), "company" character varying(64), "alt_email" character varying(64), "phone" character varying(32), "mobile" character varying(32), "aim" character varying(32), "yahoo" character varying(32), "google" character varying(32), "skype" character varying(32), "password_hash" character varying(255) DEFAULT '' NOT NULL, "password_salt" character varying(255) DEFAULT '' NOT NULL, "persistence_token" character varying(255) DEFAULT '' NOT NULL, "perishable_token" character varying(255) DEFAULT '' NOT NULL, "last_request_at" timestamp, "last_login_at" timestamp, "current_login_at" timestamp, "last_login_ip" character varying(255), "current_login_ip" character varying(255), "login_count" integer DEFAULT 0 NOT NULL, "deleted_at" timestamp, "created_at" timestamp NOT NULL, "updated_at" timestamp NOT NULL, "admin" boolean DEFAULT 'f' NOT NULL, "suspended_at" timestamp, "single_access_token" character varying(255)) 
  [1m[36m (1.2ms)[0m  [1mCREATE INDEX "index_users_on_email" ON "users" ("email")[0m
  [1m[35m (1.8ms)[0m  CREATE INDEX "index_users_on_last_request_at" ON "users" ("last_request_at")
  [1m[36m (1.3ms)[0m  [1mCREATE INDEX "index_users_on_perishable_token" ON "users" ("perishable_token")[0m
  [1m[35m (1.1ms)[0m  CREATE INDEX "index_users_on_remember_token" ON "users" ("persistence_token")
  [1m[36m (1.4ms)[0m  [1mCREATE UNIQUE INDEX "index_users_on_username_and_deleted_at" ON "users" ("username", "deleted_at")[0m
  [1m[35m (3.5ms)[0m  CREATE TABLE "versions" ("id" serial primary key, "item_type" character varying(255) NOT NULL, "item_id" integer NOT NULL, "event" character varying(512) NOT NULL, "whodunnit" character varying(255), "object" text, "created_at" timestamp, "object_changes" text, "related_id" integer, "related_type" character varying(255)) 
  [1m[36m (1.1ms)[0m  [1mCREATE INDEX "index_versions_on_item_type_and_item_id" ON "versions" ("item_type", "item_id")[0m
  [1m[35m (1.3ms)[0m  CREATE INDEX "index_versions_on_whodunnit" ON "versions" ("whodunnit")
  [1m[36m (1.1ms)[0m  [1mCREATE TABLE "schema_migrations" ("version" character varying(255) NOT NULL) [0m
  [1m[35m (1.3ms)[0m  CREATE UNIQUE INDEX "unique_schema_migrations" ON "schema_migrations" ("version")
  [1m[36m (0.4ms)[0m  [1mSELECT version FROM "schema_migrations"[0m
  [1m[35m (0.5ms)[0m  INSERT INTO "schema_migrations" (version) VALUES ('20120528102124')
  [1m[36m (0.1ms)[0m  [1mBEGIN[0m
  [1m[35m (0.5ms)[0m  SELECT COUNT(*) FROM "accounts" 
Started POST "/vend/register_sale" for 127.0.0.1 at 2013-03-13 23:19:04 +1300
Processing by VendController#register_sale as JSON
  Parameters: {"payload"=>{"created_at"=>"2013-03-13 10:12:17", "customer"=>{"balance"=>"0.000", "contact_first_name"=>"Bob", "contact_last_name"=>"Waikakte", "created_at"=>"2013-03-13 09:51:55", "custom_field_1"=>"", "custom_field_2"=>"", "custom_field_3"=>"", "custom_field_4"=>"", "customer_code"=>"Bob-4QTY", "id"=>"a3ccb1a1-8bc3-11e2-b1f5-4040782fde00", "note"=>"", "points"=>"0", "sex"=>"M", "updated_at"=>"2013-03-13 10:11:53", "year_to_date"=>"18.90000"}, "customer_id"=>"a3ccb1a1-8bc3-11e2-b1f5-4040782fde00", "id"=>"d66f205d-147e-bec6-29fd-72ec60104b0c", "invoice_number"=>"6", "market_id"=>"3", "register_id"=>"a5834e96-8b10-11e2-b1f5-4040782fde00", "register_sale_payments"=>[{"amount"=>"4.95", "id"=>"bda69263-a166-20a6-bfc5-234f8596eb8d", "payment_date"=>"2013-03-13T10:12:14Z", "payment_type_id"=>"1", "retailer_payment_type_id"=>"a58d10ac-8b10-11e2-b1f5-4040782fde00"}], "register_sale_products"=>[{"id"=>"f10c6d69-d2b6-d954-ea0c-f065b28bd303", "price"=>"4.95000", "price_set"=>"0", "price_total"=>"4.95", "product_id"=>"a5550505-8b10-11e2-b1f5-4040782fde00", "quantity"=>"1", "tax"=>"0.00000", "tax_id"=>"2b12e79e-714e-11df-b0bf-4040f540b50a", "tax_name"=>"No Tax", "tax_rate"=>"0.000000", "tax_total"=>"0"}], "sale_date"=>"2013-03-13T10:12:15Z", "short_code"=>"zmi1y8", "status"=>"CLOSED", "totals"=>{"total_payment"=>"4.95", "total_price"=>"4.95", "total_tax"=>"0", "total_to_pay"=>"0"}, "updated_at"=>"2013-03-13 10:12:17", "user"=>{"created_at"=>"2013-03-12 12:30:38", "display_name"=>"A cashier", "id"=>"a5952c31-8b10-11e2-b1f5-4040782fde00", "name"=>"itdept@crossroads.org.hk", "updated_at"=>"2013-03-12 12:30:38"}, "user_id"=>"a5952c31-8b10-11e2-b1f5-4040782fde00"}}
  [1m[36mAccount Load (0.5ms)[0m  [1mSELECT "accounts".* FROM "accounts" WHERE "accounts"."cf_vend_customer_id" = 'a3ccb1a1-8bc3-11e2-b1f5-4040782fde00' LIMIT 1[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36m (1.6ms)[0m  [1mSELECT "tags".id FROM "tags" INNER JOIN "taggings" ON "tags"."id" = "taggings"."tag_id" WHERE "taggings"."taggable_id" IS NULL AND "taggings"."taggable_type" = 'Account' AND (taggings.context = 'tags')[0m
  [1m[35mFieldGroup Load (0.5ms)[0m  SELECT "field_groups".* FROM "field_groups" WHERE "field_groups"."klass_name" = 'Account' AND (tag_id IS NULL OR tag_id IN (NULL)) ORDER BY position
  [1m[36mAccount Exists (0.4ms)[0m  [1mSELECT 1 AS one FROM "accounts" WHERE ("accounts"."name" = 'Account for Register Sale 6' AND "accounts"."deleted_at" IS NULL) LIMIT 1[0m
  [1m[35mSQL (1.6ms)[0m  INSERT INTO "accounts" ("access", "assigned_to", "background_info", "category", "cf_vend_customer_id", "created_at", "deleted_at", "email", "fax", "name", "phone", "rating", "subscribed_users", "toll_free_phone", "updated_at", "user_id", "website") VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9, $10, $11, $12, $13, $14, $15, $16, $17) RETURNING "id"  [["access", "Public"], ["assigned_to", nil], ["background_info", nil], ["category", nil], ["cf_vend_customer_id", "a3ccb1a1-8bc3-11e2-b1f5-4040782fde00"], ["created_at", Wed, 13 Mar 2013 10:19:05 UTC +00:00], ["deleted_at", nil], ["email", nil], ["fax", nil], ["name", "Account for Register Sale 6"], ["phone", nil], ["rating", 0], ["subscribed_users", nil], ["toll_free_phone", nil], ["updated_at", Wed, 13 Mar 2013 10:19:05 UTC +00:00], ["user_id", nil], ["website", nil]]
  [1m[36mSQL (1.1ms)[0m  [1mINSERT INTO "versions" ("created_at", "event", "item_id", "item_type", "object", "object_changes", "related_id", "related_type", "whodunnit") VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9) RETURNING "id"[0m  [["created_at", Wed, 13 Mar 2013 10:19:05 UTC +00:00], ["event", "create"], ["item_id", 1], ["item_type", "Account"], ["object", nil], ["object_changes", "--- !map:ActiveSupport::HashWithIndifferentAccess \nname: \n- \"\"\n- Account for Register Sale 6\ncf_vend_customer_id: \n- \n- a3ccb1a1-8bc3-11e2-b1f5-4040782fde00\ncreated_at: \n- \n- &id001 2013-03-13 10:19:05.021051 Z\nupdated_at: \n- \n- *id001\nid: \n- \n- 1\n"], ["related_id", nil], ["related_type", nil], ["whodunnit", nil]]
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36m (0.2ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35m (0.5ms)[0m  SELECT "tags".id FROM "tags" INNER JOIN "taggings" ON "tags"."id" = "taggings"."tag_id" WHERE "taggings"."taggable_id" IS NULL AND "taggings"."taggable_type" = 'Opportunity' AND (taggings.context = 'tags')
  [1m[36mFieldGroup Load (0.2ms)[0m  [1mSELECT "field_groups".* FROM "field_groups" WHERE "field_groups"."klass_name" = 'Opportunity' AND (tag_id IS NULL OR tag_id IN (NULL)) ORDER BY position[0m
  [1m[35mSQL (1.3ms)[0m  INSERT INTO "opportunities" ("access", "amount", "assigned_to", "background_info", "campaign_id", "closes_on", "created_at", "deleted_at", "discount", "name", "probability", "source", "stage", "subscribed_users", "updated_at", "user_id") VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9, $10, $11, $12, $13, $14, $15, $16) RETURNING "id"  [["access", "Public"], ["amount", #<BigDecimal:7fd786b23418,'0.495E1',18(18)>], ["assigned_to", nil], ["background_info", nil], ["campaign_id", nil], ["closes_on", nil], ["created_at", Wed, 13 Mar 2013 10:19:05 UTC +00:00], ["deleted_at", nil], ["discount", nil], ["name", "Register Sale 6"], ["probability", nil], ["source", nil], ["stage", "won"], ["subscribed_users", nil], ["updated_at", Wed, 13 Mar 2013 10:19:05 UTC +00:00], ["user_id", nil]]
  [1m[36mSQL (0.5ms)[0m  [1mINSERT INTO "versions" ("created_at", "event", "item_id", "item_type", "object", "object_changes", "related_id", "related_type", "whodunnit") VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9) RETURNING "id"[0m  [["created_at", Wed, 13 Mar 2013 10:19:05 UTC +00:00], ["event", "create"], ["item_id", 1], ["item_type", "Opportunity"], ["object", nil], ["object_changes", "--- !map:ActiveSupport::HashWithIndifferentAccess \nname: \n- \"\"\n- Register Sale 6\namount: \n- \n- 4.95\nstage: \n- \n- won\ncreated_at: \n- \n- &id001 2013-03-13 10:19:05.138773 Z\nupdated_at: \n- \n- *id001\nid: \n- \n- 1\n"], ["related_id", nil], ["related_type", nil], ["whodunnit", nil]]
  [1m[35m (0.2ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36m (0.2ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mSQL (1.0ms)[0m  INSERT INTO "account_opportunities" ("account_id", "created_at", "deleted_at", "opportunity_id", "updated_at") VALUES ($1, $2, $3, $4, $5) RETURNING "id"  [["account_id", 1], ["created_at", Wed, 13 Mar 2013 10:19:05 UTC +00:00], ["deleted_at", nil], ["opportunity_id", 1], ["updated_at", Wed, 13 Mar 2013 10:19:05 UTC +00:00]]
  [1m[36mSQL (0.4ms)[0m  [1mINSERT INTO "versions" ("created_at", "event", "item_id", "item_type", "object", "object_changes", "related_id", "related_type", "whodunnit") VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9) RETURNING "id"[0m  [["created_at", Wed, 13 Mar 2013 10:19:05 UTC +00:00], ["event", "create"], ["item_id", 1], ["item_type", "AccountOpportunity"], ["object", nil], ["object_changes", "--- !map:ActiveSupport::HashWithIndifferentAccess \naccount_id: \n- \n- 1\nopportunity_id: \n- \n- 1\ncreated_at: \n- \n- &id001 2013-03-13 10:19:05.170264 Z\nupdated_at: \n- \n- *id001\nid: \n- \n- 1\n"], ["related_id", nil], ["related_type", nil], ["whodunnit", nil]]
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36mUser Load (0.9ms)[0m  [1mSELECT "users".* FROM "users" WHERE "users"."email" = 'marketplace@crossroads.org.hk' LIMIT 1[0m
  [1m[35m (0.2ms)[0m  SAVEPOINT active_record_1
  [1m[36mUser Exists (0.4ms)[0m  [1mSELECT 1 AS one FROM "users" WHERE "users"."email" = 'marketplace@crossroads.org.hk' LIMIT 1[0m
  [1m[35mUser Exists (0.4ms)[0m  SELECT 1 AS one FROM "users" WHERE "users"."username" = '' LIMIT 1
  [1m[36mUser Exists (0.3ms)[0m  [1mSELECT 1 AS one FROM "users" WHERE "users"."persistence_token" = '99ef137d435ae76d8add33a0adb986aed5219319416aaeb7b22472eea096bfc50bb3e070078fcb7b9c1a8c7d9f6ad5d3315bfdfc2e2e5e291027314802472419' LIMIT 1[0m
  [1m[35mUser Exists (0.3ms)[0m  SELECT 1 AS one FROM "users" WHERE "users"."single_access_token" = 'cWzaNfdzeVQ5wdrYei' LIMIT 1
  [1m[36m (0.1ms)[0m  [1mROLLBACK TO SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mOpportunity Load (0.4ms)[0m  [1mSELECT "opportunities".* FROM "opportunities" WHERE "opportunities"."id" = 1 LIMIT 1[0m
  [1m[35mCACHE (0.0ms)[0m  SELECT 1 AS one FROM "users" WHERE "users"."email" = 'marketplace@crossroads.org.hk' LIMIT 1
  [1m[36mCACHE (0.0ms)[0m  [1mSELECT 1 AS one FROM "users" WHERE "users"."username" = '' LIMIT 1[0m
  [1m[35mCACHE (0.0ms)[0m  SELECT 1 AS one FROM "users" WHERE "users"."persistence_token" = '99ef137d435ae76d8add33a0adb986aed5219319416aaeb7b22472eea096bfc50bb3e070078fcb7b9c1a8c7d9f6ad5d3315bfdfc2e2e5e291027314802472419' LIMIT 1
  [1m[36mCACHE (0.0ms)[0m  [1mSELECT 1 AS one FROM "users" WHERE "users"."single_access_token" = 'cWzaNfdzeVQ5wdrYei' LIMIT 1[0m
  [1m[35mSQL (1.1ms)[0m  INSERT INTO "comments" ("comment", "commentable_id", "commentable_type", "created_at", "private", "state", "title", "updated_at", "user_id") VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9) RETURNING "id"  [["comment", "https://globalhandicrafts.vendhq.com/sale/d66f205d-147e-bec6-29fd-72ec60104b0c"], ["commentable_id", 1], ["commentable_type", "Opportunity"], ["created_at", Wed, 13 Mar 2013 10:19:05 UTC +00:00], ["private", nil], ["state", "Expanded"], ["title", ""], ["updated_at", Wed, 13 Mar 2013 10:19:05 UTC +00:00], ["user_id", nil]]
  [1m[36mSQL (0.4ms)[0m  [1mINSERT INTO "versions" ("created_at", "event", "item_id", "item_type", "object", "object_changes", "related_id", "related_type", "whodunnit") VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9) RETURNING "id"[0m  [["created_at", Wed, 13 Mar 2013 10:19:05 UTC +00:00], ["event", "create"], ["item_id", 1], ["item_type", "Comment"], ["object", nil], ["object_changes", "--- !map:ActiveSupport::HashWithIndifferentAccess \ncomment: \n- \n- https://globalhandicrafts.vendhq.com/sale/d66f205d-147e-bec6-29fd-72ec60104b0c\ncommentable_id: \n- \n- 1\ncommentable_type: \n- \n- Opportunity\ncreated_at: \n- \n- &id001 2013-03-13 10:19:05.304785 Z\nupdated_at: \n- \n- *id001\nid: \n- \n- 1\n"], ["related_id", 1], ["related_type", "Opportunity"], ["whodunnit", nil]]
  [1m[35m (0.4ms)[0m  SELECT "tags".id FROM "tags" INNER JOIN "taggings" ON "tags"."id" = "taggings"."tag_id" WHERE "taggings"."taggable_id" = 1 AND "taggings"."taggable_type" = 'Opportunity' AND (taggings.context = 'tags')
  [1m[36mFieldGroup Load (0.3ms)[0m  [1mSELECT "field_groups".* FROM "field_groups" WHERE "field_groups"."klass_name" = 'Opportunity' AND (tag_id IS NULL OR tag_id IN (NULL)) ORDER BY position[0m
  [1m[35mOpportunity Load (0.5ms)[0m  SELECT "opportunities".* FROM "opportunities" WHERE "opportunities"."id" = $1 LIMIT 1  [["id", 1]]
  [1m[36m (0.4ms)[0m  [1mUPDATE "opportunities" SET "updated_at" = '2013-03-13 10:19:05.316032', "subscribed_users" = '--- !ruby/object:Set 
hash: 
 ~: true
' WHERE "opportunities"."id" = 1[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
Completed 201 Created in 448ms (Views: 0.2ms | ActiveRecord: 0.0ms)
  [1m[36m (0.4ms)[0m  [1mSELECT COUNT(*) FROM "accounts" [0m
  [1m[35m (0.3ms)[0m  SELECT COUNT(*) FROM "accounts" 
Started POST "/vend/register_sale" for 127.0.0.1 at 2013-03-13 23:19:05 +1300
Processing by VendController#register_sale as JSON
  Parameters: {"payload"=>{"created_at"=>"2013-03-13 10:12:17", "customer"=>{"balance"=>"0.000", "contact_first_name"=>"Bob", "contact_last_name"=>"Waikakte", "created_at"=>"2013-03-13 09:51:55", "custom_field_1"=>"", "custom_field_2"=>"", "custom_field_3"=>"", "custom_field_4"=>"", "customer_code"=>"Bob-4QTY", "id"=>"a3ccb1a1-8bc3-11e2-b1f5-4040782fde00", "note"=>"", "points"=>"0", "sex"=>"M", "updated_at"=>"2013-03-13 10:11:53", "year_to_date"=>"18.90000"}, "customer_id"=>"a3ccb1a1-8bc3-11e2-b1f5-4040782fde00", "id"=>"d66f205d-147e-bec6-29fd-72ec60104b0c", "invoice_number"=>"6", "market_id"=>"3", "register_id"=>"a5834e96-8b10-11e2-b1f5-4040782fde00", "register_sale_payments"=>[{"amount"=>"4.95", "id"=>"bda69263-a166-20a6-bfc5-234f8596eb8d", "payment_date"=>"2013-03-13T10:12:14Z", "payment_type_id"=>"1", "retailer_payment_type_id"=>"a58d10ac-8b10-11e2-b1f5-4040782fde00"}], "register_sale_products"=>[{"id"=>"f10c6d69-d2b6-d954-ea0c-f065b28bd303", "price"=>"4.95000", "price_set"=>"0", "price_total"=>"4.95", "product_id"=>"a5550505-8b10-11e2-b1f5-4040782fde00", "quantity"=>"1", "tax"=>"0.00000", "tax_id"=>"2b12e79e-714e-11df-b0bf-4040f540b50a", "tax_name"=>"No Tax", "tax_rate"=>"0.000000", "tax_total"=>"0"}], "sale_date"=>"2013-03-13T10:12:15Z", "short_code"=>"zmi1y8", "status"=>"CLOSED", "totals"=>{"total_payment"=>"4.95", "total_price"=>"4.95", "total_tax"=>"0", "total_to_pay"=>"0"}, "updated_at"=>"2013-03-13 10:12:17", "user"=>{"created_at"=>"2013-03-12 12:30:38", "display_name"=>"A cashier", "id"=>"a5952c31-8b10-11e2-b1f5-4040782fde00", "name"=>"itdept@crossroads.org.hk", "updated_at"=>"2013-03-12 12:30:38"}, "user_id"=>"a5952c31-8b10-11e2-b1f5-4040782fde00"}}
  [1m[36mAccount Load (0.4ms)[0m  [1mSELECT "accounts".* FROM "accounts" WHERE "accounts"."cf_vend_customer_id" = 'a3ccb1a1-8bc3-11e2-b1f5-4040782fde00' LIMIT 1[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36m (0.4ms)[0m  [1mSELECT "tags".id FROM "tags" INNER JOIN "taggings" ON "tags"."id" = "taggings"."tag_id" WHERE "taggings"."taggable_id" IS NULL AND "taggings"."taggable_type" = 'Opportunity' AND (taggings.context = 'tags')[0m
  [1m[35mFieldGroup Load (0.3ms)[0m  SELECT "field_groups".* FROM "field_groups" WHERE "field_groups"."klass_name" = 'Opportunity' AND (tag_id IS NULL OR tag_id IN (NULL)) ORDER BY position
  [1m[36mSQL (0.6ms)[0m  [1mINSERT INTO "opportunities" ("access", "amount", "assigned_to", "background_info", "campaign_id", "closes_on", "created_at", "deleted_at", "discount", "name", "probability", "source", "stage", "subscribed_users", "updated_at", "user_id") VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9, $10, $11, $12, $13, $14, $15, $16) RETURNING "id"[0m  [["access", "Public"], ["amount", #<BigDecimal:7fd78781c200,'0.495E1',18(18)>], ["assigned_to", nil], ["background_info", nil], ["campaign_id", nil], ["closes_on", nil], ["created_at", Wed, 13 Mar 2013 10:19:05 UTC +00:00], ["deleted_at", nil], ["discount", nil], ["name", "Register Sale 6"], ["probability", nil], ["source", nil], ["stage", "won"], ["subscribed_users", nil], ["updated_at", Wed, 13 Mar 2013 10:19:05 UTC +00:00], ["user_id", nil]]
  [1m[35mSQL (0.4ms)[0m  INSERT INTO "versions" ("created_at", "event", "item_id", "item_type", "object", "object_changes", "related_id", "related_type", "whodunnit") VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9) RETURNING "id"  [["created_at", Wed, 13 Mar 2013 10:19:05 UTC +00:00], ["event", "create"], ["item_id", 2], ["item_type", "Opportunity"], ["object", nil], ["object_changes", "--- !map:ActiveSupport::HashWithIndifferentAccess \nname: \n- \"\"\n- Register Sale 6\namount: \n- \n- 4.95\nstage: \n- \n- won\ncreated_at: \n- \n- &id001 2013-03-13 10:19:05.351867 Z\nupdated_at: \n- \n- *id001\nid: \n- \n- 2\n"], ["related_id", nil], ["related_type", nil], ["whodunnit", nil]]
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mSQL (0.4ms)[0m  [1mINSERT INTO "account_opportunities" ("account_id", "created_at", "deleted_at", "opportunity_id", "updated_at") VALUES ($1, $2, $3, $4, $5) RETURNING "id"[0m  [["account_id", 1], ["created_at", Wed, 13 Mar 2013 10:19:05 UTC +00:00], ["deleted_at", nil], ["opportunity_id", 2], ["updated_at", Wed, 13 Mar 2013 10:19:05 UTC +00:00]]
  [1m[35mSQL (0.5ms)[0m  INSERT INTO "versions" ("created_at", "event", "item_id", "item_type", "object", "object_changes", "related_id", "related_type", "whodunnit") VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9) RETURNING "id"  [["created_at", Wed, 13 Mar 2013 10:19:05 UTC +00:00], ["event", "create"], ["item_id", 2], ["item_type", "AccountOpportunity"], ["object", nil], ["object_changes", "--- !map:ActiveSupport::HashWithIndifferentAccess \naccount_id: \n- \n- 1\nopportunity_id: \n- \n- 2\ncreated_at: \n- \n- &id001 2013-03-13 10:19:05.359041 Z\nupdated_at: \n- \n- *id001\nid: \n- \n- 2\n"], ["related_id", nil], ["related_type", nil], ["whodunnit", nil]]
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35mUser Load (0.4ms)[0m  SELECT "users".* FROM "users" WHERE "users"."email" = 'marketplace@crossroads.org.hk' LIMIT 1
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mUser Exists (0.2ms)[0m  SELECT 1 AS one FROM "users" WHERE "users"."email" = 'marketplace@crossroads.org.hk' LIMIT 1
  [1m[36mUser Exists (0.3ms)[0m  [1mSELECT 1 AS one FROM "users" WHERE "users"."username" = '' LIMIT 1[0m
  [1m[35mUser Exists (0.3ms)[0m  SELECT 1 AS one FROM "users" WHERE "users"."persistence_token" = 'd2892ba663e70b44f49935438f69379b2703dc906c70873d8c2280a4de9559162d01e1d61f3e89ec9d3e7d59a6bb3d0c85d40a0cc59b7d92d6880e1663ed78a5' LIMIT 1
  [1m[36mUser Exists (0.3ms)[0m  [1mSELECT 1 AS one FROM "users" WHERE "users"."single_access_token" = 'Q7jmf3D6v44OLIiPt0ka' LIMIT 1[0m
  [1m[35m (0.1ms)[0m  ROLLBACK TO SAVEPOINT active_record_1
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mOpportunity Load (0.4ms)[0m  SELECT "opportunities".* FROM "opportunities" WHERE "opportunities"."id" = 2 LIMIT 1
  [1m[36mCACHE (0.0ms)[0m  [1mSELECT 1 AS one FROM "users" WHERE "users"."email" = 'marketplace@crossroads.org.hk' LIMIT 1[0m
  [1m[35mCACHE (0.0ms)[0m  SELECT 1 AS one FROM "users" WHERE "users"."username" = '' LIMIT 1
  [1m[36mCACHE (0.0ms)[0m  [1mSELECT 1 AS one FROM "users" WHERE "users"."persistence_token" = 'd2892ba663e70b44f49935438f69379b2703dc906c70873d8c2280a4de9559162d01e1d61f3e89ec9d3e7d59a6bb3d0c85d40a0cc59b7d92d6880e1663ed78a5' LIMIT 1[0m
  [1m[35mCACHE (0.0ms)[0m  SELECT 1 AS one FROM "users" WHERE "users"."single_access_token" = 'Q7jmf3D6v44OLIiPt0ka' LIMIT 1
  [1m[36mSQL (0.5ms)[0m  [1mINSERT INTO "comments" ("comment", "commentable_id", "commentable_type", "created_at", "private", "state", "title", "updated_at", "user_id") VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9) RETURNING "id"[0m  [["comment", "https://globalhandicrafts.vendhq.com/sale/d66f205d-147e-bec6-29fd-72ec60104b0c"], ["commentable_id", 2], ["commentable_type", "Opportunity"], ["created_at", Wed, 13 Mar 2013 10:19:05 UTC +00:00], ["private", nil], ["state", "Expanded"], ["title", ""], ["updated_at", Wed, 13 Mar 2013 10:19:05 UTC +00:00], ["user_id", nil]]
  [1m[35mSQL (0.4ms)[0m  INSERT INTO "versions" ("created_at", "event", "item_id", "item_type", "object", "object_changes", "related_id", "related_type", "whodunnit") VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9) RETURNING "id"  [["created_at", Wed, 13 Mar 2013 10:19:05 UTC +00:00], ["event", "create"], ["item_id", 2], ["item_type", "Comment"], ["object", nil], ["object_changes", "--- !map:ActiveSupport::HashWithIndifferentAccess \ncomment: \n- \n- https://globalhandicrafts.vendhq.com/sale/d66f205d-147e-bec6-29fd-72ec60104b0c\ncommentable_id: \n- \n- 2\ncommentable_type: \n- \n- Opportunity\ncreated_at: \n- \n- &id001 2013-03-13 10:19:05.380831 Z\nupdated_at: \n- \n- *id001\nid: \n- \n- 2\n"], ["related_id", 2], ["related_type", "Opportunity"], ["whodunnit", nil]]
  [1m[36m (0.4ms)[0m  [1mSELECT "tags".id FROM "tags" INNER JOIN "taggings" ON "tags"."id" = "taggings"."tag_id" WHERE "taggings"."taggable_id" = 2 AND "taggings"."taggable_type" = 'Opportunity' AND (taggings.context = 'tags')[0m
  [1m[35mFieldGroup Load (0.3ms)[0m  SELECT "field_groups".* FROM "field_groups" WHERE "field_groups"."klass_name" = 'Opportunity' AND (tag_id IS NULL OR tag_id IN (NULL)) ORDER BY position
  [1m[36mOpportunity Load (0.3ms)[0m  [1mSELECT "opportunities".* FROM "opportunities" WHERE "opportunities"."id" = $1 LIMIT 1[0m  [["id", 2]]
  [1m[35m (0.3ms)[0m  UPDATE "opportunities" SET "updated_at" = '2013-03-13 10:19:05.389554', "subscribed_users" = '--- !ruby/object:Set 
hash: 
 ~: true
' WHERE "opportunities"."id" = 2
  [1m[36m (0.2ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
Completed 201 Created in 47ms (Views: 0.1ms | ActiveRecord: 0.0ms)
  [1m[35m (0.3ms)[0m  SELECT COUNT(*) FROM "accounts" 
  [1m[36mOpportunity Load (0.3ms)[0m  [1mSELECT "opportunities".* FROM "opportunities" ORDER BY "opportunities"."id" DESC LIMIT 1[0m
  [1m[35m (0.7ms)[0m  ROLLBACK
  [1m[36m (0.1ms)[0m  [1mBEGIN[0m
  [1m[35m (0.1ms)[0m  ROLLBACK
Connecting to database specified by database.yml
  [1m[36mFieldGroup Load (0.8ms)[0m  [1mSELECT "field_groups".* FROM "field_groups" WHERE "field_groups"."klass_name" = 'Account' ORDER BY position[0m
  [1m[35mFieldGroup Load (0.2ms)[0m  SELECT "field_groups".* FROM "field_groups" WHERE "field_groups"."klass_name" = 'Campaign' ORDER BY position
  [1m[36mFieldGroup Load (0.3ms)[0m  [1mSELECT "field_groups".* FROM "field_groups" WHERE "field_groups"."klass_name" = 'Contact' ORDER BY position[0m
  [1m[35mFieldGroup Load (0.3ms)[0m  SELECT "field_groups".* FROM "field_groups" WHERE "field_groups"."klass_name" = 'Lead' ORDER BY position
  [1m[36mFieldGroup Load (0.2ms)[0m  [1mSELECT "field_groups".* FROM "field_groups" WHERE "field_groups"."klass_name" = 'Opportunity' ORDER BY position[0m
  [1m[35mFieldGroup Load (0.2ms)[0m  SELECT "field_groups".* FROM "field_groups" WHERE "field_groups"."klass_name" = 'Task' ORDER BY position
Creating scope :except. Overwriting existing method User.except.
  [1m[36m (125.1ms)[0m  [1mDROP DATABASE IF EXISTS "ffcrm_vend_test"[0m
  [1m[35m (246.8ms)[0m  CREATE DATABASE "ffcrm_vend_test" ENCODING = 'utf8'
  [1m[36m (5.4ms)[0m  [1mCREATE TABLE "account_contacts" ("id" serial primary key, "account_id" integer, "contact_id" integer, "deleted_at" timestamp, "created_at" timestamp NOT NULL, "updated_at" timestamp NOT NULL) [0m
  [1m[35m (3.0ms)[0m  CREATE TABLE "account_opportunities" ("id" serial primary key, "account_id" integer, "opportunity_id" integer, "deleted_at" timestamp, "created_at" timestamp NOT NULL, "updated_at" timestamp NOT NULL) 
  [1m[36m (5.0ms)[0m  [1mCREATE TABLE "accounts" ("id" serial primary key, "user_id" integer, "assigned_to" integer, "name" character varying(64) DEFAULT '' NOT NULL, "access" character varying(8) DEFAULT 'Public', "website" character varying(64), "toll_free_phone" character varying(32), "phone" character varying(32), "fax" character varying(32), "deleted_at" timestamp, "created_at" timestamp NOT NULL, "updated_at" timestamp NOT NULL, "email" character varying(64), "background_info" character varying(255), "rating" integer DEFAULT 0 NOT NULL, "category" character varying(32), "subscribed_users" text, "cf_vend_customer_id" character varying(255)) [0m
  [1m[35m (1.3ms)[0m  CREATE INDEX "index_accounts_on_assigned_to" ON "accounts" ("assigned_to")
  [1m[36m (2.1ms)[0m  [1mCREATE UNIQUE INDEX "index_accounts_on_user_id_and_name_and_deleted_at" ON "accounts" ("user_id", "name", "deleted_at")[0m
  [1m[35m (5.1ms)[0m  CREATE TABLE "activities" ("id" serial primary key, "user_id" integer, "subject_id" integer, "subject_type" character varying(255), "action" character varying(32) DEFAULT 'created', "info" character varying(255) DEFAULT '', "private" boolean DEFAULT 'f', "created_at" timestamp NOT NULL, "updated_at" timestamp NOT NULL) 
  [1m[36m (1.2ms)[0m  [1mCREATE INDEX "index_activities_on_created_at" ON "activities" ("created_at")[0m
  [1m[35m (1.2ms)[0m  CREATE INDEX "index_activities_on_user_id" ON "activities" ("user_id")
  [1m[36m (3.7ms)[0m  [1mCREATE TABLE "addresses" ("id" serial primary key, "street1" character varying(255), "street2" character varying(255), "city" character varying(64), "state" character varying(64), "zipcode" character varying(16), "country" character varying(64), "full_address" character varying(255), "address_type" character varying(16), "addressable_id" integer, "addressable_type" character varying(255), "created_at" timestamp NOT NULL, "updated_at" timestamp NOT NULL, "deleted_at" timestamp) [0m
  [1m[35m (1.2ms)[0m  CREATE INDEX "index_addresses_on_addressable_id_and_addressable_type" ON "addresses" ("addressable_id", "addressable_type")
  [1m[36m (4.4ms)[0m  [1mCREATE TABLE "avatars" ("id" serial primary key, "user_id" integer, "entity_id" integer, "entity_type" character varying(255), "image_file_size" integer, "image_file_name" character varying(255), "image_content_type" character varying(255), "created_at" timestamp NOT NULL, "updated_at" timestamp NOT NULL) [0m
  [1m[35m (5.1ms)[0m  CREATE TABLE "campaigns" ("id" serial primary key, "user_id" integer, "assigned_to" integer, "name" character varying(64) DEFAULT '' NOT NULL, "access" character varying(8) DEFAULT 'Public', "status" character varying(64), "budget" decimal(12,2), "target_leads" integer, "target_conversion" float, "target_revenue" decimal(12,2), "leads_count" integer, "opportunities_count" integer, "revenue" decimal(12,2), "starts_on" date, "ends_on" date, "objectives" text, "deleted_at" timestamp, "created_at" timestamp NOT NULL, "updated_at" timestamp NOT NULL, "background_info" character varying(255), "subscribed_users" text) 
  [1m[36m (1.0ms)[0m  [1mCREATE INDEX "index_campaigns_on_assigned_to" ON "campaigns" ("assigned_to")[0m
  [1m[35m (1.1ms)[0m  CREATE UNIQUE INDEX "index_campaigns_on_user_id_and_name_and_deleted_at" ON "campaigns" ("user_id", "name", "deleted_at")
  [1m[36m (4.2ms)[0m  [1mCREATE TABLE "comments" ("id" serial primary key, "user_id" integer, "commentable_id" integer, "commentable_type" character varying(255), "private" boolean, "title" character varying(255) DEFAULT '', "comment" text, "created_at" timestamp NOT NULL, "updated_at" timestamp NOT NULL, "state" character varying(16) DEFAULT 'Expanded' NOT NULL) [0m
  [1m[35m (2.4ms)[0m  CREATE TABLE "contact_opportunities" ("id" serial primary key, "contact_id" integer, "opportunity_id" integer, "role" character varying(32), "deleted_at" timestamp, "created_at" timestamp NOT NULL, "updated_at" timestamp NOT NULL) 
  [1m[36m (4.7ms)[0m  [1mCREATE TABLE "contacts" ("id" serial primary key, "user_id" integer, "lead_id" integer, "assigned_to" integer, "reports_to" integer, "first_name" character varying(64) DEFAULT '' NOT NULL, "last_name" character varying(64) DEFAULT '' NOT NULL, "access" character varying(8) DEFAULT 'Public', "title" character varying(64), "department" character varying(64), "source" character varying(32), "email" character varying(64), "alt_email" character varying(64), "phone" character varying(32), "mobile" character varying(32), "fax" character varying(32), "blog" character varying(128), "linkedin" character varying(128), "facebook" character varying(128), "twitter" character varying(128), "born_on" date, "do_not_call" boolean DEFAULT 'f' NOT NULL, "deleted_at" timestamp, "created_at" timestamp NOT NULL, "updated_at" timestamp NOT NULL, "background_info" character varying(255), "skype" character varying(128), "subscribed_users" text) [0m
  [1m[35m (1.0ms)[0m  CREATE INDEX "index_contacts_on_assigned_to" ON "contacts" ("assigned_to")
  [1m[36m (1.2ms)[0m  [1mCREATE UNIQUE INDEX "id_last_name_deleted" ON "contacts" ("user_id", "last_name", "deleted_at")[0m
  [1m[35m (4.3ms)[0m  CREATE TABLE "emails" ("id" serial primary key, "imap_message_id" character varying(255) NOT NULL, "user_id" integer, "mediator_id" integer, "mediator_type" character varying(255), "sent_from" character varying(255) NOT NULL, "sent_to" character varying(255) NOT NULL, "cc" character varying(255), "bcc" character varying(255), "subject" character varying(255), "body" text, "header" text, "sent_at" timestamp, "received_at" timestamp, "deleted_at" timestamp, "created_at" timestamp NOT NULL, "updated_at" timestamp NOT NULL, "state" character varying(16) DEFAULT 'Expanded' NOT NULL) 
  [1m[36m (1.0ms)[0m  [1mCREATE INDEX "index_emails_on_mediator_id_and_mediator_type" ON "emails" ("mediator_id", "mediator_type")[0m
  [1m[35m (2.4ms)[0m  CREATE TABLE "field_groups" ("id" serial primary key, "name" character varying(64), "label" character varying(128), "position" integer, "hint" character varying(255), "created_at" timestamp NOT NULL, "updated_at" timestamp NOT NULL, "tag_id" integer, "klass_name" character varying(32)) 
  [1m[36m (3.5ms)[0m  [1mCREATE TABLE "fields" ("id" serial primary key, "type" character varying(255), "field_group_id" integer, "position" integer, "name" character varying(64), "label" character varying(128), "hint" character varying(255), "placeholder" character varying(255), "as" character varying(32), "collection" text, "disabled" boolean, "required" boolean, "maxlength" integer, "created_at" timestamp NOT NULL, "updated_at" timestamp NOT NULL) [0m
  [1m[35m (1.1ms)[0m  CREATE INDEX "index_fields_on_field_group_id" ON "fields" ("field_group_id")
  [1m[36m (1.0ms)[0m  [1mCREATE INDEX "index_fields_on_name" ON "fields" ("name")[0m
  [1m[35m (4.6ms)[0m  CREATE TABLE "leads" ("id" serial primary key, "user_id" integer, "campaign_id" integer, "assigned_to" integer, "first_name" character varying(64) DEFAULT '' NOT NULL, "last_name" character varying(64) DEFAULT '' NOT NULL, "access" character varying(8) DEFAULT 'Public', "title" character varying(64), "company" character varying(64), "source" character varying(32), "status" character varying(32), "referred_by" character varying(64), "email" character varying(64), "alt_email" character varying(64), "phone" character varying(32), "mobile" character varying(32), "blog" character varying(128), "linkedin" character varying(128), "facebook" character varying(128), "twitter" character varying(128), "rating" integer DEFAULT 0 NOT NULL, "do_not_call" boolean DEFAULT 'f' NOT NULL, "deleted_at" timestamp, "created_at" timestamp NOT NULL, "updated_at" timestamp NOT NULL, "background_info" character varying(255), "skype" character varying(128), "subscribed_users" text) 
  [1m[36m (1.2ms)[0m  [1mCREATE INDEX "index_leads_on_assigned_to" ON "leads" ("assigned_to")[0m
  [1m[35m (1.1ms)[0m  CREATE UNIQUE INDEX "index_leads_on_user_id_and_last_name_and_deleted_at" ON "leads" ("user_id", "last_name", "deleted_at")
  [1m[36m (3.6ms)[0m  [1mCREATE TABLE "lists" ("id" serial primary key, "name" character varying(255), "url" text, "created_at" timestamp NOT NULL, "updated_at" timestamp NOT NULL) [0m
  [1m[35m (3.9ms)[0m  CREATE TABLE "opportunities" ("id" serial primary key, "user_id" integer, "campaign_id" integer, "assigned_to" integer, "name" character varying(64) DEFAULT '' NOT NULL, "access" character varying(8) DEFAULT 'Public', "source" character varying(32), "stage" character varying(32), "probability" integer, "amount" decimal(12,2), "discount" decimal(12,2), "closes_on" date, "deleted_at" timestamp, "created_at" timestamp NOT NULL, "updated_at" timestamp NOT NULL, "background_info" character varying(255), "subscribed_users" text) 
  [1m[36m (1.2ms)[0m  [1mCREATE INDEX "index_opportunities_on_assigned_to" ON "opportunities" ("assigned_to")[0m
  [1m[35m (1.0ms)[0m  CREATE UNIQUE INDEX "id_name_deleted" ON "opportunities" ("user_id", "name", "deleted_at")
  [1m[36m (2.5ms)[0m  [1mCREATE TABLE "permissions" ("id" serial primary key, "user_id" integer, "asset_id" integer, "asset_type" character varying(255), "created_at" timestamp NOT NULL, "updated_at" timestamp NOT NULL) [0m
  [1m[35m (1.2ms)[0m  CREATE INDEX "index_permissions_on_asset_id_and_asset_type" ON "permissions" ("asset_id", "asset_type")
  [1m[36m (1.0ms)[0m  [1mCREATE INDEX "index_permissions_on_user_id" ON "permissions" ("user_id")[0m
  [1m[35m (4.4ms)[0m  CREATE TABLE "preferences" ("id" serial primary key, "user_id" integer, "name" character varying(32) DEFAULT '' NOT NULL, "value" text, "created_at" timestamp NOT NULL, "updated_at" timestamp NOT NULL) 
  [1m[36m (1.1ms)[0m  [1mCREATE INDEX "index_preferences_on_user_id_and_name" ON "preferences" ("user_id", "name")[0m
  [1m[35m (3.6ms)[0m  CREATE TABLE "sessions" ("id" serial primary key, "session_id" character varying(255) NOT NULL, "data" text, "created_at" timestamp NOT NULL, "updated_at" timestamp NOT NULL) 
  [1m[36m (1.1ms)[0m  [1mCREATE INDEX "index_sessions_on_session_id" ON "sessions" ("session_id")[0m
  [1m[35m (0.9ms)[0m  CREATE INDEX "index_sessions_on_updated_at" ON "sessions" ("updated_at")
  [1m[36m (3.9ms)[0m  [1mCREATE TABLE "settings" ("id" serial primary key, "name" character varying(32) DEFAULT '' NOT NULL, "value" text, "created_at" timestamp NOT NULL, "updated_at" timestamp NOT NULL) [0m
  [1m[35m (1.3ms)[0m  CREATE INDEX "index_settings_on_name" ON "settings" ("name")
  [1m[36m (3.7ms)[0m  [1mCREATE TABLE "taggings" ("id" serial primary key, "tag_id" integer, "taggable_id" integer, "tagger_id" integer, "tagger_type" character varying(255), "taggable_type" character varying(255), "context" character varying(255), "created_at" timestamp) [0m
  [1m[35m (1.0ms)[0m  CREATE INDEX "index_taggings_on_tag_id" ON "taggings" ("tag_id")
  [1m[36m (1.1ms)[0m  [1mCREATE INDEX "index_taggings_on_taggable_id_and_taggable_type_and_context" ON "taggings" ("taggable_id", "taggable_type", "context")[0m
  [1m[35m (2.4ms)[0m  CREATE TABLE "tags" ("id" serial primary key, "name" character varying(255)) 
  [1m[36m (4.8ms)[0m  [1mCREATE TABLE "tasks" ("id" serial primary key, "user_id" integer, "assigned_to" integer, "completed_by" integer, "name" character varying(255) DEFAULT '' NOT NULL, "asset_id" integer, "asset_type" character varying(255), "priority" character varying(32), "category" character varying(32), "bucket" character varying(32), "due_at" timestamp, "completed_at" timestamp, "deleted_at" timestamp, "created_at" timestamp NOT NULL, "updated_at" timestamp NOT NULL, "background_info" character varying(255), "subscribed_users" text) [0m
  [1m[35m (0.9ms)[0m  CREATE INDEX "index_tasks_on_assigned_to" ON "tasks" ("assigned_to")
  [1m[36m (1.4ms)[0m  [1mCREATE UNIQUE INDEX "index_tasks_on_user_id_and_name_and_deleted_at" ON "tasks" ("user_id", "name", "deleted_at")[0m
  [1m[35m (5.0ms)[0m  CREATE TABLE "users" ("id" serial primary key, "username" character varying(32) DEFAULT '' NOT NULL, "email" character varying(64) DEFAULT '' NOT NULL, "first_name" character varying(32), "last_name" character varying(32), "title" character varying(64), "company" character varying(64), "alt_email" character varying(64), "phone" character varying(32), "mobile" character varying(32), "aim" character varying(32), "yahoo" character varying(32), "google" character varying(32), "skype" character varying(32), "password_hash" character varying(255) DEFAULT '' NOT NULL, "password_salt" character varying(255) DEFAULT '' NOT NULL, "persistence_token" character varying(255) DEFAULT '' NOT NULL, "perishable_token" character varying(255) DEFAULT '' NOT NULL, "last_request_at" timestamp, "last_login_at" timestamp, "current_login_at" timestamp, "last_login_ip" character varying(255), "current_login_ip" character varying(255), "login_count" integer DEFAULT 0 NOT NULL, "deleted_at" timestamp, "created_at" timestamp NOT NULL, "updated_at" timestamp NOT NULL, "admin" boolean DEFAULT 'f' NOT NULL, "suspended_at" timestamp, "single_access_token" character varying(255)) 
  [1m[36m (1.0ms)[0m  [1mCREATE INDEX "index_users_on_email" ON "users" ("email")[0m
  [1m[35m (0.9ms)[0m  CREATE INDEX "index_users_on_last_request_at" ON "users" ("last_request_at")
  [1m[36m (1.0ms)[0m  [1mCREATE INDEX "index_users_on_perishable_token" ON "users" ("perishable_token")[0m
  [1m[35m (1.1ms)[0m  CREATE INDEX "index_users_on_remember_token" ON "users" ("persistence_token")
  [1m[36m (1.1ms)[0m  [1mCREATE UNIQUE INDEX "index_users_on_username_and_deleted_at" ON "users" ("username", "deleted_at")[0m
  [1m[35m (3.4ms)[0m  CREATE TABLE "versions" ("id" serial primary key, "item_type" character varying(255) NOT NULL, "item_id" integer NOT NULL, "event" character varying(512) NOT NULL, "whodunnit" character varying(255), "object" text, "created_at" timestamp, "object_changes" text, "related_id" integer, "related_type" character varying(255)) 
  [1m[36m (1.1ms)[0m  [1mCREATE INDEX "index_versions_on_item_type_and_item_id" ON "versions" ("item_type", "item_id")[0m
  [1m[35m (1.2ms)[0m  CREATE INDEX "index_versions_on_whodunnit" ON "versions" ("whodunnit")
  [1m[36m (1.1ms)[0m  [1mCREATE TABLE "schema_migrations" ("version" character varying(255) NOT NULL) [0m
  [1m[35m (1.1ms)[0m  CREATE UNIQUE INDEX "unique_schema_migrations" ON "schema_migrations" ("version")
  [1m[36m (0.3ms)[0m  [1mSELECT version FROM "schema_migrations"[0m
  [1m[35m (0.6ms)[0m  INSERT INTO "schema_migrations" (version) VALUES ('20120528102124')
  [1m[36m (0.2ms)[0m  [1mBEGIN[0m
  [1m[35m (0.5ms)[0m  SELECT COUNT(*) FROM "accounts" 
Started POST "/vend/register_sale" for 127.0.0.1 at 2013-03-13 23:20:12 +1300
Processing by VendController#register_sale as JSON
  Parameters: {"payload"=>{"created_at"=>"2013-03-13 10:12:17", "customer"=>{"balance"=>"0.000", "contact_first_name"=>"Bob", "contact_last_name"=>"Waikakte", "created_at"=>"2013-03-13 09:51:55", "custom_field_1"=>"", "custom_field_2"=>"", "custom_field_3"=>"", "custom_field_4"=>"", "customer_code"=>"Bob-4QTY", "id"=>"a3ccb1a1-8bc3-11e2-b1f5-4040782fde00", "note"=>"", "points"=>"0", "sex"=>"M", "updated_at"=>"2013-03-13 10:11:53", "year_to_date"=>"18.90000"}, "customer_id"=>"a3ccb1a1-8bc3-11e2-b1f5-4040782fde00", "id"=>"d66f205d-147e-bec6-29fd-72ec60104b0c", "invoice_number"=>"6", "market_id"=>"3", "register_id"=>"a5834e96-8b10-11e2-b1f5-4040782fde00", "register_sale_payments"=>[{"amount"=>"4.95", "id"=>"bda69263-a166-20a6-bfc5-234f8596eb8d", "payment_date"=>"2013-03-13T10:12:14Z", "payment_type_id"=>"1", "retailer_payment_type_id"=>"a58d10ac-8b10-11e2-b1f5-4040782fde00"}], "register_sale_products"=>[{"id"=>"f10c6d69-d2b6-d954-ea0c-f065b28bd303", "price"=>"4.95000", "price_set"=>"0", "price_total"=>"4.95", "product_id"=>"a5550505-8b10-11e2-b1f5-4040782fde00", "quantity"=>"1", "tax"=>"0.00000", "tax_id"=>"2b12e79e-714e-11df-b0bf-4040f540b50a", "tax_name"=>"No Tax", "tax_rate"=>"0.000000", "tax_total"=>"0"}], "sale_date"=>"2013-03-13T10:12:15Z", "short_code"=>"zmi1y8", "status"=>"CLOSED", "totals"=>{"total_payment"=>"4.95", "total_price"=>"4.95", "total_tax"=>"0", "total_to_pay"=>"0"}, "updated_at"=>"2013-03-13 10:12:17", "user"=>{"created_at"=>"2013-03-12 12:30:38", "display_name"=>"A cashier", "id"=>"a5952c31-8b10-11e2-b1f5-4040782fde00", "name"=>"itdept@crossroads.org.hk", "updated_at"=>"2013-03-12 12:30:38"}, "user_id"=>"a5952c31-8b10-11e2-b1f5-4040782fde00"}}
  [1m[36mAccount Load (0.6ms)[0m  [1mSELECT "accounts".* FROM "accounts" WHERE "accounts"."cf_vend_customer_id" = 'a3ccb1a1-8bc3-11e2-b1f5-4040782fde00' LIMIT 1[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36m (0.8ms)[0m  [1mSELECT "tags".id FROM "tags" INNER JOIN "taggings" ON "tags"."id" = "taggings"."tag_id" WHERE "taggings"."taggable_id" IS NULL AND "taggings"."taggable_type" = 'Account' AND (taggings.context = 'tags')[0m
  [1m[35mFieldGroup Load (0.5ms)[0m  SELECT "field_groups".* FROM "field_groups" WHERE "field_groups"."klass_name" = 'Account' AND (tag_id IS NULL OR tag_id IN (NULL)) ORDER BY position
  [1m[36mAccount Exists (0.4ms)[0m  [1mSELECT 1 AS one FROM "accounts" WHERE ("accounts"."name" = 'Account for Register Sale 6' AND "accounts"."deleted_at" IS NULL) LIMIT 1[0m
  [1m[35mSQL (1.2ms)[0m  INSERT INTO "accounts" ("access", "assigned_to", "background_info", "category", "cf_vend_customer_id", "created_at", "deleted_at", "email", "fax", "name", "phone", "rating", "subscribed_users", "toll_free_phone", "updated_at", "user_id", "website") VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9, $10, $11, $12, $13, $14, $15, $16, $17) RETURNING "id"  [["access", "Public"], ["assigned_to", nil], ["background_info", nil], ["category", nil], ["cf_vend_customer_id", "a3ccb1a1-8bc3-11e2-b1f5-4040782fde00"], ["created_at", Wed, 13 Mar 2013 10:20:12 UTC +00:00], ["deleted_at", nil], ["email", nil], ["fax", nil], ["name", "Account for Register Sale 6"], ["phone", nil], ["rating", 0], ["subscribed_users", nil], ["toll_free_phone", nil], ["updated_at", Wed, 13 Mar 2013 10:20:12 UTC +00:00], ["user_id", nil], ["website", nil]]
  [1m[36mSQL (1.3ms)[0m  [1mINSERT INTO "versions" ("created_at", "event", "item_id", "item_type", "object", "object_changes", "related_id", "related_type", "whodunnit") VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9) RETURNING "id"[0m  [["created_at", Wed, 13 Mar 2013 10:20:12 UTC +00:00], ["event", "create"], ["item_id", 1], ["item_type", "Account"], ["object", nil], ["object_changes", "--- !map:ActiveSupport::HashWithIndifferentAccess \nname: \n- \"\"\n- Account for Register Sale 6\ncf_vend_customer_id: \n- \n- a3ccb1a1-8bc3-11e2-b1f5-4040782fde00\ncreated_at: \n- \n- &id001 2013-03-13 10:20:12.268366 Z\nupdated_at: \n- \n- *id001\nid: \n- \n- 1\n"], ["related_id", nil], ["related_type", nil], ["whodunnit", nil]]
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36m (0.2ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35m (0.5ms)[0m  SELECT "tags".id FROM "tags" INNER JOIN "taggings" ON "tags"."id" = "taggings"."tag_id" WHERE "taggings"."taggable_id" IS NULL AND "taggings"."taggable_type" = 'Opportunity' AND (taggings.context = 'tags')
  [1m[36mFieldGroup Load (0.2ms)[0m  [1mSELECT "field_groups".* FROM "field_groups" WHERE "field_groups"."klass_name" = 'Opportunity' AND (tag_id IS NULL OR tag_id IN (NULL)) ORDER BY position[0m
  [1m[35mSQL (1.4ms)[0m  INSERT INTO "opportunities" ("access", "amount", "assigned_to", "background_info", "campaign_id", "closes_on", "created_at", "deleted_at", "discount", "name", "probability", "source", "stage", "subscribed_users", "updated_at", "user_id") VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9, $10, $11, $12, $13, $14, $15, $16) RETURNING "id"  [["access", "Public"], ["amount", #<BigDecimal:7f9eb2e3ed58,'0.495E1',18(18)>], ["assigned_to", nil], ["background_info", nil], ["campaign_id", nil], ["closes_on", nil], ["created_at", Wed, 13 Mar 2013 10:20:12 UTC +00:00], ["deleted_at", nil], ["discount", nil], ["name", "Register Sale 6"], ["probability", nil], ["source", nil], ["stage", "won"], ["subscribed_users", nil], ["updated_at", Wed, 13 Mar 2013 10:20:12 UTC +00:00], ["user_id", nil]]
  [1m[36mSQL (0.6ms)[0m  [1mINSERT INTO "versions" ("created_at", "event", "item_id", "item_type", "object", "object_changes", "related_id", "related_type", "whodunnit") VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9) RETURNING "id"[0m  [["created_at", Wed, 13 Mar 2013 10:20:12 UTC +00:00], ["event", "create"], ["item_id", 1], ["item_type", "Opportunity"], ["object", nil], ["object_changes", "--- !map:ActiveSupport::HashWithIndifferentAccess \nname: \n- \"\"\n- Register Sale 6\namount: \n- \n- 4.95\nstage: \n- \n- won\ncreated_at: \n- \n- &id001 2013-03-13 10:20:12.367178 Z\nupdated_at: \n- \n- *id001\nid: \n- \n- 1\n"], ["related_id", nil], ["related_type", nil], ["whodunnit", nil]]
  [1m[35m (0.2ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mSQL (1.0ms)[0m  INSERT INTO "account_opportunities" ("account_id", "created_at", "deleted_at", "opportunity_id", "updated_at") VALUES ($1, $2, $3, $4, $5) RETURNING "id"  [["account_id", 1], ["created_at", Wed, 13 Mar 2013 10:20:12 UTC +00:00], ["deleted_at", nil], ["opportunity_id", 1], ["updated_at", Wed, 13 Mar 2013 10:20:12 UTC +00:00]]
  [1m[36mSQL (0.4ms)[0m  [1mINSERT INTO "versions" ("created_at", "event", "item_id", "item_type", "object", "object_changes", "related_id", "related_type", "whodunnit") VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9) RETURNING "id"[0m  [["created_at", Wed, 13 Mar 2013 10:20:12 UTC +00:00], ["event", "create"], ["item_id", 1], ["item_type", "AccountOpportunity"], ["object", nil], ["object_changes", "--- !map:ActiveSupport::HashWithIndifferentAccess \naccount_id: \n- \n- 1\nopportunity_id: \n- \n- 1\ncreated_at: \n- \n- &id001 2013-03-13 10:20:12.402998 Z\nupdated_at: \n- \n- *id001\nid: \n- \n- 1\n"], ["related_id", nil], ["related_type", nil], ["whodunnit", nil]]
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36mUser Load (0.7ms)[0m  [1mSELECT "users".* FROM "users" WHERE "users"."email" = 'marketplace@crossroads.org.hk' LIMIT 1[0m
  [1m[35m (0.2ms)[0m  SAVEPOINT active_record_1
  [1m[36mUser Exists (0.4ms)[0m  [1mSELECT 1 AS one FROM "users" WHERE "users"."email" = 'marketplace@crossroads.org.hk' LIMIT 1[0m
  [1m[35mUser Exists (0.4ms)[0m  SELECT 1 AS one FROM "users" WHERE "users"."username" = '' LIMIT 1
  [1m[36mUser Exists (0.2ms)[0m  [1mSELECT 1 AS one FROM "users" WHERE "users"."persistence_token" = '3dca49d6a9a4ee3949df5772cf70c6b222bd5f078f1272d6a18be5c4e86f06552e22d61db348ec91b5be258506225833de3369bb57d392ec7bd0c32a1779c36a' LIMIT 1[0m
  [1m[35mUser Exists (0.2ms)[0m  SELECT 1 AS one FROM "users" WHERE "users"."single_access_token" = 'Jj0TVqbjEBfBcPBRaZJ' LIMIT 1
  [1m[36m (0.1ms)[0m  [1mROLLBACK TO SAVEPOINT active_record_1[0m
  [1m[35m (0.2ms)[0m  SAVEPOINT active_record_1
  [1m[36mOpportunity Load (0.4ms)[0m  [1mSELECT "opportunities".* FROM "opportunities" WHERE "opportunities"."id" = 1 LIMIT 1[0m
  [1m[35mCACHE (0.0ms)[0m  SELECT 1 AS one FROM "users" WHERE "users"."email" = 'marketplace@crossroads.org.hk' LIMIT 1
  [1m[36mCACHE (0.0ms)[0m  [1mSELECT 1 AS one FROM "users" WHERE "users"."username" = '' LIMIT 1[0m
  [1m[35mCACHE (0.0ms)[0m  SELECT 1 AS one FROM "users" WHERE "users"."persistence_token" = '3dca49d6a9a4ee3949df5772cf70c6b222bd5f078f1272d6a18be5c4e86f06552e22d61db348ec91b5be258506225833de3369bb57d392ec7bd0c32a1779c36a' LIMIT 1
  [1m[36mCACHE (0.0ms)[0m  [1mSELECT 1 AS one FROM "users" WHERE "users"."single_access_token" = 'Jj0TVqbjEBfBcPBRaZJ' LIMIT 1[0m
  [1m[35mSQL (1.2ms)[0m  INSERT INTO "comments" ("comment", "commentable_id", "commentable_type", "created_at", "private", "state", "title", "updated_at", "user_id") VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9) RETURNING "id"  [["comment", "https://globalhandicrafts.vendhq.com/sale/d66f205d-147e-bec6-29fd-72ec60104b0c"], ["commentable_id", 1], ["commentable_type", "Opportunity"], ["created_at", Wed, 13 Mar 2013 10:20:12 UTC +00:00], ["private", nil], ["state", "Expanded"], ["title", ""], ["updated_at", Wed, 13 Mar 2013 10:20:12 UTC +00:00], ["user_id", nil]]
  [1m[36mSQL (0.4ms)[0m  [1mINSERT INTO "versions" ("created_at", "event", "item_id", "item_type", "object", "object_changes", "related_id", "related_type", "whodunnit") VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9) RETURNING "id"[0m  [["created_at", Wed, 13 Mar 2013 10:20:12 UTC +00:00], ["event", "create"], ["item_id", 1], ["item_type", "Comment"], ["object", nil], ["object_changes", "--- !map:ActiveSupport::HashWithIndifferentAccess \ncomment: \n- \n- https://globalhandicrafts.vendhq.com/sale/d66f205d-147e-bec6-29fd-72ec60104b0c\ncommentable_id: \n- \n- 1\ncommentable_type: \n- \n- Opportunity\ncreated_at: \n- \n- &id001 2013-03-13 10:20:12.533609 Z\nupdated_at: \n- \n- *id001\nid: \n- \n- 1\n"], ["related_id", 1], ["related_type", "Opportunity"], ["whodunnit", nil]]
  [1m[35m (0.4ms)[0m  SELECT "tags".id FROM "tags" INNER JOIN "taggings" ON "tags"."id" = "taggings"."tag_id" WHERE "taggings"."taggable_id" = 1 AND "taggings"."taggable_type" = 'Opportunity' AND (taggings.context = 'tags')
  [1m[36mFieldGroup Load (0.3ms)[0m  [1mSELECT "field_groups".* FROM "field_groups" WHERE "field_groups"."klass_name" = 'Opportunity' AND (tag_id IS NULL OR tag_id IN (NULL)) ORDER BY position[0m
  [1m[35mOpportunity Load (0.5ms)[0m  SELECT "opportunities".* FROM "opportunities" WHERE "opportunities"."id" = $1 LIMIT 1  [["id", 1]]
  [1m[36m (0.4ms)[0m  [1mUPDATE "opportunities" SET "updated_at" = '2013-03-13 10:20:12.545667', "subscribed_users" = '--- !ruby/object:Set 
hash: 
 ~: true
' WHERE "opportunities"."id" = 1[0m
  [1m[35m (0.2ms)[0m  RELEASE SAVEPOINT active_record_1
Completed 201 Created in 416ms (Views: 0.2ms | ActiveRecord: 0.0ms)
  [1m[36m (0.4ms)[0m  [1mSELECT COUNT(*) FROM "accounts" [0m
  [1m[35m (0.3ms)[0m  SELECT COUNT(*) FROM "accounts" 
Started POST "/vend/register_sale" for 127.0.0.1 at 2013-03-13 23:20:12 +1300
Processing by VendController#register_sale as JSON
  Parameters: {"payload"=>{"created_at"=>"2013-03-13 10:12:17", "customer"=>{"balance"=>"0.000", "contact_first_name"=>"Bob", "contact_last_name"=>"Waikakte", "created_at"=>"2013-03-13 09:51:55", "custom_field_1"=>"", "custom_field_2"=>"", "custom_field_3"=>"", "custom_field_4"=>"", "customer_code"=>"Bob-4QTY", "id"=>"a3ccb1a1-8bc3-11e2-b1f5-4040782fde00", "note"=>"", "points"=>"0", "sex"=>"M", "updated_at"=>"2013-03-13 10:11:53", "year_to_date"=>"18.90000"}, "customer_id"=>"a3ccb1a1-8bc3-11e2-b1f5-4040782fde00", "id"=>"d66f205d-147e-bec6-29fd-72ec60104b0c", "invoice_number"=>"6", "market_id"=>"3", "register_id"=>"a5834e96-8b10-11e2-b1f5-4040782fde00", "register_sale_payments"=>[{"amount"=>"4.95", "id"=>"bda69263-a166-20a6-bfc5-234f8596eb8d", "payment_date"=>"2013-03-13T10:12:14Z", "payment_type_id"=>"1", "retailer_payment_type_id"=>"a58d10ac-8b10-11e2-b1f5-4040782fde00"}], "register_sale_products"=>[{"id"=>"f10c6d69-d2b6-d954-ea0c-f065b28bd303", "price"=>"4.95000", "price_set"=>"0", "price_total"=>"4.95", "product_id"=>"a5550505-8b10-11e2-b1f5-4040782fde00", "quantity"=>"1", "tax"=>"0.00000", "tax_id"=>"2b12e79e-714e-11df-b0bf-4040f540b50a", "tax_name"=>"No Tax", "tax_rate"=>"0.000000", "tax_total"=>"0"}], "sale_date"=>"2013-03-13T10:12:15Z", "short_code"=>"zmi1y8", "status"=>"CLOSED", "totals"=>{"total_payment"=>"4.95", "total_price"=>"4.95", "total_tax"=>"0", "total_to_pay"=>"0"}, "updated_at"=>"2013-03-13 10:12:17", "user"=>{"created_at"=>"2013-03-12 12:30:38", "display_name"=>"A cashier", "id"=>"a5952c31-8b10-11e2-b1f5-4040782fde00", "name"=>"itdept@crossroads.org.hk", "updated_at"=>"2013-03-12 12:30:38"}, "user_id"=>"a5952c31-8b10-11e2-b1f5-4040782fde00"}}
  [1m[36mAccount Load (0.4ms)[0m  [1mSELECT "accounts".* FROM "accounts" WHERE "accounts"."cf_vend_customer_id" = 'a3ccb1a1-8bc3-11e2-b1f5-4040782fde00' LIMIT 1[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36m (0.4ms)[0m  [1mSELECT "tags".id FROM "tags" INNER JOIN "taggings" ON "tags"."id" = "taggings"."tag_id" WHERE "taggings"."taggable_id" IS NULL AND "taggings"."taggable_type" = 'Opportunity' AND (taggings.context = 'tags')[0m
  [1m[35mFieldGroup Load (0.2ms)[0m  SELECT "field_groups".* FROM "field_groups" WHERE "field_groups"."klass_name" = 'Opportunity' AND (tag_id IS NULL OR tag_id IN (NULL)) ORDER BY position
  [1m[36mSQL (0.5ms)[0m  [1mINSERT INTO "opportunities" ("access", "amount", "assigned_to", "background_info", "campaign_id", "closes_on", "created_at", "deleted_at", "discount", "name", "probability", "source", "stage", "subscribed_users", "updated_at", "user_id") VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9, $10, $11, $12, $13, $14, $15, $16) RETURNING "id"[0m  [["access", "Public"], ["amount", #<BigDecimal:7f9eb67cee88,'0.495E1',18(18)>], ["assigned_to", nil], ["background_info", nil], ["campaign_id", nil], ["closes_on", nil], ["created_at", Wed, 13 Mar 2013 10:20:12 UTC +00:00], ["deleted_at", nil], ["discount", nil], ["name", "Register Sale 6"], ["probability", nil], ["source", nil], ["stage", "won"], ["subscribed_users", nil], ["updated_at", Wed, 13 Mar 2013 10:20:12 UTC +00:00], ["user_id", nil]]
  [1m[35mSQL (0.4ms)[0m  INSERT INTO "versions" ("created_at", "event", "item_id", "item_type", "object", "object_changes", "related_id", "related_type", "whodunnit") VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9) RETURNING "id"  [["created_at", Wed, 13 Mar 2013 10:20:12 UTC +00:00], ["event", "create"], ["item_id", 2], ["item_type", "Opportunity"], ["object", nil], ["object_changes", "--- !map:ActiveSupport::HashWithIndifferentAccess \nname: \n- \"\"\n- Register Sale 6\namount: \n- \n- 4.95\nstage: \n- \n- won\ncreated_at: \n- \n- &id001 2013-03-13 10:20:12.579252 Z\nupdated_at: \n- \n- *id001\nid: \n- \n- 2\n"], ["related_id", nil], ["related_type", nil], ["whodunnit", nil]]
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mSQL (0.3ms)[0m  [1mINSERT INTO "account_opportunities" ("account_id", "created_at", "deleted_at", "opportunity_id", "updated_at") VALUES ($1, $2, $3, $4, $5) RETURNING "id"[0m  [["account_id", 1], ["created_at", Wed, 13 Mar 2013 10:20:12 UTC +00:00], ["deleted_at", nil], ["opportunity_id", 2], ["updated_at", Wed, 13 Mar 2013 10:20:12 UTC +00:00]]
  [1m[35mSQL (0.4ms)[0m  INSERT INTO "versions" ("created_at", "event", "item_id", "item_type", "object", "object_changes", "related_id", "related_type", "whodunnit") VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9) RETURNING "id"  [["created_at", Wed, 13 Mar 2013 10:20:12 UTC +00:00], ["event", "create"], ["item_id", 2], ["item_type", "AccountOpportunity"], ["object", nil], ["object_changes", "--- !map:ActiveSupport::HashWithIndifferentAccess \naccount_id: \n- \n- 1\nopportunity_id: \n- \n- 2\ncreated_at: \n- \n- &id001 2013-03-13 10:20:12.585038 Z\nupdated_at: \n- \n- *id001\nid: \n- \n- 2\n"], ["related_id", nil], ["related_type", nil], ["whodunnit", nil]]
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35mUser Load (0.3ms)[0m  SELECT "users".* FROM "users" WHERE "users"."email" = 'marketplace@crossroads.org.hk' LIMIT 1
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mUser Exists (0.3ms)[0m  SELECT 1 AS one FROM "users" WHERE "users"."email" = 'marketplace@crossroads.org.hk' LIMIT 1
  [1m[36mUser Exists (0.3ms)[0m  [1mSELECT 1 AS one FROM "users" WHERE "users"."username" = '' LIMIT 1[0m
  [1m[35mUser Exists (0.3ms)[0m  SELECT 1 AS one FROM "users" WHERE "users"."persistence_token" = '2802651dd55a0d45f6ecb611eb14e3e8bf5e10283390d80fcc52609562252cd371fb4583372dc63ed292d102e7f355446d74790429ec0b4a3dbe6fa4febc4919' LIMIT 1
  [1m[36mUser Exists (0.2ms)[0m  [1mSELECT 1 AS one FROM "users" WHERE "users"."single_access_token" = 'Ll4OTjqstnHhU72w0q6' LIMIT 1[0m
  [1m[35m (0.1ms)[0m  ROLLBACK TO SAVEPOINT active_record_1
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mOpportunity Load (0.3ms)[0m  SELECT "opportunities".* FROM "opportunities" WHERE "opportunities"."id" = 2 LIMIT 1
  [1m[36mCACHE (0.0ms)[0m  [1mSELECT 1 AS one FROM "users" WHERE "users"."email" = 'marketplace@crossroads.org.hk' LIMIT 1[0m
  [1m[35mCACHE (0.0ms)[0m  SELECT 1 AS one FROM "users" WHERE "users"."username" = '' LIMIT 1
  [1m[36mCACHE (0.0ms)[0m  [1mSELECT 1 AS one FROM "users" WHERE "users"."persistence_token" = '2802651dd55a0d45f6ecb611eb14e3e8bf5e10283390d80fcc52609562252cd371fb4583372dc63ed292d102e7f355446d74790429ec0b4a3dbe6fa4febc4919' LIMIT 1[0m
  [1m[35mCACHE (0.0ms)[0m  SELECT 1 AS one FROM "users" WHERE "users"."single_access_token" = 'Ll4OTjqstnHhU72w0q6' LIMIT 1
  [1m[36mSQL (0.4ms)[0m  [1mINSERT INTO "comments" ("comment", "commentable_id", "commentable_type", "created_at", "private", "state", "title", "updated_at", "user_id") VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9) RETURNING "id"[0m  [["comment", "https://globalhandicrafts.vendhq.com/sale/d66f205d-147e-bec6-29fd-72ec60104b0c"], ["commentable_id", 2], ["commentable_type", "Opportunity"], ["created_at", Wed, 13 Mar 2013 10:20:12 UTC +00:00], ["private", nil], ["state", "Expanded"], ["title", ""], ["updated_at", Wed, 13 Mar 2013 10:20:12 UTC +00:00], ["user_id", nil]]
  [1m[35mSQL (0.5ms)[0m  INSERT INTO "versions" ("created_at", "event", "item_id", "item_type", "object", "object_changes", "related_id", "related_type", "whodunnit") VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9) RETURNING "id"  [["created_at", Wed, 13 Mar 2013 10:20:12 UTC +00:00], ["event", "create"], ["item_id", 2], ["item_type", "Comment"], ["object", nil], ["object_changes", "--- !map:ActiveSupport::HashWithIndifferentAccess \ncomment: \n- \n- https://globalhandicrafts.vendhq.com/sale/d66f205d-147e-bec6-29fd-72ec60104b0c\ncommentable_id: \n- \n- 2\ncommentable_type: \n- \n- Opportunity\ncreated_at: \n- \n- &id001 2013-03-13 10:20:12.602028 Z\nupdated_at: \n- \n- *id001\nid: \n- \n- 2\n"], ["related_id", 2], ["related_type", "Opportunity"], ["whodunnit", nil]]
  [1m[36m (0.4ms)[0m  [1mSELECT "tags".id FROM "tags" INNER JOIN "taggings" ON "tags"."id" = "taggings"."tag_id" WHERE "taggings"."taggable_id" = 2 AND "taggings"."taggable_type" = 'Opportunity' AND (taggings.context = 'tags')[0m
  [1m[35mFieldGroup Load (0.2ms)[0m  SELECT "field_groups".* FROM "field_groups" WHERE "field_groups"."klass_name" = 'Opportunity' AND (tag_id IS NULL OR tag_id IN (NULL)) ORDER BY position
  [1m[36mOpportunity Load (0.3ms)[0m  [1mSELECT "opportunities".* FROM "opportunities" WHERE "opportunities"."id" = $1 LIMIT 1[0m  [["id", 2]]
  [1m[35m (0.3ms)[0m  UPDATE "opportunities" SET "updated_at" = '2013-03-13 10:20:12.612159', "subscribed_users" = '--- !ruby/object:Set 
hash: 
 ~: true
' WHERE "opportunities"."id" = 2
  [1m[36m (0.2ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
Completed 201 Created in 42ms (Views: 0.1ms | ActiveRecord: 0.0ms)
  [1m[35m (0.3ms)[0m  SELECT COUNT(*) FROM "accounts" 
  [1m[36mOpportunity Load (0.3ms)[0m  [1mSELECT "opportunities".* FROM "opportunities" ORDER BY "opportunities"."id" DESC LIMIT 1[0m
  [1m[35mComment Load (0.5ms)[0m  SELECT "comments".* FROM "comments" WHERE "comments"."commentable_id" = 2 AND "comments"."commentable_type" = 'Opportunity' LIMIT 1
  [1m[36m (0.6ms)[0m  [1mROLLBACK[0m
  [1m[35m (0.1ms)[0m  BEGIN
  [1m[36m (0.1ms)[0m  [1mROLLBACK[0m
Connecting to database specified by database.yml
  [1m[36mFieldGroup Load (0.9ms)[0m  [1mSELECT "field_groups".* FROM "field_groups" WHERE "field_groups"."klass_name" = 'Account' ORDER BY position[0m
  [1m[35mFieldGroup Load (0.3ms)[0m  SELECT "field_groups".* FROM "field_groups" WHERE "field_groups"."klass_name" = 'Campaign' ORDER BY position
  [1m[36mFieldGroup Load (0.3ms)[0m  [1mSELECT "field_groups".* FROM "field_groups" WHERE "field_groups"."klass_name" = 'Contact' ORDER BY position[0m
  [1m[35mFieldGroup Load (0.3ms)[0m  SELECT "field_groups".* FROM "field_groups" WHERE "field_groups"."klass_name" = 'Lead' ORDER BY position
  [1m[36mFieldGroup Load (0.3ms)[0m  [1mSELECT "field_groups".* FROM "field_groups" WHERE "field_groups"."klass_name" = 'Opportunity' ORDER BY position[0m
  [1m[35mFieldGroup Load (0.3ms)[0m  SELECT "field_groups".* FROM "field_groups" WHERE "field_groups"."klass_name" = 'Task' ORDER BY position
Creating scope :except. Overwriting existing method User.except.
  [1m[36m (119.5ms)[0m  [1mDROP DATABASE IF EXISTS "ffcrm_vend_test"[0m
  [1m[35m (244.5ms)[0m  CREATE DATABASE "ffcrm_vend_test" ENCODING = 'utf8'
  [1m[36m (5.4ms)[0m  [1mCREATE TABLE "account_contacts" ("id" serial primary key, "account_id" integer, "contact_id" integer, "deleted_at" timestamp, "created_at" timestamp NOT NULL, "updated_at" timestamp NOT NULL) [0m
  [1m[35m (2.3ms)[0m  CREATE TABLE "account_opportunities" ("id" serial primary key, "account_id" integer, "opportunity_id" integer, "deleted_at" timestamp, "created_at" timestamp NOT NULL, "updated_at" timestamp NOT NULL) 
  [1m[36m (3.8ms)[0m  [1mCREATE TABLE "accounts" ("id" serial primary key, "user_id" integer, "assigned_to" integer, "name" character varying(64) DEFAULT '' NOT NULL, "access" character varying(8) DEFAULT 'Public', "website" character varying(64), "toll_free_phone" character varying(32), "phone" character varying(32), "fax" character varying(32), "deleted_at" timestamp, "created_at" timestamp NOT NULL, "updated_at" timestamp NOT NULL, "email" character varying(64), "background_info" character varying(255), "rating" integer DEFAULT 0 NOT NULL, "category" character varying(32), "subscribed_users" text, "cf_vend_customer_id" character varying(255)) [0m
  [1m[35m (1.2ms)[0m  CREATE INDEX "index_accounts_on_assigned_to" ON "accounts" ("assigned_to")
  [1m[36m (1.5ms)[0m  [1mCREATE UNIQUE INDEX "index_accounts_on_user_id_and_name_and_deleted_at" ON "accounts" ("user_id", "name", "deleted_at")[0m
  [1m[35m (4.7ms)[0m  CREATE TABLE "activities" ("id" serial primary key, "user_id" integer, "subject_id" integer, "subject_type" character varying(255), "action" character varying(32) DEFAULT 'created', "info" character varying(255) DEFAULT '', "private" boolean DEFAULT 'f', "created_at" timestamp NOT NULL, "updated_at" timestamp NOT NULL) 
  [1m[36m (1.1ms)[0m  [1mCREATE INDEX "index_activities_on_created_at" ON "activities" ("created_at")[0m
  [1m[35m (0.9ms)[0m  CREATE INDEX "index_activities_on_user_id" ON "activities" ("user_id")
  [1m[36m (3.0ms)[0m  [1mCREATE TABLE "addresses" ("id" serial primary key, "street1" character varying(255), "street2" character varying(255), "city" character varying(64), "state" character varying(64), "zipcode" character varying(16), "country" character varying(64), "full_address" character varying(255), "address_type" character varying(16), "addressable_id" integer, "addressable_type" character varying(255), "created_at" timestamp NOT NULL, "updated_at" timestamp NOT NULL, "deleted_at" timestamp) [0m
  [1m[35m (1.3ms)[0m  CREATE INDEX "index_addresses_on_addressable_id_and_addressable_type" ON "addresses" ("addressable_id", "addressable_type")
  [1m[36m (3.6ms)[0m  [1mCREATE TABLE "avatars" ("id" serial primary key, "user_id" integer, "entity_id" integer, "entity_type" character varying(255), "image_file_size" integer, "image_file_name" character varying(255), "image_content_type" character varying(255), "created_at" timestamp NOT NULL, "updated_at" timestamp NOT NULL) [0m
  [1m[35m (4.3ms)[0m  CREATE TABLE "campaigns" ("id" serial primary key, "user_id" integer, "assigned_to" integer, "name" character varying(64) DEFAULT '' NOT NULL, "access" character varying(8) DEFAULT 'Public', "status" character varying(64), "budget" decimal(12,2), "target_leads" integer, "target_conversion" float, "target_revenue" decimal(12,2), "leads_count" integer, "opportunities_count" integer, "revenue" decimal(12,2), "starts_on" date, "ends_on" date, "objectives" text, "deleted_at" timestamp, "created_at" timestamp NOT NULL, "updated_at" timestamp NOT NULL, "background_info" character varying(255), "subscribed_users" text) 
  [1m[36m (0.9ms)[0m  [1mCREATE INDEX "index_campaigns_on_assigned_to" ON "campaigns" ("assigned_to")[0m
  [1m[35m (1.1ms)[0m  CREATE UNIQUE INDEX "index_campaigns_on_user_id_and_name_and_deleted_at" ON "campaigns" ("user_id", "name", "deleted_at")
  [1m[36m (4.0ms)[0m  [1mCREATE TABLE "comments" ("id" serial primary key, "user_id" integer, "commentable_id" integer, "commentable_type" character varying(255), "private" boolean, "title" character varying(255) DEFAULT '', "comment" text, "created_at" timestamp NOT NULL, "updated_at" timestamp NOT NULL, "state" character varying(16) DEFAULT 'Expanded' NOT NULL) [0m
  [1m[35m (2.3ms)[0m  CREATE TABLE "contact_opportunities" ("id" serial primary key, "contact_id" integer, "opportunity_id" integer, "role" character varying(32), "deleted_at" timestamp, "created_at" timestamp NOT NULL, "updated_at" timestamp NOT NULL) 
  [1m[36m (4.1ms)[0m  [1mCREATE TABLE "contacts" ("id" serial primary key, "user_id" integer, "lead_id" integer, "assigned_to" integer, "reports_to" integer, "first_name" character varying(64) DEFAULT '' NOT NULL, "last_name" character varying(64) DEFAULT '' NOT NULL, "access" character varying(8) DEFAULT 'Public', "title" character varying(64), "department" character varying(64), "source" character varying(32), "email" character varying(64), "alt_email" character varying(64), "phone" character varying(32), "mobile" character varying(32), "fax" character varying(32), "blog" character varying(128), "linkedin" character varying(128), "facebook" character varying(128), "twitter" character varying(128), "born_on" date, "do_not_call" boolean DEFAULT 'f' NOT NULL, "deleted_at" timestamp, "created_at" timestamp NOT NULL, "updated_at" timestamp NOT NULL, "background_info" character varying(255), "skype" character varying(128), "subscribed_users" text) [0m
  [1m[35m (1.0ms)[0m  CREATE INDEX "index_contacts_on_assigned_to" ON "contacts" ("assigned_to")
  [1m[36m (1.4ms)[0m  [1mCREATE UNIQUE INDEX "id_last_name_deleted" ON "contacts" ("user_id", "last_name", "deleted_at")[0m
  [1m[35m (3.5ms)[0m  CREATE TABLE "emails" ("id" serial primary key, "imap_message_id" character varying(255) NOT NULL, "user_id" integer, "mediator_id" integer, "mediator_type" character varying(255), "sent_from" character varying(255) NOT NULL, "sent_to" character varying(255) NOT NULL, "cc" character varying(255), "bcc" character varying(255), "subject" character varying(255), "body" text, "header" text, "sent_at" timestamp, "received_at" timestamp, "deleted_at" timestamp, "created_at" timestamp NOT NULL, "updated_at" timestamp NOT NULL, "state" character varying(16) DEFAULT 'Expanded' NOT NULL) 
  [1m[36m (0.9ms)[0m  [1mCREATE INDEX "index_emails_on_mediator_id_and_mediator_type" ON "emails" ("mediator_id", "mediator_type")[0m
  [1m[35m (2.6ms)[0m  CREATE TABLE "field_groups" ("id" serial primary key, "name" character varying(64), "label" character varying(128), "position" integer, "hint" character varying(255), "created_at" timestamp NOT NULL, "updated_at" timestamp NOT NULL, "tag_id" integer, "klass_name" character varying(32)) 
  [1m[36m (3.2ms)[0m  [1mCREATE TABLE "fields" ("id" serial primary key, "type" character varying(255), "field_group_id" integer, "position" integer, "name" character varying(64), "label" character varying(128), "hint" character varying(255), "placeholder" character varying(255), "as" character varying(32), "collection" text, "disabled" boolean, "required" boolean, "maxlength" integer, "created_at" timestamp NOT NULL, "updated_at" timestamp NOT NULL) [0m
  [1m[35m (1.2ms)[0m  CREATE INDEX "index_fields_on_field_group_id" ON "fields" ("field_group_id")
  [1m[36m (1.0ms)[0m  [1mCREATE INDEX "index_fields_on_name" ON "fields" ("name")[0m
  [1m[35m (4.2ms)[0m  CREATE TABLE "leads" ("id" serial primary key, "user_id" integer, "campaign_id" integer, "assigned_to" integer, "first_name" character varying(64) DEFAULT '' NOT NULL, "last_name" character varying(64) DEFAULT '' NOT NULL, "access" character varying(8) DEFAULT 'Public', "title" character varying(64), "company" character varying(64), "source" character varying(32), "status" character varying(32), "referred_by" character varying(64), "email" character varying(64), "alt_email" character varying(64), "phone" character varying(32), "mobile" character varying(32), "blog" character varying(128), "linkedin" character varying(128), "facebook" character varying(128), "twitter" character varying(128), "rating" integer DEFAULT 0 NOT NULL, "do_not_call" boolean DEFAULT 'f' NOT NULL, "deleted_at" timestamp, "created_at" timestamp NOT NULL, "updated_at" timestamp NOT NULL, "background_info" character varying(255), "skype" character varying(128), "subscribed_users" text) 
  [1m[36m (1.0ms)[0m  [1mCREATE INDEX "index_leads_on_assigned_to" ON "leads" ("assigned_to")[0m
  [1m[35m (1.1ms)[0m  CREATE UNIQUE INDEX "index_leads_on_user_id_and_last_name_and_deleted_at" ON "leads" ("user_id", "last_name", "deleted_at")
  [1m[36m (3.0ms)[0m  [1mCREATE TABLE "lists" ("id" serial primary key, "name" character varying(255), "url" text, "created_at" timestamp NOT NULL, "updated_at" timestamp NOT NULL) [0m
  [1m[35m (3.8ms)[0m  CREATE TABLE "opportunities" ("id" serial primary key, "user_id" integer, "campaign_id" integer, "assigned_to" integer, "name" character varying(64) DEFAULT '' NOT NULL, "access" character varying(8) DEFAULT 'Public', "source" character varying(32), "stage" character varying(32), "probability" integer, "amount" decimal(12,2), "discount" decimal(12,2), "closes_on" date, "deleted_at" timestamp, "created_at" timestamp NOT NULL, "updated_at" timestamp NOT NULL, "background_info" character varying(255), "subscribed_users" text) 
  [1m[36m (0.9ms)[0m  [1mCREATE INDEX "index_opportunities_on_assigned_to" ON "opportunities" ("assigned_to")[0m
  [1m[35m (1.1ms)[0m  CREATE UNIQUE INDEX "id_name_deleted" ON "opportunities" ("user_id", "name", "deleted_at")
  [1m[36m (10.9ms)[0m  [1mCREATE TABLE "permissions" ("id" serial primary key, "user_id" integer, "asset_id" integer, "asset_type" character varying(255), "created_at" timestamp NOT NULL, "updated_at" timestamp NOT NULL) [0m
  [1m[35m (9.2ms)[0m  CREATE INDEX "index_permissions_on_asset_id_and_asset_type" ON "permissions" ("asset_id", "asset_type")
  [1m[36m (1.3ms)[0m  [1mCREATE INDEX "index_permissions_on_user_id" ON "permissions" ("user_id")[0m
  [1m[35m (3.3ms)[0m  CREATE TABLE "preferences" ("id" serial primary key, "user_id" integer, "name" character varying(32) DEFAULT '' NOT NULL, "value" text, "created_at" timestamp NOT NULL, "updated_at" timestamp NOT NULL) 
  [1m[36m (0.9ms)[0m  [1mCREATE INDEX "index_preferences_on_user_id_and_name" ON "preferences" ("user_id", "name")[0m
  [1m[35m (3.5ms)[0m  CREATE TABLE "sessions" ("id" serial primary key, "session_id" character varying(255) NOT NULL, "data" text, "created_at" timestamp NOT NULL, "updated_at" timestamp NOT NULL) 
  [1m[36m (0.9ms)[0m  [1mCREATE INDEX "index_sessions_on_session_id" ON "sessions" ("session_id")[0m
  [1m[35m (10.3ms)[0m  CREATE INDEX "index_sessions_on_updated_at" ON "sessions" ("updated_at")
  [1m[36m (10.7ms)[0m  [1mCREATE TABLE "settings" ("id" serial primary key, "name" character varying(32) DEFAULT '' NOT NULL, "value" text, "created_at" timestamp NOT NULL, "updated_at" timestamp NOT NULL) [0m
  [1m[35m (1.0ms)[0m  CREATE INDEX "index_settings_on_name" ON "settings" ("name")
  [1m[36m (3.4ms)[0m  [1mCREATE TABLE "taggings" ("id" serial primary key, "tag_id" integer, "taggable_id" integer, "tagger_id" integer, "tagger_type" character varying(255), "taggable_type" character varying(255), "context" character varying(255), "created_at" timestamp) [0m
  [1m[35m (1.1ms)[0m  CREATE INDEX "index_taggings_on_tag_id" ON "taggings" ("tag_id")
  [1m[36m (1.1ms)[0m  [1mCREATE INDEX "index_taggings_on_taggable_id_and_taggable_type_and_context" ON "taggings" ("taggable_id", "taggable_type", "context")[0m
  [1m[35m (2.1ms)[0m  CREATE TABLE "tags" ("id" serial primary key, "name" character varying(255)) 
  [1m[36m (3.9ms)[0m  [1mCREATE TABLE "tasks" ("id" serial primary key, "user_id" integer, "assigned_to" integer, "completed_by" integer, "name" character varying(255) DEFAULT '' NOT NULL, "asset_id" integer, "asset_type" character varying(255), "priority" character varying(32), "category" character varying(32), "bucket" character varying(32), "due_at" timestamp, "completed_at" timestamp, "deleted_at" timestamp, "created_at" timestamp NOT NULL, "updated_at" timestamp NOT NULL, "background_info" character varying(255), "subscribed_users" text) [0m
  [1m[35m (0.9ms)[0m  CREATE INDEX "index_tasks_on_assigned_to" ON "tasks" ("assigned_to")
  [1m[36m (1.1ms)[0m  [1mCREATE UNIQUE INDEX "index_tasks_on_user_id_and_name_and_deleted_at" ON "tasks" ("user_id", "name", "deleted_at")[0m
  [1m[35m (4.4ms)[0m  CREATE TABLE "users" ("id" serial primary key, "username" character varying(32) DEFAULT '' NOT NULL, "email" character varying(64) DEFAULT '' NOT NULL, "first_name" character varying(32), "last_name" character varying(32), "title" character varying(64), "company" character varying(64), "alt_email" character varying(64), "phone" character varying(32), "mobile" character varying(32), "aim" character varying(32), "yahoo" character varying(32), "google" character varying(32), "skype" character varying(32), "password_hash" character varying(255) DEFAULT '' NOT NULL, "password_salt" character varying(255) DEFAULT '' NOT NULL, "persistence_token" character varying(255) DEFAULT '' NOT NULL, "perishable_token" character varying(255) DEFAULT '' NOT NULL, "last_request_at" timestamp, "last_login_at" timestamp, "current_login_at" timestamp, "last_login_ip" character varying(255), "current_login_ip" character varying(255), "login_count" integer DEFAULT 0 NOT NULL, "deleted_at" timestamp, "created_at" timestamp NOT NULL, "updated_at" timestamp NOT NULL, "admin" boolean DEFAULT 'f' NOT NULL, "suspended_at" timestamp, "single_access_token" character varying(255)) 
  [1m[36m (1.2ms)[0m  [1mCREATE INDEX "index_users_on_email" ON "users" ("email")[0m
  [1m[35m (1.0ms)[0m  CREATE INDEX "index_users_on_last_request_at" ON "users" ("last_request_at")
  [1m[36m (10.8ms)[0m  [1mCREATE INDEX "index_users_on_perishable_token" ON "users" ("perishable_token")[0m
  [1m[35m (8.0ms)[0m  CREATE INDEX "index_users_on_remember_token" ON "users" ("persistence_token")
  [1m[36m (1.7ms)[0m  [1mCREATE UNIQUE INDEX "index_users_on_username_and_deleted_at" ON "users" ("username", "deleted_at")[0m
  [1m[35m (3.1ms)[0m  CREATE TABLE "versions" ("id" serial primary key, "item_type" character varying(255) NOT NULL, "item_id" integer NOT NULL, "event" character varying(512) NOT NULL, "whodunnit" character varying(255), "object" text, "created_at" timestamp, "object_changes" text, "related_id" integer, "related_type" character varying(255)) 
  [1m[36m (1.2ms)[0m  [1mCREATE INDEX "index_versions_on_item_type_and_item_id" ON "versions" ("item_type", "item_id")[0m
  [1m[35m (0.9ms)[0m  CREATE INDEX "index_versions_on_whodunnit" ON "versions" ("whodunnit")
  [1m[36m (0.7ms)[0m  [1mCREATE TABLE "schema_migrations" ("version" character varying(255) NOT NULL) [0m
  [1m[35m (0.9ms)[0m  CREATE UNIQUE INDEX "unique_schema_migrations" ON "schema_migrations" ("version")
  [1m[36m (0.2ms)[0m  [1mSELECT version FROM "schema_migrations"[0m
  [1m[35m (6.4ms)[0m  INSERT INTO "schema_migrations" (version) VALUES ('20120528102124')
  [1m[36m (0.1ms)[0m  [1mBEGIN[0m
  [1m[35m (0.3ms)[0m  ROLLBACK
  [1m[36m (0.1ms)[0m  [1mBEGIN[0m
  [1m[35m (0.5ms)[0m  SELECT COUNT(*) FROM "accounts" 
Started POST "/vend/register_sale" for 127.0.0.1 at 2013-03-13 23:25:39 +1300
Processing by VendController#register_sale as JSON
  Parameters: {"payload"=>{"created_at"=>"2013-03-13 10:12:17", "customer"=>{"balance"=>"0.000", "contact_first_name"=>"Bob", "contact_last_name"=>"Waikakte", "created_at"=>"2013-03-13 09:51:55", "custom_field_1"=>"", "custom_field_2"=>"", "custom_field_3"=>"", "custom_field_4"=>"", "customer_code"=>"Bob-4QTY", "id"=>"a3ccb1a1-8bc3-11e2-b1f5-4040782fde00", "note"=>"", "points"=>"0", "sex"=>"M", "updated_at"=>"2013-03-13 10:11:53", "year_to_date"=>"18.90000"}, "customer_id"=>"a3ccb1a1-8bc3-11e2-b1f5-4040782fde00", "id"=>"d66f205d-147e-bec6-29fd-72ec60104b0c", "invoice_number"=>"6", "market_id"=>"3", "register_id"=>"a5834e96-8b10-11e2-b1f5-4040782fde00", "register_sale_payments"=>[{"amount"=>"4.95", "id"=>"bda69263-a166-20a6-bfc5-234f8596eb8d", "payment_date"=>"2013-03-13T10:12:14Z", "payment_type_id"=>"1", "retailer_payment_type_id"=>"a58d10ac-8b10-11e2-b1f5-4040782fde00"}], "register_sale_products"=>[{"id"=>"f10c6d69-d2b6-d954-ea0c-f065b28bd303", "price"=>"4.95000", "price_set"=>"0", "price_total"=>"4.95", "product_id"=>"a5550505-8b10-11e2-b1f5-4040782fde00", "quantity"=>"1", "tax"=>"0.00000", "tax_id"=>"2b12e79e-714e-11df-b0bf-4040f540b50a", "tax_name"=>"No Tax", "tax_rate"=>"0.000000", "tax_total"=>"0"}], "sale_date"=>"2013-03-13T10:12:15Z", "short_code"=>"zmi1y8", "status"=>"CLOSED", "totals"=>{"total_payment"=>"4.95", "total_price"=>"4.95", "total_tax"=>"0", "total_to_pay"=>"0"}, "updated_at"=>"2013-03-13 10:12:17", "user"=>{"created_at"=>"2013-03-12 12:30:38", "display_name"=>"A cashier", "id"=>"a5952c31-8b10-11e2-b1f5-4040782fde00", "name"=>"itdept@crossroads.org.hk", "updated_at"=>"2013-03-12 12:30:38"}, "user_id"=>"a5952c31-8b10-11e2-b1f5-4040782fde00"}}
  [1m[36mAccount Load (0.5ms)[0m  [1mSELECT "accounts".* FROM "accounts" WHERE "accounts"."cf_vend_customer_id" = 'a3ccb1a1-8bc3-11e2-b1f5-4040782fde00' LIMIT 1[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36m (0.7ms)[0m  [1mSELECT "tags".id FROM "tags" INNER JOIN "taggings" ON "tags"."id" = "taggings"."tag_id" WHERE "taggings"."taggable_id" IS NULL AND "taggings"."taggable_type" = 'Account' AND (taggings.context = 'tags')[0m
  [1m[35mFieldGroup Load (0.8ms)[0m  SELECT "field_groups".* FROM "field_groups" WHERE "field_groups"."klass_name" = 'Account' AND (tag_id IS NULL OR tag_id IN (NULL)) ORDER BY position
  [1m[36mAccount Exists (0.4ms)[0m  [1mSELECT 1 AS one FROM "accounts" WHERE ("accounts"."name" = 'Account for Register Sale 6' AND "accounts"."deleted_at" IS NULL) LIMIT 1[0m
  [1m[35mSQL (1.2ms)[0m  INSERT INTO "accounts" ("access", "assigned_to", "background_info", "category", "cf_vend_customer_id", "created_at", "deleted_at", "email", "fax", "name", "phone", "rating", "subscribed_users", "toll_free_phone", "updated_at", "user_id", "website") VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9, $10, $11, $12, $13, $14, $15, $16, $17) RETURNING "id"  [["access", "Public"], ["assigned_to", nil], ["background_info", nil], ["category", nil], ["cf_vend_customer_id", "a3ccb1a1-8bc3-11e2-b1f5-4040782fde00"], ["created_at", Wed, 13 Mar 2013 10:25:40 UTC +00:00], ["deleted_at", nil], ["email", nil], ["fax", nil], ["name", "Account for Register Sale 6"], ["phone", nil], ["rating", 0], ["subscribed_users", nil], ["toll_free_phone", nil], ["updated_at", Wed, 13 Mar 2013 10:25:40 UTC +00:00], ["user_id", nil], ["website", nil]]
  [1m[36mSQL (2.2ms)[0m  [1mINSERT INTO "versions" ("created_at", "event", "item_id", "item_type", "object", "object_changes", "related_id", "related_type", "whodunnit") VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9) RETURNING "id"[0m  [["created_at", Wed, 13 Mar 2013 10:25:40 UTC +00:00], ["event", "create"], ["item_id", 1], ["item_type", "Account"], ["object", nil], ["object_changes", "--- !map:ActiveSupport::HashWithIndifferentAccess \nname: \n- \"\"\n- Account for Register Sale 6\ncf_vend_customer_id: \n- \n- a3ccb1a1-8bc3-11e2-b1f5-4040782fde00\ncreated_at: \n- \n- &id001 2013-03-13 10:25:40.136347 Z\nupdated_at: \n- \n- *id001\nid: \n- \n- 1\n"], ["related_id", nil], ["related_type", nil], ["whodunnit", nil]]
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36m (0.2ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35m (0.4ms)[0m  SELECT "tags".id FROM "tags" INNER JOIN "taggings" ON "tags"."id" = "taggings"."tag_id" WHERE "taggings"."taggable_id" IS NULL AND "taggings"."taggable_type" = 'Opportunity' AND (taggings.context = 'tags')
  [1m[36mFieldGroup Load (0.3ms)[0m  [1mSELECT "field_groups".* FROM "field_groups" WHERE "field_groups"."klass_name" = 'Opportunity' AND (tag_id IS NULL OR tag_id IN (NULL)) ORDER BY position[0m
  [1m[35mSQL (1.7ms)[0m  INSERT INTO "opportunities" ("access", "amount", "assigned_to", "background_info", "campaign_id", "closes_on", "created_at", "deleted_at", "discount", "name", "probability", "source", "stage", "subscribed_users", "updated_at", "user_id") VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9, $10, $11, $12, $13, $14, $15, $16) RETURNING "id"  [["access", "Public"], ["amount", #<BigDecimal:7f8a63380000,'0.495E1',18(18)>], ["assigned_to", nil], ["background_info", nil], ["campaign_id", nil], ["closes_on", nil], ["created_at", Wed, 13 Mar 2013 10:25:40 UTC +00:00], ["deleted_at", nil], ["discount", nil], ["name", "Register Sale 6"], ["probability", nil], ["source", nil], ["stage", "won"], ["subscribed_users", nil], ["updated_at", Wed, 13 Mar 2013 10:25:40 UTC +00:00], ["user_id", nil]]
  [1m[36mSQL (0.5ms)[0m  [1mINSERT INTO "versions" ("created_at", "event", "item_id", "item_type", "object", "object_changes", "related_id", "related_type", "whodunnit") VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9) RETURNING "id"[0m  [["created_at", Wed, 13 Mar 2013 10:25:40 UTC +00:00], ["event", "create"], ["item_id", 1], ["item_type", "Opportunity"], ["object", nil], ["object_changes", "--- !map:ActiveSupport::HashWithIndifferentAccess \nname: \n- \"\"\n- Register Sale 6\namount: \n- \n- 4.95\nstage: \n- \n- won\ncreated_at: \n- \n- &id001 2013-03-13 10:25:40.237400 Z\nupdated_at: \n- \n- *id001\nid: \n- \n- 1\n"], ["related_id", nil], ["related_type", nil], ["whodunnit", nil]]
  [1m[35m (0.2ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36m (0.2ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mSQL (0.9ms)[0m  INSERT INTO "account_opportunities" ("account_id", "created_at", "deleted_at", "opportunity_id", "updated_at") VALUES ($1, $2, $3, $4, $5) RETURNING "id"  [["account_id", 1], ["created_at", Wed, 13 Mar 2013 10:25:40 UTC +00:00], ["deleted_at", nil], ["opportunity_id", 1], ["updated_at", Wed, 13 Mar 2013 10:25:40 UTC +00:00]]
  [1m[36mSQL (0.4ms)[0m  [1mINSERT INTO "versions" ("created_at", "event", "item_id", "item_type", "object", "object_changes", "related_id", "related_type", "whodunnit") VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9) RETURNING "id"[0m  [["created_at", Wed, 13 Mar 2013 10:25:40 UTC +00:00], ["event", "create"], ["item_id", 1], ["item_type", "AccountOpportunity"], ["object", nil], ["object_changes", "--- !map:ActiveSupport::HashWithIndifferentAccess \naccount_id: \n- \n- 1\nopportunity_id: \n- \n- 1\ncreated_at: \n- \n- &id001 2013-03-13 10:25:40.267487 Z\nupdated_at: \n- \n- *id001\nid: \n- \n- 1\n"], ["related_id", nil], ["related_type", nil], ["whodunnit", nil]]
  [1m[35m (0.2ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36mUser Load (0.9ms)[0m  [1mSELECT "users".* FROM "users" WHERE "users"."email" = 'marketplace@crossroads.org.hk' LIMIT 1[0m
  [1m[35m (0.2ms)[0m  SAVEPOINT active_record_1
  [1m[36mUser Exists (0.4ms)[0m  [1mSELECT 1 AS one FROM "users" WHERE "users"."email" = 'marketplace@crossroads.org.hk' LIMIT 1[0m
  [1m[35mUser Exists (0.3ms)[0m  SELECT 1 AS one FROM "users" WHERE "users"."username" = '' LIMIT 1
  [1m[36mUser Exists (0.3ms)[0m  [1mSELECT 1 AS one FROM "users" WHERE "users"."persistence_token" = '94d216cd4f898080f6a5e779cd288833a77f4e90b20d6a0c4fe194b0e345f01f18ac8d59d70553a01a84dfad3eef78bd2292e5f85a6f372a8cec7a4a8281ca5d' LIMIT 1[0m
  [1m[35mUser Exists (0.3ms)[0m  SELECT 1 AS one FROM "users" WHERE "users"."single_access_token" = 'H9C8NyEgFqipsczSAX' LIMIT 1
  [1m[36m (0.1ms)[0m  [1mROLLBACK TO SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mOpportunity Load (0.5ms)[0m  [1mSELECT "opportunities".* FROM "opportunities" WHERE "opportunities"."id" = 1 LIMIT 1[0m
  [1m[35mCACHE (0.0ms)[0m  SELECT 1 AS one FROM "users" WHERE "users"."email" = 'marketplace@crossroads.org.hk' LIMIT 1
  [1m[36mCACHE (0.0ms)[0m  [1mSELECT 1 AS one FROM "users" WHERE "users"."username" = '' LIMIT 1[0m
  [1m[35mCACHE (0.0ms)[0m  SELECT 1 AS one FROM "users" WHERE "users"."persistence_token" = '94d216cd4f898080f6a5e779cd288833a77f4e90b20d6a0c4fe194b0e345f01f18ac8d59d70553a01a84dfad3eef78bd2292e5f85a6f372a8cec7a4a8281ca5d' LIMIT 1
  [1m[36mCACHE (0.0ms)[0m  [1mSELECT 1 AS one FROM "users" WHERE "users"."single_access_token" = 'H9C8NyEgFqipsczSAX' LIMIT 1[0m
  [1m[35mSQL (1.0ms)[0m  INSERT INTO "comments" ("comment", "commentable_id", "commentable_type", "created_at", "private", "state", "title", "updated_at", "user_id") VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9) RETURNING "id"  [["comment", "https://globalhandicrafts.vendhq.com/sale/d66f205d-147e-bec6-29fd-72ec60104b0c"], ["commentable_id", 1], ["commentable_type", "Opportunity"], ["created_at", Wed, 13 Mar 2013 10:25:40 UTC +00:00], ["private", nil], ["state", "Expanded"], ["title", ""], ["updated_at", Wed, 13 Mar 2013 10:25:40 UTC +00:00], ["user_id", nil]]
  [1m[36mSQL (0.4ms)[0m  [1mINSERT INTO "versions" ("created_at", "event", "item_id", "item_type", "object", "object_changes", "related_id", "related_type", "whodunnit") VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9) RETURNING "id"[0m  [["created_at", Wed, 13 Mar 2013 10:25:40 UTC +00:00], ["event", "create"], ["item_id", 1], ["item_type", "Comment"], ["object", nil], ["object_changes", "--- !map:ActiveSupport::HashWithIndifferentAccess \ncomment: \n- \n- https://globalhandicrafts.vendhq.com/sale/d66f205d-147e-bec6-29fd-72ec60104b0c\ncommentable_id: \n- \n- 1\ncommentable_type: \n- \n- Opportunity\ncreated_at: \n- \n- &id001 2013-03-13 10:25:40.399160 Z\nupdated_at: \n- \n- *id001\nid: \n- \n- 1\n"], ["related_id", 1], ["related_type", "Opportunity"], ["whodunnit", nil]]
  [1m[35m (0.4ms)[0m  SELECT "tags".id FROM "tags" INNER JOIN "taggings" ON "tags"."id" = "taggings"."tag_id" WHERE "taggings"."taggable_id" = 1 AND "taggings"."taggable_type" = 'Opportunity' AND (taggings.context = 'tags')
  [1m[36mFieldGroup Load (0.2ms)[0m  [1mSELECT "field_groups".* FROM "field_groups" WHERE "field_groups"."klass_name" = 'Opportunity' AND (tag_id IS NULL OR tag_id IN (NULL)) ORDER BY position[0m
  [1m[35mOpportunity Load (0.5ms)[0m  SELECT "opportunities".* FROM "opportunities" WHERE "opportunities"."id" = $1 LIMIT 1  [["id", 1]]
  [1m[36m (0.4ms)[0m  [1mUPDATE "opportunities" SET "updated_at" = '2013-03-13 10:25:40.410520', "subscribed_users" = '--- !ruby/object:Set 
hash: 
 ~: true
' WHERE "opportunities"."id" = 1[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
Completed 201 Created in 422ms (Views: 0.2ms | ActiveRecord: 0.0ms)
  [1m[36m (0.4ms)[0m  [1mSELECT COUNT(*) FROM "accounts" [0m
  [1m[35m (0.3ms)[0m  SELECT COUNT(*) FROM "accounts" 
Started POST "/vend/register_sale" for 127.0.0.1 at 2013-03-13 23:25:40 +1300
Processing by VendController#register_sale as JSON
  Parameters: {"payload"=>{"created_at"=>"2013-03-13 10:12:17", "customer"=>{"balance"=>"0.000", "contact_first_name"=>"Bob", "contact_last_name"=>"Waikakte", "created_at"=>"2013-03-13 09:51:55", "custom_field_1"=>"", "custom_field_2"=>"", "custom_field_3"=>"", "custom_field_4"=>"", "customer_code"=>"Bob-4QTY", "id"=>"a3ccb1a1-8bc3-11e2-b1f5-4040782fde00", "note"=>"", "points"=>"0", "sex"=>"M", "updated_at"=>"2013-03-13 10:11:53", "year_to_date"=>"18.90000"}, "customer_id"=>"a3ccb1a1-8bc3-11e2-b1f5-4040782fde00", "id"=>"d66f205d-147e-bec6-29fd-72ec60104b0c", "invoice_number"=>"6", "market_id"=>"3", "register_id"=>"a5834e96-8b10-11e2-b1f5-4040782fde00", "register_sale_payments"=>[{"amount"=>"4.95", "id"=>"bda69263-a166-20a6-bfc5-234f8596eb8d", "payment_date"=>"2013-03-13T10:12:14Z", "payment_type_id"=>"1", "retailer_payment_type_id"=>"a58d10ac-8b10-11e2-b1f5-4040782fde00"}], "register_sale_products"=>[{"id"=>"f10c6d69-d2b6-d954-ea0c-f065b28bd303", "price"=>"4.95000", "price_set"=>"0", "price_total"=>"4.95", "product_id"=>"a5550505-8b10-11e2-b1f5-4040782fde00", "quantity"=>"1", "tax"=>"0.00000", "tax_id"=>"2b12e79e-714e-11df-b0bf-4040f540b50a", "tax_name"=>"No Tax", "tax_rate"=>"0.000000", "tax_total"=>"0"}], "sale_date"=>"2013-03-13T10:12:15Z", "short_code"=>"zmi1y8", "status"=>"CLOSED", "totals"=>{"total_payment"=>"4.95", "total_price"=>"4.95", "total_tax"=>"0", "total_to_pay"=>"0"}, "updated_at"=>"2013-03-13 10:12:17", "user"=>{"created_at"=>"2013-03-12 12:30:38", "display_name"=>"A cashier", "id"=>"a5952c31-8b10-11e2-b1f5-4040782fde00", "name"=>"itdept@crossroads.org.hk", "updated_at"=>"2013-03-12 12:30:38"}, "user_id"=>"a5952c31-8b10-11e2-b1f5-4040782fde00"}}
  [1m[36mAccount Load (0.4ms)[0m  [1mSELECT "accounts".* FROM "accounts" WHERE "accounts"."cf_vend_customer_id" = 'a3ccb1a1-8bc3-11e2-b1f5-4040782fde00' LIMIT 1[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36m (0.4ms)[0m  [1mSELECT "tags".id FROM "tags" INNER JOIN "taggings" ON "tags"."id" = "taggings"."tag_id" WHERE "taggings"."taggable_id" IS NULL AND "taggings"."taggable_type" = 'Opportunity' AND (taggings.context = 'tags')[0m
  [1m[35mFieldGroup Load (0.3ms)[0m  SELECT "field_groups".* FROM "field_groups" WHERE "field_groups"."klass_name" = 'Opportunity' AND (tag_id IS NULL OR tag_id IN (NULL)) ORDER BY position
  [1m[36mSQL (0.5ms)[0m  [1mINSERT INTO "opportunities" ("access", "amount", "assigned_to", "background_info", "campaign_id", "closes_on", "created_at", "deleted_at", "discount", "name", "probability", "source", "stage", "subscribed_users", "updated_at", "user_id") VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9, $10, $11, $12, $13, $14, $15, $16) RETURNING "id"[0m  [["access", "Public"], ["amount", #<BigDecimal:7f8a65f18320,'0.495E1',18(18)>], ["assigned_to", nil], ["background_info", nil], ["campaign_id", nil], ["closes_on", nil], ["created_at", Wed, 13 Mar 2013 10:25:40 UTC +00:00], ["deleted_at", nil], ["discount", nil], ["name", "Register Sale 6"], ["probability", nil], ["source", nil], ["stage", "won"], ["subscribed_users", nil], ["updated_at", Wed, 13 Mar 2013 10:25:40 UTC +00:00], ["user_id", nil]]
  [1m[35mSQL (0.3ms)[0m  INSERT INTO "versions" ("created_at", "event", "item_id", "item_type", "object", "object_changes", "related_id", "related_type", "whodunnit") VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9) RETURNING "id"  [["created_at", Wed, 13 Mar 2013 10:25:40 UTC +00:00], ["event", "create"], ["item_id", 2], ["item_type", "Opportunity"], ["object", nil], ["object_changes", "--- !map:ActiveSupport::HashWithIndifferentAccess \nname: \n- \"\"\n- Register Sale 6\namount: \n- \n- 4.95\nstage: \n- \n- won\ncreated_at: \n- \n- &id001 2013-03-13 10:25:40.443692 Z\nupdated_at: \n- \n- *id001\nid: \n- \n- 2\n"], ["related_id", nil], ["related_type", nil], ["whodunnit", nil]]
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mSQL (0.3ms)[0m  [1mINSERT INTO "account_opportunities" ("account_id", "created_at", "deleted_at", "opportunity_id", "updated_at") VALUES ($1, $2, $3, $4, $5) RETURNING "id"[0m  [["account_id", 1], ["created_at", Wed, 13 Mar 2013 10:25:40 UTC +00:00], ["deleted_at", nil], ["opportunity_id", 2], ["updated_at", Wed, 13 Mar 2013 10:25:40 UTC +00:00]]
  [1m[35mSQL (0.4ms)[0m  INSERT INTO "versions" ("created_at", "event", "item_id", "item_type", "object", "object_changes", "related_id", "related_type", "whodunnit") VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9) RETURNING "id"  [["created_at", Wed, 13 Mar 2013 10:25:40 UTC +00:00], ["event", "create"], ["item_id", 2], ["item_type", "AccountOpportunity"], ["object", nil], ["object_changes", "--- !map:ActiveSupport::HashWithIndifferentAccess \naccount_id: \n- \n- 1\nopportunity_id: \n- \n- 2\ncreated_at: \n- \n- &id001 2013-03-13 10:25:40.449369 Z\nupdated_at: \n- \n- *id001\nid: \n- \n- 2\n"], ["related_id", nil], ["related_type", nil], ["whodunnit", nil]]
  [1m[36m (0.2ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35mUser Load (0.3ms)[0m  SELECT "users".* FROM "users" WHERE "users"."email" = 'marketplace@crossroads.org.hk' LIMIT 1
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mUser Exists (0.4ms)[0m  SELECT 1 AS one FROM "users" WHERE "users"."email" = 'marketplace@crossroads.org.hk' LIMIT 1
  [1m[36mUser Exists (0.3ms)[0m  [1mSELECT 1 AS one FROM "users" WHERE "users"."username" = '' LIMIT 1[0m
  [1m[35mUser Exists (0.3ms)[0m  SELECT 1 AS one FROM "users" WHERE "users"."persistence_token" = 'e0c058dbb2787acd1837cf117edac72f1545d8931b9322f52b3c0290368a7d7b190de7cfe5c927a0e404dfd40e1001e12286ea32495963ebf96b1cae330584bc' LIMIT 1
  [1m[36mUser Exists (0.2ms)[0m  [1mSELECT 1 AS one FROM "users" WHERE "users"."single_access_token" = 'TMFaTehbzFTF9gh2c0Yv' LIMIT 1[0m
  [1m[35m (0.1ms)[0m  ROLLBACK TO SAVEPOINT active_record_1
  [1m[36m (0.0ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mOpportunity Load (0.4ms)[0m  SELECT "opportunities".* FROM "opportunities" WHERE "opportunities"."id" = 2 LIMIT 1
  [1m[36mCACHE (0.0ms)[0m  [1mSELECT 1 AS one FROM "users" WHERE "users"."email" = 'marketplace@crossroads.org.hk' LIMIT 1[0m
  [1m[35mCACHE (0.0ms)[0m  SELECT 1 AS one FROM "users" WHERE "users"."username" = '' LIMIT 1
  [1m[36mCACHE (0.0ms)[0m  [1mSELECT 1 AS one FROM "users" WHERE "users"."persistence_token" = 'e0c058dbb2787acd1837cf117edac72f1545d8931b9322f52b3c0290368a7d7b190de7cfe5c927a0e404dfd40e1001e12286ea32495963ebf96b1cae330584bc' LIMIT 1[0m
  [1m[35mCACHE (0.0ms)[0m  SELECT 1 AS one FROM "users" WHERE "users"."single_access_token" = 'TMFaTehbzFTF9gh2c0Yv' LIMIT 1
  [1m[36mSQL (0.5ms)[0m  [1mINSERT INTO "comments" ("comment", "commentable_id", "commentable_type", "created_at", "private", "state", "title", "updated_at", "user_id") VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9) RETURNING "id"[0m  [["comment", "https://globalhandicrafts.vendhq.com/sale/d66f205d-147e-bec6-29fd-72ec60104b0c"], ["commentable_id", 2], ["commentable_type", "Opportunity"], ["created_at", Wed, 13 Mar 2013 10:25:40 UTC +00:00], ["private", nil], ["state", "Expanded"], ["title", ""], ["updated_at", Wed, 13 Mar 2013 10:25:40 UTC +00:00], ["user_id", nil]]
  [1m[35mSQL (0.4ms)[0m  INSERT INTO "versions" ("created_at", "event", "item_id", "item_type", "object", "object_changes", "related_id", "related_type", "whodunnit") VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9) RETURNING "id"  [["created_at", Wed, 13 Mar 2013 10:25:40 UTC +00:00], ["event", "create"], ["item_id", 2], ["item_type", "Comment"], ["object", nil], ["object_changes", "--- !map:ActiveSupport::HashWithIndifferentAccess \ncomment: \n- \n- https://globalhandicrafts.vendhq.com/sale/d66f205d-147e-bec6-29fd-72ec60104b0c\ncommentable_id: \n- \n- 2\ncommentable_type: \n- \n- Opportunity\ncreated_at: \n- \n- &id001 2013-03-13 10:25:40.466131 Z\nupdated_at: \n- \n- *id001\nid: \n- \n- 2\n"], ["related_id", 2], ["related_type", "Opportunity"], ["whodunnit", nil]]
  [1m[36m (0.4ms)[0m  [1mSELECT "tags".id FROM "tags" INNER JOIN "taggings" ON "tags"."id" = "taggings"."tag_id" WHERE "taggings"."taggable_id" = 2 AND "taggings"."taggable_type" = 'Opportunity' AND (taggings.context = 'tags')[0m
  [1m[35mFieldGroup Load (0.2ms)[0m  SELECT "field_groups".* FROM "field_groups" WHERE "field_groups"."klass_name" = 'Opportunity' AND (tag_id IS NULL OR tag_id IN (NULL)) ORDER BY position
  [1m[36mOpportunity Load (0.4ms)[0m  [1mSELECT "opportunities".* FROM "opportunities" WHERE "opportunities"."id" = $1 LIMIT 1[0m  [["id", 2]]
  [1m[35m (0.3ms)[0m  UPDATE "opportunities" SET "updated_at" = '2013-03-13 10:25:40.474697', "subscribed_users" = '--- !ruby/object:Set 
hash: 
 ~: true
' WHERE "opportunities"."id" = 2
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
Completed 201 Created in 40ms (Views: 0.1ms | ActiveRecord: 0.0ms)
  [1m[35m (0.3ms)[0m  SELECT COUNT(*) FROM "accounts" 
  [1m[36mOpportunity Load (0.4ms)[0m  [1mSELECT "opportunities".* FROM "opportunities" ORDER BY "opportunities"."id" DESC LIMIT 1[0m
  [1m[35mComment Load (0.5ms)[0m  SELECT "comments".* FROM "comments" WHERE "comments"."commentable_id" = 2 AND "comments"."commentable_type" = 'Opportunity' LIMIT 1
  [1m[36m (0.5ms)[0m  [1mROLLBACK[0m
Connecting to database specified by database.yml
  [1m[36mFieldGroup Load (0.9ms)[0m  [1mSELECT "field_groups".* FROM "field_groups" WHERE "field_groups"."klass_name" = 'Account' ORDER BY position[0m
  [1m[35mFieldGroup Load (0.2ms)[0m  SELECT "field_groups".* FROM "field_groups" WHERE "field_groups"."klass_name" = 'Campaign' ORDER BY position
  [1m[36mFieldGroup Load (0.3ms)[0m  [1mSELECT "field_groups".* FROM "field_groups" WHERE "field_groups"."klass_name" = 'Contact' ORDER BY position[0m
  [1m[35mFieldGroup Load (0.2ms)[0m  SELECT "field_groups".* FROM "field_groups" WHERE "field_groups"."klass_name" = 'Lead' ORDER BY position
  [1m[36mFieldGroup Load (0.2ms)[0m  [1mSELECT "field_groups".* FROM "field_groups" WHERE "field_groups"."klass_name" = 'Opportunity' ORDER BY position[0m
  [1m[35mFieldGroup Load (0.3ms)[0m  SELECT "field_groups".* FROM "field_groups" WHERE "field_groups"."klass_name" = 'Task' ORDER BY position
Creating scope :except. Overwriting existing method User.except.
  [1m[36m (121.8ms)[0m  [1mDROP DATABASE IF EXISTS "ffcrm_vend_test"[0m
  [1m[35m (250.1ms)[0m  CREATE DATABASE "ffcrm_vend_test" ENCODING = 'utf8'
  [1m[36m (6.1ms)[0m  [1mCREATE TABLE "account_contacts" ("id" serial primary key, "account_id" integer, "contact_id" integer, "deleted_at" timestamp, "created_at" timestamp NOT NULL, "updated_at" timestamp NOT NULL) [0m
  [1m[35m (2.5ms)[0m  CREATE TABLE "account_opportunities" ("id" serial primary key, "account_id" integer, "opportunity_id" integer, "deleted_at" timestamp, "created_at" timestamp NOT NULL, "updated_at" timestamp NOT NULL) 
  [1m[36m (3.8ms)[0m  [1mCREATE TABLE "accounts" ("id" serial primary key, "user_id" integer, "assigned_to" integer, "name" character varying(64) DEFAULT '' NOT NULL, "access" character varying(8) DEFAULT 'Public', "website" character varying(64), "toll_free_phone" character varying(32), "phone" character varying(32), "fax" character varying(32), "deleted_at" timestamp, "created_at" timestamp NOT NULL, "updated_at" timestamp NOT NULL, "email" character varying(64), "background_info" character varying(255), "rating" integer DEFAULT 0 NOT NULL, "category" character varying(32), "subscribed_users" text, "cf_vend_customer_id" character varying(255)) [0m
  [1m[35m (1.2ms)[0m  CREATE INDEX "index_accounts_on_assigned_to" ON "accounts" ("assigned_to")
  [1m[36m (1.4ms)[0m  [1mCREATE UNIQUE INDEX "index_accounts_on_user_id_and_name_and_deleted_at" ON "accounts" ("user_id", "name", "deleted_at")[0m
  [1m[35m (3.5ms)[0m  CREATE TABLE "activities" ("id" serial primary key, "user_id" integer, "subject_id" integer, "subject_type" character varying(255), "action" character varying(32) DEFAULT 'created', "info" character varying(255) DEFAULT '', "private" boolean DEFAULT 'f', "created_at" timestamp NOT NULL, "updated_at" timestamp NOT NULL) 
  [1m[36m (1.0ms)[0m  [1mCREATE INDEX "index_activities_on_created_at" ON "activities" ("created_at")[0m
  [1m[35m (0.9ms)[0m  CREATE INDEX "index_activities_on_user_id" ON "activities" ("user_id")
  [1m[36m (3.9ms)[0m  [1mCREATE TABLE "addresses" ("id" serial primary key, "street1" character varying(255), "street2" character varying(255), "city" character varying(64), "state" character varying(64), "zipcode" character varying(16), "country" character varying(64), "full_address" character varying(255), "address_type" character varying(16), "addressable_id" integer, "addressable_type" character varying(255), "created_at" timestamp NOT NULL, "updated_at" timestamp NOT NULL, "deleted_at" timestamp) [0m
  [1m[35m (1.1ms)[0m  CREATE INDEX "index_addresses_on_addressable_id_and_addressable_type" ON "addresses" ("addressable_id", "addressable_type")
  [1m[36m (3.3ms)[0m  [1mCREATE TABLE "avatars" ("id" serial primary key, "user_id" integer, "entity_id" integer, "entity_type" character varying(255), "image_file_size" integer, "image_file_name" character varying(255), "image_content_type" character varying(255), "created_at" timestamp NOT NULL, "updated_at" timestamp NOT NULL) [0m
  [1m[35m (3.8ms)[0m  CREATE TABLE "campaigns" ("id" serial primary key, "user_id" integer, "assigned_to" integer, "name" character varying(64) DEFAULT '' NOT NULL, "access" character varying(8) DEFAULT 'Public', "status" character varying(64), "budget" decimal(12,2), "target_leads" integer, "target_conversion" float, "target_revenue" decimal(12,2), "leads_count" integer, "opportunities_count" integer, "revenue" decimal(12,2), "starts_on" date, "ends_on" date, "objectives" text, "deleted_at" timestamp, "created_at" timestamp NOT NULL, "updated_at" timestamp NOT NULL, "background_info" character varying(255), "subscribed_users" text) 
  [1m[36m (1.1ms)[0m  [1mCREATE INDEX "index_campaigns_on_assigned_to" ON "campaigns" ("assigned_to")[0m
  [1m[35m (1.2ms)[0m  CREATE UNIQUE INDEX "index_campaigns_on_user_id_and_name_and_deleted_at" ON "campaigns" ("user_id", "name", "deleted_at")
  [1m[36m (26.4ms)[0m  [1mCREATE TABLE "comments" ("id" serial primary key, "user_id" integer, "commentable_id" integer, "commentable_type" character varying(255), "private" boolean, "title" character varying(255) DEFAULT '', "comment" text, "created_at" timestamp NOT NULL, "updated_at" timestamp NOT NULL, "state" character varying(16) DEFAULT 'Expanded' NOT NULL) [0m
  [1m[35m (2.9ms)[0m  CREATE TABLE "contact_opportunities" ("id" serial primary key, "contact_id" integer, "opportunity_id" integer, "role" character varying(32), "deleted_at" timestamp, "created_at" timestamp NOT NULL, "updated_at" timestamp NOT NULL) 
  [1m[36m (4.1ms)[0m  [1mCREATE TABLE "contacts" ("id" serial primary key, "user_id" integer, "lead_id" integer, "assigned_to" integer, "reports_to" integer, "first_name" character varying(64) DEFAULT '' NOT NULL, "last_name" character varying(64) DEFAULT '' NOT NULL, "access" character varying(8) DEFAULT 'Public', "title" character varying(64), "department" character varying(64), "source" character varying(32), "email" character varying(64), "alt_email" character varying(64), "phone" character varying(32), "mobile" character varying(32), "fax" character varying(32), "blog" character varying(128), "linkedin" character varying(128), "facebook" character varying(128), "twitter" character varying(128), "born_on" date, "do_not_call" boolean DEFAULT 'f' NOT NULL, "deleted_at" timestamp, "created_at" timestamp NOT NULL, "updated_at" timestamp NOT NULL, "background_info" character varying(255), "skype" character varying(128), "subscribed_users" text) [0m
  [1m[35m (1.0ms)[0m  CREATE INDEX "index_contacts_on_assigned_to" ON "contacts" ("assigned_to")
  [1m[36m (11.3ms)[0m  [1mCREATE UNIQUE INDEX "id_last_name_deleted" ON "contacts" ("user_id", "last_name", "deleted_at")[0m
  [1m[35m (4.1ms)[0m  CREATE TABLE "emails" ("id" serial primary key, "imap_message_id" character varying(255) NOT NULL, "user_id" integer, "mediator_id" integer, "mediator_type" character varying(255), "sent_from" character varying(255) NOT NULL, "sent_to" character varying(255) NOT NULL, "cc" character varying(255), "bcc" character varying(255), "subject" character varying(255), "body" text, "header" text, "sent_at" timestamp, "received_at" timestamp, "deleted_at" timestamp, "created_at" timestamp NOT NULL, "updated_at" timestamp NOT NULL, "state" character varying(16) DEFAULT 'Expanded' NOT NULL) 
  [1m[36m (1.0ms)[0m  [1mCREATE INDEX "index_emails_on_mediator_id_and_mediator_type" ON "emails" ("mediator_id", "mediator_type")[0m
  [1m[35m (3.2ms)[0m  CREATE TABLE "field_groups" ("id" serial primary key, "name" character varying(64), "label" character varying(128), "position" integer, "hint" character varying(255), "created_at" timestamp NOT NULL, "updated_at" timestamp NOT NULL, "tag_id" integer, "klass_name" character varying(32)) 
  [1m[36m (3.4ms)[0m  [1mCREATE TABLE "fields" ("id" serial primary key, "type" character varying(255), "field_group_id" integer, "position" integer, "name" character varying(64), "label" character varying(128), "hint" character varying(255), "placeholder" character varying(255), "as" character varying(32), "collection" text, "disabled" boolean, "required" boolean, "maxlength" integer, "created_at" timestamp NOT NULL, "updated_at" timestamp NOT NULL) [0m
  [1m[35m (1.0ms)[0m  CREATE INDEX "index_fields_on_field_group_id" ON "fields" ("field_group_id")
  [1m[36m (1.0ms)[0m  [1mCREATE INDEX "index_fields_on_name" ON "fields" ("name")[0m
  [1m[35m (4.0ms)[0m  CREATE TABLE "leads" ("id" serial primary key, "user_id" integer, "campaign_id" integer, "assigned_to" integer, "first_name" character varying(64) DEFAULT '' NOT NULL, "last_name" character varying(64) DEFAULT '' NOT NULL, "access" character varying(8) DEFAULT 'Public', "title" character varying(64), "company" character varying(64), "source" character varying(32), "status" character varying(32), "referred_by" character varying(64), "email" character varying(64), "alt_email" character varying(64), "phone" character varying(32), "mobile" character varying(32), "blog" character varying(128), "linkedin" character varying(128), "facebook" character varying(128), "twitter" character varying(128), "rating" integer DEFAULT 0 NOT NULL, "do_not_call" boolean DEFAULT 'f' NOT NULL, "deleted_at" timestamp, "created_at" timestamp NOT NULL, "updated_at" timestamp NOT NULL, "background_info" character varying(255), "skype" character varying(128), "subscribed_users" text) 
  [1m[36m (9.7ms)[0m  [1mCREATE INDEX "index_leads_on_assigned_to" ON "leads" ("assigned_to")[0m
  [1m[35m (6.9ms)[0m  CREATE UNIQUE INDEX "index_leads_on_user_id_and_last_name_and_deleted_at" ON "leads" ("user_id", "last_name", "deleted_at")
  [1m[36m (20.0ms)[0m  [1mCREATE TABLE "lists" ("id" serial primary key, "name" character varying(255), "url" text, "created_at" timestamp NOT NULL, "updated_at" timestamp NOT NULL) [0m
  [1m[35m (3.7ms)[0m  CREATE TABLE "opportunities" ("id" serial primary key, "user_id" integer, "campaign_id" integer, "assigned_to" integer, "name" character varying(64) DEFAULT '' NOT NULL, "access" character varying(8) DEFAULT 'Public', "source" character varying(32), "stage" character varying(32), "probability" integer, "amount" decimal(12,2), "discount" decimal(12,2), "closes_on" date, "deleted_at" timestamp, "created_at" timestamp NOT NULL, "updated_at" timestamp NOT NULL, "background_info" character varying(255), "subscribed_users" text) 
  [1m[36m (1.0ms)[0m  [1mCREATE INDEX "index_opportunities_on_assigned_to" ON "opportunities" ("assigned_to")[0m
  [1m[35m (1.2ms)[0m  CREATE UNIQUE INDEX "id_name_deleted" ON "opportunities" ("user_id", "name", "deleted_at")
  [1m[36m (2.5ms)[0m  [1mCREATE TABLE "permissions" ("id" serial primary key, "user_id" integer, "asset_id" integer, "asset_type" character varying(255), "created_at" timestamp NOT NULL, "updated_at" timestamp NOT NULL) [0m
  [1m[35m (1.0ms)[0m  CREATE INDEX "index_permissions_on_asset_id_and_asset_type" ON "permissions" ("asset_id", "asset_type")
  [1m[36m (0.9ms)[0m  [1mCREATE INDEX "index_permissions_on_user_id" ON "permissions" ("user_id")[0m
  [1m[35m (3.4ms)[0m  CREATE TABLE "preferences" ("id" serial primary key, "user_id" integer, "name" character varying(32) DEFAULT '' NOT NULL, "value" text, "created_at" timestamp NOT NULL, "updated_at" timestamp NOT NULL) 
  [1m[36m (1.0ms)[0m  [1mCREATE INDEX "index_preferences_on_user_id_and_name" ON "preferences" ("user_id", "name")[0m
  [1m[35m (4.5ms)[0m  CREATE TABLE "sessions" ("id" serial primary key, "session_id" character varying(255) NOT NULL, "data" text, "created_at" timestamp NOT NULL, "updated_at" timestamp NOT NULL) 
  [1m[36m (1.0ms)[0m  [1mCREATE INDEX "index_sessions_on_session_id" ON "sessions" ("session_id")[0m
  [1m[35m (0.9ms)[0m  CREATE INDEX "index_sessions_on_updated_at" ON "sessions" ("updated_at")
  [1m[36m (3.1ms)[0m  [1mCREATE TABLE "settings" ("id" serial primary key, "name" character varying(32) DEFAULT '' NOT NULL, "value" text, "created_at" timestamp NOT NULL, "updated_at" timestamp NOT NULL) [0m
  [1m[35m (1.1ms)[0m  CREATE INDEX "index_settings_on_name" ON "settings" ("name")
  [1m[36m (3.5ms)[0m  [1mCREATE TABLE "taggings" ("id" serial primary key, "tag_id" integer, "taggable_id" integer, "tagger_id" integer, "tagger_type" character varying(255), "taggable_type" character varying(255), "context" character varying(255), "created_at" timestamp) [0m
  [1m[35m (1.1ms)[0m  CREATE INDEX "index_taggings_on_tag_id" ON "taggings" ("tag_id")
  [1m[36m (1.4ms)[0m  [1mCREATE INDEX "index_taggings_on_taggable_id_and_taggable_type_and_context" ON "taggings" ("taggable_id", "taggable_type", "context")[0m
  [1m[35m (2.2ms)[0m  CREATE TABLE "tags" ("id" serial primary key, "name" character varying(255)) 
  [1m[36m (3.4ms)[0m  [1mCREATE TABLE "tasks" ("id" serial primary key, "user_id" integer, "assigned_to" integer, "completed_by" integer, "name" character varying(255) DEFAULT '' NOT NULL, "asset_id" integer, "asset_type" character varying(255), "priority" character varying(32), "category" character varying(32), "bucket" character varying(32), "due_at" timestamp, "completed_at" timestamp, "deleted_at" timestamp, "created_at" timestamp NOT NULL, "updated_at" timestamp NOT NULL, "background_info" character varying(255), "subscribed_users" text) [0m
  [1m[35m (1.1ms)[0m  CREATE INDEX "index_tasks_on_assigned_to" ON "tasks" ("assigned_to")
  [1m[36m (1.2ms)[0m  [1mCREATE UNIQUE INDEX "index_tasks_on_user_id_and_name_and_deleted_at" ON "tasks" ("user_id", "name", "deleted_at")[0m
  [1m[35m (4.7ms)[0m  CREATE TABLE "users" ("id" serial primary key, "username" character varying(32) DEFAULT '' NOT NULL, "email" character varying(64) DEFAULT '' NOT NULL, "first_name" character varying(32), "last_name" character varying(32), "title" character varying(64), "company" character varying(64), "alt_email" character varying(64), "phone" character varying(32), "mobile" character varying(32), "aim" character varying(32), "yahoo" character varying(32), "google" character varying(32), "skype" character varying(32), "password_hash" character varying(255) DEFAULT '' NOT NULL, "password_salt" character varying(255) DEFAULT '' NOT NULL, "persistence_token" character varying(255) DEFAULT '' NOT NULL, "perishable_token" character varying(255) DEFAULT '' NOT NULL, "last_request_at" timestamp, "last_login_at" timestamp, "current_login_at" timestamp, "last_login_ip" character varying(255), "current_login_ip" character varying(255), "login_count" integer DEFAULT 0 NOT NULL, "deleted_at" timestamp, "created_at" timestamp NOT NULL, "updated_at" timestamp NOT NULL, "admin" boolean DEFAULT 'f' NOT NULL, "suspended_at" timestamp, "single_access_token" character varying(255)) 
  [1m[36m (1.1ms)[0m  [1mCREATE INDEX "index_users_on_email" ON "users" ("email")[0m
  [1m[35m (1.2ms)[0m  CREATE INDEX "index_users_on_last_request_at" ON "users" ("last_request_at")
  [1m[36m (1.0ms)[0m  [1mCREATE INDEX "index_users_on_perishable_token" ON "users" ("perishable_token")[0m
  [1m[35m (1.1ms)[0m  CREATE INDEX "index_users_on_remember_token" ON "users" ("persistence_token")
  [1m[36m (1.1ms)[0m  [1mCREATE UNIQUE INDEX "index_users_on_username_and_deleted_at" ON "users" ("username", "deleted_at")[0m
  [1m[35m (3.5ms)[0m  CREATE TABLE "versions" ("id" serial primary key, "item_type" character varying(255) NOT NULL, "item_id" integer NOT NULL, "event" character varying(512) NOT NULL, "whodunnit" character varying(255), "object" text, "created_at" timestamp, "object_changes" text, "related_id" integer, "related_type" character varying(255)) 
  [1m[36m (1.0ms)[0m  [1mCREATE INDEX "index_versions_on_item_type_and_item_id" ON "versions" ("item_type", "item_id")[0m
  [1m[35m (0.9ms)[0m  CREATE INDEX "index_versions_on_whodunnit" ON "versions" ("whodunnit")
  [1m[36m (0.7ms)[0m  [1mCREATE TABLE "schema_migrations" ("version" character varying(255) NOT NULL) [0m
  [1m[35m (1.1ms)[0m  CREATE UNIQUE INDEX "unique_schema_migrations" ON "schema_migrations" ("version")
  [1m[36m (0.3ms)[0m  [1mSELECT version FROM "schema_migrations"[0m
  [1m[35m (0.5ms)[0m  INSERT INTO "schema_migrations" (version) VALUES ('20120528102124')
  [1m[36m (0.2ms)[0m  [1mBEGIN[0m
  [1m[35m (0.6ms)[0m  SELECT COUNT(*) FROM "accounts" 
Started POST "/vend/register_sale" for 127.0.0.1 at 2013-03-13 23:30:53 +1300
Processing by VendController#register_sale as JSON
  Parameters: {"payload"=>"{\n   \"created_at\":\"2013-03-13 10:12:17\",\n   \"customer\":{\n      \"balance\":\"0.000\",\n      \"contact_first_name\":\"Bob\",\n      \"contact_last_name\":\"Waikakte\",\n      \"created_at\":\"2013-03-13 09:51:55\",\n      \"custom_field_1\":\"\",\n      \"custom_field_2\":\"\",\n      \"custom_field_3\":\"\",\n      \"custom_field_4\":\"\",\n      \"customer_code\":\"Bob-4QTY\",\n      \"id\":\"a3ccb1a1-8bc3-11e2-b1f5-4040782fde00\",\n      \"note\":\"\",\n      \"points\":\"0\",\n      \"sex\":\"M\",\n      \"updated_at\":\"2013-03-13 10:11:53\",\n      \"year_to_date\":\"18.90000\"\n   },\n   \"customer_id\":\"a3ccb1a1-8bc3-11e2-b1f5-4040782fde00\",\n   \"id\":\"d66f205d-147e-bec6-29fd-72ec60104b0c\",\n   \"invoice_number\":\"6\",\n   \"market_id\":\"3\",\n   \"register_id\":\"a5834e96-8b10-11e2-b1f5-4040782fde00\",\n   \"register_sale_payments\":[\n      {\n         \"amount\":\"4.95\",\n         \"id\":\"bda69263-a166-20a6-bfc5-234f8596eb8d\",\n         \"payment_date\":\"2013-03-13T10:12:14Z\",\n         \"payment_type_id\":\"1\",\n         \"retailer_payment_type_id\":\"a58d10ac-8b10-11e2-b1f5-4040782fde00\"\n      }\n   ],\n   \"register_sale_products\":[\n      {\n         \"id\":\"f10c6d69-d2b6-d954-ea0c-f065b28bd303\",\n         \"price\":\"4.95000\",\n         \"price_set\":\"0\",\n         \"price_total\":\"4.95\",\n         \"product_id\":\"a5550505-8b10-11e2-b1f5-4040782fde00\",\n         \"quantity\":\"1\",\n         \"tax\":\"0.00000\",\n         \"tax_id\":\"2b12e79e-714e-11df-b0bf-4040f540b50a\",\n         \"tax_name\":\"No Tax\",\n         \"tax_rate\":\"0.000000\",\n         \"tax_total\":\"0\"\n      }\n   ],\n   \"sale_date\":\"2013-03-13T10:12:15Z\",\n   \"short_code\":\"zmi1y8\",\n   \"status\":\"CLOSED\",\n   \"totals\":{\n      \"total_payment\":\"4.95\",\n      \"total_price\":\"4.95\",\n      \"total_tax\":\"0\",\n      \"total_to_pay\":\"0\"\n   },\n   \"updated_at\":\"2013-03-13 10:12:17\",\n   \"user\":{\n      \"created_at\":\"2013-03-12 12:30:38\",\n      \"display_name\":\"A cashier\",\n      \"id\":\"a5952c31-8b10-11e2-b1f5-4040782fde00\",\n      \"name\":\"itdept@crossroads.org.hk\",\n      \"updated_at\":\"2013-03-12 12:30:38\"\n   },\n   \"user_id\":\"a5952c31-8b10-11e2-b1f5-4040782fde00\"\n}"}
Completed 500 Internal Server Error in 1ms
  [1m[36m (0.3ms)[0m  [1mROLLBACK[0m
  [1m[35m (0.0ms)[0m  BEGIN
  [1m[36m (0.1ms)[0m  [1mROLLBACK[0m
Connecting to database specified by database.yml
  [1m[36mFieldGroup Load (1.1ms)[0m  [1mSELECT "field_groups".* FROM "field_groups" WHERE "field_groups"."klass_name" = 'Account' ORDER BY position[0m
  [1m[35mFieldGroup Load (0.3ms)[0m  SELECT "field_groups".* FROM "field_groups" WHERE "field_groups"."klass_name" = 'Campaign' ORDER BY position
  [1m[36mFieldGroup Load (0.3ms)[0m  [1mSELECT "field_groups".* FROM "field_groups" WHERE "field_groups"."klass_name" = 'Contact' ORDER BY position[0m
  [1m[35mFieldGroup Load (0.3ms)[0m  SELECT "field_groups".* FROM "field_groups" WHERE "field_groups"."klass_name" = 'Lead' ORDER BY position
  [1m[36mFieldGroup Load (0.3ms)[0m  [1mSELECT "field_groups".* FROM "field_groups" WHERE "field_groups"."klass_name" = 'Opportunity' ORDER BY position[0m
  [1m[35mFieldGroup Load (0.3ms)[0m  SELECT "field_groups".* FROM "field_groups" WHERE "field_groups"."klass_name" = 'Task' ORDER BY position
Creating scope :except. Overwriting existing method User.except.
  [1m[36m (122.8ms)[0m  [1mDROP DATABASE IF EXISTS "ffcrm_vend_test"[0m
  [1m[35m (243.4ms)[0m  CREATE DATABASE "ffcrm_vend_test" ENCODING = 'utf8'
  [1m[36m (24.6ms)[0m  [1mCREATE TABLE "account_contacts" ("id" serial primary key, "account_id" integer, "contact_id" integer, "deleted_at" timestamp, "created_at" timestamp NOT NULL, "updated_at" timestamp NOT NULL) [0m
  [1m[35m (2.3ms)[0m  CREATE TABLE "account_opportunities" ("id" serial primary key, "account_id" integer, "opportunity_id" integer, "deleted_at" timestamp, "created_at" timestamp NOT NULL, "updated_at" timestamp NOT NULL) 
  [1m[36m (4.0ms)[0m  [1mCREATE TABLE "accounts" ("id" serial primary key, "user_id" integer, "assigned_to" integer, "name" character varying(64) DEFAULT '' NOT NULL, "access" character varying(8) DEFAULT 'Public', "website" character varying(64), "toll_free_phone" character varying(32), "phone" character varying(32), "fax" character varying(32), "deleted_at" timestamp, "created_at" timestamp NOT NULL, "updated_at" timestamp NOT NULL, "email" character varying(64), "background_info" character varying(255), "rating" integer DEFAULT 0 NOT NULL, "category" character varying(32), "subscribed_users" text, "cf_vend_customer_id" character varying(255)) [0m
  [1m[35m (1.0ms)[0m  CREATE INDEX "index_accounts_on_assigned_to" ON "accounts" ("assigned_to")
  [1m[36m (1.7ms)[0m  [1mCREATE UNIQUE INDEX "index_accounts_on_user_id_and_name_and_deleted_at" ON "accounts" ("user_id", "name", "deleted_at")[0m
  [1m[35m (3.7ms)[0m  CREATE TABLE "activities" ("id" serial primary key, "user_id" integer, "subject_id" integer, "subject_type" character varying(255), "action" character varying(32) DEFAULT 'created', "info" character varying(255) DEFAULT '', "private" boolean DEFAULT 'f', "created_at" timestamp NOT NULL, "updated_at" timestamp NOT NULL) 
  [1m[36m (0.9ms)[0m  [1mCREATE INDEX "index_activities_on_created_at" ON "activities" ("created_at")[0m
  [1m[35m (1.1ms)[0m  CREATE INDEX "index_activities_on_user_id" ON "activities" ("user_id")
  [1m[36m (3.9ms)[0m  [1mCREATE TABLE "addresses" ("id" serial primary key, "street1" character varying(255), "street2" character varying(255), "city" character varying(64), "state" character varying(64), "zipcode" character varying(16), "country" character varying(64), "full_address" character varying(255), "address_type" character varying(16), "addressable_id" integer, "addressable_type" character varying(255), "created_at" timestamp NOT NULL, "updated_at" timestamp NOT NULL, "deleted_at" timestamp) [0m
  [1m[35m (1.2ms)[0m  CREATE INDEX "index_addresses_on_addressable_id_and_addressable_type" ON "addresses" ("addressable_id", "addressable_type")
  [1m[36m (3.4ms)[0m  [1mCREATE TABLE "avatars" ("id" serial primary key, "user_id" integer, "entity_id" integer, "entity_type" character varying(255), "image_file_size" integer, "image_file_name" character varying(255), "image_content_type" character varying(255), "created_at" timestamp NOT NULL, "updated_at" timestamp NOT NULL) [0m
  [1m[35m (3.9ms)[0m  CREATE TABLE "campaigns" ("id" serial primary key, "user_id" integer, "assigned_to" integer, "name" character varying(64) DEFAULT '' NOT NULL, "access" character varying(8) DEFAULT 'Public', "status" character varying(64), "budget" decimal(12,2), "target_leads" integer, "target_conversion" float, "target_revenue" decimal(12,2), "leads_count" integer, "opportunities_count" integer, "revenue" decimal(12,2), "starts_on" date, "ends_on" date, "objectives" text, "deleted_at" timestamp, "created_at" timestamp NOT NULL, "updated_at" timestamp NOT NULL, "background_info" character varying(255), "subscribed_users" text) 
  [1m[36m (1.0ms)[0m  [1mCREATE INDEX "index_campaigns_on_assigned_to" ON "campaigns" ("assigned_to")[0m
  [1m[35m (1.2ms)[0m  CREATE UNIQUE INDEX "index_campaigns_on_user_id_and_name_and_deleted_at" ON "campaigns" ("user_id", "name", "deleted_at")
  [1m[36m (3.6ms)[0m  [1mCREATE TABLE "comments" ("id" serial primary key, "user_id" integer, "commentable_id" integer, "commentable_type" character varying(255), "private" boolean, "title" character varying(255) DEFAULT '', "comment" text, "created_at" timestamp NOT NULL, "updated_at" timestamp NOT NULL, "state" character varying(16) DEFAULT 'Expanded' NOT NULL) [0m
  [1m[35m (2.6ms)[0m  CREATE TABLE "contact_opportunities" ("id" serial primary key, "contact_id" integer, "opportunity_id" integer, "role" character varying(32), "deleted_at" timestamp, "created_at" timestamp NOT NULL, "updated_at" timestamp NOT NULL) 
  [1m[36m (4.2ms)[0m  [1mCREATE TABLE "contacts" ("id" serial primary key, "user_id" integer, "lead_id" integer, "assigned_to" integer, "reports_to" integer, "first_name" character varying(64) DEFAULT '' NOT NULL, "last_name" character varying(64) DEFAULT '' NOT NULL, "access" character varying(8) DEFAULT 'Public', "title" character varying(64), "department" character varying(64), "source" character varying(32), "email" character varying(64), "alt_email" character varying(64), "phone" character varying(32), "mobile" character varying(32), "fax" character varying(32), "blog" character varying(128), "linkedin" character varying(128), "facebook" character varying(128), "twitter" character varying(128), "born_on" date, "do_not_call" boolean DEFAULT 'f' NOT NULL, "deleted_at" timestamp, "created_at" timestamp NOT NULL, "updated_at" timestamp NOT NULL, "background_info" character varying(255), "skype" character varying(128), "subscribed_users" text) [0m
  [1m[35m (0.9ms)[0m  CREATE INDEX "index_contacts_on_assigned_to" ON "contacts" ("assigned_to")
  [1m[36m (1.2ms)[0m  [1mCREATE UNIQUE INDEX "id_last_name_deleted" ON "contacts" ("user_id", "last_name", "deleted_at")[0m
  [1m[35m (3.6ms)[0m  CREATE TABLE "emails" ("id" serial primary key, "imap_message_id" character varying(255) NOT NULL, "user_id" integer, "mediator_id" integer, "mediator_type" character varying(255), "sent_from" character varying(255) NOT NULL, "sent_to" character varying(255) NOT NULL, "cc" character varying(255), "bcc" character varying(255), "subject" character varying(255), "body" text, "header" text, "sent_at" timestamp, "received_at" timestamp, "deleted_at" timestamp, "created_at" timestamp NOT NULL, "updated_at" timestamp NOT NULL, "state" character varying(16) DEFAULT 'Expanded' NOT NULL) 
  [1m[36m (1.1ms)[0m  [1mCREATE INDEX "index_emails_on_mediator_id_and_mediator_type" ON "emails" ("mediator_id", "mediator_type")[0m
  [1m[35m (3.0ms)[0m  CREATE TABLE "field_groups" ("id" serial primary key, "name" character varying(64), "label" character varying(128), "position" integer, "hint" character varying(255), "created_at" timestamp NOT NULL, "updated_at" timestamp NOT NULL, "tag_id" integer, "klass_name" character varying(32)) 
  [1m[36m (3.6ms)[0m  [1mCREATE TABLE "fields" ("id" serial primary key, "type" character varying(255), "field_group_id" integer, "position" integer, "name" character varying(64), "label" character varying(128), "hint" character varying(255), "placeholder" character varying(255), "as" character varying(32), "collection" text, "disabled" boolean, "required" boolean, "maxlength" integer, "created_at" timestamp NOT NULL, "updated_at" timestamp NOT NULL) [0m
  [1m[35m (0.9ms)[0m  CREATE INDEX "index_fields_on_field_group_id" ON "fields" ("field_group_id")
  [1m[36m (1.0ms)[0m  [1mCREATE INDEX "index_fields_on_name" ON "fields" ("name")[0m
  [1m[35m (4.1ms)[0m  CREATE TABLE "leads" ("id" serial primary key, "user_id" integer, "campaign_id" integer, "assigned_to" integer, "first_name" character varying(64) DEFAULT '' NOT NULL, "last_name" character varying(64) DEFAULT '' NOT NULL, "access" character varying(8) DEFAULT 'Public', "title" character varying(64), "company" character varying(64), "source" character varying(32), "status" character varying(32), "referred_by" character varying(64), "email" character varying(64), "alt_email" character varying(64), "phone" character varying(32), "mobile" character varying(32), "blog" character varying(128), "linkedin" character varying(128), "facebook" character varying(128), "twitter" character varying(128), "rating" integer DEFAULT 0 NOT NULL, "do_not_call" boolean DEFAULT 'f' NOT NULL, "deleted_at" timestamp, "created_at" timestamp NOT NULL, "updated_at" timestamp NOT NULL, "background_info" character varying(255), "skype" character varying(128), "subscribed_users" text) 
  [1m[36m (0.9ms)[0m  [1mCREATE INDEX "index_leads_on_assigned_to" ON "leads" ("assigned_to")[0m
  [1m[35m (1.4ms)[0m  CREATE UNIQUE INDEX "index_leads_on_user_id_and_last_name_and_deleted_at" ON "leads" ("user_id", "last_name", "deleted_at")
  [1m[36m (3.3ms)[0m  [1mCREATE TABLE "lists" ("id" serial primary key, "name" character varying(255), "url" text, "created_at" timestamp NOT NULL, "updated_at" timestamp NOT NULL) [0m
  [1m[35m (4.2ms)[0m  CREATE TABLE "opportunities" ("id" serial primary key, "user_id" integer, "campaign_id" integer, "assigned_to" integer, "name" character varying(64) DEFAULT '' NOT NULL, "access" character varying(8) DEFAULT 'Public', "source" character varying(32), "stage" character varying(32), "probability" integer, "amount" decimal(12,2), "discount" decimal(12,2), "closes_on" date, "deleted_at" timestamp, "created_at" timestamp NOT NULL, "updated_at" timestamp NOT NULL, "background_info" character varying(255), "subscribed_users" text) 
  [1m[36m (1.2ms)[0m  [1mCREATE INDEX "index_opportunities_on_assigned_to" ON "opportunities" ("assigned_to")[0m
  [1m[35m (1.2ms)[0m  CREATE UNIQUE INDEX "id_name_deleted" ON "opportunities" ("user_id", "name", "deleted_at")
  [1m[36m (3.3ms)[0m  [1mCREATE TABLE "permissions" ("id" serial primary key, "user_id" integer, "asset_id" integer, "asset_type" character varying(255), "created_at" timestamp NOT NULL, "updated_at" timestamp NOT NULL) [0m
  [1m[35m (1.1ms)[0m  CREATE INDEX "index_permissions_on_asset_id_and_asset_type" ON "permissions" ("asset_id", "asset_type")
  [1m[36m (1.0ms)[0m  [1mCREATE INDEX "index_permissions_on_user_id" ON "permissions" ("user_id")[0m
  [1m[35m (4.2ms)[0m  CREATE TABLE "preferences" ("id" serial primary key, "user_id" integer, "name" character varying(32) DEFAULT '' NOT NULL, "value" text, "created_at" timestamp NOT NULL, "updated_at" timestamp NOT NULL) 
  [1m[36m (1.3ms)[0m  [1mCREATE INDEX "index_preferences_on_user_id_and_name" ON "preferences" ("user_id", "name")[0m
  [1m[35m (4.0ms)[0m  CREATE TABLE "sessions" ("id" serial primary key, "session_id" character varying(255) NOT NULL, "data" text, "created_at" timestamp NOT NULL, "updated_at" timestamp NOT NULL) 
  [1m[36m (1.0ms)[0m  [1mCREATE INDEX "index_sessions_on_session_id" ON "sessions" ("session_id")[0m
  [1m[35m (0.9ms)[0m  CREATE INDEX "index_sessions_on_updated_at" ON "sessions" ("updated_at")
  [1m[36m (4.2ms)[0m  [1mCREATE TABLE "settings" ("id" serial primary key, "name" character varying(32) DEFAULT '' NOT NULL, "value" text, "created_at" timestamp NOT NULL, "updated_at" timestamp NOT NULL) [0m
  [1m[35m (1.3ms)[0m  CREATE INDEX "index_settings_on_name" ON "settings" ("name")
  [1m[36m (5.3ms)[0m  [1mCREATE TABLE "taggings" ("id" serial primary key, "tag_id" integer, "taggable_id" integer, "tagger_id" integer, "tagger_type" character varying(255), "taggable_type" character varying(255), "context" character varying(255), "created_at" timestamp) [0m
  [1m[35m (10.6ms)[0m  CREATE INDEX "index_taggings_on_tag_id" ON "taggings" ("tag_id")
  [1m[36m (3.4ms)[0m  [1mCREATE INDEX "index_taggings_on_taggable_id_and_taggable_type_and_context" ON "taggings" ("taggable_id", "taggable_type", "context")[0m
  [1m[35m (15.7ms)[0m  CREATE TABLE "tags" ("id" serial primary key, "name" character varying(255)) 
  [1m[36m (4.1ms)[0m  [1mCREATE TABLE "tasks" ("id" serial primary key, "user_id" integer, "assigned_to" integer, "completed_by" integer, "name" character varying(255) DEFAULT '' NOT NULL, "asset_id" integer, "asset_type" character varying(255), "priority" character varying(32), "category" character varying(32), "bucket" character varying(32), "due_at" timestamp, "completed_at" timestamp, "deleted_at" timestamp, "created_at" timestamp NOT NULL, "updated_at" timestamp NOT NULL, "background_info" character varying(255), "subscribed_users" text) [0m
  [1m[35m (1.7ms)[0m  CREATE INDEX "index_tasks_on_assigned_to" ON "tasks" ("assigned_to")
  [1m[36m (1.1ms)[0m  [1mCREATE UNIQUE INDEX "index_tasks_on_user_id_and_name_and_deleted_at" ON "tasks" ("user_id", "name", "deleted_at")[0m
  [1m[35m (6.3ms)[0m  CREATE TABLE "users" ("id" serial primary key, "username" character varying(32) DEFAULT '' NOT NULL, "email" character varying(64) DEFAULT '' NOT NULL, "first_name" character varying(32), "last_name" character varying(32), "title" character varying(64), "company" character varying(64), "alt_email" character varying(64), "phone" character varying(32), "mobile" character varying(32), "aim" character varying(32), "yahoo" character varying(32), "google" character varying(32), "skype" character varying(32), "password_hash" character varying(255) DEFAULT '' NOT NULL, "password_salt" character varying(255) DEFAULT '' NOT NULL, "persistence_token" character varying(255) DEFAULT '' NOT NULL, "perishable_token" character varying(255) DEFAULT '' NOT NULL, "last_request_at" timestamp, "last_login_at" timestamp, "current_login_at" timestamp, "last_login_ip" character varying(255), "current_login_ip" character varying(255), "login_count" integer DEFAULT 0 NOT NULL, "deleted_at" timestamp, "created_at" timestamp NOT NULL, "updated_at" timestamp NOT NULL, "admin" boolean DEFAULT 'f' NOT NULL, "suspended_at" timestamp, "single_access_token" character varying(255)) 
  [1m[36m (1.1ms)[0m  [1mCREATE INDEX "index_users_on_email" ON "users" ("email")[0m
  [1m[35m (9.6ms)[0m  CREATE INDEX "index_users_on_last_request_at" ON "users" ("last_request_at")
  [1m[36m (3.1ms)[0m  [1mCREATE INDEX "index_users_on_perishable_token" ON "users" ("perishable_token")[0m
  [1m[35m (2.0ms)[0m  CREATE INDEX "index_users_on_remember_token" ON "users" ("persistence_token")
  [1m[36m (1.4ms)[0m  [1mCREATE UNIQUE INDEX "index_users_on_username_and_deleted_at" ON "users" ("username", "deleted_at")[0m
  [1m[35m (4.3ms)[0m  CREATE TABLE "versions" ("id" serial primary key, "item_type" character varying(255) NOT NULL, "item_id" integer NOT NULL, "event" character varying(512) NOT NULL, "whodunnit" character varying(255), "object" text, "created_at" timestamp, "object_changes" text, "related_id" integer, "related_type" character varying(255)) 
  [1m[36m (1.3ms)[0m  [1mCREATE INDEX "index_versions_on_item_type_and_item_id" ON "versions" ("item_type", "item_id")[0m
  [1m[35m (1.1ms)[0m  CREATE INDEX "index_versions_on_whodunnit" ON "versions" ("whodunnit")
  [1m[36m (0.9ms)[0m  [1mCREATE TABLE "schema_migrations" ("version" character varying(255) NOT NULL) [0m
  [1m[35m (1.1ms)[0m  CREATE UNIQUE INDEX "unique_schema_migrations" ON "schema_migrations" ("version")
  [1m[36m (0.3ms)[0m  [1mSELECT version FROM "schema_migrations"[0m
  [1m[35m (0.5ms)[0m  INSERT INTO "schema_migrations" (version) VALUES ('20120528102124')
  [1m[36m (0.2ms)[0m  [1mBEGIN[0m
  [1m[35m (0.6ms)[0m  SELECT COUNT(*) FROM "accounts" 
Started POST "/vend/register_sale" for 127.0.0.1 at 2013-03-13 23:32:57 +1300
Processing by VendController#register_sale as JSON
  Parameters: {"payload"=>"{\n   \"created_at\":\"2013-03-13 10:12:17\",\n   \"customer\":{\n      \"balance\":\"0.000\",\n      \"contact_first_name\":\"Bob\",\n      \"contact_last_name\":\"Waikakte\",\n      \"created_at\":\"2013-03-13 09:51:55\",\n      \"custom_field_1\":\"\",\n      \"custom_field_2\":\"\",\n      \"custom_field_3\":\"\",\n      \"custom_field_4\":\"\",\n      \"customer_code\":\"Bob-4QTY\",\n      \"id\":\"a3ccb1a1-8bc3-11e2-b1f5-4040782fde00\",\n      \"note\":\"\",\n      \"points\":\"0\",\n      \"sex\":\"M\",\n      \"updated_at\":\"2013-03-13 10:11:53\",\n      \"year_to_date\":\"18.90000\"\n   },\n   \"customer_id\":\"a3ccb1a1-8bc3-11e2-b1f5-4040782fde00\",\n   \"id\":\"d66f205d-147e-bec6-29fd-72ec60104b0c\",\n   \"invoice_number\":\"6\",\n   \"market_id\":\"3\",\n   \"register_id\":\"a5834e96-8b10-11e2-b1f5-4040782fde00\",\n   \"register_sale_payments\":[\n      {\n         \"amount\":\"4.95\",\n         \"id\":\"bda69263-a166-20a6-bfc5-234f8596eb8d\",\n         \"payment_date\":\"2013-03-13T10:12:14Z\",\n         \"payment_type_id\":\"1\",\n         \"retailer_payment_type_id\":\"a58d10ac-8b10-11e2-b1f5-4040782fde00\"\n      }\n   ],\n   \"register_sale_products\":[\n      {\n         \"id\":\"f10c6d69-d2b6-d954-ea0c-f065b28bd303\",\n         \"price\":\"4.95000\",\n         \"price_set\":\"0\",\n         \"price_total\":\"4.95\",\n         \"product_id\":\"a5550505-8b10-11e2-b1f5-4040782fde00\",\n         \"quantity\":\"1\",\n         \"tax\":\"0.00000\",\n         \"tax_id\":\"2b12e79e-714e-11df-b0bf-4040f540b50a\",\n         \"tax_name\":\"No Tax\",\n         \"tax_rate\":\"0.000000\",\n         \"tax_total\":\"0\"\n      }\n   ],\n   \"sale_date\":\"2013-03-13T10:12:15Z\",\n   \"short_code\":\"zmi1y8\",\n   \"status\":\"CLOSED\",\n   \"totals\":{\n      \"total_payment\":\"4.95\",\n      \"total_price\":\"4.95\",\n      \"total_tax\":\"0\",\n      \"total_to_pay\":\"0\"\n   },\n   \"updated_at\":\"2013-03-13 10:12:17\",\n   \"user\":{\n      \"created_at\":\"2013-03-12 12:30:38\",\n      \"display_name\":\"A cashier\",\n      \"id\":\"a5952c31-8b10-11e2-b1f5-4040782fde00\",\n      \"name\":\"itdept@crossroads.org.hk\",\n      \"updated_at\":\"2013-03-12 12:30:38\"\n   },\n   \"user_id\":\"a5952c31-8b10-11e2-b1f5-4040782fde00\"\n}"}
  [1m[36mAccount Load (0.3ms)[0m  [1mSELECT "accounts".* FROM "accounts" WHERE "accounts"."cf_vend_customer_id" IS NULL LIMIT 1[0m
  [1m[35m (0.2ms)[0m  SAVEPOINT active_record_1
  [1m[36m (0.8ms)[0m  [1mSELECT "tags".id FROM "tags" INNER JOIN "taggings" ON "tags"."id" = "taggings"."tag_id" WHERE "taggings"."taggable_id" IS NULL AND "taggings"."taggable_type" = 'Account' AND (taggings.context = 'tags')[0m
  [1m[35mFieldGroup Load (0.4ms)[0m  SELECT "field_groups".* FROM "field_groups" WHERE "field_groups"."klass_name" = 'Account' AND (tag_id IS NULL OR tag_id IN (NULL)) ORDER BY position
  [1m[36mAccount Exists (0.5ms)[0m  [1mSELECT 1 AS one FROM "accounts" WHERE ("accounts"."name" = 'Account for Register Sale ' AND "accounts"."deleted_at" IS NULL) LIMIT 1[0m
  [1m[35mSQL (1.3ms)[0m  INSERT INTO "accounts" ("access", "assigned_to", "background_info", "category", "cf_vend_customer_id", "created_at", "deleted_at", "email", "fax", "name", "phone", "rating", "subscribed_users", "toll_free_phone", "updated_at", "user_id", "website") VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9, $10, $11, $12, $13, $14, $15, $16, $17) RETURNING "id"  [["access", "Public"], ["assigned_to", nil], ["background_info", nil], ["category", nil], ["cf_vend_customer_id", nil], ["created_at", Wed, 13 Mar 2013 10:32:57 UTC +00:00], ["deleted_at", nil], ["email", nil], ["fax", nil], ["name", "Account for Register Sale "], ["phone", nil], ["rating", 0], ["subscribed_users", nil], ["toll_free_phone", nil], ["updated_at", Wed, 13 Mar 2013 10:32:57 UTC +00:00], ["user_id", nil], ["website", nil]]
  [1m[36mSQL (1.6ms)[0m  [1mINSERT INTO "versions" ("created_at", "event", "item_id", "item_type", "object", "object_changes", "related_id", "related_type", "whodunnit") VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9) RETURNING "id"[0m  [["created_at", Wed, 13 Mar 2013 10:32:57 UTC +00:00], ["event", "create"], ["item_id", 1], ["item_type", "Account"], ["object", nil], ["object_changes", "--- !map:ActiveSupport::HashWithIndifferentAccess \nname: \n- \"\"\n- \"Account for Register Sale \"\ncreated_at: \n- \n- &id001 2013-03-13 10:32:57.848001 Z\nupdated_at: \n- \n- *id001\nid: \n- \n- 1\n"], ["related_id", nil], ["related_type", nil], ["whodunnit", nil]]
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
Completed 500 Internal Server Error in 197ms
  [1m[36m (1.2ms)[0m  [1mROLLBACK[0m
  [1m[35m (0.1ms)[0m  BEGIN
  [1m[36m (0.1ms)[0m  [1mROLLBACK[0m
Connecting to database specified by database.yml
  [1m[36mFieldGroup Load (0.9ms)[0m  [1mSELECT "field_groups".* FROM "field_groups" WHERE "field_groups"."klass_name" = 'Account' ORDER BY position[0m
  [1m[35mFieldGroup Load (0.3ms)[0m  SELECT "field_groups".* FROM "field_groups" WHERE "field_groups"."klass_name" = 'Campaign' ORDER BY position
  [1m[36mFieldGroup Load (0.3ms)[0m  [1mSELECT "field_groups".* FROM "field_groups" WHERE "field_groups"."klass_name" = 'Contact' ORDER BY position[0m
  [1m[35mFieldGroup Load (0.3ms)[0m  SELECT "field_groups".* FROM "field_groups" WHERE "field_groups"."klass_name" = 'Lead' ORDER BY position
  [1m[36mFieldGroup Load (0.2ms)[0m  [1mSELECT "field_groups".* FROM "field_groups" WHERE "field_groups"."klass_name" = 'Opportunity' ORDER BY position[0m
  [1m[35mFieldGroup Load (0.2ms)[0m  SELECT "field_groups".* FROM "field_groups" WHERE "field_groups"."klass_name" = 'Task' ORDER BY position
Creating scope :except. Overwriting existing method User.except.
  [1m[36m (119.8ms)[0m  [1mDROP DATABASE IF EXISTS "ffcrm_vend_test"[0m
  [1m[35m (241.9ms)[0m  CREATE DATABASE "ffcrm_vend_test" ENCODING = 'utf8'
  [1m[36m (6.0ms)[0m  [1mCREATE TABLE "account_contacts" ("id" serial primary key, "account_id" integer, "contact_id" integer, "deleted_at" timestamp, "created_at" timestamp NOT NULL, "updated_at" timestamp NOT NULL) [0m
  [1m[35m (2.2ms)[0m  CREATE TABLE "account_opportunities" ("id" serial primary key, "account_id" integer, "opportunity_id" integer, "deleted_at" timestamp, "created_at" timestamp NOT NULL, "updated_at" timestamp NOT NULL) 
  [1m[36m (4.3ms)[0m  [1mCREATE TABLE "accounts" ("id" serial primary key, "user_id" integer, "assigned_to" integer, "name" character varying(64) DEFAULT '' NOT NULL, "access" character varying(8) DEFAULT 'Public', "website" character varying(64), "toll_free_phone" character varying(32), "phone" character varying(32), "fax" character varying(32), "deleted_at" timestamp, "created_at" timestamp NOT NULL, "updated_at" timestamp NOT NULL, "email" character varying(64), "background_info" character varying(255), "rating" integer DEFAULT 0 NOT NULL, "category" character varying(32), "subscribed_users" text, "cf_vend_customer_id" character varying(255)) [0m
  [1m[35m (10.5ms)[0m  CREATE INDEX "index_accounts_on_assigned_to" ON "accounts" ("assigned_to")
  [1m[36m (3.1ms)[0m  [1mCREATE UNIQUE INDEX "index_accounts_on_user_id_and_name_and_deleted_at" ON "accounts" ("user_id", "name", "deleted_at")[0m
  [1m[35m (4.2ms)[0m  CREATE TABLE "activities" ("id" serial primary key, "user_id" integer, "subject_id" integer, "subject_type" character varying(255), "action" character varying(32) DEFAULT 'created', "info" character varying(255) DEFAULT '', "private" boolean DEFAULT 'f', "created_at" timestamp NOT NULL, "updated_at" timestamp NOT NULL) 
  [1m[36m (0.9ms)[0m  [1mCREATE INDEX "index_activities_on_created_at" ON "activities" ("created_at")[0m
  [1m[35m (0.8ms)[0m  CREATE INDEX "index_activities_on_user_id" ON "activities" ("user_id")
  [1m[36m (3.5ms)[0m  [1mCREATE TABLE "addresses" ("id" serial primary key, "street1" character varying(255), "street2" character varying(255), "city" character varying(64), "state" character varying(64), "zipcode" character varying(16), "country" character varying(64), "full_address" character varying(255), "address_type" character varying(16), "addressable_id" integer, "addressable_type" character varying(255), "created_at" timestamp NOT NULL, "updated_at" timestamp NOT NULL, "deleted_at" timestamp) [0m
  [1m[35m (1.2ms)[0m  CREATE INDEX "index_addresses_on_addressable_id_and_addressable_type" ON "addresses" ("addressable_id", "addressable_type")
  [1m[36m (4.1ms)[0m  [1mCREATE TABLE "avatars" ("id" serial primary key, "user_id" integer, "entity_id" integer, "entity_type" character varying(255), "image_file_size" integer, "image_file_name" character varying(255), "image_content_type" character varying(255), "created_at" timestamp NOT NULL, "updated_at" timestamp NOT NULL) [0m
  [1m[35m (13.4ms)[0m  CREATE TABLE "campaigns" ("id" serial primary key, "user_id" integer, "assigned_to" integer, "name" character varying(64) DEFAULT '' NOT NULL, "access" character varying(8) DEFAULT 'Public', "status" character varying(64), "budget" decimal(12,2), "target_leads" integer, "target_conversion" float, "target_revenue" decimal(12,2), "leads_count" integer, "opportunities_count" integer, "revenue" decimal(12,2), "starts_on" date, "ends_on" date, "objectives" text, "deleted_at" timestamp, "created_at" timestamp NOT NULL, "updated_at" timestamp NOT NULL, "background_info" character varying(255), "subscribed_users" text) 
  [1m[36m (1.0ms)[0m  [1mCREATE INDEX "index_campaigns_on_assigned_to" ON "campaigns" ("assigned_to")[0m
  [1m[35m (1.1ms)[0m  CREATE UNIQUE INDEX "index_campaigns_on_user_id_and_name_and_deleted_at" ON "campaigns" ("user_id", "name", "deleted_at")
  [1m[36m (14.0ms)[0m  [1mCREATE TABLE "comments" ("id" serial primary key, "user_id" integer, "commentable_id" integer, "commentable_type" character varying(255), "private" boolean, "title" character varying(255) DEFAULT '', "comment" text, "created_at" timestamp NOT NULL, "updated_at" timestamp NOT NULL, "state" character varying(16) DEFAULT 'Expanded' NOT NULL) [0m
  [1m[35m (2.3ms)[0m  CREATE TABLE "contact_opportunities" ("id" serial primary key, "contact_id" integer, "opportunity_id" integer, "role" character varying(32), "deleted_at" timestamp, "created_at" timestamp NOT NULL, "updated_at" timestamp NOT NULL) 
  [1m[36m (4.1ms)[0m  [1mCREATE TABLE "contacts" ("id" serial primary key, "user_id" integer, "lead_id" integer, "assigned_to" integer, "reports_to" integer, "first_name" character varying(64) DEFAULT '' NOT NULL, "last_name" character varying(64) DEFAULT '' NOT NULL, "access" character varying(8) DEFAULT 'Public', "title" character varying(64), "department" character varying(64), "source" character varying(32), "email" character varying(64), "alt_email" character varying(64), "phone" character varying(32), "mobile" character varying(32), "fax" character varying(32), "blog" character varying(128), "linkedin" character varying(128), "facebook" character varying(128), "twitter" character varying(128), "born_on" date, "do_not_call" boolean DEFAULT 'f' NOT NULL, "deleted_at" timestamp, "created_at" timestamp NOT NULL, "updated_at" timestamp NOT NULL, "background_info" character varying(255), "skype" character varying(128), "subscribed_users" text) [0m
  [1m[35m (1.0ms)[0m  CREATE INDEX "index_contacts_on_assigned_to" ON "contacts" ("assigned_to")
  [1m[36m (1.2ms)[0m  [1mCREATE UNIQUE INDEX "id_last_name_deleted" ON "contacts" ("user_id", "last_name", "deleted_at")[0m
  [1m[35m (3.6ms)[0m  CREATE TABLE "emails" ("id" serial primary key, "imap_message_id" character varying(255) NOT NULL, "user_id" integer, "mediator_id" integer, "mediator_type" character varying(255), "sent_from" character varying(255) NOT NULL, "sent_to" character varying(255) NOT NULL, "cc" character varying(255), "bcc" character varying(255), "subject" character varying(255), "body" text, "header" text, "sent_at" timestamp, "received_at" timestamp, "deleted_at" timestamp, "created_at" timestamp NOT NULL, "updated_at" timestamp NOT NULL, "state" character varying(16) DEFAULT 'Expanded' NOT NULL) 
  [1m[36m (1.2ms)[0m  [1mCREATE INDEX "index_emails_on_mediator_id_and_mediator_type" ON "emails" ("mediator_id", "mediator_type")[0m
  [1m[35m (2.3ms)[0m  CREATE TABLE "field_groups" ("id" serial primary key, "name" character varying(64), "label" character varying(128), "position" integer, "hint" character varying(255), "created_at" timestamp NOT NULL, "updated_at" timestamp NOT NULL, "tag_id" integer, "klass_name" character varying(32)) 
  [1m[36m (3.3ms)[0m  [1mCREATE TABLE "fields" ("id" serial primary key, "type" character varying(255), "field_group_id" integer, "position" integer, "name" character varying(64), "label" character varying(128), "hint" character varying(255), "placeholder" character varying(255), "as" character varying(32), "collection" text, "disabled" boolean, "required" boolean, "maxlength" integer, "created_at" timestamp NOT NULL, "updated_at" timestamp NOT NULL) [0m
  [1m[35m (1.0ms)[0m  CREATE INDEX "index_fields_on_field_group_id" ON "fields" ("field_group_id")
  [1m[36m (0.9ms)[0m  [1mCREATE INDEX "index_fields_on_name" ON "fields" ("name")[0m
  [1m[35m (4.3ms)[0m  CREATE TABLE "leads" ("id" serial primary key, "user_id" integer, "campaign_id" integer, "assigned_to" integer, "first_name" character varying(64) DEFAULT '' NOT NULL, "last_name" character varying(64) DEFAULT '' NOT NULL, "access" character varying(8) DEFAULT 'Public', "title" character varying(64), "company" character varying(64), "source" character varying(32), "status" character varying(32), "referred_by" character varying(64), "email" character varying(64), "alt_email" character varying(64), "phone" character varying(32), "mobile" character varying(32), "blog" character varying(128), "linkedin" character varying(128), "facebook" character varying(128), "twitter" character varying(128), "rating" integer DEFAULT 0 NOT NULL, "do_not_call" boolean DEFAULT 'f' NOT NULL, "deleted_at" timestamp, "created_at" timestamp NOT NULL, "updated_at" timestamp NOT NULL, "background_info" character varying(255), "skype" character varying(128), "subscribed_users" text) 
  [1m[36m (1.1ms)[0m  [1mCREATE INDEX "index_leads_on_assigned_to" ON "leads" ("assigned_to")[0m
  [1m[35m (1.1ms)[0m  CREATE UNIQUE INDEX "index_leads_on_user_id_and_last_name_and_deleted_at" ON "leads" ("user_id", "last_name", "deleted_at")
  [1m[36m (2.9ms)[0m  [1mCREATE TABLE "lists" ("id" serial primary key, "name" character varying(255), "url" text, "created_at" timestamp NOT NULL, "updated_at" timestamp NOT NULL) [0m
  [1m[35m (4.3ms)[0m  CREATE TABLE "opportunities" ("id" serial primary key, "user_id" integer, "campaign_id" integer, "assigned_to" integer, "name" character varying(64) DEFAULT '' NOT NULL, "access" character varying(8) DEFAULT 'Public', "source" character varying(32), "stage" character varying(32), "probability" integer, "amount" decimal(12,2), "discount" decimal(12,2), "closes_on" date, "deleted_at" timestamp, "created_at" timestamp NOT NULL, "updated_at" timestamp NOT NULL, "background_info" character varying(255), "subscribed_users" text) 
  [1m[36m (1.0ms)[0m  [1mCREATE INDEX "index_opportunities_on_assigned_to" ON "opportunities" ("assigned_to")[0m
  [1m[35m (1.0ms)[0m  CREATE UNIQUE INDEX "id_name_deleted" ON "opportunities" ("user_id", "name", "deleted_at")
  [1m[36m (2.5ms)[0m  [1mCREATE TABLE "permissions" ("id" serial primary key, "user_id" integer, "asset_id" integer, "asset_type" character varying(255), "created_at" timestamp NOT NULL, "updated_at" timestamp NOT NULL) [0m
  [1m[35m (1.1ms)[0m  CREATE INDEX "index_permissions_on_asset_id_and_asset_type" ON "permissions" ("asset_id", "asset_type")
  [1m[36m (0.9ms)[0m  [1mCREATE INDEX "index_permissions_on_user_id" ON "permissions" ("user_id")[0m
  [1m[35m (3.4ms)[0m  CREATE TABLE "preferences" ("id" serial primary key, "user_id" integer, "name" character varying(32) DEFAULT '' NOT NULL, "value" text, "created_at" timestamp NOT NULL, "updated_at" timestamp NOT NULL) 
  [1m[36m (1.2ms)[0m  [1mCREATE INDEX "index_preferences_on_user_id_and_name" ON "preferences" ("user_id", "name")[0m
  [1m[35m (3.1ms)[0m  CREATE TABLE "sessions" ("id" serial primary key, "session_id" character varying(255) NOT NULL, "data" text, "created_at" timestamp NOT NULL, "updated_at" timestamp NOT NULL) 
  [1m[36m (1.0ms)[0m  [1mCREATE INDEX "index_sessions_on_session_id" ON "sessions" ("session_id")[0m
  [1m[35m (0.9ms)[0m  CREATE INDEX "index_sessions_on_updated_at" ON "sessions" ("updated_at")
  [1m[36m (3.3ms)[0m  [1mCREATE TABLE "settings" ("id" serial primary key, "name" character varying(32) DEFAULT '' NOT NULL, "value" text, "created_at" timestamp NOT NULL, "updated_at" timestamp NOT NULL) [0m
  [1m[35m (1.0ms)[0m  CREATE INDEX "index_settings_on_name" ON "settings" ("name")
  [1m[36m (3.8ms)[0m  [1mCREATE TABLE "taggings" ("id" serial primary key, "tag_id" integer, "taggable_id" integer, "tagger_id" integer, "tagger_type" character varying(255), "taggable_type" character varying(255), "context" character varying(255), "created_at" timestamp) [0m
  [1m[35m (0.9ms)[0m  CREATE INDEX "index_taggings_on_tag_id" ON "taggings" ("tag_id")
  [1m[36m (1.1ms)[0m  [1mCREATE INDEX "index_taggings_on_taggable_id_and_taggable_type_and_context" ON "taggings" ("taggable_id", "taggable_type", "context")[0m
  [1m[35m (2.2ms)[0m  CREATE TABLE "tags" ("id" serial primary key, "name" character varying(255)) 
  [1m[36m (3.6ms)[0m  [1mCREATE TABLE "tasks" ("id" serial primary key, "user_id" integer, "assigned_to" integer, "completed_by" integer, "name" character varying(255) DEFAULT '' NOT NULL, "asset_id" integer, "asset_type" character varying(255), "priority" character varying(32), "category" character varying(32), "bucket" character varying(32), "due_at" timestamp, "completed_at" timestamp, "deleted_at" timestamp, "created_at" timestamp NOT NULL, "updated_at" timestamp NOT NULL, "background_info" character varying(255), "subscribed_users" text) [0m
  [1m[35m (1.1ms)[0m  CREATE INDEX "index_tasks_on_assigned_to" ON "tasks" ("assigned_to")
  [1m[36m (1.2ms)[0m  [1mCREATE UNIQUE INDEX "index_tasks_on_user_id_and_name_and_deleted_at" ON "tasks" ("user_id", "name", "deleted_at")[0m
  [1m[35m (4.0ms)[0m  CREATE TABLE "users" ("id" serial primary key, "username" character varying(32) DEFAULT '' NOT NULL, "email" character varying(64) DEFAULT '' NOT NULL, "first_name" character varying(32), "last_name" character varying(32), "title" character varying(64), "company" character varying(64), "alt_email" character varying(64), "phone" character varying(32), "mobile" character varying(32), "aim" character varying(32), "yahoo" character varying(32), "google" character varying(32), "skype" character varying(32), "password_hash" character varying(255) DEFAULT '' NOT NULL, "password_salt" character varying(255) DEFAULT '' NOT NULL, "persistence_token" character varying(255) DEFAULT '' NOT NULL, "perishable_token" character varying(255) DEFAULT '' NOT NULL, "last_request_at" timestamp, "last_login_at" timestamp, "current_login_at" timestamp, "last_login_ip" character varying(255), "current_login_ip" character varying(255), "login_count" integer DEFAULT 0 NOT NULL, "deleted_at" timestamp, "created_at" timestamp NOT NULL, "updated_at" timestamp NOT NULL, "admin" boolean DEFAULT 'f' NOT NULL, "suspended_at" timestamp, "single_access_token" character varying(255)) 
  [1m[36m (1.1ms)[0m  [1mCREATE INDEX "index_users_on_email" ON "users" ("email")[0m
  [1m[35m (0.9ms)[0m  CREATE INDEX "index_users_on_last_request_at" ON "users" ("last_request_at")
  [1m[36m (1.2ms)[0m  [1mCREATE INDEX "index_users_on_perishable_token" ON "users" ("perishable_token")[0m
  [1m[35m (1.0ms)[0m  CREATE INDEX "index_users_on_remember_token" ON "users" ("persistence_token")
  [1m[36m (1.0ms)[0m  [1mCREATE UNIQUE INDEX "index_users_on_username_and_deleted_at" ON "users" ("username", "deleted_at")[0m
  [1m[35m (4.4ms)[0m  CREATE TABLE "versions" ("id" serial primary key, "item_type" character varying(255) NOT NULL, "item_id" integer NOT NULL, "event" character varying(512) NOT NULL, "whodunnit" character varying(255), "object" text, "created_at" timestamp, "object_changes" text, "related_id" integer, "related_type" character varying(255)) 
  [1m[36m (0.9ms)[0m  [1mCREATE INDEX "index_versions_on_item_type_and_item_id" ON "versions" ("item_type", "item_id")[0m
  [1m[35m (1.8ms)[0m  CREATE INDEX "index_versions_on_whodunnit" ON "versions" ("whodunnit")
  [1m[36m (0.8ms)[0m  [1mCREATE TABLE "schema_migrations" ("version" character varying(255) NOT NULL) [0m
  [1m[35m (1.0ms)[0m  CREATE UNIQUE INDEX "unique_schema_migrations" ON "schema_migrations" ("version")
  [1m[36m (0.2ms)[0m  [1mSELECT version FROM "schema_migrations"[0m
  [1m[35m (0.4ms)[0m  INSERT INTO "schema_migrations" (version) VALUES ('20120528102124')
  [1m[36m (0.2ms)[0m  [1mBEGIN[0m
  [1m[35m (0.6ms)[0m  SELECT COUNT(*) FROM "accounts" 
Started POST "/vend/register_sale" for 127.0.0.1 at 2013-03-13 23:35:24 +1300
Processing by VendController#register_sale as JSON
  Parameters: {"payload"=>"{\n   \"created_at\":\"2013-03-13 10:12:17\",\n   \"customer\":{\n      \"balance\":\"0.000\",\n      \"contact_first_name\":\"Bob\",\n      \"contact_last_name\":\"Waikakte\",\n      \"created_at\":\"2013-03-13 09:51:55\",\n      \"custom_field_1\":\"\",\n      \"custom_field_2\":\"\",\n      \"custom_field_3\":\"\",\n      \"custom_field_4\":\"\",\n      \"customer_code\":\"Bob-4QTY\",\n      \"id\":\"a3ccb1a1-8bc3-11e2-b1f5-4040782fde00\",\n      \"note\":\"\",\n      \"points\":\"0\",\n      \"sex\":\"M\",\n      \"updated_at\":\"2013-03-13 10:11:53\",\n      \"year_to_date\":\"18.90000\"\n   },\n   \"customer_id\":\"a3ccb1a1-8bc3-11e2-b1f5-4040782fde00\",\n   \"id\":\"d66f205d-147e-bec6-29fd-72ec60104b0c\",\n   \"invoice_number\":\"6\",\n   \"market_id\":\"3\",\n   \"register_id\":\"a5834e96-8b10-11e2-b1f5-4040782fde00\",\n   \"register_sale_payments\":[\n      {\n         \"amount\":\"4.95\",\n         \"id\":\"bda69263-a166-20a6-bfc5-234f8596eb8d\",\n         \"payment_date\":\"2013-03-13T10:12:14Z\",\n         \"payment_type_id\":\"1\",\n         \"retailer_payment_type_id\":\"a58d10ac-8b10-11e2-b1f5-4040782fde00\"\n      }\n   ],\n   \"register_sale_products\":[\n      {\n         \"id\":\"f10c6d69-d2b6-d954-ea0c-f065b28bd303\",\n         \"price\":\"4.95000\",\n         \"price_set\":\"0\",\n         \"price_total\":\"4.95\",\n         \"product_id\":\"a5550505-8b10-11e2-b1f5-4040782fde00\",\n         \"quantity\":\"1\",\n         \"tax\":\"0.00000\",\n         \"tax_id\":\"2b12e79e-714e-11df-b0bf-4040f540b50a\",\n         \"tax_name\":\"No Tax\",\n         \"tax_rate\":\"0.000000\",\n         \"tax_total\":\"0\"\n      }\n   ],\n   \"sale_date\":\"2013-03-13T10:12:15Z\",\n   \"short_code\":\"zmi1y8\",\n   \"status\":\"CLOSED\",\n   \"totals\":{\n      \"total_payment\":\"4.95\",\n      \"total_price\":\"4.95\",\n      \"total_tax\":\"0\",\n      \"total_to_pay\":\"0\"\n   },\n   \"updated_at\":\"2013-03-13 10:12:17\",\n   \"user\":{\n      \"created_at\":\"2013-03-12 12:30:38\",\n      \"display_name\":\"A cashier\",\n      \"id\":\"a5952c31-8b10-11e2-b1f5-4040782fde00\",\n      \"name\":\"itdept@crossroads.org.hk\",\n      \"updated_at\":\"2013-03-12 12:30:38\"\n   },\n   \"user_id\":\"a5952c31-8b10-11e2-b1f5-4040782fde00\"\n}"}
  [1m[36mAccount Load (0.5ms)[0m  [1mSELECT "accounts".* FROM "accounts" WHERE "accounts"."cf_vend_customer_id" IS NULL LIMIT 1[0m
  [1m[35m (0.2ms)[0m  SAVEPOINT active_record_1
  [1m[36m (0.8ms)[0m  [1mSELECT "tags".id FROM "tags" INNER JOIN "taggings" ON "tags"."id" = "taggings"."tag_id" WHERE "taggings"."taggable_id" IS NULL AND "taggings"."taggable_type" = 'Account' AND (taggings.context = 'tags')[0m
  [1m[35mFieldGroup Load (0.7ms)[0m  SELECT "field_groups".* FROM "field_groups" WHERE "field_groups"."klass_name" = 'Account' AND (tag_id IS NULL OR tag_id IN (NULL)) ORDER BY position
  [1m[36mAccount Exists (0.4ms)[0m  [1mSELECT 1 AS one FROM "accounts" WHERE ("accounts"."name" = 'Account for Register Sale ' AND "accounts"."deleted_at" IS NULL) LIMIT 1[0m
  [1m[35mSQL (1.8ms)[0m  INSERT INTO "accounts" ("access", "assigned_to", "background_info", "category", "cf_vend_customer_id", "created_at", "deleted_at", "email", "fax", "name", "phone", "rating", "subscribed_users", "toll_free_phone", "updated_at", "user_id", "website") VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9, $10, $11, $12, $13, $14, $15, $16, $17) RETURNING "id"  [["access", "Public"], ["assigned_to", nil], ["background_info", nil], ["category", nil], ["cf_vend_customer_id", nil], ["created_at", Wed, 13 Mar 2013 10:35:24 UTC +00:00], ["deleted_at", nil], ["email", nil], ["fax", nil], ["name", "Account for Register Sale "], ["phone", nil], ["rating", 0], ["subscribed_users", nil], ["toll_free_phone", nil], ["updated_at", Wed, 13 Mar 2013 10:35:24 UTC +00:00], ["user_id", nil], ["website", nil]]
  [1m[36mSQL (1.4ms)[0m  [1mINSERT INTO "versions" ("created_at", "event", "item_id", "item_type", "object", "object_changes", "related_id", "related_type", "whodunnit") VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9) RETURNING "id"[0m  [["created_at", Wed, 13 Mar 2013 10:35:24 UTC +00:00], ["event", "create"], ["item_id", 1], ["item_type", "Account"], ["object", nil], ["object_changes", "--- !map:ActiveSupport::HashWithIndifferentAccess \nname: \n- \"\"\n- \"Account for Register Sale \"\ncreated_at: \n- \n- &id001 2013-03-13 10:35:24.745853 Z\nupdated_at: \n- \n- *id001\nid: \n- \n- 1\n"], ["related_id", nil], ["related_type", nil], ["whodunnit", nil]]
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
